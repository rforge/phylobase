<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>NCL: nxsunalignedblock.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="ncl.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>nxsunalignedblock.cpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//  Copyright (C) 2007 Paul O. Lewis</span>
<a name="l00002"></a>00002 <span class="comment">//</span>
<a name="l00003"></a>00003 <span class="comment">//  This file is part of NCL (Nexus Class Library) version 2.0.</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">//  NCL is free software; you can redistribute it and/or modify</span>
<a name="l00006"></a>00006 <span class="comment">//  it under the terms of the GNU General Public License as published by</span>
<a name="l00007"></a>00007 <span class="comment">//  the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00008"></a>00008 <span class="comment">//  (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment">//</span>
<a name="l00010"></a>00010 <span class="comment">//  NCL is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment">//  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment">//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<a name="l00013"></a>00013 <span class="comment">//  GNU General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment">//</span>
<a name="l00015"></a>00015 <span class="comment">//  You should have received a copy of the GNU General Public License</span>
<a name="l00016"></a>00016 <span class="comment">//  along with NCL; if not, write to the Free Software Foundation, Inc.,</span>
<a name="l00017"></a>00017 <span class="comment">//  59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<a name="l00018"></a>00018 <span class="comment">//</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;climits&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;ncl/nxsunalignedblock.h&quot;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;ncl/nxsreader.h&quot;</span>
<a name="l00024"></a>00024 <span class="keyword">using namespace </span>std;
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="comment">//@POL Note: This file is not yet ready for use (Paul Lewis, 19-May-2007)</span>
<a name="l00027"></a>00027 
<a name="l00034"></a><a class="code" href="classNxsUnalignedBlock_ad3a661c5f927c4d318565632c03ebb0c.html#ad3a661c5f927c4d318565632c03ebb0c">00034</a> <a class="code" href="classNxsUnalignedBlock_ad3a661c5f927c4d318565632c03ebb0c.html#ad3a661c5f927c4d318565632c03ebb0c" title="Initializes `id&amp;#39; to &amp;quot;UNALIGNED&amp;quot;, `taxa&amp;#39; to `tb&amp;#39;, `assumptionsBlock&amp;#39;...">NxsUnalignedBlock::NxsUnalignedBlock</a>(
<a name="l00035"></a>00035   <a class="code" href="classNxsTaxaBlockAPI.html" title="This abstract class describes the interface that every block that wants to serve...">NxsTaxaBlockAPI</a> * tb)         <span class="comment">/* is the taxa block object to consult for taxon labels */</span>
<a name="l00036"></a>00036   : <a class="code" href="classNxsBlock.html" title="This is the base class from which all block classes are derived.">NxsBlock</a>(),
<a name="l00037"></a>00037   <a class="code" href="classNxsTaxaBlockSurrogate.html" title="This class is the base class for blocks that can (in a pinch) serve as a TAXA block...">NxsTaxaBlockSurrogate</a>(tb, NULL)
<a name="l00038"></a>00038     {
<a name="l00039"></a>00039     <span class="keywordtype">id</span> = <span class="stringliteral">&quot;UNALIGNED&quot;</span>;
<a name="l00040"></a>00040     <a class="code" href="classNxsUnalignedBlock_a09af4c6bf421dc24aed22d5e064497ae.html#a09af4c6bf421dc24aed22d5e064497ae" title="Returns NxsUnalignedBlock object to the state it was in when first created.">Reset</a>();
<a name="l00041"></a>00041     }
<a name="l00042"></a>00042 
<a name="l00047"></a><a class="code" href="classNxsUnalignedBlock_a18574c9dd79fd45e818eb9daf5b065ff.html#a18574c9dd79fd45e818eb9daf5b065ff">00047</a> <a class="code" href="classNxsUnalignedBlock_a18574c9dd79fd45e818eb9daf5b065ff.html#a18574c9dd79fd45e818eb9daf5b065ff" title="Deletes any memory allocated to the arrays `symbols&amp;#39;, `taxonPos&amp;#39; and `activeTaxon&amp;#39;...">NxsUnalignedBlock::~NxsUnalignedBlock</a>()
<a name="l00048"></a>00048     {
<a name="l00049"></a>00049     <a class="code" href="classNxsUnalignedBlock_a09af4c6bf421dc24aed22d5e064497ae.html#a09af4c6bf421dc24aed22d5e064497ae" title="Returns NxsUnalignedBlock object to the state it was in when first created.">Reset</a>();
<a name="l00050"></a>00050     }
<a name="l00051"></a>00051 
<a name="l00056"></a><a class="code" href="classNxsUnalignedBlock_a09af4c6bf421dc24aed22d5e064497ae.html#a09af4c6bf421dc24aed22d5e064497ae">00056</a> <span class="keywordtype">void</span> <a class="code" href="classNxsUnalignedBlock_a09af4c6bf421dc24aed22d5e064497ae.html#a09af4c6bf421dc24aed22d5e064497ae" title="Returns NxsUnalignedBlock object to the state it was in when first created.">NxsUnalignedBlock::Reset</a>()
<a name="l00057"></a>00057     {
<a name="l00058"></a>00058     <a class="code" href="classNxsUnalignedBlock_a09af4c6bf421dc24aed22d5e064497ae.html#a09af4c6bf421dc24aed22d5e064497ae" title="Returns NxsUnalignedBlock object to the state it was in when first created.">NxsBlock::Reset</a>();
<a name="l00059"></a>00059     ResetSurrogate();
<a name="l00060"></a>00060     nTaxWithData = 0;
<a name="l00061"></a>00061     newtaxa             = <span class="keyword">false</span>;
<a name="l00062"></a>00062     respectingCase      = <span class="keyword">false</span>;
<a name="l00063"></a>00063     labels              = <span class="keyword">true</span>;
<a name="l00064"></a>00064     originalDatatype = datatype = NxsCharactersBlock::standard;
<a name="l00065"></a>00065     missing             = <span class="charliteral">&#39;?&#39;</span>;
<a name="l00066"></a>00066     <a class="code" href="classNxsUnalignedBlock_a7f9d272e707eb0529785967d4c97dd9c.html#a7f9d272e707eb0529785967d4c97dd9c" title="Resets standard symbol set after a change in `datatype&amp;#39; is made.">ResetSymbols</a>(); <span class="comment">// also resets equates</span>
<a name="l00067"></a>00067     nChar = 0;
<a name="l00068"></a>00068     uMatrix.clear();
<a name="l00069"></a>00069     }
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="keywordtype">void</span> NxsUnalignedBlock::ResetDatatypeMapper()
<a name="l00073"></a>00073     {
<a name="l00074"></a>00074     mapper = <a class="code" href="classNxsDiscreteDatatypeMapper.html" title="This class stores the information needed to map the internal storage for a cell of...">NxsDiscreteDatatypeMapper</a>(datatype, symbols, missing, <span class="charliteral">&#39;\0&#39;</span>, matchchar, respectingCase, equates);
<a name="l00075"></a>00075     datatype = mapper.GetDatatype();
<a name="l00076"></a>00076     }
<a name="l00081"></a><a class="code" href="classNxsUnalignedBlock_a7f9d272e707eb0529785967d4c97dd9c.html#a7f9d272e707eb0529785967d4c97dd9c">00081</a> <span class="keywordtype">void</span> <a class="code" href="classNxsUnalignedBlock_a7f9d272e707eb0529785967d4c97dd9c.html#a7f9d272e707eb0529785967d4c97dd9c" title="Resets standard symbol set after a change in `datatype&amp;#39; is made.">NxsUnalignedBlock::ResetSymbols</a>()
<a name="l00082"></a>00082     {
<a name="l00083"></a>00083     <span class="keywordflow">switch</span>(datatype)
<a name="l00084"></a>00084         {
<a name="l00085"></a>00085         <span class="keywordflow">case</span> <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290caa9ca7e6de7b65840b97d9ecd42c0ad3a" title="indicates `matrix&amp;#39; holds RNA sequences (states A, C, G, U)">NxsCharactersBlock::nucleotide</a>:
<a name="l00086"></a>00086         <span class="keywordflow">case</span> <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca0145b9755a4581acaabe1e4c458d7f73" title="indicates `matrix&amp;#39; holds characters with arbitrarily-assigned, discrete states...">NxsCharactersBlock::dna</a>:
<a name="l00087"></a>00087             symbols =  <span class="stringliteral">&quot;ACGT&quot;</span>;
<a name="l00088"></a>00088             <span class="keywordflow">break</span>;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090         <span class="keywordflow">case</span> <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca9cb7e8ceb8521a96df0b81ecac913814" title="indicates `matrix&amp;#39; holds DNA sequences (states A, C, G, T)">NxsCharactersBlock::rna</a>:
<a name="l00091"></a>00091             symbols = <span class="stringliteral">&quot;ACGU&quot;</span>;
<a name="l00092"></a>00092             <span class="keywordflow">break</span>;
<a name="l00093"></a>00093 
<a name="l00094"></a>00094         <span class="keywordflow">case</span> <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca6867b9b05a5ce824179b5bdf10c891fc" title="indicates `matrix&amp;#39; holds nucleotide sequences">NxsCharactersBlock::protein</a>:
<a name="l00095"></a>00095             symbols =  <span class="stringliteral">&quot;ACDEFGHIKLMNPQRSTVWY*&quot;</span>;
<a name="l00096"></a>00096             <span class="keywordflow">break</span>;
<a name="l00097"></a>00097 
<a name="l00098"></a>00098         <span class="keywordflow">default</span>:
<a name="l00099"></a>00099             symbols = <span class="stringliteral">&quot;01&quot;</span>;
<a name="l00100"></a>00100         }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     equates.clear();
<a name="l00103"></a>00103     this-&gt;equates = NxsCharactersBlock::GetDefaultEquates(datatype);
<a name="l00104"></a>00104     ResetDatatypeMapper();
<a name="l00105"></a>00105     }
<a name="l00111"></a><a class="code" href="classNxsUnalignedBlock_a369571721700328c851fd21ecadc7bd7.html#a369571721700328c851fd21ecadc7bd7">00111</a> <span class="keywordtype">void</span> <a class="code" href="classNxsUnalignedBlock_a369571721700328c851fd21ecadc7bd7.html#a369571721700328c851fd21ecadc7bd7" title="Provides a dump of the contents of the `uMatrix&amp;#39; variable.">NxsUnalignedBlock::DebugShowMatrix</a>(
<a name="l00112"></a>00112   std::ostream &amp; out,       <span class="comment">/* is the output stream on which to print */</span>
<a name="l00113"></a>00113   <span class="keyword">const</span> <span class="keywordtype">char</span> * marginText) NCL_COULD_BE_CONST <span class="comment">/* is text printed first on each line */</span> <span class="comment">/*v2.1to2.2 1 */</span>
<a name="l00114"></a>00114     {
<a name="l00115"></a>00115     <span class="keywordflow">if</span> (!taxa)
<a name="l00116"></a>00116         <span class="keywordflow">return</span>;
<a name="l00117"></a>00117     <span class="keywordtype">unsigned</span> width = taxa-&gt;GetMaxTaxonLabelLength();
<a name="l00118"></a>00118     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ntt = GetNTaxTotal();
<a name="l00119"></a>00119     NCL_ASSERT(uMatrix.size() &gt;= ntt);
<a name="l00120"></a>00120     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; ntt; i++)
<a name="l00121"></a>00121         {
<a name="l00122"></a>00122         <span class="keyword">const</span> NxsDiscreteStateRow * row = GetDiscreteMatrixRow(i);
<a name="l00123"></a>00123         <span class="keywordflow">if</span> (row &amp;&amp; !(row-&gt;empty()))
<a name="l00124"></a>00124             {
<a name="l00125"></a>00125             <span class="keywordflow">if</span> (marginText != NULL)
<a name="l00126"></a>00126                 out &lt;&lt; marginText;
<a name="l00127"></a>00127             <span class="keyword">const</span> <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> currTaxonLabel = taxa-&gt;GetTaxonLabel(i); <span class="comment">/*v2.1to2.2 4 */</span>
<a name="l00128"></a>00128             out &lt;&lt; currTaxonLabel;
<a name="l00129"></a>00129             <span class="keywordtype">unsigned</span> currTaxonLabelLen = (unsigned)currTaxonLabel.size();
<a name="l00130"></a>00130             <span class="keywordtype">unsigned</span> diff = width - currTaxonLabelLen;
<a name="l00131"></a>00131             std::string spacer(diff+5, <span class="charliteral">&#39; &#39;</span>);
<a name="l00132"></a>00132             out &lt;&lt; spacer;
<a name="l00133"></a>00133             mapper.WriteStateCodeRowAsNexus(out, *row);
<a name="l00134"></a>00134             }
<a name="l00135"></a>00135         }
<a name="l00136"></a>00136     }
<a name="l00137"></a>00137 
<a name="l00141"></a><a class="code" href="classNxsUnalignedBlock_a6a15c0afdf8f563e7a2e87adf4b2018f.html#a6a15c0afdf8f563e7a2e87adf4b2018f">00141</a> std::string <a class="code" href="classNxsUnalignedBlock_a6a15c0afdf8f563e7a2e87adf4b2018f.html#a6a15c0afdf8f563e7a2e87adf4b2018f" title="Returns a string containing a formatted representation of the state `x&amp;#39;.">NxsUnalignedBlock::FormatState</a>(
<a name="l00142"></a>00142   <a class="code" href="classNxsDiscreteDatum.html" title="Reference to a cell in a DiscreteMatrix.">NxsDiscreteDatum</a> d)       <span class="comment">/* is the element of `uMatrix&#39; to format */</span><span class="keyword"></span>
<a name="l00143"></a>00143 <span class="keyword">  const</span>
<a name="l00144"></a>00144 <span class="keyword">    </span>{
<a name="l00145"></a>00145     <span class="keywordflow">if</span> (d.taxInd &gt;= <a class="code" href="classNxsUnalignedBlock_ae40607f8ee9b891e2abf13482081b276.html#ae40607f8ee9b891e2abf13482081b276" title="Returns the number of taxa in the taxa block associated with the unaligned block...">GetNTaxTotal</a>())
<a name="l00146"></a>00146         <span class="keywordflow">throw</span> <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(<span class="stringliteral">&quot;Taxon out of range in NxsUnalignedBlock::FormatState&quot;</span>);
<a name="l00147"></a>00147     <span class="keyword">const</span> NxsDiscreteStateRow &amp; row = uMatrix[d.taxInd];
<a name="l00148"></a>00148     <span class="keywordflow">if</span> (d.charInd &gt;= row.size())
<a name="l00149"></a>00149         <span class="keywordflow">return</span> std::string(1, missing);
<a name="l00150"></a>00150     <span class="keywordflow">return</span> mapper.<a class="code" href="classNxsDiscreteDatatypeMapper_ab8641f24c773df5d85b862c854fd705e.html#ab8641f24c773df5d85b862c854fd705e" title="Returns the NEXUS reperesenation of the state code `scode` which may be a multiple...">StateCodeToNexusString</a>(row[d.charInd]);
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152 
<a name="l00157"></a><a class="code" href="classNxsUnalignedBlock_a6fec9291655df9f0d77a6182a7da41e5.html#a6fec9291655df9f0d77a6182a7da41e5">00157</a> <span class="keywordtype">bool</span> <a class="code" href="classNxsUnalignedBlock_a6fec9291655df9f0d77a6182a7da41e5.html#a6fec9291655df9f0d77a6182a7da41e5" title="Returns true if `ch&amp;#39; can be found in the `symbols&amp;#39; array.">NxsUnalignedBlock::IsInSymbols</a>(
<a name="l00158"></a>00158   <span class="keywordtype">char</span> ch)  <span class="comment">/* the symbol character to search for */</span>
<a name="l00159"></a>00159     {
<a name="l00160"></a>00160     <span class="keywordtype">char</span> char_in_question = (respectingCase ? ch : (char)toupper(ch));
<a name="l00161"></a>00161     <span class="keywordflow">for</span> (std::string::const_iterator sIt = symbols.begin(); sIt != symbols.end(); ++sIt)
<a name="l00162"></a>00162         {
<a name="l00163"></a>00163         <span class="keyword">const</span> <span class="keywordtype">char</span> char_in_symbols = (respectingCase ? *sIt : (char)toupper(*sIt));
<a name="l00164"></a>00164         <span class="keywordflow">if</span> (char_in_symbols == char_in_question)
<a name="l00165"></a>00165             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00166"></a>00166         }
<a name="l00167"></a>00167     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00168"></a>00168     }
<a name="l00169"></a>00169 
<a name="l00174"></a><a class="code" href="classNxsUnalignedBlock_a481990bc1a73bb3ee04b700701b94ac2.html#a481990bc1a73bb3ee04b700701b94ac2">00174</a> <span class="keywordtype">void</span> <a class="code" href="classNxsUnalignedBlock_a481990bc1a73bb3ee04b700701b94ac2.html#a481990bc1a73bb3ee04b700701b94ac2" title="Called when DIMENSIONS command needs to be parsed from within the UNALIGNED block...">NxsUnalignedBlock::HandleDimensions</a>(
<a name="l00175"></a>00175   <a class="code" href="classNxsToken.html">NxsToken</a> &amp; token)         <span class="comment">/* the token used to read from `in&#39; */</span>
<a name="l00176"></a>00176     {
<a name="l00177"></a>00177     <span class="keywordtype">unsigned</span> ntaxRead = 0;
<a name="l00178"></a>00178     <span class="keywordflow">for</span> (;;)
<a name="l00179"></a>00179         {
<a name="l00180"></a>00180         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l00181"></a>00181         <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;NEWTAXA&quot;</span>))
<a name="l00182"></a>00182             newtaxa = <span class="keyword">true</span>;
<a name="l00183"></a>00183         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;NTAX&quot;</span>))
<a name="l00184"></a>00184             {
<a name="l00185"></a>00185             <a class="code" href="classNxsBlock_aee6771bdd0c70f375d925c4e0b6d1095.html#aee6771bdd0c70f375d925c4e0b6d1095" title="Advances the token, and raise an exception if it is not an equals sign.">DemandEquals</a>(token, <span class="stringliteral">&quot;after NTAX in DIMENSIONS command&quot;</span>);
<a name="l00186"></a>00186             ntaxRead = <a class="code" href="classNxsBlock_a67feaaa54959cb9faa9cbfaaa67b7ce2.html#a67feaaa54959cb9faa9cbfaaa67b7ce2" title="Advances the token, and returns the unsigned int that the token represents.">DemandPositiveInt</a>(token, <span class="stringliteral">&quot;NTAX&quot;</span>);
<a name="l00187"></a>00187             }
<a name="l00188"></a>00188         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;;&quot;</span>))
<a name="l00189"></a>00189             <span class="keywordflow">break</span>;
<a name="l00190"></a>00190         }
<a name="l00191"></a>00191     <span class="keywordflow">if</span> (newtaxa)
<a name="l00192"></a>00192         {
<a name="l00193"></a>00193         <span class="keywordflow">if</span> (ntaxRead == 0)
<a name="l00194"></a>00194             {
<a name="l00195"></a>00195             errormsg = <span class="stringliteral">&quot;DIMENSIONS command must have an NTAX subcommand when the NEWTAXA option is in effect.&quot;</span>;
<a name="l00196"></a>00196             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l00197"></a>00197             }
<a name="l00198"></a>00198         AssureTaxaBlock(createImpliedBlock, token, <span class="stringliteral">&quot;Dimensions&quot;</span>);
<a name="l00199"></a>00199         <span class="keywordflow">if</span> (!createImpliedBlock)
<a name="l00200"></a>00200             {
<a name="l00201"></a>00201             taxa-&gt;<a class="code" href="classNxsBlock_a3642d732dd82298ef2f35a7b83b97719.html#a3642d732dd82298ef2f35a7b83b97719" title="This virtual function should be overridden for each derived class to completely reset...">Reset</a>();
<a name="l00202"></a>00202             <span class="keywordflow">if</span> (nexusReader)
<a name="l00203"></a>00203                 nexusReader-&gt;<a class="code" href="classNxsReader_ad05c38b8d256b9acca8be01f645d9f9e.html#ad05c38b8d256b9acca8be01f645d9f9e" title="Removes a block from the NxsReader&amp;#39;s records.">RemoveBlockFromUsedBlockList</a>(taxa);
<a name="l00204"></a>00204             }
<a name="l00205"></a>00205         taxa-&gt;<a class="code" href="classNxsTaxaBlockAPI_a83f32ad078abc3afc501ede2780cc655.html#a83f32ad078abc3afc501ede2780cc655" title="Sets the number of taxa to be included in the block.">SetNtax</a>(ntaxRead);
<a name="l00206"></a>00206         nTaxWithData = ntaxRead;
<a name="l00207"></a>00207         }
<a name="l00208"></a>00208     <span class="keywordflow">else</span>
<a name="l00209"></a>00209         {
<a name="l00210"></a>00210         AssureTaxaBlock(<span class="keyword">false</span>, token, <span class="stringliteral">&quot;Dimensions&quot;</span>);
<a name="l00211"></a>00211         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ntaxinblock = taxa-&gt;<a class="code" href="classNxsTaxaBlockAPI_a3e9b998d97ad05914bda0d616069c26f.html#a3e9b998d97ad05914bda0d616069c26f">GetNTax</a>();
<a name="l00212"></a>00212         <span class="keywordflow">if</span> (ntaxinblock == 0)
<a name="l00213"></a>00213             {
<a name="l00214"></a>00214             errormsg = <span class="stringliteral">&quot;A TAXA block must be read before character data, or the DIMENSIONS command must use the NEWTAXA.&quot;</span>;
<a name="l00215"></a>00215             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l00216"></a>00216             }
<a name="l00217"></a>00217         <span class="keywordflow">if</span> (ntaxinblock &lt; ntaxRead)
<a name="l00218"></a>00218             {
<a name="l00219"></a>00219             errormsg = <span class="stringliteral">&quot;NTAX in UNALIGNED block must be less than or equal to NTAX in TAXA block\nNote: one circumstance that can cause this error is \nforgetting to specify NTAX in DIMENSIONS command when \na TAXA block has not been provided&quot;</span>;
<a name="l00220"></a>00220             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token.<a class="code" href="classNxsToken_a17e5caf91acc756c23159f76f8b2d0fd.html#a17e5caf91acc756c23159f76f8b2d0fd" title="Returns value stored in filepos, which keeps track of the current position in the...">GetFilePosition</a>(), token.<a class="code" href="classNxsToken_ae0fb11bf350d907295447864afa714ec.html#ae0fb11bf350d907295447864afa714ec" title="Returns value stored in `fileline&amp;#39;, which keeps track of the current line in...">GetFileLine</a>(), token.<a class="code" href="classNxsToken_a7272fd1469fa6424086a95ec4f92eab0.html#a7272fd1469fa6424086a95ec4f92eab0" title="Returns value stored in `filecol&amp;#39;, which keeps track of the current column in...">GetFileColumn</a>());
<a name="l00221"></a>00221             }
<a name="l00222"></a>00222         nTaxWithData = (ntaxRead == 0 ? ntaxinblock : ntaxRead);
<a name="l00223"></a>00223         }
<a name="l00224"></a>00224     }
<a name="l00225"></a>00225 
<a name="l00233"></a><a class="code" href="classNxsUnalignedBlock_a8497907c680a040c93568f248882cf62.html#a8497907c680a040c93568f248882cf62">00233</a> <span class="keywordtype">void</span> <a class="code" href="classNxsUnalignedBlock_a8497907c680a040c93568f248882cf62.html#a8497907c680a040c93568f248882cf62" title="Called when the END or ENDBLOCK command needs to be parsed from within the UNALIGNED...">NxsUnalignedBlock::HandleEndblock</a>(
<a name="l00234"></a>00234   <a class="code" href="classNxsToken.html">NxsToken</a> &amp; token)     <span class="comment">/* the token used to read from `in&#39; */</span>
<a name="l00235"></a>00235     {
<a name="l00236"></a>00236     DemandEndSemicolon(token, <span class="stringliteral">&quot;END or ENDBLOCK&quot;</span>);
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238 
<a name="l00243"></a><a class="code" href="classNxsUnalignedBlock_ad388c00f7eb08ac4ddbbda9fa7cfe12c.html#ad388c00f7eb08ac4ddbbda9fa7cfe12c">00243</a> <span class="keywordtype">void</span> <a class="code" href="classNxsUnalignedBlock_ad388c00f7eb08ac4ddbbda9fa7cfe12c.html#ad388c00f7eb08ac4ddbbda9fa7cfe12c" title="Called when FORMAT command needs to be parsed from within the DIMENSIONS block.">NxsUnalignedBlock::HandleFormat</a>(
<a name="l00244"></a>00244   <a class="code" href="classNxsToken.html">NxsToken</a> &amp; token) <span class="comment">/* is the token used to read from `in&#39; */</span>
<a name="l00245"></a>00245     {
<a name="l00246"></a>00246     <span class="keywordtype">bool</span> standardDataTypeAssumed = <span class="keyword">false</span>;
<a name="l00247"></a>00247     <span class="keywordtype">bool</span> ignoreCaseAssumed = <span class="keyword">false</span>;
<a name="l00248"></a>00248 
<a name="l00249"></a>00249     <span class="keywordflow">for</span> (;;)
<a name="l00250"></a>00250         {
<a name="l00251"></a>00251         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l00252"></a>00252 
<a name="l00253"></a>00253         <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;DATATYPE&quot;</span>))
<a name="l00254"></a>00254             {
<a name="l00255"></a>00255             <a class="code" href="classNxsBlock_aee6771bdd0c70f375d925c4e0b6d1095.html#aee6771bdd0c70f375d925c4e0b6d1095" title="Advances the token, and raise an exception if it is not an equals sign.">DemandEquals</a>(token, <span class="stringliteral">&quot;after keyword DATATYPE&quot;</span>);
<a name="l00256"></a>00256             <span class="comment">// This should be one of the following: STANDARD, DNA, RNA, NUCLEOTIDE or PROTEIN</span>
<a name="l00257"></a>00257             token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l00258"></a>00258 
<a name="l00259"></a>00259             <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;STANDARD&quot;</span>))
<a name="l00260"></a>00260                 datatype = NxsCharactersBlock::standard;
<a name="l00261"></a>00261             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;DNA&quot;</span>))
<a name="l00262"></a>00262                 datatype = <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca0145b9755a4581acaabe1e4c458d7f73" title="indicates `matrix&amp;#39; holds characters with arbitrarily-assigned, discrete states...">NxsCharactersBlock::dna</a>;
<a name="l00263"></a>00263             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;RNA&quot;</span>))
<a name="l00264"></a>00264                 datatype = <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca9cb7e8ceb8521a96df0b81ecac913814" title="indicates `matrix&amp;#39; holds DNA sequences (states A, C, G, T)">NxsCharactersBlock::rna</a>;
<a name="l00265"></a>00265             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;NUCLEOTIDE&quot;</span>))
<a name="l00266"></a>00266                 datatype = <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290caa9ca7e6de7b65840b97d9ecd42c0ad3a" title="indicates `matrix&amp;#39; holds RNA sequences (states A, C, G, U)">NxsCharactersBlock::nucleotide</a>;
<a name="l00267"></a>00267             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;PROTEIN&quot;</span>))
<a name="l00268"></a>00268                 datatype = <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca6867b9b05a5ce824179b5bdf10c891fc" title="indicates `matrix&amp;#39; holds nucleotide sequences">NxsCharactersBlock::protein</a>;
<a name="l00269"></a>00269             <span class="keywordflow">else</span>
<a name="l00270"></a>00270                 {
<a name="l00271"></a>00271                 errormsg = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l00272"></a>00272                 errormsg += <span class="stringliteral">&quot; is not a valid DATATYPE within a &quot;</span>;
<a name="l00273"></a>00273                 errormsg += id;
<a name="l00274"></a>00274                 errormsg += <span class="stringliteral">&quot; block&quot;</span>;
<a name="l00275"></a>00275                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token.<a class="code" href="classNxsToken_a17e5caf91acc756c23159f76f8b2d0fd.html#a17e5caf91acc756c23159f76f8b2d0fd" title="Returns value stored in filepos, which keeps track of the current position in the...">GetFilePosition</a>(), token.<a class="code" href="classNxsToken_ae0fb11bf350d907295447864afa714ec.html#ae0fb11bf350d907295447864afa714ec" title="Returns value stored in `fileline&amp;#39;, which keeps track of the current line in...">GetFileLine</a>(), token.<a class="code" href="classNxsToken_a7272fd1469fa6424086a95ec4f92eab0.html#a7272fd1469fa6424086a95ec4f92eab0" title="Returns value stored in `filecol&amp;#39;, which keeps track of the current column in...">GetFileColumn</a>());
<a name="l00276"></a>00276                 }
<a name="l00277"></a>00277             <span class="keywordflow">if</span> (standardDataTypeAssumed &amp;&amp; datatype != NxsCharactersBlock::standard)
<a name="l00278"></a>00278                 {
<a name="l00279"></a>00279                 errormsg = <span class="stringliteral">&quot;DATATYPE must be specified first in FORMAT command&quot;</span>;
<a name="l00280"></a>00280                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token.<a class="code" href="classNxsToken_a17e5caf91acc756c23159f76f8b2d0fd.html#a17e5caf91acc756c23159f76f8b2d0fd" title="Returns value stored in filepos, which keeps track of the current position in the...">GetFilePosition</a>(), token.<a class="code" href="classNxsToken_ae0fb11bf350d907295447864afa714ec.html#ae0fb11bf350d907295447864afa714ec" title="Returns value stored in `fileline&amp;#39;, which keeps track of the current line in...">GetFileLine</a>(), token.<a class="code" href="classNxsToken_a7272fd1469fa6424086a95ec4f92eab0.html#a7272fd1469fa6424086a95ec4f92eab0" title="Returns value stored in `filecol&amp;#39;, which keeps track of the current column in...">GetFileColumn</a>());
<a name="l00281"></a>00281                 }
<a name="l00282"></a>00282             originalDatatype = datatype;
<a name="l00283"></a>00283             <a class="code" href="classNxsUnalignedBlock_a7f9d272e707eb0529785967d4c97dd9c.html#a7f9d272e707eb0529785967d4c97dd9c" title="Resets standard symbol set after a change in `datatype&amp;#39; is made.">ResetSymbols</a>();
<a name="l00284"></a>00284             }
<a name="l00285"></a>00285         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;RESPECTCASE&quot;</span>))
<a name="l00286"></a>00286             {
<a name="l00287"></a>00287             <span class="keywordflow">if</span> (ignoreCaseAssumed)
<a name="l00288"></a>00288                 {
<a name="l00289"></a>00289                 errormsg = <span class="stringliteral">&quot;RESPECTCASE must be specified before MISSING and SYMBOLS in FORMAT command&quot;</span>;
<a name="l00290"></a>00290                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token.<a class="code" href="classNxsToken_a17e5caf91acc756c23159f76f8b2d0fd.html#a17e5caf91acc756c23159f76f8b2d0fd" title="Returns value stored in filepos, which keeps track of the current position in the...">GetFilePosition</a>(), token.<a class="code" href="classNxsToken_ae0fb11bf350d907295447864afa714ec.html#ae0fb11bf350d907295447864afa714ec" title="Returns value stored in `fileline&amp;#39;, which keeps track of the current line in...">GetFileLine</a>(), token.<a class="code" href="classNxsToken_a7272fd1469fa6424086a95ec4f92eab0.html#a7272fd1469fa6424086a95ec4f92eab0" title="Returns value stored in `filecol&amp;#39;, which keeps track of the current column in...">GetFileColumn</a>());
<a name="l00291"></a>00291                 }
<a name="l00292"></a>00292             standardDataTypeAssumed = <span class="keyword">true</span>;
<a name="l00293"></a>00293             respectingCase = <span class="keyword">true</span>;
<a name="l00294"></a>00294             }
<a name="l00295"></a>00295         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;MISSING&quot;</span>))
<a name="l00296"></a>00296             {
<a name="l00297"></a>00297             <a class="code" href="classNxsBlock_aee6771bdd0c70f375d925c4e0b6d1095.html#aee6771bdd0c70f375d925c4e0b6d1095" title="Advances the token, and raise an exception if it is not an equals sign.">DemandEquals</a>(token, <span class="stringliteral">&quot;after keyword MISSING&quot;</span>);
<a name="l00298"></a>00298             <span class="comment">// This should be the missing data symbol (single character)</span>
<a name="l00299"></a>00299             token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l00300"></a>00300 
<a name="l00301"></a>00301             <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a8231aba780039e4ef1fe2fbf24e21dba.html#a8231aba780039e4ef1fe2fbf24e21dba" title="Returns token.size().">GetTokenLength</a>() != 1)
<a name="l00302"></a>00302                 {
<a name="l00303"></a>00303                 errormsg = <span class="stringliteral">&quot;MISSING symbol should be a single character, but &quot;</span>;
<a name="l00304"></a>00304                 errormsg += token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l00305"></a>00305                 errormsg += <span class="stringliteral">&quot; was specified&quot;</span>;
<a name="l00306"></a>00306                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token.<a class="code" href="classNxsToken_a17e5caf91acc756c23159f76f8b2d0fd.html#a17e5caf91acc756c23159f76f8b2d0fd" title="Returns value stored in filepos, which keeps track of the current position in the...">GetFilePosition</a>(), token.<a class="code" href="classNxsToken_ae0fb11bf350d907295447864afa714ec.html#ae0fb11bf350d907295447864afa714ec" title="Returns value stored in `fileline&amp;#39;, which keeps track of the current line in...">GetFileLine</a>(), token.<a class="code" href="classNxsToken_a7272fd1469fa6424086a95ec4f92eab0.html#a7272fd1469fa6424086a95ec4f92eab0" title="Returns value stored in `filecol&amp;#39;, which keeps track of the current column in...">GetFileColumn</a>());
<a name="l00307"></a>00307                 }
<a name="l00308"></a>00308             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a0e5bcf6a302bf475420b28036a218b51.html#a0e5bcf6a302bf475420b28036a218b51" title="Returns true if current token is a single character and this character is a punctuation...">IsPunctuationToken</a>() &amp;&amp; !token.<a class="code" href="classNxsToken_af75d27ce09e09c66c838ad61e13839f7.html#af75d27ce09e09c66c838ad61e13839f7" title="Returns true if current token is a single character and this character is either...">IsPlusMinusToken</a>())
<a name="l00309"></a>00309                 {
<a name="l00310"></a>00310                 errormsg = <span class="stringliteral">&quot;MISSING symbol specified cannot be a punctuation token (&quot;</span>;
<a name="l00311"></a>00311                 errormsg += token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l00312"></a>00312                 errormsg += <span class="stringliteral">&quot; was specified)&quot;</span>;
<a name="l00313"></a>00313                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token.<a class="code" href="classNxsToken_a17e5caf91acc756c23159f76f8b2d0fd.html#a17e5caf91acc756c23159f76f8b2d0fd" title="Returns value stored in filepos, which keeps track of the current position in the...">GetFilePosition</a>(), token.<a class="code" href="classNxsToken_ae0fb11bf350d907295447864afa714ec.html#ae0fb11bf350d907295447864afa714ec" title="Returns value stored in `fileline&amp;#39;, which keeps track of the current line in...">GetFileLine</a>(), token.<a class="code" href="classNxsToken_a7272fd1469fa6424086a95ec4f92eab0.html#a7272fd1469fa6424086a95ec4f92eab0" title="Returns value stored in `filecol&amp;#39;, which keeps track of the current column in...">GetFileColumn</a>());
<a name="l00314"></a>00314                 }
<a name="l00315"></a>00315             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_ada43d5e71e16665d7f20874bd6fb6641.html#ada43d5e71e16665d7f20874bd6fb6641" title="Returns true if current token is a single character and this character is a whitespace...">IsWhitespaceToken</a>())
<a name="l00316"></a>00316                 {
<a name="l00317"></a>00317                 errormsg = <span class="stringliteral">&quot;MISSING symbol specified cannot be a whitespace character (&quot;</span>;
<a name="l00318"></a>00318                 errormsg += token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l00319"></a>00319                 errormsg += <span class="stringliteral">&quot; was specified)&quot;</span>;
<a name="l00320"></a>00320                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token.<a class="code" href="classNxsToken_a17e5caf91acc756c23159f76f8b2d0fd.html#a17e5caf91acc756c23159f76f8b2d0fd" title="Returns value stored in filepos, which keeps track of the current position in the...">GetFilePosition</a>(), token.<a class="code" href="classNxsToken_ae0fb11bf350d907295447864afa714ec.html#ae0fb11bf350d907295447864afa714ec" title="Returns value stored in `fileline&amp;#39;, which keeps track of the current line in...">GetFileLine</a>(), token.<a class="code" href="classNxsToken_a7272fd1469fa6424086a95ec4f92eab0.html#a7272fd1469fa6424086a95ec4f92eab0" title="Returns value stored in `filecol&amp;#39;, which keeps track of the current column in...">GetFileColumn</a>());
<a name="l00321"></a>00321                 }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323             missing = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>()[0];
<a name="l00324"></a>00324 
<a name="l00325"></a>00325             ignoreCaseAssumed = <span class="keyword">true</span>;
<a name="l00326"></a>00326             standardDataTypeAssumed = <span class="keyword">true</span>;
<a name="l00327"></a>00327             }
<a name="l00328"></a>00328         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;SYMBOLS&quot;</span>) || token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;SYMBOL&quot;</span>))
<a name="l00329"></a>00329             {
<a name="l00330"></a>00330             NxsDiscreteStateCell numDefStates;
<a name="l00331"></a>00331             <span class="keywordtype">unsigned</span> maxNewStates;
<a name="l00332"></a>00332             <span class="keywordflow">switch</span>(datatype)
<a name="l00333"></a>00333                 {
<a name="l00334"></a>00334                 <span class="keywordflow">case</span> <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca0145b9755a4581acaabe1e4c458d7f73" title="indicates `matrix&amp;#39; holds characters with arbitrarily-assigned, discrete states...">NxsCharactersBlock::dna</a>:
<a name="l00335"></a>00335                 <span class="keywordflow">case</span> <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca9cb7e8ceb8521a96df0b81ecac913814" title="indicates `matrix&amp;#39; holds DNA sequences (states A, C, G, T)">NxsCharactersBlock::rna</a>:
<a name="l00336"></a>00336                 <span class="keywordflow">case</span> <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290caa9ca7e6de7b65840b97d9ecd42c0ad3a" title="indicates `matrix&amp;#39; holds RNA sequences (states A, C, G, U)">NxsCharactersBlock::nucleotide</a>:
<a name="l00337"></a>00337                     numDefStates = 4;
<a name="l00338"></a>00338                     maxNewStates = NCL_MAX_STATES-4;
<a name="l00339"></a>00339                     <span class="keywordflow">break</span>;
<a name="l00340"></a>00340                 <span class="keywordflow">case</span> <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca6867b9b05a5ce824179b5bdf10c891fc" title="indicates `matrix&amp;#39; holds nucleotide sequences">NxsCharactersBlock::protein</a>:
<a name="l00341"></a>00341                     numDefStates = 21;
<a name="l00342"></a>00342                     maxNewStates = NCL_MAX_STATES-21;
<a name="l00343"></a>00343                     <span class="keywordflow">break</span>;
<a name="l00344"></a>00344                 <span class="keywordflow">default</span>:
<a name="l00345"></a>00345                     numDefStates = 0; <span class="comment">// replace symbols list for standard datatype</span>
<a name="l00346"></a>00346                     symbols[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00347"></a>00347                     maxNewStates = NCL_MAX_STATES;
<a name="l00348"></a>00348                 }
<a name="l00349"></a>00349             <a class="code" href="classNxsBlock_aee6771bdd0c70f375d925c4e0b6d1095.html#aee6771bdd0c70f375d925c4e0b6d1095" title="Advances the token, and raise an exception if it is not an equals sign.">DemandEquals</a>(token, <span class="stringliteral">&quot;after keyword SYMBOLS&quot;</span>);
<a name="l00350"></a>00350 
<a name="l00351"></a>00351             <span class="comment">// This should be the symbols list</span>
<a name="l00352"></a>00352             token.<a class="code" href="classNxsToken_afa5232738ca19e069173e8befe75e730.html#afa5232738ca19e069173e8befe75e730" title="Sets the bit specified in the variable `labileFlags&amp;#39;.">SetLabileFlagBit</a>(NxsToken::doubleQuotedToken);
<a name="l00353"></a>00353             token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l00354"></a>00354 
<a name="l00355"></a>00355             token.<a class="code" href="classNxsToken_a1c6fa60bd11ed8df496ea30083005532.html#a1c6fa60bd11ed8df496ea30083005532" title="Strips whitespace from currently-stored token.">StripWhitespace</a>();
<a name="l00356"></a>00356             <span class="keywordtype">unsigned</span> numNewSymbols = token.<a class="code" href="classNxsToken_a8231aba780039e4ef1fe2fbf24e21dba.html#a8231aba780039e4ef1fe2fbf24e21dba" title="Returns token.size().">GetTokenLength</a>();
<a name="l00357"></a>00357 
<a name="l00358"></a>00358             <span class="keywordflow">if</span> (numNewSymbols &gt; maxNewStates)
<a name="l00359"></a>00359                 {
<a name="l00360"></a>00360                 errormsg = <span class="stringliteral">&quot;SYMBOLS defines &quot;</span>;
<a name="l00361"></a>00361                 errormsg += numNewSymbols;
<a name="l00362"></a>00362                 errormsg += <span class="stringliteral">&quot; new states but only &quot;</span>;
<a name="l00363"></a>00363                 errormsg += maxNewStates;
<a name="l00364"></a>00364                 errormsg += <span class="stringliteral">&quot; new states allowed for this DATATYPE&quot;</span>;
<a name="l00365"></a>00365                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token.<a class="code" href="classNxsToken_a17e5caf91acc756c23159f76f8b2d0fd.html#a17e5caf91acc756c23159f76f8b2d0fd" title="Returns value stored in filepos, which keeps track of the current position in the...">GetFilePosition</a>(), token.<a class="code" href="classNxsToken_ae0fb11bf350d907295447864afa714ec.html#ae0fb11bf350d907295447864afa714ec" title="Returns value stored in `fileline&amp;#39;, which keeps track of the current line in...">GetFileLine</a>(), token.<a class="code" href="classNxsToken_a7272fd1469fa6424086a95ec4f92eab0.html#a7272fd1469fa6424086a95ec4f92eab0" title="Returns value stored in `filecol&amp;#39;, which keeps track of the current column in...">GetFileColumn</a>());
<a name="l00366"></a>00366                 }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368             <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> to = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l00369"></a>00369             <span class="keywordtype">unsigned</span> tlen = (unsigned)to.size();
<a name="l00370"></a>00370             <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> processedS;
<a name="l00371"></a>00371             <span class="comment">// Check to make sure user has not used any symbols already in the</span>
<a name="l00372"></a>00372             <span class="comment">// default symbols list for this data type</span>
<a name="l00373"></a>00373             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; tlen; i++)
<a name="l00374"></a>00374                 {
<a name="l00375"></a>00375                 <span class="keywordflow">if</span> (<a class="code" href="classNxsUnalignedBlock_a6fec9291655df9f0d77a6182a7da41e5.html#a6fec9291655df9f0d77a6182a7da41e5" title="Returns true if `ch&amp;#39; can be found in the `symbols&amp;#39; array.">IsInSymbols</a>(to[i]))
<a name="l00376"></a>00376                     {
<a name="l00377"></a>00377                     errormsg = <span class="stringliteral">&quot;The character &quot;</span>;
<a name="l00378"></a>00378                     errormsg &lt;&lt; to[i] &lt;&lt; <span class="stringliteral">&quot; defined in SYMBOLS is predefined for this DATATYPE and shoud not occur in a SYMBOLS subcommand of a FORMAT command.&quot;</span>;
<a name="l00379"></a>00379                     <span class="keywordflow">if</span> (nexusReader)
<a name="l00380"></a>00380                         {
<a name="l00381"></a>00381                         nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad6030a0462aaf947e6383d0fd91a0b68">NxsReader::SKIPPING_CONTENT_WARNING</a>, token);
<a name="l00382"></a>00382                         errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l00383"></a>00383                         }
<a name="l00384"></a>00384                     }
<a name="l00385"></a>00385                 <span class="keywordflow">else</span>
<a name="l00386"></a>00386                     processedS += to[i];
<a name="l00387"></a>00387                 }
<a name="l00388"></a>00388 
<a name="l00389"></a>00389             <span class="comment">// If we&#39;ve made it this far, go ahead and add the user-defined</span>
<a name="l00390"></a>00390             <span class="comment">// symbols to the end of the list of predefined symbols</span>
<a name="l00391"></a>00391             symbols.append(processedS);
<a name="l00392"></a>00392 
<a name="l00393"></a>00393             ignoreCaseAssumed = <span class="keyword">true</span>;
<a name="l00394"></a>00394             standardDataTypeAssumed = <span class="keyword">true</span>;
<a name="l00395"></a>00395             }
<a name="l00396"></a>00396 
<a name="l00397"></a>00397         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;EQUATE&quot;</span>))
<a name="l00398"></a>00398             {
<a name="l00399"></a>00399             <a class="code" href="classNxsBlock_aee6771bdd0c70f375d925c4e0b6d1095.html#aee6771bdd0c70f375d925c4e0b6d1095" title="Advances the token, and raise an exception if it is not an equals sign.">DemandEquals</a>(token, <span class="stringliteral">&quot;after keyword EQUATE&quot;</span>);
<a name="l00400"></a>00400 
<a name="l00401"></a>00401             <span class="comment">// This should be a double-quote character</span>
<a name="l00402"></a>00402             token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l00403"></a>00403 
<a name="l00404"></a>00404             <span class="keywordflow">if</span> (!token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;\&quot;&quot;</span>))
<a name="l00405"></a>00405                 {
<a name="l00406"></a>00406                 errormsg = <span class="stringliteral">&quot;Expecting &#39;\&quot;&#39; after keyword EQUATE but found &quot;</span>;
<a name="l00407"></a>00407                 errormsg += token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l00408"></a>00408                 errormsg += <span class="stringliteral">&quot; instead&quot;</span>;
<a name="l00409"></a>00409                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token.<a class="code" href="classNxsToken_a17e5caf91acc756c23159f76f8b2d0fd.html#a17e5caf91acc756c23159f76f8b2d0fd" title="Returns value stored in filepos, which keeps track of the current position in the...">GetFilePosition</a>(), token.<a class="code" href="classNxsToken_ae0fb11bf350d907295447864afa714ec.html#ae0fb11bf350d907295447864afa714ec" title="Returns value stored in `fileline&amp;#39;, which keeps track of the current line in...">GetFileLine</a>(), token.<a class="code" href="classNxsToken_a7272fd1469fa6424086a95ec4f92eab0.html#a7272fd1469fa6424086a95ec4f92eab0" title="Returns value stored in `filecol&amp;#39;, which keeps track of the current column in...">GetFileColumn</a>());
<a name="l00410"></a>00410                 }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412             <span class="comment">// Loop until second double-quote character is encountered</span>
<a name="l00413"></a>00413             <span class="keywordflow">for</span> (;;)
<a name="l00414"></a>00414                 {
<a name="l00415"></a>00415                 token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l00416"></a>00416                 <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;\&quot;&quot;</span>))
<a name="l00417"></a>00417                     <span class="keywordflow">break</span>;
<a name="l00418"></a>00418 
<a name="l00419"></a>00419                 <span class="comment">// If token is not a double-quote character, then it must be the equate symbol (i.e., the</span>
<a name="l00420"></a>00420                 <span class="comment">// character to be replaced in the data matrix)</span>
<a name="l00421"></a>00421                 <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a8231aba780039e4ef1fe2fbf24e21dba.html#a8231aba780039e4ef1fe2fbf24e21dba" title="Returns token.size().">GetTokenLength</a>() != 1)
<a name="l00422"></a>00422                     {
<a name="l00423"></a>00423                     errormsg = <span class="stringliteral">&quot;Expecting single-character EQUATE symbol but found &quot;</span>;
<a name="l00424"></a>00424                     errormsg += token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l00425"></a>00425                     errormsg += <span class="stringliteral">&quot; instead&quot;</span>;
<a name="l00426"></a>00426                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token.<a class="code" href="classNxsToken_a17e5caf91acc756c23159f76f8b2d0fd.html#a17e5caf91acc756c23159f76f8b2d0fd" title="Returns value stored in filepos, which keeps track of the current position in the...">GetFilePosition</a>(), token.<a class="code" href="classNxsToken_ae0fb11bf350d907295447864afa714ec.html#ae0fb11bf350d907295447864afa714ec" title="Returns value stored in `fileline&amp;#39;, which keeps track of the current line in...">GetFileLine</a>(), token.<a class="code" href="classNxsToken_a7272fd1469fa6424086a95ec4f92eab0.html#a7272fd1469fa6424086a95ec4f92eab0" title="Returns value stored in `filecol&amp;#39;, which keeps track of the current column in...">GetFileColumn</a>());
<a name="l00427"></a>00427                     }
<a name="l00428"></a>00428 
<a name="l00429"></a>00429                 <span class="comment">// Check for bad choice of equate symbol</span>
<a name="l00430"></a>00430                 <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> t = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l00431"></a>00431                 <span class="keyword">const</span> <span class="keywordtype">char</span> ch = t[0];
<a name="l00432"></a>00432                 <span class="keywordtype">bool</span> badEquateSymbol = <span class="keyword">false</span>;
<a name="l00433"></a>00433 
<a name="l00434"></a>00434                 <span class="comment">// The character &#39;^&#39; cannot be an equate symbol</span>
<a name="l00435"></a>00435                 <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;^&#39;</span>)
<a name="l00436"></a>00436                     badEquateSymbol = <span class="keyword">true</span>;
<a name="l00437"></a>00437 
<a name="l00438"></a>00438                 <span class="comment">// Equate symbols cannot be punctuation (except for + and -)</span>
<a name="l00439"></a>00439                 <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a0e5bcf6a302bf475420b28036a218b51.html#a0e5bcf6a302bf475420b28036a218b51" title="Returns true if current token is a single character and this character is a punctuation...">IsPunctuationToken</a>() &amp;&amp; !token.<a class="code" href="classNxsToken_af75d27ce09e09c66c838ad61e13839f7.html#af75d27ce09e09c66c838ad61e13839f7" title="Returns true if current token is a single character and this character is either...">IsPlusMinusToken</a>())
<a name="l00440"></a>00440                     badEquateSymbol = <span class="keyword">true</span>;
<a name="l00441"></a>00441 
<a name="l00442"></a>00442                 <span class="comment">// Equate symbols cannot be same as matchchar, missing, or gap</span>
<a name="l00443"></a>00443                 <span class="keywordflow">if</span> (ch == missing)
<a name="l00444"></a>00444                     badEquateSymbol = <span class="keyword">true</span>;
<a name="l00445"></a>00445 
<a name="l00446"></a>00446                 <span class="comment">// Equate symbols cannot be one of the state symbols currently defined</span>
<a name="l00447"></a>00447                 <span class="keywordflow">if</span> (<a class="code" href="classNxsUnalignedBlock_a6fec9291655df9f0d77a6182a7da41e5.html#a6fec9291655df9f0d77a6182a7da41e5" title="Returns true if `ch&amp;#39; can be found in the `symbols&amp;#39; array.">IsInSymbols</a>(ch))
<a name="l00448"></a>00448                     badEquateSymbol = <span class="keyword">true</span>;
<a name="l00449"></a>00449 
<a name="l00450"></a>00450                 <span class="keywordflow">if</span> (badEquateSymbol)
<a name="l00451"></a>00451                     {
<a name="l00452"></a>00452                     errormsg = <span class="stringliteral">&quot;EQUATE symbol specified (&quot;</span>;
<a name="l00453"></a>00453                     errormsg += token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l00454"></a>00454                     errormsg += <span class="stringliteral">&quot;) is not valid; must not be same as missing, \nmatchchar, gap, state symbols, or any of the following: ()[]{}/\\,;:=*&#39;\&quot;`&lt;&gt;^&quot;</span>;
<a name="l00455"></a>00455                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token.<a class="code" href="classNxsToken_a17e5caf91acc756c23159f76f8b2d0fd.html#a17e5caf91acc756c23159f76f8b2d0fd" title="Returns value stored in filepos, which keeps track of the current position in the...">GetFilePosition</a>(), token.<a class="code" href="classNxsToken_ae0fb11bf350d907295447864afa714ec.html#ae0fb11bf350d907295447864afa714ec" title="Returns value stored in `fileline&amp;#39;, which keeps track of the current line in...">GetFileLine</a>(), token.<a class="code" href="classNxsToken_a7272fd1469fa6424086a95ec4f92eab0.html#a7272fd1469fa6424086a95ec4f92eab0" title="Returns value stored in `filecol&amp;#39;, which keeps track of the current column in...">GetFileColumn</a>());
<a name="l00456"></a>00456                     }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458                 <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> k = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l00459"></a>00459 
<a name="l00460"></a>00460                 <a class="code" href="classNxsBlock_aee6771bdd0c70f375d925c4e0b6d1095.html#aee6771bdd0c70f375d925c4e0b6d1095" title="Advances the token, and raise an exception if it is not an equals sign.">DemandEquals</a>(token, <span class="stringliteral">&quot;in EQUATE definition&quot;</span>);
<a name="l00461"></a>00461 
<a name="l00462"></a>00462                 <span class="comment">// This should be the token to be substituted in for the equate symbol</span>
<a name="l00463"></a>00463                 token.<a class="code" href="classNxsToken_afa5232738ca19e069173e8befe75e730.html#afa5232738ca19e069173e8befe75e730" title="Sets the bit specified in the variable `labileFlags&amp;#39;.">SetLabileFlagBit</a>(NxsToken::parentheticalToken);
<a name="l00464"></a>00464                 token.<a class="code" href="classNxsToken_afa5232738ca19e069173e8befe75e730.html#afa5232738ca19e069173e8befe75e730" title="Sets the bit specified in the variable `labileFlags&amp;#39;.">SetLabileFlagBit</a>(NxsToken::curlyBracketedToken);
<a name="l00465"></a>00465                 token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l00466"></a>00466                 <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> v = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l00467"></a>00467 
<a name="l00468"></a>00468                 <span class="comment">// Add the new equate association to the equates list</span>
<a name="l00469"></a>00469                 equates[ch] = v;
<a name="l00470"></a>00470                 }
<a name="l00471"></a>00471 
<a name="l00472"></a>00472             standardDataTypeAssumed = <span class="keyword">true</span>;
<a name="l00473"></a>00473             }
<a name="l00474"></a>00474         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;LABELS&quot;</span>))
<a name="l00475"></a>00475             {
<a name="l00476"></a>00476             labels = <span class="keyword">true</span>;
<a name="l00477"></a>00477             standardDataTypeAssumed = <span class="keyword">true</span>;
<a name="l00478"></a>00478             }
<a name="l00479"></a>00479         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;NOLABELS&quot;</span>))
<a name="l00480"></a>00480             {
<a name="l00481"></a>00481             labels = <span class="keyword">false</span>;
<a name="l00482"></a>00482             standardDataTypeAssumed = <span class="keyword">true</span>;
<a name="l00483"></a>00483             }
<a name="l00484"></a>00484         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;;&quot;</span>))
<a name="l00485"></a>00485             {
<a name="l00486"></a>00486             <span class="keywordflow">break</span>;
<a name="l00487"></a>00487             }
<a name="l00488"></a>00488         }
<a name="l00489"></a>00489     ResetDatatypeMapper();
<a name="l00490"></a>00490     }
<a name="l00491"></a>00491 
<a name="l00496"></a><a class="code" href="classNxsUnalignedBlock_ae7b00910ce41b95ab1fac58482c3144f.html#ae7b00910ce41b95ab1fac58482c3144f">00496</a> <span class="keywordtype">bool</span> <a class="code" href="classNxsUnalignedBlock_ae7b00910ce41b95ab1fac58482c3144f.html#ae7b00910ce41b95ab1fac58482c3144f" title="Called from HandleMatrix function to read in the next state.">NxsUnalignedBlock::HandleNextState</a>(
<a name="l00497"></a>00497   <a class="code" href="classNxsToken.html">NxsToken</a> &amp; token,         <span class="comment">/* is the token used to read from `in&#39; */</span>
<a name="l00498"></a>00498   <span class="keywordtype">unsigned</span> taxNum,              <span class="comment">/* is the row in range [0..ntax) (used for error reporting only) */</span>
<a name="l00499"></a>00499   <span class="keywordtype">unsigned</span> charNum,             <span class="comment">/* is the column (used for error reporting only) */</span>
<a name="l00500"></a>00500   NxsDiscreteStateRow &amp; row, <span class="keyword">const</span> <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> &amp;nameStr)  <span class="comment">/* is the container for storing new state */</span>
<a name="l00501"></a>00501     {
<a name="l00502"></a>00502     token.<a class="code" href="classNxsToken_afa5232738ca19e069173e8befe75e730.html#afa5232738ca19e069173e8befe75e730" title="Sets the bit specified in the variable `labileFlags&amp;#39;.">SetLabileFlagBit</a>(NxsToken::parentheticalToken);
<a name="l00503"></a>00503     token.<a class="code" href="classNxsToken_afa5232738ca19e069173e8befe75e730.html#afa5232738ca19e069173e8befe75e730" title="Sets the bit specified in the variable `labileFlags&amp;#39;.">SetLabileFlagBit</a>(NxsToken::curlyBracketedToken);
<a name="l00504"></a>00504     token.<a class="code" href="classNxsToken_afa5232738ca19e069173e8befe75e730.html#afa5232738ca19e069173e8befe75e730" title="Sets the bit specified in the variable `labileFlags&amp;#39;.">SetLabileFlagBit</a>(NxsToken::singleCharacterToken);
<a name="l00505"></a>00505 
<a name="l00506"></a>00506     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l00507"></a>00507 
<a name="l00508"></a>00508     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;,&quot;</span>) || token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;;&quot;</span>))
<a name="l00509"></a>00509         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00510"></a>00510     <span class="keyword">const</span> <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> stateAsNexus = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l00511"></a>00511     <span class="keyword">const</span> NxsDiscreteStateCell stateCode = mapper.<a class="code" href="classNxsDiscreteDatatypeMapper_a38754dbada3764610403d269a6cd2ce9.html#a38754dbada3764610403d269a6cd2ce9" title="Called from HandleStdMatrix or HandleTransposedMatrix function to read in the next...">EncodeNexusStateString</a>(stateAsNexus, token, taxNum, charNum, NULL, nameStr);
<a name="l00512"></a>00512     <span class="keywordflow">if</span> (charNum &lt; row.size())
<a name="l00513"></a>00513         row[charNum] = stateCode;
<a name="l00514"></a>00514     <span class="keywordflow">else</span>
<a name="l00515"></a>00515         {
<a name="l00516"></a>00516         <span class="keywordflow">while</span> (charNum &lt; row.size())
<a name="l00517"></a>00517             row.push_back(NXS_INVALID_STATE_CODE);
<a name="l00518"></a>00518         row.push_back(stateCode);
<a name="l00519"></a>00519         }
<a name="l00520"></a>00520     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00521"></a>00521     }
<a name="l00522"></a>00522 
<a name="l00527"></a><a class="code" href="classNxsUnalignedBlock_a10c462ac1aa5f2cca925c5281952d5df.html#a10c462ac1aa5f2cca925c5281952d5df">00527</a> <span class="keywordtype">void</span> <a class="code" href="classNxsUnalignedBlock_a10c462ac1aa5f2cca925c5281952d5df.html#a10c462ac1aa5f2cca925c5281952d5df" title="Called when MATRIX command needs to be parsed from within the UNALIGNED block.">NxsUnalignedBlock::HandleMatrix</a>(
<a name="l00528"></a>00528   <a class="code" href="classNxsToken.html">NxsToken</a> &amp; token) <span class="comment">/* is the token used to read from `in&#39; */</span>
<a name="l00529"></a>00529     {
<a name="l00530"></a>00530     <span class="keywordflow">if</span> (taxa == NULL)
<a name="l00531"></a>00531         {
<a name="l00532"></a>00532         AssureTaxaBlock(<span class="keyword">false</span>, token, <span class="stringliteral">&quot;Matrix&quot;</span>);
<a name="l00533"></a>00533         <span class="keywordtype">unsigned</span> ntax = taxa-&gt;<a class="code" href="classNxsTaxaBlockAPI_a3e9b998d97ad05914bda0d616069c26f.html#a3e9b998d97ad05914bda0d616069c26f">GetNTax</a>();
<a name="l00534"></a>00534         <span class="keywordflow">if</span> (ntax == 0)
<a name="l00535"></a>00535             {
<a name="l00536"></a>00536             errormsg = <span class="stringliteral">&quot;Must precede &quot;</span>;
<a name="l00537"></a>00537             errormsg += id;
<a name="l00538"></a>00538             errormsg += <span class="stringliteral">&quot; block with a TAXA block or specify NEWTAXA and NTAX in the DIMENSIONS command&quot;</span>;
<a name="l00539"></a>00539             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token.<a class="code" href="classNxsToken_a17e5caf91acc756c23159f76f8b2d0fd.html#a17e5caf91acc756c23159f76f8b2d0fd" title="Returns value stored in filepos, which keeps track of the current position in the...">GetFilePosition</a>(), token.<a class="code" href="classNxsToken_ae0fb11bf350d907295447864afa714ec.html#ae0fb11bf350d907295447864afa714ec" title="Returns value stored in `fileline&amp;#39;, which keeps track of the current line in...">GetFileLine</a>(), token.<a class="code" href="classNxsToken_a7272fd1469fa6424086a95ec4f92eab0.html#a7272fd1469fa6424086a95ec4f92eab0" title="Returns value stored in `filecol&amp;#39;, which keeps track of the current column in...">GetFileColumn</a>());
<a name="l00540"></a>00540             }
<a name="l00541"></a>00541         }
<a name="l00542"></a>00542     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ntax = taxa-&gt;<a class="code" href="classNxsTaxaBlockAPI_a3e9b998d97ad05914bda0d616069c26f.html#a3e9b998d97ad05914bda0d616069c26f">GetNTax</a>();
<a name="l00543"></a>00543     uMatrix.clear();
<a name="l00544"></a>00544     uMatrix.resize(ntax);
<a name="l00545"></a>00545     <span class="keywordtype">unsigned</span> indOfTaxInMemory = 0;
<a name="l00546"></a>00546     std::vector&lt;unsigned&gt; toInMem(nTaxWithData, UINT_MAX);
<a name="l00547"></a>00547     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ntlabels = taxa-&gt;<a class="code" href="classNxsTaxaBlockAPI_ad875bc0358bc242d998a1e84f5cefccb.html#ad875bc0358bc242d998a1e84f5cefccb">GetNumTaxonLabels</a>();
<a name="l00548"></a>00548     errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l00549"></a>00549     <span class="keywordtype">bool</span> taxaBlockNeedsLabels = (ntlabels == 0);
<a name="l00550"></a>00550     <span class="keywordflow">if</span> (!taxaBlockNeedsLabels &amp;&amp; ntlabels &lt; nTaxWithData)
<a name="l00551"></a>00551         {
<a name="l00552"></a>00552         errormsg &lt;&lt; <span class="stringliteral">&quot;Not enough taxlabels are known to read characters for &quot;</span> &lt;&lt; nTaxWithData &lt;&lt; <span class="stringliteral">&quot; taxa in the Matrix command.&quot;</span>;
<a name="l00553"></a>00553         <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l00554"></a>00554         }
<a name="l00555"></a>00555     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> indOfTaxInCommand = 0; indOfTaxInCommand &lt; nTaxWithData; indOfTaxInCommand++)
<a name="l00556"></a>00556         {
<a name="l00557"></a>00557         <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> nameStr;
<a name="l00558"></a>00558         <span class="keywordflow">if</span> (labels)
<a name="l00559"></a>00559             {
<a name="l00560"></a>00560             token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l00561"></a>00561             nameStr = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l00562"></a>00562             <span class="keywordflow">if</span> (taxaBlockNeedsLabels)
<a name="l00563"></a>00563                 {
<a name="l00564"></a>00564                 <span class="keywordflow">if</span> (taxa-&gt;<a class="code" href="classNxsTaxaBlockAPI_a82efb07d79a05062e57b98de6f33cbba.html#a82efb07d79a05062e57b98de6f33cbba">IsAlreadyDefined</a>(nameStr))
<a name="l00565"></a>00565                     {
<a name="l00566"></a>00566                     errormsg &lt;&lt; <span class="stringliteral">&quot;Data for this taxon (&quot;</span> &lt;&lt; nameStr &lt;&lt; <span class="stringliteral">&quot;) has already been saved&quot;</span>;
<a name="l00567"></a>00567                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l00568"></a>00568                     }
<a name="l00569"></a>00569                 indOfTaxInMemory = taxa-&gt;<a class="code" href="classNxsTaxaBlockAPI_adb06043c2f1668102b6f0b725c7612b8.html#adb06043c2f1668102b6f0b725c7612b8" title="Adds taxon label &amp;#39;s&amp;#39; to end of list of taxon labels and increments dimNTax...">AddTaxonLabel</a>(nameStr);
<a name="l00570"></a>00570                 }
<a name="l00571"></a>00571             <span class="keywordflow">else</span>
<a name="l00572"></a>00572                 {
<a name="l00573"></a>00573                 <span class="keywordtype">unsigned</span> numOfTaxInMemory = taxa-&gt;<a class="code" href="classNxsTaxaBlockAPI_a708b8b703ca7b354ae00b720dbb150a8.html#a708b8b703ca7b354ae00b720dbb150a8">TaxLabelToNumber</a>(nameStr);
<a name="l00574"></a>00574                 <span class="keywordflow">if</span> (numOfTaxInMemory == 0)
<a name="l00575"></a>00575                     {
<a name="l00576"></a>00576                     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;;&quot;</span>))
<a name="l00577"></a>00577                         errormsg &lt;&lt; <span class="stringliteral">&quot;Unexpected ;&quot;</span>;
<a name="l00578"></a>00578                     <span class="keywordflow">else</span>
<a name="l00579"></a>00579                         errormsg &lt;&lt; <span class="stringliteral">&quot;Could not find taxon named &quot;</span> &lt;&lt; nameStr &lt;&lt; <span class="stringliteral">&quot; among stored taxon labels&quot;</span>;
<a name="l00580"></a>00580                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token.<a class="code" href="classNxsToken_a17e5caf91acc756c23159f76f8b2d0fd.html#a17e5caf91acc756c23159f76f8b2d0fd" title="Returns value stored in filepos, which keeps track of the current position in the...">GetFilePosition</a>(), token.<a class="code" href="classNxsToken_ae0fb11bf350d907295447864afa714ec.html#ae0fb11bf350d907295447864afa714ec" title="Returns value stored in `fileline&amp;#39;, which keeps track of the current line in...">GetFileLine</a>(), token.<a class="code" href="classNxsToken_a7272fd1469fa6424086a95ec4f92eab0.html#a7272fd1469fa6424086a95ec4f92eab0" title="Returns value stored in `filecol&amp;#39;, which keeps track of the current column in...">GetFileColumn</a>());
<a name="l00581"></a>00581                     }
<a name="l00582"></a>00582                 indOfTaxInMemory = numOfTaxInMemory - 1;
<a name="l00583"></a>00583                 }
<a name="l00584"></a>00584             }
<a name="l00585"></a>00585         <span class="keywordflow">else</span>
<a name="l00586"></a>00586             {
<a name="l00587"></a>00587             indOfTaxInMemory = indOfTaxInCommand;
<a name="l00588"></a>00588             nameStr &lt;&lt; 1+indOfTaxInMemory;
<a name="l00589"></a>00589             }
<a name="l00590"></a>00590         <span class="keywordflow">if</span> (toInMem[indOfTaxInCommand] != UINT_MAX)
<a name="l00591"></a>00591             {
<a name="l00592"></a>00592             errormsg &lt;&lt; <span class="stringliteral">&quot;Characters for taxon &quot;</span> &lt;&lt; indOfTaxInCommand &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; taxa-&gt;<a class="code" href="classNxsTaxaBlockAPI_ae172f21958353f1be42371f0cad7061d.html#ae172f21958353f1be42371f0cad7061d">GetTaxonLabel</a>(indOfTaxInMemory) &lt;&lt; <span class="stringliteral">&quot;) have already been stored&quot;</span>;
<a name="l00593"></a>00593             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l00594"></a>00594             }
<a name="l00595"></a>00595         toInMem[indOfTaxInCommand] = indOfTaxInMemory;
<a name="l00596"></a>00596         NxsDiscreteStateRow * new_row = &amp;uMatrix[indOfTaxInMemory];
<a name="l00597"></a>00597         <span class="keywordtype">unsigned</span> charInd = 0;
<a name="l00598"></a>00598         <span class="keywordflow">while</span> (<a class="code" href="classNxsUnalignedBlock_ae7b00910ce41b95ab1fac58482c3144f.html#ae7b00910ce41b95ab1fac58482c3144f" title="Called from HandleMatrix function to read in the next state.">HandleNextState</a>(token, indOfTaxInMemory, charInd, *new_row, nameStr))
<a name="l00599"></a>00599             charInd++;
<a name="l00600"></a>00600         }
<a name="l00601"></a>00601     }
<a name="l00602"></a>00602 
<a name="l00603"></a>00603 
<a name="l00609"></a><a class="code" href="classNxsUnalignedBlock_ab44cf6018e22f4d8d84ecd37eaa32dfb.html#ab44cf6018e22f4d8d84ecd37eaa32dfb">00609</a> <span class="keywordtype">void</span> <a class="code" href="classNxsUnalignedBlock_ab44cf6018e22f4d8d84ecd37eaa32dfb.html#ab44cf6018e22f4d8d84ecd37eaa32dfb" title="This function provides the ability to read everything following the block name (which...">NxsUnalignedBlock::Read</a>(
<a name="l00610"></a>00610   <a class="code" href="classNxsToken.html">NxsToken</a> &amp; token) <span class="comment">/* is the token used to read from `in&#39; */</span>
<a name="l00611"></a>00611     {
<a name="l00612"></a>00612     isEmpty = <span class="keyword">false</span>;
<a name="l00613"></a>00613     isUserSupplied = <span class="keyword">true</span>;
<a name="l00614"></a>00614 
<a name="l00615"></a>00615     <span class="comment">// This should be the semicolon after the block name</span>
<a name="l00616"></a>00616     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l00617"></a>00617     <span class="keywordflow">if</span> (!token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;;&quot;</span>))
<a name="l00618"></a>00618         {
<a name="l00619"></a>00619         errormsg = <span class="stringliteral">&quot;Expecting &#39;;&#39; after &quot;</span>;
<a name="l00620"></a>00620         errormsg += id;
<a name="l00621"></a>00621         errormsg += <span class="stringliteral">&quot; block name, but found &quot;</span>;
<a name="l00622"></a>00622         errormsg += token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l00623"></a>00623         errormsg += <span class="stringliteral">&quot; instead&quot;</span>;
<a name="l00624"></a>00624         <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token.<a class="code" href="classNxsToken_a17e5caf91acc756c23159f76f8b2d0fd.html#a17e5caf91acc756c23159f76f8b2d0fd" title="Returns value stored in filepos, which keeps track of the current position in the...">GetFilePosition</a>(), token.<a class="code" href="classNxsToken_ae0fb11bf350d907295447864afa714ec.html#ae0fb11bf350d907295447864afa714ec" title="Returns value stored in `fileline&amp;#39;, which keeps track of the current line in...">GetFileLine</a>(), token.<a class="code" href="classNxsToken_a7272fd1469fa6424086a95ec4f92eab0.html#a7272fd1469fa6424086a95ec4f92eab0" title="Returns value stored in `filecol&amp;#39;, which keeps track of the current column in...">GetFileColumn</a>());
<a name="l00625"></a>00625         }
<a name="l00626"></a>00626     nTaxWithData = 0;
<a name="l00627"></a>00627 
<a name="l00628"></a>00628     <span class="keywordflow">for</span> (;;)
<a name="l00629"></a>00629         {
<a name="l00630"></a>00630         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l00631"></a>00631         NxsBlock::NxsCommandResult res = <a class="code" href="classNxsBlock_af9c3fcff6324f4b220a1dd9ebcb1017a.html#af9c3fcff6324f4b220a1dd9ebcb1017a" title="Hook to consolidate the handling of COMMANDS that are common to all blocks (TITLE...">HandleBasicBlockCommands</a>(token);
<a name="l00632"></a>00632         <span class="keywordflow">if</span> (res == NxsBlock::NxsCommandResult(STOP_PARSING_BLOCK))
<a name="l00633"></a>00633             <span class="keywordflow">return</span>;
<a name="l00634"></a>00634         <span class="keywordflow">if</span> (res != NxsBlock::NxsCommandResult(HANDLED_COMMAND))
<a name="l00635"></a>00635             {
<a name="l00636"></a>00636             <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;DIMENSIONS&quot;</span>))
<a name="l00637"></a>00637                 <a class="code" href="classNxsUnalignedBlock_a481990bc1a73bb3ee04b700701b94ac2.html#a481990bc1a73bb3ee04b700701b94ac2" title="Called when DIMENSIONS command needs to be parsed from within the UNALIGNED block...">HandleDimensions</a>(token);
<a name="l00638"></a>00638             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;FORMAT&quot;</span>))
<a name="l00639"></a>00639                 <a class="code" href="classNxsUnalignedBlock_ad388c00f7eb08ac4ddbbda9fa7cfe12c.html#ad388c00f7eb08ac4ddbbda9fa7cfe12c" title="Called when FORMAT command needs to be parsed from within the DIMENSIONS block.">HandleFormat</a>(token);
<a name="l00640"></a>00640             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;TAXLABELS&quot;</span>))
<a name="l00641"></a>00641                 <a class="code" href="classNxsTaxaBlockSurrogate_ad899bacf59e0e049f7fdf9b9142f6bc2.html#ad899bacf59e0e049f7fdf9b9142f6bc2" title="Called when TAXLABELS command needs to be parsed from within the UNALIGNED block...">HandleTaxLabels</a>(token);
<a name="l00642"></a>00642             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;MATRIX&quot;</span>))
<a name="l00643"></a>00643                 <a class="code" href="classNxsUnalignedBlock_a10c462ac1aa5f2cca925c5281952d5df.html#a10c462ac1aa5f2cca925c5281952d5df" title="Called when MATRIX command needs to be parsed from within the UNALIGNED block.">HandleMatrix</a>(token);
<a name="l00644"></a>00644             <span class="keywordflow">else</span>
<a name="l00645"></a>00645                 SkipCommand(token);
<a name="l00646"></a>00646             }
<a name="l00647"></a>00647         }   <span class="comment">// for (;;)</span>
<a name="l00648"></a>00648     }
<a name="l00649"></a>00649 
<a name="l00654"></a><a class="code" href="classNxsUnalignedBlock_a7dd6b73dc90618e28c80ea30d1da6cc5.html#a7dd6b73dc90618e28c80ea30d1da6cc5">00654</a> <span class="keywordtype">void</span> <a class="code" href="classNxsUnalignedBlock_a7dd6b73dc90618e28c80ea30d1da6cc5.html#a7dd6b73dc90618e28c80ea30d1da6cc5" title="This function outputs a brief report of the contents of this UNALIGNED block.">NxsUnalignedBlock::Report</a>(
<a name="l00655"></a>00655   std::ostream &amp; out) NCL_COULD_BE_CONST <span class="comment">/* is the output stream to which to write the report */</span> <span class="comment">/*v2.1to2.2 1 */</span>
<a name="l00656"></a>00656     {
<a name="l00657"></a>00657     out &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot; block contains &quot;</span>;
<a name="l00658"></a>00658     <span class="keywordflow">if</span> (nTaxWithData == 0)
<a name="l00659"></a>00659         out &lt;&lt; <span class="stringliteral">&quot;no taxa&quot;</span>;
<a name="l00660"></a>00660     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nTaxWithData == 1)
<a name="l00661"></a>00661         out &lt;&lt; <span class="stringliteral">&quot;one taxon&quot;</span>;
<a name="l00662"></a>00662     <span class="keywordflow">else</span>
<a name="l00663"></a>00663         out &lt;&lt; nTaxWithData &lt;&lt; <span class="stringliteral">&quot; taxa&quot;</span>;
<a name="l00664"></a>00664 
<a name="l00665"></a>00665     out &lt;&lt; <span class="stringliteral">&quot;\n  Data type is \&quot;&quot;</span> &lt;&lt; this-&gt;GetDatatypeName() &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span> &lt;&lt; endl;
<a name="l00666"></a>00666 
<a name="l00667"></a>00667     <span class="keywordflow">if</span> (respectingCase)
<a name="l00668"></a>00668         out &lt;&lt; <span class="stringliteral">&quot;  Respecting case&quot;</span> &lt;&lt; endl;
<a name="l00669"></a>00669     <span class="keywordflow">else</span>
<a name="l00670"></a>00670         out &lt;&lt; <span class="stringliteral">&quot;  Ignoring case&quot;</span> &lt;&lt; endl;
<a name="l00671"></a>00671 
<a name="l00672"></a>00672     <span class="keywordflow">if</span> (labels)
<a name="l00673"></a>00673         out &lt;&lt; <span class="stringliteral">&quot;  Taxon labels were provided on left side of matrix&quot;</span> &lt;&lt; endl;
<a name="l00674"></a>00674     <span class="keywordflow">else</span>
<a name="l00675"></a>00675         out &lt;&lt; <span class="stringliteral">&quot;  No taxon labels were provided on left side of matrix&quot;</span> &lt;&lt; endl;
<a name="l00676"></a>00676 
<a name="l00677"></a>00677     out &lt;&lt; <span class="stringliteral">&quot;  Missing data symbol is &#39;&quot;</span> &lt;&lt; missing &lt;&lt; <span class="charliteral">&#39;\&#39;&#39;</span> &lt;&lt; endl;
<a name="l00678"></a>00678     out &lt;&lt; <span class="stringliteral">&quot;  Valid symbols are: &quot;</span> &lt;&lt; symbols &lt;&lt; endl;
<a name="l00679"></a>00679 
<a name="l00680"></a>00680     <span class="keywordtype">int</span> numEquateMacros = (int)equates.size();
<a name="l00681"></a>00681     <span class="keywordflow">if</span> (numEquateMacros &gt; 0)
<a name="l00682"></a>00682         {
<a name="l00683"></a>00683         out &lt;&lt; <span class="stringliteral">&quot;  Equate macros in effect:&quot;</span> &lt;&lt; endl;
<a name="l00684"></a>00684         std::map&lt;char, NxsString&gt;::const_iterator i = equates.begin();
<a name="l00685"></a>00685         <span class="keywordflow">for</span> (; i != equates.end(); ++i)
<a name="l00686"></a>00686             {
<a name="l00687"></a>00687             out &lt;&lt; <span class="stringliteral">&quot;    &quot;</span> &lt;&lt; (*i).first &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; (*i).second &lt;&lt; endl;
<a name="l00688"></a>00688             }
<a name="l00689"></a>00689         }
<a name="l00690"></a>00690     <span class="keywordflow">else</span>
<a name="l00691"></a>00691         out &lt;&lt; <span class="stringliteral">&quot;  No equate macros have been defined&quot;</span> &lt;&lt; endl;
<a name="l00692"></a>00692 
<a name="l00693"></a>00693     out &lt;&lt; <span class="stringliteral">&quot;  Data matrix:&quot;</span> &lt;&lt; endl;
<a name="l00694"></a>00694     DebugShowMatrix(out, <span class="stringliteral">&quot;    &quot;</span>);
<a name="l00695"></a>00695     }
<a name="l00696"></a>00696 
<a name="l00700"></a><a class="code" href="classNxsUnalignedBlock_a68e5af6e139405023554457b6ac42c0c.html#a68e5af6e139405023554457b6ac42c0c">00700</a> <span class="keywordtype">void</span> <a class="code" href="classNxsUnalignedBlock_a68e5af6e139405023554457b6ac42c0c.html#a68e5af6e139405023554457b6ac42c0c" title="Writes out the information in this block in NEXUS format to the specified std::ostream...">NxsUnalignedBlock::WriteAsNexus</a>(
<a name="l00701"></a>00701   std::ostream &amp; out)   <span class="comment">/* is the output stream on which to write */</span><span class="keyword"></span>
<a name="l00702"></a>00702 <span class="keyword">  const</span>
<a name="l00703"></a>00703 <span class="keyword">    </span>{
<a name="l00704"></a>00704     out &lt;&lt; <span class="stringliteral">&quot;BEGIN UNALIGNED;\n&quot;</span>;
<a name="l00705"></a>00705     WriteBasicBlockCommands(out);
<a name="l00706"></a>00706     <span class="keywordflow">if</span> (this-&gt;taxa &amp;&amp; taxa-&gt;<a class="code" href="classNxsTaxaBlockAPI_ad875bc0358bc242d998a1e84f5cefccb.html#ad875bc0358bc242d998a1e84f5cefccb">GetNumTaxonLabels</a>() &gt; this-&gt;nTaxWithData)
<a name="l00707"></a>00707         out &lt;&lt; <span class="stringliteral">&quot;    DIMENSIONS NTax=&quot;</span> &lt;&lt; this-&gt;nTaxWithData &lt;&lt; <span class="stringliteral">&quot;;\n&quot;</span>;
<a name="l00708"></a>00708 
<a name="l00709"></a>00709     this-&gt;<a class="code" href="classNxsUnalignedBlock_a15fd0a57cea954520a60ee4ef4d8cd1f.html#a15fd0a57cea954520a60ee4ef4d8cd1f" title="Writes out the information in the FORMAT command in NEXUS format to the specified...">WriteFormatCommand</a>(out);
<a name="l00710"></a>00710     this-&gt;<a class="code" href="classNxsUnalignedBlock_a27f2d8de08c2cb402480814a5157783c.html#a27f2d8de08c2cb402480814a5157783c" title="Writes out the information in the MATRIX command in NEXUS format to the specified...">WriteMatrixCommand</a>(out);
<a name="l00711"></a>00711     WriteSkippedCommands(out);
<a name="l00712"></a>00712     out &lt;&lt; <span class="stringliteral">&quot;END;\n&quot;</span>;
<a name="l00713"></a>00713     }
<a name="l00714"></a>00714 
<a name="l00718"></a><a class="code" href="classNxsUnalignedBlock_a27f2d8de08c2cb402480814a5157783c.html#a27f2d8de08c2cb402480814a5157783c">00718</a> <span class="keywordtype">void</span> <a class="code" href="classNxsUnalignedBlock_a27f2d8de08c2cb402480814a5157783c.html#a27f2d8de08c2cb402480814a5157783c" title="Writes out the information in the MATRIX command in NEXUS format to the specified...">NxsUnalignedBlock::WriteMatrixCommand</a>(
<a name="l00719"></a>00719   std::ostream &amp; out)   <span class="comment">/* is the output stream on which to print the matrix */</span><span class="keyword"></span>
<a name="l00720"></a>00720 <span class="keyword">  const</span>
<a name="l00721"></a>00721 <span class="keyword">    </span>{
<a name="l00722"></a>00722     NCL_ASSERT(taxa);
<a name="l00723"></a>00723     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ntax = taxa-&gt;<a class="code" href="classNxsTaxaBlockAPI_a3e9b998d97ad05914bda0d616069c26f.html#a3e9b998d97ad05914bda0d616069c26f">GetNTax</a>();
<a name="l00724"></a>00724     <span class="keywordtype">unsigned</span> width = taxa-&gt;<a class="code" href="classNxsTaxaBlockAPI_a50ef9fdb2944f553fc3a4d4dd94cd1ef.html#a50ef9fdb2944f553fc3a4d4dd94cd1ef">GetMaxTaxonLabelLength</a>();
<a name="l00725"></a>00725     out &lt;&lt; <span class="stringliteral">&quot;Matrix&quot;</span>;
<a name="l00726"></a>00726 
<a name="l00727"></a>00727     <span class="comment">//std::vector&lt;unsigned&gt; origIndexVec = this-&gt;GetOrigMatrixIndicesToWrite();</span>
<a name="l00728"></a>00728     <span class="keywordtype">bool</span> first = <span class="keyword">true</span>;
<a name="l00729"></a>00729     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; ntax; ++i)
<a name="l00730"></a>00730         {
<a name="l00731"></a>00731         <span class="keywordflow">if</span> (!uMatrix[i].empty())
<a name="l00732"></a>00732             {
<a name="l00733"></a>00733             <span class="keywordflow">if</span> (first)
<a name="l00734"></a>00734                 out &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00735"></a>00735             <span class="keywordflow">else</span>
<a name="l00736"></a>00736                 out &lt;&lt; <span class="stringliteral">&quot;,\n&quot;</span>;
<a name="l00737"></a>00737             first = <span class="keyword">false</span>;
<a name="l00738"></a>00738             <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> nm = taxa-&gt;<a class="code" href="classNxsTaxaBlockAPI_ae172f21958353f1be42371f0cad7061d.html#ae172f21958353f1be42371f0cad7061d">GetTaxonLabel</a>(i); <span class="comment">/*v2.1to2.2 4 */</span>
<a name="l00739"></a>00739             std::string s = nm.c_str();
<a name="l00740"></a>00740             <span class="keyword">const</span> std::string currTaxonLabel = NxsString::GetEscaped(taxa-&gt;<a class="code" href="classNxsTaxaBlockAPI_ae172f21958353f1be42371f0cad7061d.html#ae172f21958353f1be42371f0cad7061d">GetTaxonLabel</a>(i));
<a name="l00741"></a>00741             out &lt;&lt; currTaxonLabel;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743             <span class="comment">// Print out enough spaces to even up the left edge of the matrix output</span>
<a name="l00744"></a>00744             <span class="keywordtype">unsigned</span> currTaxonLabelLen = (unsigned)currTaxonLabel.size();
<a name="l00745"></a>00745             <span class="keywordtype">unsigned</span> diff = width - currTaxonLabelLen;
<a name="l00746"></a>00746             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> k = 0; k &lt; diff + 5; k++)
<a name="l00747"></a>00747                 out &lt;&lt; <span class="charliteral">&#39; &#39;</span>;
<a name="l00748"></a>00748 
<a name="l00749"></a>00749             WriteStatesForMatrixRow(out, i);
<a name="l00750"></a>00750             }
<a name="l00751"></a>00751         }
<a name="l00752"></a>00752     out &lt;&lt; <span class="stringliteral">&quot;\n;\n&quot;</span>;
<a name="l00753"></a>00753     }
<a name="l00754"></a>00754 
<a name="l00755"></a>00755 <span class="keywordtype">void</span> NxsUnalignedBlock::WriteStatesForMatrixRow(
<a name="l00756"></a>00756   std::ostream &amp;out,                <span class="comment">/* the output stream on which to write */</span>
<a name="l00757"></a>00757   <span class="keywordtype">unsigned</span> currTaxonIndex) <span class="keyword">const</span>    <span class="comment">/* the taxon, in range [0..`ntax&#39;) */</span>
<a name="l00758"></a>00758     {
<a name="l00759"></a>00759     <span class="keyword">const</span> NxsDiscreteStateRow &amp; row = uMatrix[currTaxonIndex];
<a name="l00760"></a>00760     <span class="keywordflow">for</span> (NxsDiscreteStateRow::const_iterator rIt = row.begin(); rIt != row.end(); ++rIt)
<a name="l00761"></a>00761         mapper.WriteStateCodeAsNexusString(out, *rIt);
<a name="l00762"></a>00762     }
<a name="l00763"></a>00763 
<a name="l00764"></a>00764 
<a name="l00768"></a><a class="code" href="classNxsUnalignedBlock_a15fd0a57cea954520a60ee4ef4d8cd1f.html#a15fd0a57cea954520a60ee4ef4d8cd1f">00768</a> <span class="keywordtype">void</span> <a class="code" href="classNxsUnalignedBlock_a15fd0a57cea954520a60ee4ef4d8cd1f.html#a15fd0a57cea954520a60ee4ef4d8cd1f" title="Writes out the information in the FORMAT command in NEXUS format to the specified...">NxsUnalignedBlock::WriteFormatCommand</a>(std::ostream &amp;out)<span class="keyword"> const</span>
<a name="l00769"></a>00769 <span class="keyword">    </span>{
<a name="l00770"></a>00770     mapper.WriteStartOfFormatCommand(out);
<a name="l00771"></a>00771     <span class="keywordflow">if</span> (this-&gt;respectingCase)
<a name="l00772"></a>00772         out &lt;&lt; <span class="stringliteral">&quot; RespectCase&quot;</span>;
<a name="l00773"></a>00773     <span class="comment">// Output terminating semicolon</span>
<a name="l00774"></a>00774     out &lt;&lt; <span class="stringliteral">&quot;;\n&quot;</span>;
<a name="l00775"></a>00775     }
<a name="l00776"></a>00776 
<a name="l00777"></a>00777 <a class="code" href="classNxsUnalignedBlock.html" title="This class handles reading and storage for the NEXUS block UNALIGNED.">NxsUnalignedBlock</a> *NxsUnalignedBlockFactory::GetBlockReaderForID(<span class="keyword">const</span> std::string &amp; idneeded, <a class="code" href="classNxsReader.html" title="This is the class that orchestrates the reading of a NEXUS data file, and so is the...">NxsReader</a> *reader, <a class="code" href="classNxsToken.html">NxsToken</a> *)
<a name="l00778"></a>00778     {
<a name="l00779"></a>00779     <span class="keywordflow">if</span> (reader == NULL || idneeded != <span class="stringliteral">&quot;UNALIGNED&quot;</span>)
<a name="l00780"></a>00780         <span class="keywordflow">return</span> NULL;
<a name="l00781"></a>00781     <a class="code" href="classNxsUnalignedBlock.html" title="This class handles reading and storage for the NEXUS block UNALIGNED.">NxsUnalignedBlock</a> * nb  = <span class="keyword">new</span> <a class="code" href="classNxsUnalignedBlock_ad3a661c5f927c4d318565632c03ebb0c.html#ad3a661c5f927c4d318565632c03ebb0c" title="Initializes `id&amp;#39; to &amp;quot;UNALIGNED&amp;quot;, `taxa&amp;#39; to `tb&amp;#39;, `assumptionsBlock&amp;#39;...">NxsUnalignedBlock</a>(NULL);
<a name="l00782"></a>00782     nb-&gt;SetCreateImpliedBlock(<span class="keyword">true</span>);
<a name="l00783"></a>00783     nb-&gt;<a class="code" href="classNxsBlock_a1c26882db165367dcb8e7ada8d5b1aea.html#a1c26882db165367dcb8e7ada8d5b1aea" title="Should be called with SetImplementsLinkAPI(true) by all blocks that overload both:...">SetImplementsLinkAPI</a>(<span class="keyword">true</span>);
<a name="l00784"></a>00784     <span class="keywordflow">return</span> nb;
<a name="l00785"></a>00785     }
<a name="l00786"></a>00786 
<a name="l00800"></a><a class="code" href="classNxsUnalignedBlock_a4600aab59451cd5bf2798db38b26cf52.html#a4600aab59451cd5bf2798db38b26cf52">00800</a> NxsDiscreteStateRow <a class="code" href="classNxsUnalignedBlock_a4600aab59451cd5bf2798db38b26cf52.html#a4600aab59451cd5bf2798db38b26cf52" title="Returns internal representation of the state for taxon `i&amp;#39;, character `j&amp;#39;...">NxsUnalignedBlock::GetInternalRepresentation</a>(
<a name="l00801"></a>00801   <span class="keywordtype">unsigned</span> taxInd,  <span class="comment">/* is the index of the taxon in the TAXA block in range [0..`ntaxTotal&#39;) */</span>
<a name="l00802"></a>00802   <span class="keywordtype">unsigned</span> charInd) <span class="comment">/* is the character index (greater than or equal to 0) */</span>
<a name="l00803"></a>00803     {
<a name="l00804"></a>00804     <span class="keywordflow">if</span> (taxInd &gt;= uMatrix.size())
<a name="l00805"></a>00805         <span class="keywordflow">throw</span> NxsUnalignedBlock::NxsX_NoDataForTaxon(taxInd);
<a name="l00806"></a>00806     NxsDiscreteStateRow &amp; row = uMatrix[taxInd];
<a name="l00807"></a>00807     <span class="keywordflow">if</span> (charInd &gt;= (<span class="keywordtype">unsigned</span>)row.size())
<a name="l00808"></a>00808         <span class="keywordflow">return</span> NxsDiscreteStateRow();
<a name="l00809"></a>00809     <span class="keywordflow">return</span> mapper.<a class="code" href="classNxsDiscreteDatatypeMapper_a6e298a0157e729dd2f9fa437c9cac749.html#a6e298a0157e729dd2f9fa437c9cac749" title="Returns the set of state indices that correspond to the states of state code `c`...">GetStateVectorForCode</a>(row[charInd]);
<a name="l00810"></a>00810     }
<a name="l00811"></a>00811 
<a name="l00820"></a><a class="code" href="classNxsUnalignedBlock_aeeb0a377927720409439edfef0f76ffa.html#aeeb0a377927720409439edfef0f76ffa">00820</a> <span class="keywordtype">unsigned</span> <a class="code" href="classNxsUnalignedBlock_aeeb0a377927720409439edfef0f76ffa.html#aeeb0a377927720409439edfef0f76ffa" title="Returns number of characters stored for taxon whose index in the TAXA block is `i&amp;#39;...">NxsUnalignedBlock::NumCharsForTaxon</a>(
<a name="l00821"></a>00821   <span class="keywordtype">unsigned</span> taxInd)  <span class="comment">/* is the index of the taxon in range [0..`ntaxTotal&#39;) */</span>
<a name="l00822"></a>00822     {
<a name="l00823"></a>00823     <span class="keywordflow">if</span> (taxInd &gt;= uMatrix.size())
<a name="l00824"></a>00824         <span class="keywordflow">throw</span> NxsUnalignedBlock::NxsX_NoDataForTaxon(taxInd);
<a name="l00825"></a>00825     <span class="keywordflow">return</span> (<span class="keywordtype">unsigned</span>)uMatrix[taxInd].size();
<a name="l00826"></a>00826     }
<a name="l00827"></a>00827 
<a name="l00828"></a>00828 
<a name="l00837"></a><a class="code" href="classNxsUnalignedBlock_abf8019d97f9a3d3bedff8cf8d7dee639.html#abf8019d97f9a3d3bedff8cf8d7dee639">00837</a> <span class="keywordtype">unsigned</span> <a class="code" href="classNxsUnalignedBlock_abf8019d97f9a3d3bedff8cf8d7dee639.html#abf8019d97f9a3d3bedff8cf8d7dee639" title="Returns the number of states for taxon `i&amp;#39;, character `j&amp;#39;.">NxsUnalignedBlock::GetNumStates</a>(
<a name="l00838"></a>00838   <span class="keywordtype">unsigned</span> taxInd,  <span class="comment">/* the taxon in range [0..`ntaxTotal&#39;) */</span>
<a name="l00839"></a>00839   <span class="keywordtype">unsigned</span> charInd) <span class="comment">/* the character in range [0..`nchar&#39;) */</span>
<a name="l00840"></a>00840     {
<a name="l00841"></a>00841     <span class="keywordflow">if</span> (taxInd &gt;= uMatrix.size())
<a name="l00842"></a>00842         <span class="keywordflow">throw</span> NxsUnalignedBlock::NxsX_NoDataForTaxon(taxInd);
<a name="l00843"></a>00843     NxsDiscreteStateRow &amp; row = uMatrix[taxInd];
<a name="l00844"></a>00844     <span class="keywordflow">if</span> (charInd &gt;= (<span class="keywordtype">unsigned</span>)row.size())
<a name="l00845"></a>00845         <span class="keywordflow">return</span> UINT_MAX;
<a name="l00846"></a>00846     <span class="keywordflow">return</span> mapper.GetNumStatesInStateCode(row[charInd]);
<a name="l00847"></a>00847     }
<a name="l00848"></a>00848 
<a name="l00857"></a><a class="code" href="classNxsUnalignedBlock_a6bde3a8a230281d84ac947e18d3f1218.html#a6bde3a8a230281d84ac947e18d3f1218">00857</a> <span class="keywordtype">bool</span> <a class="code" href="classNxsUnalignedBlock_a6bde3a8a230281d84ac947e18d3f1218.html#a6bde3a8a230281d84ac947e18d3f1218" title="Returns true if the state at taxon `taxInd&amp;#39;, character `j&amp;#39; is the missing...">NxsUnalignedBlock::IsMissingState</a>(
<a name="l00858"></a>00858   <span class="keywordtype">unsigned</span> taxInd,  <span class="comment">/* the taxon, in range [0..`ntaxTotal&#39;) */</span>
<a name="l00859"></a>00859   <span class="keywordtype">unsigned</span> charInd) <span class="comment">/* the character, in range [0..infinity) */</span>
<a name="l00860"></a>00860     {
<a name="l00861"></a>00861     <span class="keywordflow">if</span> (taxInd &gt;= uMatrix.size())
<a name="l00862"></a>00862         <span class="keywordflow">throw</span> <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(<span class="stringliteral">&quot;Taxon index out of range of NxsUnalignedBlock::IsMissingState&quot;</span>);
<a name="l00863"></a>00863     NxsDiscreteStateRow &amp; row = uMatrix[taxInd];
<a name="l00864"></a>00864     <span class="keywordflow">if</span> (charInd &gt;= (<span class="keywordtype">unsigned</span>)row.size())
<a name="l00865"></a>00865         <span class="keywordflow">throw</span> <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(<span class="stringliteral">&quot;Character index out of range of NxsUnalignedBlock::IsMissingState&quot;</span>);
<a name="l00866"></a>00866     <span class="keywordflow">return</span> mapper.GetNumStates()  == (unsigned) row[charInd];
<a name="l00867"></a>00867     }
<a name="l00868"></a>00868 
<a name="l00878"></a><a class="code" href="classNxsUnalignedBlock_a487d9097345be423ddbfeb071cd6d1f7.html#a487d9097345be423ddbfeb071cd6d1f7">00878</a> <span class="keywordtype">bool</span> <a class="code" href="classNxsUnalignedBlock_a487d9097345be423ddbfeb071cd6d1f7.html#a487d9097345be423ddbfeb071cd6d1f7" title="Returns true if taxon `taxInd&amp;#39; is polymorphic for character `j&amp;#39;, false otherwise...">NxsUnalignedBlock::IsPolymorphic</a>(
<a name="l00879"></a>00879   <span class="keywordtype">unsigned</span> taxInd,  <span class="comment">/* the taxon in range [0..`ntaxTotal&#39;) */</span>
<a name="l00880"></a>00880   <span class="keywordtype">unsigned</span> charInd) <span class="comment">/* the character in range [0..infinity) */</span>
<a name="l00881"></a>00881     {
<a name="l00882"></a>00882     <span class="keywordflow">if</span> (taxInd &gt;= uMatrix.size())
<a name="l00883"></a>00883         <span class="keywordflow">throw</span> <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(<span class="stringliteral">&quot;Taxon index out of range of NxsUnalignedBlock::IsMissingState&quot;</span>);
<a name="l00884"></a>00884     NxsDiscreteStateRow &amp; row = uMatrix[taxInd];
<a name="l00885"></a>00885     <span class="keywordflow">if</span> (charInd &gt;= (<span class="keywordtype">unsigned</span>)row.size())
<a name="l00886"></a>00886         <span class="keywordflow">throw</span> <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(<span class="stringliteral">&quot;Character index out of range of NxsUnalignedBlock::IsMissingState&quot;</span>);
<a name="l00887"></a>00887     <span class="keywordflow">return</span> mapper.<a class="code" href="classNxsDiscreteDatatypeMapper_afe4f8b3edb65863211bcd5a2746215e3.html#afe4f8b3edb65863211bcd5a2746215e3" title="Returns true if the state code maps to a collection of states that were flagged as...">IsPolymorphic</a>(row[charInd]);
<a name="l00888"></a>00888     }
<a name="l00889"></a>00889 
<a name="l00890"></a>00890 
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Mon Mar 29 16:37:12 2010 for NCL by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
