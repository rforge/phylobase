<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>NCL: nxsassumptionsblock.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>nxsassumptionsblock.cpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//  Copyright (C) 1999-2003 Paul O. Lewis</span>
<a name="l00002"></a>00002 <span class="comment">//</span>
<a name="l00003"></a>00003 <span class="comment">//  This file is part of NCL (Nexus Class Library) version 2.0.</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">//  NCL is free software; you can redistribute it and/or modify</span>
<a name="l00006"></a>00006 <span class="comment">//  it under the terms of the GNU General Public License as published by</span>
<a name="l00007"></a>00007 <span class="comment">//  the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00008"></a>00008 <span class="comment">//  (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment">//</span>
<a name="l00010"></a>00010 <span class="comment">//  NCL is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment">//  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment">//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<a name="l00013"></a>00013 <span class="comment">//  GNU General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment">//</span>
<a name="l00015"></a>00015 <span class="comment">//  You should have received a copy of the GNU General Public License</span>
<a name="l00016"></a>00016 <span class="comment">//  along with NCL; if not, write to the Free Software Foundation, Inc.,</span>
<a name="l00017"></a>00017 <span class="comment">//  59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<a name="l00018"></a>00018 <span class="comment">//</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;iomanip&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;climits&gt;</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;ncl/nxsassumptionsblock.h&quot;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;ncl/nxssetreader.h&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;ncl/nxsreader.h&quot;</span>
<a name="l00026"></a>00026 <span class="keyword">using namespace </span>std;
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="keyword">class </span>BogusToIndMapper: <span class="keyword">public</span> <a class="code" href="classNxsLabelToIndicesMapper.html" title="This is the base class for the block interfaces that correspond to blocks that hold...">NxsLabelToIndicesMapper</a>
<a name="l00029"></a>00029     {
<a name="l00030"></a>00030     <span class="keyword">public</span>:
<a name="l00031"></a>00031         BogusToIndMapper()
<a name="l00032"></a>00032             :queried(false)
<a name="l00033"></a>00033             {}
<a name="l00034"></a>00034         <span class="keyword">virtual</span> ~BogusToIndMapper(){}
<a name="l00035"></a>00035         <span class="keyword">virtual</span> <span class="keywordtype">unsigned</span> GetMaxIndex()<span class="keyword"> const</span>
<a name="l00036"></a>00036 <span class="keyword">            </span>{
<a name="l00037"></a>00037             <span class="keywordflow">return</span> UINT_MAX;
<a name="l00038"></a>00038             }
<a name="l00039"></a>00039         <span class="keyword">virtual</span> <span class="keywordtype">unsigned</span> GetIndicesForLabel(<span class="keyword">const</span> std::string &amp;label, NxsUnsignedSet *)<span class="keyword"> const</span>
<a name="l00040"></a>00040 <span class="keyword">            </span>{
<a name="l00041"></a>00041             queried=<span class="keyword">true</span>;
<a name="l00042"></a>00042             <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> e;
<a name="l00043"></a>00043             e &lt;&lt; <span class="stringliteral">&quot;The symbol &quot;</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">&quot; was not recognized&quot;</span>;
<a name="l00044"></a>00044             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(e);
<a name="l00045"></a>00045             }
<a name="l00046"></a>00046 
<a name="l00047"></a>00047         <span class="keyword">virtual</span> <span class="keywordtype">unsigned</span> GetIndexSet(<span class="keyword">const</span> std::string &amp;, NxsUnsignedSet * )<span class="keyword"> const</span>
<a name="l00048"></a>00048 <span class="keyword">            </span>{
<a name="l00049"></a>00049             <span class="keywordflow">return</span> 0;
<a name="l00050"></a>00050             }
<a name="l00051"></a>00051         <span class="keyword">virtual</span> <span class="keywordtype">bool</span> AddNewIndexSet(<span class="keyword">const</span> std::string &amp;, <span class="keyword">const</span> NxsUnsignedSet &amp; )
<a name="l00052"></a>00052             {
<a name="l00053"></a>00053             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00054"></a>00054             }
<a name="l00055"></a>00055         <span class="keyword">virtual</span> <span class="keywordtype">bool</span> AddNewPartition(<span class="keyword">const</span> std::string &amp;, <span class="keyword">const</span> NxsPartition &amp; )
<a name="l00056"></a>00056             {
<a name="l00057"></a>00057             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00058"></a>00058             }
<a name="l00059"></a>00059 
<a name="l00061"></a>00061         <span class="keyword">virtual</span> <span class="keywordtype">unsigned</span> AppendNewLabel(std::string &amp;label)
<a name="l00062"></a>00062             {
<a name="l00063"></a>00063             queried=<span class="keyword">true</span>;
<a name="l00064"></a>00064             <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> e;
<a name="l00065"></a>00065             e &lt;&lt; <span class="stringliteral">&quot;The symbol &quot;</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">&quot; was not recognized&quot;</span>;
<a name="l00066"></a>00066             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(e);
<a name="l00067"></a>00067             }
<a name="l00068"></a>00068 
<a name="l00069"></a>00069         std::vector&lt;std::string&gt; GetLabels()<span class="keyword"> const</span>
<a name="l00070"></a>00070 <span class="keyword">            </span>{
<a name="l00071"></a>00071             queried=<span class="keyword">true</span>;
<a name="l00072"></a>00072             <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> e;
<a name="l00073"></a>00073             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(e);
<a name="l00074"></a>00074             }
<a name="l00075"></a>00075         <span class="keyword">mutable</span> <span class="keywordtype">bool</span> queried;
<a name="l00076"></a>00076     };
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="keywordtype">void</span> NxsTransformationManager::Reset()
<a name="l00080"></a>00080     {
<a name="l00081"></a>00081     standardTypeNames.clear();
<a name="l00082"></a>00082     standardTypeNames.insert(<span class="stringliteral">&quot;UNORD&quot;</span>);
<a name="l00083"></a>00083     standardTypeNames.insert(<span class="stringliteral">&quot;ORD&quot;</span>);
<a name="l00084"></a>00084     standardTypeNames.insert(<span class="stringliteral">&quot;IRREV&quot;</span>);
<a name="l00085"></a>00085     standardTypeNames.insert(<span class="stringliteral">&quot;IRREV.UP&quot;</span>);
<a name="l00086"></a>00086     standardTypeNames.insert(<span class="stringliteral">&quot;IRREV.DOWN&quot;</span>);
<a name="l00087"></a>00087     standardTypeNames.insert(<span class="stringliteral">&quot;DOLLO&quot;</span>);
<a name="l00088"></a>00088     standardTypeNames.insert(<span class="stringliteral">&quot;DOLLO.UP&quot;</span>);
<a name="l00089"></a>00089     standardTypeNames.insert(<span class="stringliteral">&quot;DOLLO.DOWN&quot;</span>);
<a name="l00090"></a>00090     standardTypeNames.insert(<span class="stringliteral">&quot;STRAT&quot;</span>);
<a name="l00091"></a>00091     standardTypeNames.insert(<span class="stringliteral">&quot;SQUARED&quot;</span>); <span class="comment">/* new in Mesquite */</span>
<a name="l00092"></a>00092     standardTypeNames.insert(<span class="stringliteral">&quot;LINEAR&quot;</span>); <span class="comment">/* new in Mesquite */</span>
<a name="l00093"></a>00093     allTypeNames.clear();
<a name="l00094"></a>00094     allTypeNames.insert(standardTypeNames.begin(), standardTypeNames.end());
<a name="l00095"></a>00095 
<a name="l00096"></a>00096     userTypeNames.clear();
<a name="l00097"></a>00097     dblUserTypes.clear();
<a name="l00098"></a>00098     intUserTypes.clear();
<a name="l00099"></a>00099     dblWtSets.clear();
<a name="l00100"></a>00100     intWtSets.clear();
<a name="l00101"></a>00101     typeSets.clear();
<a name="l00102"></a>00102     def_wtset.clear();
<a name="l00103"></a>00103     def_typeset.clear();
<a name="l00104"></a>00104     def_type.clear();
<a name="l00105"></a>00105     }
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 <span class="keywordtype">void</span> NxsTransformationManager::WriteUserType(std::ostream &amp;out)<span class="keyword"> const</span>
<a name="l00108"></a>00108 <span class="keyword">    </span>{
<a name="l00109"></a>00109     <span class="keywordflow">if</span> (dblUserTypes.empty() &amp;&amp; intUserTypes.empty())
<a name="l00110"></a>00110         <span class="keywordflow">return</span>;
<a name="l00111"></a>00111     <span class="keywordflow">for</span> (std::map&lt;std::string, NxsRealStepMatrix&gt;::const_iterator csIt = dblUserTypes.begin(); csIt != dblUserTypes.end(); ++csIt)
<a name="l00112"></a>00112         {
<a name="l00113"></a>00113         out &lt;&lt; <span class="stringliteral">&quot;    UserType &quot;</span>;
<a name="l00114"></a>00114         out &lt;&lt; <a class="code" href="classNxsToken_a9f41ec322921ff9cadad0ec566eaa0b5.html#a9f41ec322921ff9cadad0ec566eaa0b5" title="Returns copy of s but with quoting according to the NEXUS Standard iff s needs to...">NexusToken::EscapeString</a>(csIt-&gt;first) &lt;&lt; <span class="stringliteral">&quot; (Stepmatrix) = &quot;</span>;
<a name="l00115"></a>00115         <span class="keyword">const</span> <a class="code" href="classNxsRealStepMatrix.html" title="Internal representation of a stepmatrix with cells composed of doubles.">NxsRealStepMatrix</a> &amp; p = csIt-&gt;second;
<a name="l00116"></a>00116         <span class="keyword">const</span> std::vector&lt;std::string&gt; &amp; states = p.GetSymbols();
<a name="l00117"></a>00117         <span class="keyword">const</span> NxsRealStepMatrix::DblMatrix &amp; mat = p.GetMatrix();
<a name="l00118"></a>00118         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> nStates = (<span class="keyword">const</span> unsigned)states.size();
<a name="l00119"></a>00119         out &lt;&lt; nStates;
<a name="l00120"></a>00120         out &lt;&lt; <span class="stringliteral">&quot;\n    &quot;</span>;
<a name="l00121"></a>00121         <span class="keywordflow">for</span> (std::vector&lt;std::string&gt;::const_iterator sIt = states.begin(); sIt != states.end(); ++sIt)
<a name="l00122"></a>00122             out &lt;&lt; <span class="stringliteral">&quot;   &quot;</span>&lt;&lt; NxsString::GetEscaped(*sIt) ;
<a name="l00123"></a>00123         <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> n;
<a name="l00124"></a>00124         std::ios::fmtflags prevflags = out.setf(std::ios::showpoint);
<a name="l00125"></a>00125         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; nStates; ++i)
<a name="l00126"></a>00126             {
<a name="l00127"></a>00127             out &lt;&lt; <span class="stringliteral">&quot;\n    &quot;</span>;
<a name="l00128"></a>00128             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; nStates; ++j)
<a name="l00129"></a>00129                 {
<a name="l00130"></a>00130                 <span class="keyword">const</span> <span class="keywordtype">double</span> el = mat.at(i).at(j);
<a name="l00131"></a>00131                 <span class="keywordflow">if</span> (i == j &amp;&amp; el == 0.0)
<a name="l00132"></a>00132                     out &lt;&lt; <span class="stringliteral">&quot;   .&quot;</span>;
<a name="l00133"></a>00133                 <span class="keywordflow">else</span>
<a name="l00134"></a>00134                     {
<a name="l00135"></a>00135                     n.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l00136"></a>00136                     <span class="keywordflow">if</span> (el == DBL_MAX)
<a name="l00137"></a>00137                         n += <span class="stringliteral">&quot;i&quot;</span>;
<a name="l00138"></a>00138                     <span class="keywordflow">else</span>
<a name="l00139"></a>00139                         n += el;
<a name="l00140"></a>00140                     out &lt;&lt; <span class="stringliteral">&quot;   &quot;</span> &lt;&lt; NxsString::GetEscaped(n);
<a name="l00141"></a>00141                     }
<a name="l00142"></a>00142                 }
<a name="l00143"></a>00143             }
<a name="l00144"></a>00144         out.flags(prevflags);
<a name="l00145"></a>00145         out &lt;&lt; <span class="stringliteral">&quot;;\n&quot;</span>;
<a name="l00146"></a>00146         }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148     <span class="keywordflow">for</span> (std::map&lt;std::string, NxsIntStepMatrix&gt;::const_iterator csIt = intUserTypes.begin(); csIt != intUserTypes.end(); ++csIt)
<a name="l00149"></a>00149         {
<a name="l00150"></a>00150         out &lt;&lt; <span class="stringliteral">&quot;    UserType &quot;</span>;
<a name="l00151"></a>00151         out &lt;&lt; <a class="code" href="classNxsToken_a9f41ec322921ff9cadad0ec566eaa0b5.html#a9f41ec322921ff9cadad0ec566eaa0b5" title="Returns copy of s but with quoting according to the NEXUS Standard iff s needs to...">NexusToken::EscapeString</a>(csIt-&gt;first) &lt;&lt; <span class="stringliteral">&quot; (Stepmatrix) = &quot;</span>;
<a name="l00152"></a>00152         <span class="keyword">const</span> <a class="code" href="classNxsIntStepMatrix.html" title="Internal representation of a stepmatrix with cells composed of ints.">NxsIntStepMatrix</a> &amp; p = csIt-&gt;second;
<a name="l00153"></a>00153         <span class="keyword">const</span> std::vector&lt;std::string&gt; &amp; states = p.GetSymbols();
<a name="l00154"></a>00154         <span class="keyword">const</span> NxsIntStepMatrix::IntMatrix &amp; mat = p.GetMatrix();
<a name="l00155"></a>00155         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> nStates = (<span class="keyword">const</span> unsigned)states.size();
<a name="l00156"></a>00156         out &lt;&lt; nStates;
<a name="l00157"></a>00157         out &lt;&lt; <span class="stringliteral">&quot;\n    &quot;</span>;
<a name="l00158"></a>00158         <span class="keywordflow">for</span> (std::vector&lt;std::string&gt;::const_iterator sIt = states.begin(); sIt != states.end(); ++sIt)
<a name="l00159"></a>00159             out &lt;&lt; <span class="stringliteral">&quot;   &quot;</span>&lt;&lt; NxsString::GetEscaped(*sIt) ;
<a name="l00160"></a>00160         <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> n;
<a name="l00161"></a>00161         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; nStates; ++i)
<a name="l00162"></a>00162             {
<a name="l00163"></a>00163             out &lt;&lt; <span class="stringliteral">&quot;\n    &quot;</span>;
<a name="l00164"></a>00164             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; nStates; ++j)
<a name="l00165"></a>00165                 {
<a name="l00166"></a>00166                 <span class="keyword">const</span> <span class="keywordtype">int</span> el = mat.at(i).at(j);
<a name="l00167"></a>00167                 <span class="keywordflow">if</span> (i == j &amp;&amp; el == 0)
<a name="l00168"></a>00168                     out &lt;&lt; <span class="stringliteral">&quot;   .&quot;</span>;
<a name="l00169"></a>00169                 <span class="keywordflow">else</span>
<a name="l00170"></a>00170                     {
<a name="l00171"></a>00171                     <span class="keywordflow">if</span> (el == INT_MAX)
<a name="l00172"></a>00172                         n = <span class="stringliteral">&quot;i&quot;</span>;
<a name="l00173"></a>00173                     <span class="keywordflow">else</span>
<a name="l00174"></a>00174                         {
<a name="l00175"></a>00175                         n.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l00176"></a>00176                         n += el;
<a name="l00177"></a>00177                         }
<a name="l00178"></a>00178                     out &lt;&lt; <span class="stringliteral">&quot;   &quot;</span> &lt;&lt; NxsString::GetEscaped(n);
<a name="l00179"></a>00179                     }
<a name="l00180"></a>00180                 }
<a name="l00181"></a>00181             }
<a name="l00182"></a>00182         out &lt;&lt; <span class="stringliteral">&quot;;\n&quot;</span>;
<a name="l00183"></a>00183         }
<a name="l00184"></a>00184     }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186 <span class="keywordtype">void</span> NxsTransformationManager::WriteWtSet(std::ostream &amp;out)<span class="keyword"> const</span>
<a name="l00187"></a>00187 <span class="keyword">    </span>{
<a name="l00188"></a>00188     <span class="keywordflow">if</span> (dblWtSets.empty() &amp;&amp; intWtSets.empty())
<a name="l00189"></a>00189         <span class="keywordflow">return</span>;
<a name="l00190"></a>00190     <span class="keyword">const</span> <span class="keywordtype">char</span> * dtp = (def_wtset.empty() ? NULL : def_wtset.c_str());
<a name="l00191"></a>00191     <span class="keywordflow">for</span> (std::map&lt;std::string, ListOfDblWeights&gt;::const_iterator csIt = dblWtSets.begin(); csIt != dblWtSets.end(); ++csIt)
<a name="l00192"></a>00192         {
<a name="l00193"></a>00193         out &lt;&lt; <span class="stringliteral">&quot;    WtSet &quot;</span>;
<a name="l00194"></a>00194         <span class="keywordflow">if</span> (NxsString::case_insensitive_equals(csIt-&gt;first.c_str(), dtp))
<a name="l00195"></a>00195             out &lt;&lt; <span class="stringliteral">&quot;* &quot;</span>;
<a name="l00196"></a>00196         out &lt;&lt; <a class="code" href="classNxsToken_a9f41ec322921ff9cadad0ec566eaa0b5.html#a9f41ec322921ff9cadad0ec566eaa0b5" title="Returns copy of s but with quoting according to the NEXUS Standard iff s needs to...">NexusToken::EscapeString</a>(csIt-&gt;first) &lt;&lt; <span class="stringliteral">&quot; =&quot;</span>;
<a name="l00197"></a>00197         <span class="keyword">const</span> ListOfDblWeights &amp; p = csIt-&gt;second;
<a name="l00198"></a>00198         <span class="keywordtype">bool</span> first = <span class="keyword">true</span>;
<a name="l00199"></a>00199         <span class="keywordflow">for</span> (ListOfDblWeights::const_iterator pIt = p.begin(); pIt != p.end(); ++pIt)
<a name="l00200"></a>00200             {
<a name="l00201"></a>00201             <span class="keyword">const</span> DblWeightToIndexSet &amp; g = *pIt;
<a name="l00202"></a>00202             <span class="keywordflow">if</span> (!first)
<a name="l00203"></a>00203                 out &lt;&lt; <span class="charliteral">&#39;,&#39;</span>;
<a name="l00204"></a>00204             out &lt;&lt; <span class="stringliteral">&quot; \&#39;&quot;</span> &lt;&lt; g.first &lt;&lt; <span class="stringliteral">&quot;&#39; :&quot;</span>;
<a name="l00205"></a>00205             NxsSetReader::WriteSetAsNexusValue(g.second, out);
<a name="l00206"></a>00206             first = <span class="keyword">false</span>;
<a name="l00207"></a>00207             }
<a name="l00208"></a>00208         out &lt;&lt; <span class="stringliteral">&quot;;\n&quot;</span>;
<a name="l00209"></a>00209         }
<a name="l00210"></a>00210     <span class="keywordflow">for</span> (std::map&lt;std::string, ListOfIntWeights&gt;::const_iterator csIt = intWtSets.begin(); csIt != intWtSets.end(); ++csIt)
<a name="l00211"></a>00211         {
<a name="l00212"></a>00212         out &lt;&lt; <span class="stringliteral">&quot;    WtSet &quot;</span>;
<a name="l00213"></a>00213         <span class="keywordflow">if</span> (NxsString::case_insensitive_equals(csIt-&gt;first.c_str(), dtp))
<a name="l00214"></a>00214             out &lt;&lt; <span class="stringliteral">&quot;* &quot;</span>;
<a name="l00215"></a>00215         out &lt;&lt; <a class="code" href="classNxsToken_a9f41ec322921ff9cadad0ec566eaa0b5.html#a9f41ec322921ff9cadad0ec566eaa0b5" title="Returns copy of s but with quoting according to the NEXUS Standard iff s needs to...">NexusToken::EscapeString</a>(csIt-&gt;first) &lt;&lt; <span class="stringliteral">&quot; =&quot;</span>;
<a name="l00216"></a>00216         <span class="keyword">const</span> ListOfIntWeights &amp; p = csIt-&gt;second;
<a name="l00217"></a>00217         <span class="keywordtype">bool</span> first = <span class="keyword">true</span>;
<a name="l00218"></a>00218         <span class="keywordflow">for</span> (ListOfIntWeights::const_iterator pIt = p.begin(); pIt != p.end(); ++pIt)
<a name="l00219"></a>00219             {
<a name="l00220"></a>00220             <span class="keyword">const</span> IntWeightToIndexSet &amp; g = *pIt;
<a name="l00221"></a>00221             <span class="keywordflow">if</span> (!first)
<a name="l00222"></a>00222                 out &lt;&lt; <span class="charliteral">&#39;,&#39;</span>;
<a name="l00223"></a>00223             out &lt;&lt; <span class="stringliteral">&quot; \&#39;&quot;</span> &lt;&lt; g.first &lt;&lt; <span class="stringliteral">&quot;&#39; :&quot;</span>;
<a name="l00224"></a>00224             NxsSetReader::WriteSetAsNexusValue(g.second, out);
<a name="l00225"></a>00225             first = <span class="keyword">false</span>;
<a name="l00226"></a>00226             }
<a name="l00227"></a>00227         out &lt;&lt; <span class="stringliteral">&quot;;\n&quot;</span>;
<a name="l00228"></a>00228         }
<a name="l00229"></a>00229     }
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 
<a name="l00235"></a><a class="code" href="classNxsTransformationManager_a720487e62ceb55bc37e6f4e154b3850c.html#a720487e62ceb55bc37e6f4e154b3850c">00235</a> <span class="keywordtype">void</span> <a class="code" href="classNxsTransformationManager_a720487e62ceb55bc37e6f4e154b3850c.html#a720487e62ceb55bc37e6f4e154b3850c" title="Returns -1 if `index` is not in `wtset`.">NxsTransformationManager::SetDefaultTypeName</a>(<span class="keyword">const</span> std::string &amp;n)
<a name="l00236"></a>00236     {
<a name="l00237"></a>00237     <span class="keywordflow">if</span> (!(n.empty() || <a class="code" href="classNxsTransformationManager_ab72c47de22344f0e6a79717fa1299314.html#ab72c47de22344f0e6a79717fa1299314" title="Returns true if `n` is the name of a known type (standard or user type) -- not case-sensitive...">IsValidTypeName</a>(n)))
<a name="l00238"></a>00238         {
<a name="l00239"></a>00239         <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> e(n.c_str());
<a name="l00240"></a>00240         e &lt;&lt; <span class="stringliteral">&quot; is not the name of a known type (and therefore is not a valid default type)&quot;</span>;
<a name="l00241"></a>00241         <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(e);
<a name="l00242"></a>00242         }
<a name="l00243"></a>00243     def_type = n;
<a name="l00244"></a>00244     }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 <span class="keywordtype">bool</span> NxsTransformationManager::IsEmpty()<span class="keyword"> const</span>
<a name="l00248"></a>00248 <span class="keyword">    </span>{
<a name="l00249"></a>00249     <span class="keywordflow">return</span> (userTypeNames.empty()
<a name="l00250"></a>00250             &amp;&amp; dblWtSets.empty()
<a name="l00251"></a>00251             &amp;&amp; intWtSets.empty()
<a name="l00252"></a>00252             &amp;&amp; typeSets.empty()
<a name="l00253"></a>00253             &amp;&amp; (def_type.empty() || !NxsString::case_insensitive_equals(def_type.c_str(), <span class="stringliteral">&quot;ORD&quot;</span>)));
<a name="l00254"></a>00254     }
<a name="l00255"></a>00255 
<a name="l00259"></a><a class="code" href="classNxsTransformationManager_a13d6b14673c970840d79b6b820bc3318.html#a13d6b14673c970840d79b6b820bc3318">00259</a> <span class="keywordtype">double</span> <a class="code" href="classNxsTransformationManager_a1dae32b90d73e116c00bd717c2576add.html#a1dae32b90d73e116c00bd717c2576add" title="character index which should be in the range in [0, nchar)">NxsTransformationManager::GetWeightForIndex</a>(<span class="keyword">const</span> ListOfDblWeights &amp; wtset, <span class="keywordtype">unsigned</span> index)
<a name="l00260"></a>00260     {
<a name="l00261"></a>00261     <span class="keywordflow">for</span> (ListOfDblWeights::const_iterator wIt = wtset.begin(); wIt != wtset.end(); ++wIt)
<a name="l00262"></a>00262         {
<a name="l00263"></a>00263         <span class="keywordflow">if</span> (wIt-&gt;second.count(index) &gt; 0)
<a name="l00264"></a>00264             <span class="keywordflow">return</span> wIt-&gt;first;
<a name="l00265"></a>00265         }
<a name="l00266"></a>00266     <span class="keywordflow">return</span> -1.0;
<a name="l00267"></a>00267     }
<a name="l00268"></a>00268 
<a name="l00272"></a><a class="code" href="classNxsTransformationManager_a1dae32b90d73e116c00bd717c2576add.html#a1dae32b90d73e116c00bd717c2576add">00272</a> <span class="keywordtype">int</span> <a class="code" href="classNxsTransformationManager_a1dae32b90d73e116c00bd717c2576add.html#a1dae32b90d73e116c00bd717c2576add" title="character index which should be in the range in [0, nchar)">NxsTransformationManager::GetWeightForIndex</a>(<span class="keyword">const</span> ListOfIntWeights &amp; wtset, <span class="keywordtype">unsigned</span> index)
<a name="l00273"></a>00273     {
<a name="l00274"></a>00274     <span class="keywordflow">for</span> (ListOfIntWeights::const_iterator wIt = wtset.begin(); wIt != wtset.end(); ++wIt)
<a name="l00275"></a>00275         {
<a name="l00276"></a>00276         <span class="keywordflow">if</span> (wIt-&gt;second.count(index) &gt; 0)
<a name="l00277"></a>00277             <span class="keywordflow">return</span> wIt-&gt;first;
<a name="l00278"></a>00278         }
<a name="l00279"></a>00279     <span class="keywordflow">return</span> 1;
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281 
<a name="l00285"></a><a class="code" href="classNxsTransformationManager_ace2ec0c644d4d45e22999d9b33a20b57.html#ace2ec0c644d4d45e22999d9b33a20b57">00285</a> <span class="keywordtype">bool</span> <a class="code" href="classNxsTransformationManager_ace2ec0c644d4d45e22999d9b33a20b57.html#ace2ec0c644d4d45e22999d9b33a20b57" title="Raises an NxsNCLAPIException if the `n` is not a type name.">NxsTransformationManager::IsIntType</a>(<span class="keyword">const</span> std::string &amp; n)<span class="keyword"> const</span>
<a name="l00286"></a>00286 <span class="keyword">    </span>{
<a name="l00287"></a>00287     std::string capName(n.c_str());
<a name="l00288"></a>00288     <a class="code" href="classNxsString_afa27910900e7e9f3bdc8d1b9753479a9.html#afa27910900e7e9f3bdc8d1b9753479a9" title="Capitalizes every character in s.">NxsString::to_upper</a>(capName);
<a name="l00289"></a>00289     <span class="keywordflow">if</span> (standardTypeNames.count(capName) &gt; 0)
<a name="l00290"></a>00290         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00291"></a>00291     <span class="keywordflow">if</span> (intUserTypes.find(capName) != intUserTypes.end())
<a name="l00292"></a>00292         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00293"></a>00293     <span class="keywordflow">if</span> (dblUserTypes.find(capName) != dblUserTypes.end())
<a name="l00294"></a>00294         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00295"></a>00295     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> errormsg = <span class="stringliteral">&quot;Type name &quot;</span>;
<a name="l00296"></a>00296     errormsg &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot; not found.&quot;</span>;
<a name="l00297"></a>00297     <span class="keywordflow">throw</span> <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(errormsg);
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 
<a name="l00304"></a><a class="code" href="classNxsTransformationManager_ab72c47de22344f0e6a79717fa1299314.html#ab72c47de22344f0e6a79717fa1299314">00304</a> <span class="keywordtype">bool</span> <a class="code" href="classNxsTransformationManager_ab72c47de22344f0e6a79717fa1299314.html#ab72c47de22344f0e6a79717fa1299314" title="Returns true if `n` is the name of a known type (standard or user type) -- not case-sensitive...">NxsTransformationManager::IsValidTypeName</a>(<span class="keyword">const</span> std::string &amp; n)<span class="keyword"> const</span>
<a name="l00305"></a>00305 <span class="keyword">    </span>{
<a name="l00306"></a>00306     std::string capName(n.c_str());
<a name="l00307"></a>00307     <a class="code" href="classNxsString_afa27910900e7e9f3bdc8d1b9753479a9.html#afa27910900e7e9f3bdc8d1b9753479a9" title="Capitalizes every character in s.">NxsString::to_upper</a>(capName);
<a name="l00308"></a>00308     <span class="keywordflow">return</span> (allTypeNames.count(capName) &gt; 0);
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310 
<a name="l00314"></a><a class="code" href="classNxsTransformationManager_a0db6bb31ceddbaa7bbb8c4bc722eea0d.html#a0db6bb31ceddbaa7bbb8c4bc722eea0d">00314</a> <span class="keywordtype">bool</span> <a class="code" href="classNxsTransformationManager_a0db6bb31ceddbaa7bbb8c4bc722eea0d.html#a0db6bb31ceddbaa7bbb8c4bc722eea0d" title="Raises an NxsNCLAPIException if the `n` is not a type name.">NxsTransformationManager::IsStandardType</a>(<span class="keyword">const</span> std::string &amp; n)<span class="keyword"> const</span>
<a name="l00315"></a>00315 <span class="keyword">    </span>{
<a name="l00316"></a>00316     std::string capName(n.c_str());
<a name="l00317"></a>00317     <a class="code" href="classNxsString_afa27910900e7e9f3bdc8d1b9753479a9.html#afa27910900e7e9f3bdc8d1b9753479a9" title="Capitalizes every character in s.">NxsString::to_upper</a>(capName);
<a name="l00318"></a>00318     <span class="keywordflow">return</span> (standardTypeNames.count(capName) &gt; 0);
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320 
<a name="l00326"></a><a class="code" href="classNxsTransformationManager_a0ab7ef12cbd80066ddcdb27683e34796.html#a0ab7ef12cbd80066ddcdb27683e34796">00326</a> <span class="keyword">const</span> <a class="code" href="classNxsIntStepMatrix.html" title="Internal representation of a stepmatrix with cells composed of ints.">NxsIntStepMatrix</a> &amp; <a class="code" href="classNxsTransformationManager_a0ab7ef12cbd80066ddcdb27683e34796.html#a0ab7ef12cbd80066ddcdb27683e34796" title="Returns the Stepmatrix for User Type with the name `n`.">NxsTransformationManager::GetIntType</a>(<span class="keyword">const</span> std::string &amp; n)<span class="keyword"> const</span>
<a name="l00327"></a>00327 <span class="keyword">    </span>{
<a name="l00328"></a>00328     std::string capName(n.c_str());
<a name="l00329"></a>00329     <a class="code" href="classNxsString_afa27910900e7e9f3bdc8d1b9753479a9.html#afa27910900e7e9f3bdc8d1b9753479a9" title="Capitalizes every character in s.">NxsString::to_upper</a>(capName);
<a name="l00330"></a>00330     <span class="keywordflow">if</span> (<a class="code" href="classNxsTransformationManager_a0db6bb31ceddbaa7bbb8c4bc722eea0d.html#a0db6bb31ceddbaa7bbb8c4bc722eea0d" title="Raises an NxsNCLAPIException if the `n` is not a type name.">IsStandardType</a>(n))
<a name="l00331"></a>00331         <span class="keywordflow">throw</span> <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(<span class="stringliteral">&quot;Standard (predefined) types cannot be fetched using GetIntType.&quot;</span>);
<a name="l00332"></a>00332 
<a name="l00333"></a>00333     std::map&lt;std::string, NxsIntStepMatrix&gt;::const_iterator i = intUserTypes.find(capName);
<a name="l00334"></a>00334     <span class="keywordflow">if</span> (i != intUserTypes.end())
<a name="l00335"></a>00335         <span class="keywordflow">return</span> i-&gt;second;
<a name="l00336"></a>00336     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> errormsg = <span class="stringliteral">&quot;Type name &quot;</span>;
<a name="l00337"></a>00337     errormsg &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot; not found.&quot;</span>;
<a name="l00338"></a>00338     <span class="keywordflow">throw</span> <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(errormsg);
<a name="l00339"></a>00339     }
<a name="l00340"></a>00340 
<a name="l00346"></a><a class="code" href="classNxsTransformationManager_a13d51a6ee858bb4264e333d5f474bdee.html#a13d51a6ee858bb4264e333d5f474bdee">00346</a> <span class="keyword">const</span> <a class="code" href="classNxsRealStepMatrix.html" title="Internal representation of a stepmatrix with cells composed of doubles.">NxsRealStepMatrix</a> &amp; <a class="code" href="classNxsTransformationManager_a13d51a6ee858bb4264e333d5f474bdee.html#a13d51a6ee858bb4264e333d5f474bdee" title="Returns the Stepmatrix for User Type with the name `n`.">NxsTransformationManager::GetRealType</a>(<span class="keyword">const</span> std::string &amp; n)<span class="keyword"> const</span>
<a name="l00347"></a>00347 <span class="keyword">    </span>{
<a name="l00348"></a>00348     std::string capName(n.c_str());
<a name="l00349"></a>00349     <a class="code" href="classNxsString_afa27910900e7e9f3bdc8d1b9753479a9.html#afa27910900e7e9f3bdc8d1b9753479a9" title="Capitalizes every character in s.">NxsString::to_upper</a>(capName);
<a name="l00350"></a>00350     std::map&lt;std::string, NxsRealStepMatrix&gt;::const_iterator i = dblUserTypes.find(capName);
<a name="l00351"></a>00351     <span class="keywordflow">if</span> (i != dblUserTypes.end())
<a name="l00352"></a>00352         <span class="keywordflow">return</span> i-&gt;second;
<a name="l00353"></a>00353     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> errormsg = <span class="stringliteral">&quot;Type name &quot;</span>;
<a name="l00354"></a>00354     errormsg &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot; not found.&quot;</span>;
<a name="l00355"></a>00355     <span class="keywordflow">throw</span> <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(errormsg);
<a name="l00356"></a>00356     }
<a name="l00357"></a>00357 
<a name="l00358"></a><a class="code" href="classNxsTransformationManager_a9b7090a580b51a65f6726647dfb23fb0.html#a9b7090a580b51a65f6726647dfb23fb0">00358</a> <span class="keyword">const</span> NxsIntStepMatrix::IntMatrix <a class="code" href="classNxsTransformationManager_a9b7090a580b51a65f6726647dfb23fb0.html#a9b7090a580b51a65f6726647dfb23fb0">NxsTransformationManager::GetOrderedType</a>(<span class="keywordtype">unsigned</span> nStates)
<a name="l00359"></a>00359     {
<a name="l00360"></a>00360     NxsIntStepMatrix::IntVec v(nStates, 1);
<a name="l00361"></a>00361     NxsIntStepMatrix::IntMatrix m(nStates, v);
<a name="l00362"></a>00362     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; nStates; ++i)
<a name="l00363"></a>00363         m[i][i] = 0;
<a name="l00364"></a>00364     <span class="keywordflow">return</span> m;
<a name="l00365"></a>00365     }
<a name="l00366"></a>00366 
<a name="l00367"></a><a class="code" href="classNxsTransformationManager_ae8806ece41deb8e8996fafc98484b6da.html#ae8806ece41deb8e8996fafc98484b6da">00367</a> <span class="keyword">const</span> NxsIntStepMatrix::IntMatrix <a class="code" href="classNxsTransformationManager_ae8806ece41deb8e8996fafc98484b6da.html#ae8806ece41deb8e8996fafc98484b6da">NxsTransformationManager::GetUnorderedType</a>(<span class="keywordtype">unsigned</span> nStates)
<a name="l00368"></a>00368     {
<a name="l00369"></a>00369     NxsIntStepMatrix::IntVec v(nStates, 0);
<a name="l00370"></a>00370     NxsIntStepMatrix::IntMatrix m(nStates, v);
<a name="l00371"></a>00371     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; nStates; ++i)
<a name="l00372"></a>00372         {
<a name="l00373"></a>00373         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; nStates; ++j)
<a name="l00374"></a>00374             {
<a name="l00375"></a>00375             <span class="keywordflow">if</span> (i &gt; j)
<a name="l00376"></a>00376                 m[i][j] = j - i;
<a name="l00377"></a>00377             <span class="keywordflow">else</span>
<a name="l00378"></a>00378                 m[i][j] = i - j;
<a name="l00379"></a>00379             }
<a name="l00380"></a>00380         }
<a name="l00381"></a>00381     <span class="keywordflow">return</span> m;
<a name="l00382"></a>00382     }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 
<a name="l00389"></a><a class="code" href="classNxsTransformationManager_adf35400da3a9e9e3d74f4084d08bf52e.html#adf35400da3a9e9e3d74f4084d08bf52e">00389</a> <span class="keywordtype">bool</span> <a class="code" href="classNxsTransformationManager_adf35400da3a9e9e3d74f4084d08bf52e.html#adf35400da3a9e9e3d74f4084d08bf52e" title="Raises an NxsNCLAPIException if the `name` is the name of a &amp;quot;standard&amp;quot;...">NxsTransformationManager::AddIntType</a>(<span class="keyword">const</span> std::string &amp;name, <span class="keyword">const</span> <a class="code" href="classNxsIntStepMatrix.html" title="Internal representation of a stepmatrix with cells composed of ints.">NxsIntStepMatrix</a> &amp;s)
<a name="l00390"></a>00390     {
<a name="l00391"></a>00391     std::string capName(name.c_str());
<a name="l00392"></a>00392     <a class="code" href="classNxsString_afa27910900e7e9f3bdc8d1b9753479a9.html#afa27910900e7e9f3bdc8d1b9753479a9" title="Capitalizes every character in s.">NxsString::to_upper</a>(capName);
<a name="l00393"></a>00393     <span class="keywordflow">if</span> (standardTypeNames.count(capName) &gt; 0)
<a name="l00394"></a>00394         {
<a name="l00395"></a>00395         <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> errormsg(name.c_str());
<a name="l00396"></a>00396         errormsg &lt;&lt;  <span class="stringliteral">&quot; is a predefined type which cannot be redefined&quot;</span>;
<a name="l00397"></a>00397         <span class="keywordflow">throw</span> <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(errormsg);
<a name="l00398"></a>00398         }
<a name="l00399"></a>00399     <span class="keywordtype">bool</span> replacing = intUserTypes.find(capName) != intUserTypes.end();
<a name="l00400"></a>00400     <span class="keywordflow">if</span> (!replacing &amp;&amp;  dblUserTypes.find(capName) != dblUserTypes.end())
<a name="l00401"></a>00401         {
<a name="l00402"></a>00402         replacing = <span class="keyword">true</span>;
<a name="l00403"></a>00403         dblUserTypes.erase(capName);
<a name="l00404"></a>00404         }
<a name="l00405"></a>00405     intUserTypes.insert(pair&lt;std::string, NxsIntStepMatrix&gt;(capName, s));
<a name="l00406"></a>00406     userTypeNames.insert(name);
<a name="l00407"></a>00407     allTypeNames.insert(capName);
<a name="l00408"></a>00408     <span class="keywordflow">return</span> replacing;
<a name="l00409"></a>00409     }
<a name="l00410"></a>00410 
<a name="l00415"></a><a class="code" href="classNxsTransformationManager_a8b912a987afbdb9ca09f67878799a815.html#a8b912a987afbdb9ca09f67878799a815">00415</a> <span class="keywordtype">bool</span> <a class="code" href="classNxsTransformationManager_a8b912a987afbdb9ca09f67878799a815.html#a8b912a987afbdb9ca09f67878799a815" title="Raises an NxsNCLAPIException if the `name` is the name of a &amp;quot;standard&amp;quot;...">NxsTransformationManager::AddRealType</a>(<span class="keyword">const</span> std::string &amp;name, <span class="keyword">const</span> <a class="code" href="classNxsRealStepMatrix.html" title="Internal representation of a stepmatrix with cells composed of doubles.">NxsRealStepMatrix</a> &amp;s)
<a name="l00416"></a>00416     {
<a name="l00417"></a>00417     std::string capName(name.c_str());
<a name="l00418"></a>00418     <a class="code" href="classNxsString_afa27910900e7e9f3bdc8d1b9753479a9.html#afa27910900e7e9f3bdc8d1b9753479a9" title="Capitalizes every character in s.">NxsString::to_upper</a>(capName);
<a name="l00419"></a>00419     <span class="keywordflow">if</span> (standardTypeNames.count(capName) &gt; 0)
<a name="l00420"></a>00420         {
<a name="l00421"></a>00421         <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> errormsg(name.c_str());
<a name="l00422"></a>00422         errormsg &lt;&lt;  <span class="stringliteral">&quot; is a predefined type which cannot be redefined&quot;</span>;
<a name="l00423"></a>00423         <span class="keywordflow">throw</span> <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(errormsg);
<a name="l00424"></a>00424         }
<a name="l00425"></a>00425     <span class="keywordtype">bool</span> replacing = dblUserTypes.find(capName) != dblUserTypes.end();
<a name="l00426"></a>00426     <span class="keywordflow">if</span> (!replacing &amp;&amp;  intUserTypes.find(capName) != intUserTypes.end())
<a name="l00427"></a>00427         {
<a name="l00428"></a>00428         replacing = <span class="keyword">true</span>;
<a name="l00429"></a>00429         intUserTypes.erase(capName);
<a name="l00430"></a>00430         }
<a name="l00431"></a>00431     dblUserTypes.insert(pair&lt;std::string, NxsRealStepMatrix&gt;(capName, s));
<a name="l00432"></a>00432     userTypeNames.insert(capName);
<a name="l00433"></a>00433     allTypeNames.insert(capName);
<a name="l00434"></a>00434     <span class="keywordflow">return</span> replacing;
<a name="l00435"></a>00435     }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437 <span class="keywordtype">bool</span> NxsTransformationManager::AddIntWeightSet(<span class="keyword">const</span> std::string &amp;name, <span class="keyword">const</span> NxsTransformationManager::ListOfIntWeights &amp;ws, <span class="keywordtype">bool</span> isDefault)
<a name="l00438"></a>00438     {
<a name="l00439"></a>00439     std::string capName(name.c_str());
<a name="l00440"></a>00440     <a class="code" href="classNxsString_afa27910900e7e9f3bdc8d1b9753479a9.html#afa27910900e7e9f3bdc8d1b9753479a9" title="Capitalizes every character in s.">NxsString::to_upper</a>(capName);
<a name="l00441"></a>00441     <span class="keywordtype">bool</span> replacing = intWtSets.find(capName) != intWtSets.end();
<a name="l00442"></a>00442     <span class="keywordflow">if</span> (!replacing &amp;&amp;  dblWtSets.find(capName) != dblWtSets.end())
<a name="l00443"></a>00443         {
<a name="l00444"></a>00444         replacing = <span class="keyword">true</span>;
<a name="l00445"></a>00445         dblWtSets.erase(capName);
<a name="l00446"></a>00446         }
<a name="l00447"></a>00447     intWtSets[capName] = ws;
<a name="l00448"></a>00448     <span class="keywordflow">if</span> (isDefault)
<a name="l00449"></a>00449         def_wtset = name;
<a name="l00450"></a>00450     <span class="keywordflow">return</span> replacing;
<a name="l00451"></a>00451     }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 <span class="keywordtype">bool</span> NxsTransformationManager::AddRealWeightSet(<span class="keyword">const</span> std::string &amp;name, <span class="keyword">const</span> NxsTransformationManager::ListOfDblWeights &amp;ws, <span class="keywordtype">bool</span> isDefault)
<a name="l00454"></a>00454     {
<a name="l00455"></a>00455     std::string capName(name.c_str());
<a name="l00456"></a>00456     <a class="code" href="classNxsString_afa27910900e7e9f3bdc8d1b9753479a9.html#afa27910900e7e9f3bdc8d1b9753479a9" title="Capitalizes every character in s.">NxsString::to_upper</a>(capName);
<a name="l00457"></a>00457     <span class="keywordtype">bool</span> replacing = dblWtSets.find(capName) != dblWtSets.end();
<a name="l00458"></a>00458     <span class="keywordflow">if</span> (!replacing &amp;&amp;  intWtSets.find(capName) != intWtSets.end())
<a name="l00459"></a>00459         {
<a name="l00460"></a>00460         replacing = <span class="keyword">true</span>;
<a name="l00461"></a>00461         intWtSets.erase(capName);
<a name="l00462"></a>00462         }
<a name="l00463"></a>00463     dblWtSets[capName] = ws;
<a name="l00464"></a>00464     <span class="keywordflow">if</span> (isDefault)
<a name="l00465"></a>00465         {
<a name="l00466"></a>00466         def_wtset = name;
<a name="l00467"></a>00467         }
<a name="l00468"></a>00468     <span class="keywordflow">return</span> replacing;
<a name="l00469"></a>00469     }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471 <span class="keywordtype">bool</span> NxsTransformationManager::AddTypeSet(<span class="keyword">const</span> std::string &amp;name, <span class="keyword">const</span> NxsPartition &amp;ts, <span class="keywordtype">bool</span> isDefault)
<a name="l00472"></a>00472     {
<a name="l00473"></a>00473     std::string capName(name.c_str());
<a name="l00474"></a>00474     <a class="code" href="classNxsString_afa27910900e7e9f3bdc8d1b9753479a9.html#afa27910900e7e9f3bdc8d1b9753479a9" title="Capitalizes every character in s.">NxsString::to_upper</a>(capName);
<a name="l00475"></a>00475     <span class="keywordtype">bool</span> replacing = typeSets.find(capName) != typeSets.end();
<a name="l00476"></a>00476     typeSets[capName] = ts;
<a name="l00477"></a>00477     <span class="keywordflow">if</span> (isDefault)
<a name="l00478"></a>00478         {
<a name="l00479"></a>00479         def_typeset = name;
<a name="l00480"></a>00480         }
<a name="l00481"></a>00481     <span class="keywordflow">return</span> replacing;
<a name="l00482"></a>00482     }
<a name="l00483"></a>00483 
<a name="l00484"></a><a class="code" href="classNxsTransformationManager_a67416e5beef2033061c1144121565c38.html#a67416e5beef2033061c1144121565c38">00484</a> std::set&lt;std::string&gt; <a class="code" href="classNxsTransformationManager_a67416e5beef2033061c1144121565c38.html#a67416e5beef2033061c1144121565c38">NxsTransformationManager::GetWeightSetNames</a>()<span class="keyword"> const</span>
<a name="l00485"></a>00485 <span class="keyword">    </span>{
<a name="l00486"></a>00486     std::set&lt;std::string&gt; s;
<a name="l00487"></a>00487     std::map&lt;std::string, ListOfDblWeights&gt;::const_iterator dws = dblWtSets.begin();
<a name="l00488"></a>00488     <span class="keywordflow">for</span> (; dws != dblWtSets.end(); ++dws)
<a name="l00489"></a>00489         s.insert(dws-&gt;first);
<a name="l00490"></a>00490     std::map&lt;std::string, ListOfIntWeights&gt;::const_iterator iws = intWtSets.begin();
<a name="l00491"></a>00491     <span class="keywordflow">for</span> (; iws != intWtSets.end(); ++iws)
<a name="l00492"></a>00492         s.insert(iws-&gt;first);
<a name="l00493"></a>00493     <span class="keywordflow">return</span> s;
<a name="l00494"></a>00494     }
<a name="l00495"></a>00495 
<a name="l00496"></a><a class="code" href="classNxsTransformationManager_a056878f550770fcdbdc490f77223ba37.html#a056878f550770fcdbdc490f77223ba37">00496</a> std::set&lt;std::string&gt; <a class="code" href="classNxsTransformationManager_a056878f550770fcdbdc490f77223ba37.html#a056878f550770fcdbdc490f77223ba37">NxsTransformationManager::GetTypeSetNames</a>()<span class="keyword"> const</span>
<a name="l00497"></a>00497 <span class="keyword">    </span>{
<a name="l00498"></a>00498     std::set&lt;std::string&gt; s;
<a name="l00499"></a>00499     std::map&lt;std::string, ListOfTypeNamesToSets&gt;::const_iterator dws = typeSets.begin();
<a name="l00500"></a>00500     <span class="keywordflow">for</span> (; dws != typeSets.end(); ++dws)
<a name="l00501"></a>00501         s.insert(dws-&gt;first);
<a name="l00502"></a>00502     <span class="keywordflow">return</span> s;
<a name="l00503"></a>00503     }
<a name="l00504"></a>00504 
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 <span class="keywordtype">void</span> NxsAssumptionsBlock::AddCharPartition(<span class="keyword">const</span> std::string &amp; name, <span class="keyword">const</span> NxsPartition &amp;p)
<a name="l00507"></a>00507     {
<a name="l00508"></a>00508     charPartitions[name] = p;
<a name="l00509"></a>00509     }
<a name="l00510"></a>00510 <span class="keywordtype">void</span> NxsAssumptionsBlock::AddTaxPartition(<span class="keyword">const</span> std::string &amp; name, <span class="keyword">const</span> NxsPartition &amp;p)
<a name="l00511"></a>00511     {
<a name="l00512"></a>00512     taxPartitions[name] = p;
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515 <span class="keywordtype">void</span> NxsAssumptionsBlock::AddTreePartition(<span class="keyword">const</span> std::string &amp; name, <span class="keyword">const</span> NxsPartition &amp;p)
<a name="l00516"></a>00516     {
<a name="l00517"></a>00517     treePartitions[name] = p;
<a name="l00518"></a>00518     }
<a name="l00519"></a>00519 
<a name="l00520"></a>00520 <span class="keywordtype">void</span> NxsAssumptionsBlock::AddCodeSet(<span class="keyword">const</span> std::string &amp; name, <span class="keyword">const</span> NxsPartition &amp;p, <span class="keywordtype">bool</span> asterisked)
<a name="l00521"></a>00521     {
<a name="l00522"></a>00522     codeSets[name] = p;
<a name="l00523"></a>00523     <span class="keywordflow">if</span> (asterisked)
<a name="l00524"></a>00524         def_codeSet.assign(name.c_str());
<a name="l00525"></a>00525     }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527 <span class="keywordtype">void</span> NxsAssumptionsBlock::AddCodonPosSet(<span class="keyword">const</span> std::string &amp; name, <span class="keyword">const</span> NxsPartition &amp;p, <span class="keywordtype">bool</span> asterisked)
<a name="l00528"></a>00528     {
<a name="l00529"></a>00529     codonPosSets[name] = p;
<a name="l00530"></a>00530     <span class="keywordflow">if</span> (asterisked)
<a name="l00531"></a>00531         def_codonPosSet.assign(name.c_str());
<a name="l00532"></a>00532     }
<a name="l00533"></a>00533 
<a name="l00534"></a>00534 
<a name="l00535"></a>00535 <span class="keywordtype">void</span> NxsAssumptionsBlock::WriteOptions(std::ostream &amp; out)<span class="keyword"> const</span>
<a name="l00536"></a>00536 <span class="keyword">    </span>{
<a name="l00537"></a>00537     <span class="keyword">const</span> std::string d = transfMgr.<a class="code" href="classNxsTransformationManager_afc72202b64fa7e9f57f31786a438c58b.html#afc72202b64fa7e9f57f31786a438c58b">GetDefaultTypeName</a>();
<a name="l00538"></a>00538     <span class="keywordflow">if</span> ((!d.empty() &amp;&amp; !NxsString::case_insensitive_equals(d.c_str(), <span class="stringliteral">&quot;ORD&quot;</span>))
<a name="l00539"></a>00539         || gapsAsNewstate || polyTCountValue != POLY_T_COUNT_UNKNOWN)
<a name="l00540"></a>00540         {
<a name="l00541"></a>00541         out &lt;&lt; <span class="stringliteral">&quot;    OPTIONS&quot;</span>;
<a name="l00542"></a>00542         <span class="keywordflow">if</span> (!d.empty())
<a name="l00543"></a>00543             out &lt;&lt; <span class="stringliteral">&quot; DefType = &quot;</span> &lt;&lt; NxsString::GetEscaped(d);
<a name="l00544"></a>00544         <span class="keywordflow">if</span> (gapsAsNewstate)
<a name="l00545"></a>00545             out &lt;&lt; <span class="stringliteral">&quot; GapMode = NewState&quot;</span>;
<a name="l00546"></a>00546         <span class="keywordflow">if</span> (polyTCountValue == POLY_T_COUNT_MIN)
<a name="l00547"></a>00547             out &lt;&lt; <span class="stringliteral">&quot; PolyTCount = MinSteps&quot;</span>;
<a name="l00548"></a>00548         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (polyTCountValue == POLY_T_COUNT_MAX)
<a name="l00549"></a>00549             out &lt;&lt; <span class="stringliteral">&quot; PolyTCount = MaxSteps&quot;</span>;
<a name="l00550"></a>00550         out &lt;&lt; <span class="stringliteral">&quot;;\n&quot;</span>;
<a name="l00551"></a>00551         }
<a name="l00552"></a>00552     }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 <span class="keywordtype">bool</span> NxsAssumptionsBlock::HasAssumptionsBlockCommands()<span class="keyword"> const</span>
<a name="l00555"></a>00555 <span class="keyword">    </span>{
<a name="l00556"></a>00556     <span class="keywordflow">return</span> (gapsAsNewstate
<a name="l00557"></a>00557             || !transfMgr.IsEmpty()
<a name="l00558"></a>00558             || !exsets.empty()
<a name="l00559"></a>00559             ||  polyTCountValue != POLY_T_COUNT_UNKNOWN);
<a name="l00560"></a>00560     }
<a name="l00561"></a>00561 <span class="keywordtype">bool</span> NxsAssumptionsBlock::HasSetsBlockCommands()<span class="keyword"> const</span>
<a name="l00562"></a>00562 <span class="keyword">    </span>{
<a name="l00563"></a>00563     <span class="keywordflow">return</span> (!charsets.empty() || !taxsets.empty() || !treesets.empty()
<a name="l00564"></a>00564             ||!charPartitions.empty() || !taxPartitions.empty() || !treePartitions.empty() );
<a name="l00565"></a>00565     }
<a name="l00566"></a>00566 <span class="keywordtype">bool</span> NxsAssumptionsBlock::HasCodonsBlockCommands()<span class="keyword"> const</span>
<a name="l00567"></a>00567 <span class="keyword">    </span>{
<a name="l00568"></a>00568     <span class="keywordflow">return</span> (!codeSets.empty() || !codonPosSets.empty() || !codesMgr.IsEmpty());
<a name="l00569"></a>00569     }
<a name="l00570"></a>00570 
<a name="l00571"></a>00571 <span class="keywordtype">bool</span> NxsAssumptionsBlock::CanReadBlockType(<span class="keyword">const</span> <a class="code" href="classNxsToken.html">NxsToken</a> &amp; token)
<a name="l00572"></a>00572     {
<a name="l00573"></a>00573     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;ASSUMPTIONS&quot;</span>))
<a name="l00574"></a>00574         {
<a name="l00575"></a>00575         <span class="keywordtype">id</span> = <span class="stringliteral">&quot;ASSUMPTIONS&quot;</span>;
<a name="l00576"></a>00576         readAs = ASSUMPTIONS_BLOCK_READ;
<a name="l00577"></a>00577         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00578"></a>00578         }
<a name="l00579"></a>00579     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;SETS&quot;</span>))
<a name="l00580"></a>00580         {
<a name="l00581"></a>00581         <span class="keywordtype">id</span> = <span class="stringliteral">&quot;SETS&quot;</span>;
<a name="l00582"></a>00582         readAs = SETS_BLOCK_READ;
<a name="l00583"></a>00583         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00584"></a>00584         }
<a name="l00585"></a>00585     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;CODONS&quot;</span>))
<a name="l00586"></a>00586         {
<a name="l00587"></a>00587         <span class="keywordtype">id</span> = <span class="stringliteral">&quot;CODONS&quot;</span>;
<a name="l00588"></a>00588         readAs = CODONS_BLOCK_READ;
<a name="l00589"></a>00589         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00590"></a>00590         }
<a name="l00591"></a>00591     <span class="keywordflow">return</span> token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<a class="code" href="classNxsBlock_a43cb2dac4ccc14d798d29670d9dc6017.html#a43cb2dac4ccc14d798d29670d9dc6017" title="Returns the `id` NxsString.">GetID</a>());
<a name="l00592"></a>00592     }
<a name="l00593"></a>00593 
<a name="l00594"></a>00594 
<a name="l00595"></a>00595 
<a name="l00596"></a><a class="code" href="classNxsAssumptionsBlock_a24730bd115d2c2f200f603b759255570.html#a24730bd115d2c2f200f603b759255570">00596</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a24730bd115d2c2f200f603b759255570.html#a24730bd115d2c2f200f603b759255570" title="Should serialize the content of the block as NEXUS.">NxsAssumptionsBlock::WriteAsNexus</a>(std::ostream &amp;out)<span class="keyword"> const</span>
<a name="l00597"></a>00597 <span class="keyword">    </span>{
<a name="l00598"></a>00598     <a class="code" href="classNxsAssumptionsBlock.html" title="This class handles reading and storage for the NxsReader block ASSUMPTIONS.">NxsAssumptionsBlock</a> *t = <span class="keyword">const_cast&lt;</span><a class="code" href="classNxsAssumptionsBlock.html" title="This class handles reading and storage for the NxsReader block ASSUMPTIONS.">NxsAssumptionsBlock</a> *<span class="keyword">&gt;</span>(<span class="keyword">this</span>); <span class="comment">/*title switching*/</span>
<a name="l00599"></a>00599     <span class="keyword">const</span> std::string ft = title;
<a name="l00600"></a>00600     t-&gt;title.clear();
<a name="l00601"></a>00601     NameOfAssumpBlockAsRead treatAs = this-&gt;readAs;
<a name="l00602"></a>00602     <span class="keywordflow">if</span> (treatAs == UNREAD_OR_GENERATED_BLOCK)
<a name="l00603"></a>00603         {
<a name="l00604"></a>00604         <span class="comment">/*  Precedence order here is reverse the order of writing. This delays</span>
<a name="l00605"></a>00605 <span class="comment">            skipped blocks to the last among SETS, CODONS, and ASSUMPTIONS blocks.</span>
<a name="l00606"></a>00606 <span class="comment">        */</span>
<a name="l00607"></a>00607         <span class="keywordflow">if</span> (HasAssumptionsBlockCommands())
<a name="l00608"></a>00608             treatAs = ASSUMPTIONS_BLOCK_READ;
<a name="l00609"></a>00609         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (HasCodonsBlockCommands())
<a name="l00610"></a>00610             treatAs = CODONS_BLOCK_READ;
<a name="l00611"></a>00611         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (HasSetsBlockCommands())
<a name="l00612"></a>00612             treatAs = SETS_BLOCK_READ;
<a name="l00613"></a>00613         }
<a name="l00614"></a>00614     <span class="keywordflow">try</span>
<a name="l00615"></a>00615         {
<a name="l00616"></a>00616         <span class="keywordflow">if</span> (HasSetsBlockCommands())
<a name="l00617"></a>00617             {
<a name="l00618"></a>00618             <span class="keywordflow">if</span> (treatAs == SETS_BLOCK_READ &amp;&amp; !IsAutoGeneratedTitle())
<a name="l00619"></a>00619                 t-&gt;title = ft;
<a name="l00620"></a>00620             out &lt;&lt; <span class="stringliteral">&quot;BEGIN SETS;\n&quot;</span>;
<a name="l00621"></a>00621             WriteBasicBlockCommands(out);
<a name="l00622"></a>00622             this-&gt;WriteTaxSet(out);
<a name="l00623"></a>00623             this-&gt;WriteCharSet(out);
<a name="l00624"></a>00624             this-&gt;WriteTreeSet(out);
<a name="l00625"></a>00625             this-&gt;WriteTaxPartition(out);
<a name="l00626"></a>00626             this-&gt;WriteCharPartition(out);
<a name="l00627"></a>00627             this-&gt;WriteTreePartition(out);
<a name="l00628"></a>00628             <span class="keywordflow">if</span> (treatAs == SETS_BLOCK_READ)
<a name="l00629"></a>00629                 {
<a name="l00630"></a>00630                 WriteSkippedCommands(out);
<a name="l00631"></a>00631                 t-&gt;title.clear();
<a name="l00632"></a>00632                 }
<a name="l00633"></a>00633             out &lt;&lt; <span class="stringliteral">&quot;END;\n&quot;</span>;
<a name="l00634"></a>00634             }
<a name="l00635"></a>00635         <span class="keywordflow">if</span> (HasCodonsBlockCommands())
<a name="l00636"></a>00636             {
<a name="l00637"></a>00637             <span class="keywordflow">if</span> (treatAs == CODONS_BLOCK_READ &amp;&amp; !IsAutoGeneratedTitle())
<a name="l00638"></a>00638                 t-&gt;title = ft;
<a name="l00639"></a>00639             out &lt;&lt; <span class="stringliteral">&quot;BEGIN CODONS;\n&quot;</span>;
<a name="l00640"></a>00640             WriteBasicBlockCommands(out);
<a name="l00641"></a>00641             this-&gt;codesMgr.WriteGeneticCode(out);
<a name="l00642"></a>00642             this-&gt;WriteCodonPosSet(out);
<a name="l00643"></a>00643             this-&gt;WriteCodeSet(out);
<a name="l00644"></a>00644             <span class="keywordflow">if</span> (treatAs == CODONS_BLOCK_READ)
<a name="l00645"></a>00645                 {
<a name="l00646"></a>00646                 WriteSkippedCommands(out);
<a name="l00647"></a>00647                 t-&gt;title.clear();
<a name="l00648"></a>00648                 }
<a name="l00649"></a>00649             out &lt;&lt; <span class="stringliteral">&quot;END;\n&quot;</span>;
<a name="l00650"></a>00650             }
<a name="l00651"></a>00651         <span class="keywordflow">if</span> (HasAssumptionsBlockCommands())
<a name="l00652"></a>00652             {
<a name="l00653"></a>00653             <span class="keywordflow">if</span> (treatAs == ASSUMPTIONS_BLOCK_READ &amp;&amp; !IsAutoGeneratedTitle())
<a name="l00654"></a>00654                 t-&gt;title = ft;
<a name="l00655"></a>00655             out &lt;&lt; <span class="stringliteral">&quot;BEGIN ASSUMPTIONS;\n&quot;</span>;
<a name="l00656"></a>00656             WriteBasicBlockCommands(out);
<a name="l00657"></a>00657             this-&gt;WriteExSet(out);
<a name="l00658"></a>00658             this-&gt;transfMgr.WriteUserType(out);
<a name="l00659"></a>00659             this-&gt;transfMgr.WriteWtSet(out);
<a name="l00660"></a>00660             this-&gt;transfMgr.WriteTypeSet(out);
<a name="l00661"></a>00661             this-&gt;WriteOptions(out);
<a name="l00662"></a>00662             <span class="keywordflow">if</span> (treatAs == ASSUMPTIONS_BLOCK_READ)
<a name="l00663"></a>00663                 WriteSkippedCommands(out);
<a name="l00664"></a>00664             out &lt;&lt; <span class="stringliteral">&quot;END;\n&quot;</span>;
<a name="l00665"></a>00665             }
<a name="l00666"></a>00666         }
<a name="l00667"></a>00667     <span class="keywordflow">catch</span> (...)
<a name="l00668"></a>00668         {
<a name="l00669"></a>00669         t-&gt;title =  ft;
<a name="l00670"></a>00670         <span class="keywordflow">throw</span>;
<a name="l00671"></a>00671         }
<a name="l00672"></a>00672     t-&gt;title =  ft;
<a name="l00673"></a>00673     }
<a name="l00674"></a>00674 
<a name="l00675"></a>00675 
<a name="l00676"></a>00676 <a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a> * NxsAssumptionsBlock::GetCharBlockPtr(<span class="keywordtype">int</span> *status)
<a name="l00677"></a>00677     {
<a name="l00678"></a>00678     <span class="keywordflow">if</span> (status)
<a name="l00679"></a>00679         *status = GetCharLinkStatus();
<a name="l00680"></a>00680     <span class="keywordflow">return</span> charBlockPtr;
<a name="l00681"></a>00681     }
<a name="l00682"></a>00682 <a class="code" href="classNxsTaxaBlockAPI.html" title="This abstract class describes the interface that every block that wants to serve...">NxsTaxaBlockAPI</a> * NxsAssumptionsBlock::GetTaxaBlockPtr(<span class="keywordtype">int</span> *status)
<a name="l00683"></a>00683     {
<a name="l00684"></a>00684     <span class="keywordflow">if</span> (status)
<a name="l00685"></a>00685         *status = GetTaxaLinkStatus();
<a name="l00686"></a>00686     <span class="keywordflow">return</span> taxa;
<a name="l00687"></a>00687     }
<a name="l00688"></a>00688 NxsTreesBlockAPI * NxsAssumptionsBlock::GetTreesBlockPtr(<span class="keywordtype">int</span> *status)
<a name="l00689"></a>00689     {
<a name="l00690"></a>00690     <span class="keywordflow">if</span> (status)
<a name="l00691"></a>00691         *status = GetTreesLinkStatus();
<a name="l00692"></a>00692     <span class="keywordflow">return</span> treesBlockPtr;
<a name="l00693"></a>00693     }
<a name="l00694"></a>00694 
<a name="l00695"></a>00695 NxsAssumptionsBlockAPI  *NxsAssumptionsBlock::CreateNewAssumptionsBlock(<a class="code" href="classNxsToken.html">NxsToken</a> &amp;token)
<a name="l00696"></a>00696     {
<a name="l00697"></a>00697     NxsAssumptionsBlockAPI * aba = NULL;
<a name="l00698"></a>00698     <span class="keywordflow">if</span> (nexusReader)
<a name="l00699"></a>00699         {
<a name="l00700"></a>00700         <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> n(<span class="stringliteral">&quot;ASSUMPTIONS&quot;</span>);
<a name="l00701"></a>00701         <a class="code" href="classNxsBlock.html" title="This is the base class from which all block classes are derived.">NxsBlock</a> * block = nexusReader-&gt;<a class="code" href="classNxsReader_ab718454df56c5cb2b36f7492c81a72e4.html#ab718454df56c5cb2b36f7492c81a72e4" title="Uses the registered Factories to spawn a reader for blocks with the name &amp;quot;currBlockName...">CreateBlockFromFactories</a>(n, token, NULL);
<a name="l00702"></a>00702         aba = <span class="keyword">static_cast&lt;</span>NxsAssumptionsBlockAPI *<span class="keyword">&gt;</span>(block);
<a name="l00703"></a>00703         }
<a name="l00704"></a>00704     <span class="keywordflow">if</span> (aba == NULL)
<a name="l00705"></a>00705         {
<a name="l00706"></a>00706         <a class="code" href="classNxsAssumptionsBlock.html" title="This class handles reading and storage for the NxsReader block ASSUMPTIONS.">NxsAssumptionsBlock</a> *ab =  <span class="keyword">new</span> <a class="code" href="classNxsAssumptionsBlock_a286f1cc68103b9f6e64d05d0a5933744.html#a286f1cc68103b9f6e64d05d0a5933744" title="Sets id = &amp;quot;ASSUMPTIONS&amp;quot;, charBlockPtr = NULL, and taxa = t.">NxsAssumptionsBlock</a>(NULL);
<a name="l00707"></a>00707         ab-&gt;<a class="code" href="classNxsBlock_a1c26882db165367dcb8e7ada8d5b1aea.html#a1c26882db165367dcb8e7ada8d5b1aea" title="Should be called with SetImplementsLinkAPI(true) by all blocks that overload both:...">SetImplementsLinkAPI</a>(this-&gt;<a class="code" href="classNxsBlock_a282f1d4e65cc16e3686400e9a6fa1b4d.html#a282f1d4e65cc16e3686400e9a6fa1b4d" title="Accessor to &amp;quot;linkAPI&amp;quot; field.">ImplementsLinkAPI</a>());
<a name="l00708"></a>00708         aba = ab;
<a name="l00709"></a>00709         }
<a name="l00710"></a>00710     aba-&gt;<a class="code" href="classNxsBlock_ade0e632784669a14df73fa0dc927d6b2.html#ade0e632784669a14df73fa0dc927d6b2" title="Sets the nexusReader data member of the NxsBlock object to &amp;#39;nxsptr&amp;#39;.">SetNexus</a>(nexusReader);
<a name="l00711"></a>00711     passedRefOfOwnedBlock = <span class="keyword">false</span>;
<a name="l00712"></a>00712     createdSubBlocks.push_back(aba);
<a name="l00713"></a>00713     <span class="keywordflow">return</span> aba;
<a name="l00714"></a>00714     }
<a name="l00715"></a>00715 
<a name="l00716"></a>00716 NxsAssumptionsBlockAPI  *NxsAssumptionsBlock::GetAssumptionsBlockForCharBlock(<a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a> *cb, NxsBlockLinkStatus status, <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token)
<a name="l00717"></a>00717     {
<a name="l00718"></a>00718     <span class="keywordtype">int</span> cbstatus;
<a name="l00719"></a>00719     <a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a> * thisCB = GetCharBlockPtr(&amp;cbstatus);
<a name="l00720"></a>00720     <span class="keywordflow">if</span> (thisCB == NULL)
<a name="l00721"></a>00721         {
<a name="l00722"></a>00722         SetCharBlockPtr(cb, status);
<a name="l00723"></a>00723         <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00724"></a>00724         }
<a name="l00725"></a>00725     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cb == thisCB)
<a name="l00726"></a>00726         {
<a name="l00727"></a>00727         <span class="keywordtype">int</span> f = cbstatus &amp; NxsBlock::BLOCK_LINK_UNUSED_MASK;
<a name="l00728"></a>00728         <span class="keywordflow">if</span> (f == status)
<a name="l00729"></a>00729             <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00730"></a>00730         <span class="keywordflow">if</span> (!(cbstatus &amp; NxsBlock::BLOCK_LINK_USED))
<a name="l00731"></a>00731             {
<a name="l00732"></a>00732             <span class="keywordflow">if</span> (cbstatus == BLOCK_LINK_UNINITIALIZED || cbstatus == BLOCK_LINK_UNKNOWN_STATUS)
<a name="l00733"></a>00733                 {
<a name="l00734"></a>00734                 SetCharLinkStatus(status);
<a name="l00735"></a>00735                 <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00736"></a>00736                 }
<a name="l00737"></a>00737             }
<a name="l00738"></a>00738         <span class="keywordflow">else</span>
<a name="l00739"></a>00739             {
<a name="l00740"></a>00740             <span class="comment">/* return the same block for these two link statuses since they are both &quot;safe&quot; */</span>
<a name="l00741"></a>00741             <span class="keywordflow">if</span> ((f | status) == (BLOCK_LINK_FROM_LINK_CMD | BLOCK_LINK_TO_ONLY_CHOICE))
<a name="l00742"></a>00742                 {
<a name="l00743"></a>00743                 charLinkStatus |= (BLOCK_LINK_FROM_LINK_CMD | BLOCK_LINK_TO_ONLY_CHOICE);
<a name="l00744"></a>00744                 <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00745"></a>00745                 }
<a name="l00746"></a>00746             }
<a name="l00747"></a>00747         }
<a name="l00748"></a>00748     <span class="keywordflow">for</span> (VecAssumpBlockPtr::iterator bIt = createdSubBlocks.begin(); bIt != createdSubBlocks.end(); ++bIt)
<a name="l00749"></a>00749         {
<a name="l00750"></a>00750         NxsAssumptionsBlockAPI  * c = *bIt;
<a name="l00751"></a>00751         <span class="keywordflow">if</span> (c &amp;&amp; cb == c-&gt;GetCharBlockPtr(&amp;cbstatus) &amp;&amp; (cbstatus &amp; BLOCK_LINK_UNUSED_MASK) == status)
<a name="l00752"></a>00752             <span class="keywordflow">return</span> c;
<a name="l00753"></a>00753         }
<a name="l00754"></a>00754     NxsAssumptionsBlockAPI  *effBlock = CreateNewAssumptionsBlock(token);
<a name="l00755"></a>00755     effBlock-&gt;SetCharBlockPtr(cb, status);
<a name="l00756"></a>00756     <span class="keywordflow">return</span> effBlock;
<a name="l00757"></a>00757     }
<a name="l00758"></a>00758 
<a name="l00759"></a>00759 NxsAssumptionsBlockAPI  *NxsAssumptionsBlock::GetAssumptionsBlockForTaxaBlock(<a class="code" href="classNxsTaxaBlockAPI.html" title="This abstract class describes the interface that every block that wants to serve...">NxsTaxaBlockAPI</a> *cb, NxsBlockLinkStatus status, <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token)
<a name="l00760"></a>00760     {
<a name="l00761"></a>00761     <span class="keywordtype">int</span> cbstatus;
<a name="l00762"></a>00762     <a class="code" href="classNxsTaxaBlockAPI.html" title="This abstract class describes the interface that every block that wants to serve...">NxsTaxaBlockAPI</a> * thisCB = GetTaxaBlockPtr(&amp;cbstatus);
<a name="l00763"></a>00763     <span class="keywordflow">if</span> (thisCB == NULL)
<a name="l00764"></a>00764         {
<a name="l00765"></a>00765         SetTaxaBlockPtr(cb, status);
<a name="l00766"></a>00766         <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00767"></a>00767         }
<a name="l00768"></a>00768     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cb == GetTaxaBlockPtr(&amp;cbstatus))
<a name="l00769"></a>00769         {
<a name="l00770"></a>00770         <span class="keywordtype">int</span> f = cbstatus &amp; NxsBlock::BLOCK_LINK_UNUSED_MASK;
<a name="l00771"></a>00771         <span class="keywordflow">if</span> (f == status)
<a name="l00772"></a>00772             <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00773"></a>00773         <span class="keywordflow">if</span> (!(cbstatus &amp; NxsBlock::BLOCK_LINK_USED))
<a name="l00774"></a>00774             {
<a name="l00775"></a>00775             <span class="keywordflow">if</span> (cbstatus == BLOCK_LINK_UNINITIALIZED || cbstatus == BLOCK_LINK_UNKNOWN_STATUS)
<a name="l00776"></a>00776                 {
<a name="l00777"></a>00777                 SetTaxaLinkStatus(status);
<a name="l00778"></a>00778                 <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00779"></a>00779                 }
<a name="l00780"></a>00780             }
<a name="l00781"></a>00781         <span class="keywordflow">else</span>
<a name="l00782"></a>00782             {
<a name="l00783"></a>00783             <span class="comment">/* return the same block for these two link statuses since they are both &quot;safe&quot; */</span>
<a name="l00784"></a>00784             <span class="keywordflow">if</span> ((f | status) == (BLOCK_LINK_FROM_LINK_CMD | BLOCK_LINK_TO_ONLY_CHOICE))
<a name="l00785"></a>00785                 {
<a name="l00786"></a>00786                 taxaLinkStatus |= (BLOCK_LINK_FROM_LINK_CMD | BLOCK_LINK_TO_ONLY_CHOICE);
<a name="l00787"></a>00787                 <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00788"></a>00788                 }
<a name="l00789"></a>00789             }
<a name="l00790"></a>00790         }
<a name="l00791"></a>00791     <span class="keywordflow">for</span> (VecAssumpBlockPtr::iterator bIt = createdSubBlocks.begin(); bIt != createdSubBlocks.end(); ++bIt)
<a name="l00792"></a>00792         {
<a name="l00793"></a>00793         NxsAssumptionsBlockAPI  * c = *bIt;
<a name="l00794"></a>00794         <span class="keywordflow">if</span> (c &amp;&amp; cb == c-&gt;GetTaxaBlockPtr(&amp;cbstatus) &amp;&amp; (cbstatus &amp; BLOCK_LINK_UNUSED_MASK) == status)
<a name="l00795"></a>00795             <span class="keywordflow">return</span> c;
<a name="l00796"></a>00796         }
<a name="l00797"></a>00797     NxsAssumptionsBlockAPI  *effBlock = CreateNewAssumptionsBlock(token);
<a name="l00798"></a>00798     effBlock-&gt;SetTaxaBlockPtr(cb, status);
<a name="l00799"></a>00799     <span class="keywordflow">return</span> effBlock;
<a name="l00800"></a>00800     }
<a name="l00801"></a>00801 NxsAssumptionsBlockAPI  *NxsAssumptionsBlock::GetAssumptionsBlockForTreesBlock(NxsTreesBlockAPI *cb, NxsBlockLinkStatus status, <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token)
<a name="l00802"></a>00802     {
<a name="l00803"></a>00803     <span class="keywordtype">int</span> cbstatus;
<a name="l00804"></a>00804     NxsTreesBlockAPI * thisCB = GetTreesBlockPtr(&amp;cbstatus);
<a name="l00805"></a>00805     <span class="keywordflow">if</span> (thisCB == NULL)
<a name="l00806"></a>00806         {
<a name="l00807"></a>00807         SetTreesBlockPtr(cb, status);
<a name="l00808"></a>00808         <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00809"></a>00809         }
<a name="l00810"></a>00810     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cb == GetTreesBlockPtr(&amp;cbstatus))
<a name="l00811"></a>00811         {
<a name="l00812"></a>00812         <span class="keywordtype">int</span> f = cbstatus &amp; NxsBlock::BLOCK_LINK_UNUSED_MASK;
<a name="l00813"></a>00813         <span class="keywordflow">if</span> (f == status)
<a name="l00814"></a>00814             <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00815"></a>00815         <span class="keywordflow">if</span> (!(cbstatus &amp; NxsBlock::BLOCK_LINK_USED))
<a name="l00816"></a>00816             {
<a name="l00817"></a>00817             <span class="keywordflow">if</span> (cbstatus == BLOCK_LINK_UNINITIALIZED || cbstatus == BLOCK_LINK_UNKNOWN_STATUS)
<a name="l00818"></a>00818                 {
<a name="l00819"></a>00819                 SetTreesLinkStatus(status);
<a name="l00820"></a>00820                 <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00821"></a>00821                 }
<a name="l00822"></a>00822             }
<a name="l00823"></a>00823         <span class="keywordflow">else</span>
<a name="l00824"></a>00824             {
<a name="l00825"></a>00825             <span class="comment">/* return the same block for these two link statuses since they are both &quot;safe&quot; */</span>
<a name="l00826"></a>00826             <span class="keywordflow">if</span> ((f | status) == (BLOCK_LINK_FROM_LINK_CMD | BLOCK_LINK_TO_ONLY_CHOICE))
<a name="l00827"></a>00827                 {
<a name="l00828"></a>00828                 treesLinkStatus |= (BLOCK_LINK_FROM_LINK_CMD | BLOCK_LINK_TO_ONLY_CHOICE);
<a name="l00829"></a>00829                 <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00830"></a>00830                 }
<a name="l00831"></a>00831             }
<a name="l00832"></a>00832         }
<a name="l00833"></a>00833     <span class="keywordflow">for</span> (VecAssumpBlockPtr::iterator bIt = createdSubBlocks.begin(); bIt != createdSubBlocks.end(); ++bIt)
<a name="l00834"></a>00834         {
<a name="l00835"></a>00835         NxsAssumptionsBlockAPI  * c = *bIt;
<a name="l00836"></a>00836         <span class="keywordflow">if</span> (c &amp;&amp; cb == c-&gt;GetTreesBlockPtr(&amp;cbstatus) &amp;&amp; (cbstatus &amp; BLOCK_LINK_UNUSED_MASK) == status)
<a name="l00837"></a>00837             <span class="keywordflow">return</span> c;
<a name="l00838"></a>00838         }
<a name="l00839"></a>00839     NxsAssumptionsBlockAPI  *effBlock = CreateNewAssumptionsBlock(token);
<a name="l00840"></a>00840     effBlock-&gt;SetTreesBlockPtr(cb, status);
<a name="l00841"></a>00841     <span class="keywordflow">return</span> effBlock;
<a name="l00842"></a>00842     }
<a name="l00843"></a>00843 
<a name="l00844"></a>00844 NxsAssumptionsBlockAPI  *NxsAssumptionsBlock::GetAssumptionsBlockForCharTitle(<span class="keyword">const</span> <span class="keywordtype">char</span> *charTitle, <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token, <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd)
<a name="l00845"></a>00845     {
<a name="l00846"></a>00846     <span class="keywordflow">if</span> (!nexusReader)
<a name="l00847"></a>00847         <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(<span class="stringliteral">&quot;No NxsReader when reading Assumptions block.&quot;</span>);
<a name="l00848"></a>00848     <span class="keywordflow">if</span> (charTitle == NULL)
<a name="l00849"></a>00849         {
<a name="l00850"></a>00850         <span class="keywordtype">int</span> cbstatus;
<a name="l00851"></a>00851         <a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a> * thisCB = GetCharBlockPtr(&amp;cbstatus);
<a name="l00852"></a>00852         <span class="keywordtype">int</span> ust = cbstatus &amp; NxsBlock::BLOCK_LINK_UNUSED_MASK;
<a name="l00853"></a>00853         <span class="keywordflow">if</span> (thisCB != NULL &amp;&amp; ust != BLOCK_LINK_UNINITIALIZED &amp;&amp; ust != BLOCK_LINK_UNKNOWN_STATUS)
<a name="l00854"></a>00854             <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00855"></a>00855         }
<a name="l00856"></a>00856     <span class="keywordtype">unsigned</span> ncb = 0;
<a name="l00857"></a>00857     <a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a> * cb = nexusReader-&gt;<a class="code" href="classNxsReader_aa6781043d2429789e69bd67f486a16d4.html#aa6781043d2429789e69bd67f486a16d4" title="NOTE: cast to NxsCharactersBlockAPI *.">GetCharBlockByTitle</a>(charTitle, &amp;ncb);
<a name="l00858"></a>00858     NxsAssumptionsBlockAPI *effectiveB = NULL;
<a name="l00859"></a>00859     <span class="keywordflow">if</span> (cb == NULL)
<a name="l00860"></a>00860         {
<a name="l00861"></a>00861         <span class="keywordflow">if</span> (charBlockPtr)
<a name="l00862"></a>00862             {
<a name="l00863"></a>00863             <span class="keyword">const</span> <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a>  t=charBlockPtr-&gt;<a class="code" href="classNxsBlock_a43cb2dac4ccc14d798d29670d9dc6017.html#a43cb2dac4ccc14d798d29670d9dc6017" title="Returns the `id` NxsString.">GetID</a>();
<a name="l00864"></a>00864             <span class="keywordflow">if</span> (t.empty())
<a name="l00865"></a>00865                 {
<a name="l00866"></a>00866                 <span class="keywordflow">if</span> (charTitle == NULL)
<a name="l00867"></a>00867                     effectiveB = <span class="keyword">this</span>;
<a name="l00868"></a>00868                 }
<a name="l00869"></a>00869             <span class="keywordflow">else</span>
<a name="l00870"></a>00870                 {
<a name="l00871"></a>00871                 <span class="keywordflow">if</span> (NxsString::case_insensitive_equals(charTitle, t.c_str()))
<a name="l00872"></a>00872                     effectiveB = <span class="keyword">this</span>;
<a name="l00873"></a>00873                 }
<a name="l00874"></a>00874             }
<a name="l00875"></a>00875         <span class="keywordflow">if</span> (effectiveB == NULL)
<a name="l00876"></a>00876             {
<a name="l00877"></a>00877             errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l00878"></a>00878             errormsg &lt;&lt; <span class="stringliteral">&quot;A CHARACTERS (or DATA) block &quot;</span>;
<a name="l00879"></a>00879             <span class="keywordflow">if</span> (charTitle)
<a name="l00880"></a>00880                 errormsg &lt;&lt; <span class="stringliteral">&quot;with the title &quot;</span> &lt;&lt; NxsString::GetEscaped(charTitle);
<a name="l00881"></a>00881             errormsg &lt;&lt; <span class="stringliteral">&quot; must precede an &quot;</span> &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot; block with a &quot;</span> &lt;&lt;  cmd &lt;&lt;  <span class="stringliteral">&quot; command.&quot;</span>;
<a name="l00882"></a>00882             errormsg &lt;&lt; <span class="stringliteral">&quot;\n(If such a block exists, then this program may not be using an API for the NCL library that supports block linking).&quot;</span>;
<a name="l00883"></a>00883             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l00884"></a>00884             }
<a name="l00885"></a>00885         }
<a name="l00886"></a>00886     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ncb &gt; 1)
<a name="l00887"></a>00887         {
<a name="l00888"></a>00888         errormsg = <span class="stringliteral">&quot;Multiple CHARACTERS blocks have been encountered, but a &quot;</span>;
<a name="l00889"></a>00889         errormsg += cmd;
<a name="l00890"></a>00890         errormsg += <span class="stringliteral">&quot; command was found which does not specify which CHARACTERS block it uses.   The most recent CHARACTERS block will be used.&quot;</span>;
<a name="l00891"></a>00891         <span class="keywordflow">if</span> (nexusReader)
<a name="l00892"></a>00892             nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ac790b23b7c9d8cd1b9716a561fe31e6b">NxsReader::AMBIGUOUS_CONTENT_WARNING</a>, token);
<a name="l00893"></a>00893         errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l00894"></a>00894         effectiveB = GetAssumptionsBlockForCharBlock(cb, NxsBlock::BLOCK_LINK_TO_MOST_RECENT, token);
<a name="l00895"></a>00895         }
<a name="l00896"></a>00896     <span class="keywordflow">else</span>
<a name="l00897"></a>00897         {
<a name="l00898"></a>00898         NxsBlockLinkStatus statusRequested = (charTitle == NULL ? NxsBlock::BLOCK_LINK_TO_ONLY_CHOICE : NxsBlock::BLOCK_LINK_FROM_LINK_CMD);
<a name="l00899"></a>00899         effectiveB = GetAssumptionsBlockForCharBlock(cb, statusRequested, token);
<a name="l00900"></a>00900         }
<a name="l00901"></a>00901     effectiveB-&gt;FlagCharBlockAsUsed();
<a name="l00902"></a>00902     <span class="keywordflow">return</span> effectiveB;
<a name="l00903"></a>00903     }
<a name="l00904"></a>00904 
<a name="l00905"></a>00905 NxsAssumptionsBlockAPI  *NxsAssumptionsBlock::GetAssumptionsBlockForTaxaTitle(<span class="keyword">const</span> <span class="keywordtype">char</span> *taxTitle, <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token, <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd)
<a name="l00906"></a>00906     {
<a name="l00907"></a>00907     <span class="keywordflow">if</span> (!nexusReader)
<a name="l00908"></a>00908         <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(<span class="stringliteral">&quot;No NxsReader when reading Assumptions block.&quot;</span>);
<a name="l00909"></a>00909     <span class="keywordflow">if</span> (taxTitle == NULL)
<a name="l00910"></a>00910         {
<a name="l00911"></a>00911         <span class="keywordtype">int</span> cbstatus;
<a name="l00912"></a>00912         <a class="code" href="classNxsTaxaBlockAPI.html" title="This abstract class describes the interface that every block that wants to serve...">NxsTaxaBlockAPI</a> * thisCB = GetTaxaBlockPtr(&amp;cbstatus);
<a name="l00913"></a>00913         <span class="keywordtype">int</span> ust = cbstatus &amp; NxsBlock::BLOCK_LINK_UNUSED_MASK;
<a name="l00914"></a>00914         <span class="keywordflow">if</span> (thisCB != NULL &amp;&amp; ust != BLOCK_LINK_UNINITIALIZED &amp;&amp; ust != BLOCK_LINK_UNKNOWN_STATUS)
<a name="l00915"></a>00915             <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00916"></a>00916         }
<a name="l00917"></a>00917     <span class="keywordtype">unsigned</span> ncb = 0;
<a name="l00918"></a>00918     <a class="code" href="classNxsTaxaBlockAPI.html" title="This abstract class describes the interface that every block that wants to serve...">NxsTaxaBlockAPI</a> * cb = nexusReader-&gt;<a class="code" href="classNxsReader_acb2f095e4d006a3757d5296eb68743e4.html#acb2f095e4d006a3757d5296eb68743e4" title="NOTE: cast to NxsTaxaBlockAPI *.">GetTaxaBlockByTitle</a>(taxTitle, &amp;ncb);
<a name="l00919"></a>00919     NxsAssumptionsBlockAPI *effectiveB = NULL;
<a name="l00920"></a>00920     <span class="keywordflow">if</span> (cb == NULL)
<a name="l00921"></a>00921         {
<a name="l00922"></a>00922         <span class="keywordflow">if</span> (taxa)
<a name="l00923"></a>00923             {
<a name="l00924"></a>00924             <span class="keyword">const</span> <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a>  t=taxa-&gt;<a class="code" href="classNxsBlock_a43cb2dac4ccc14d798d29670d9dc6017.html#a43cb2dac4ccc14d798d29670d9dc6017" title="Returns the `id` NxsString.">GetID</a>();
<a name="l00925"></a>00925             <span class="keywordflow">if</span> (t.empty())
<a name="l00926"></a>00926                 {
<a name="l00927"></a>00927                 <span class="keywordflow">if</span> (taxTitle == NULL)
<a name="l00928"></a>00928                     effectiveB = <span class="keyword">this</span>;
<a name="l00929"></a>00929                 }
<a name="l00930"></a>00930             <span class="keywordflow">else</span>
<a name="l00931"></a>00931                 {
<a name="l00932"></a>00932                 <span class="keywordflow">if</span> (NxsString::case_insensitive_equals(taxTitle, t.c_str()))
<a name="l00933"></a>00933                     effectiveB = <span class="keyword">this</span>;
<a name="l00934"></a>00934                 }
<a name="l00935"></a>00935             }
<a name="l00936"></a>00936         <span class="keywordflow">if</span> (effectiveB == NULL)
<a name="l00937"></a>00937             {
<a name="l00938"></a>00938             errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l00939"></a>00939             errormsg &lt;&lt;  <span class="stringliteral">&quot;A TAXA block &quot;</span>;
<a name="l00940"></a>00940             <span class="keywordflow">if</span> (taxTitle)
<a name="l00941"></a>00941                 errormsg &lt;&lt; <span class="stringliteral">&quot;with the title &quot;</span> &lt;&lt; NxsString::GetEscaped(taxTitle);
<a name="l00942"></a>00942             errormsg &lt;&lt; <span class="stringliteral">&quot; must precede an &quot;</span> &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot; block with a &quot;</span> &lt;&lt;  cmd &lt;&lt;  <span class="stringliteral">&quot; command.&quot;</span>;
<a name="l00943"></a>00943             errormsg &lt;&lt; <span class="stringliteral">&quot;\n(If such a block exists, then this program may not be using an API for the NCL library that supports block linking).&quot;</span>;
<a name="l00944"></a>00944             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l00945"></a>00945             }
<a name="l00946"></a>00946         }
<a name="l00947"></a>00947     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ncb &gt; 1)
<a name="l00948"></a>00948         {
<a name="l00949"></a>00949         errormsg = <span class="stringliteral">&quot;Multiple TAXA blocks have been encountered, but a &quot;</span>;
<a name="l00950"></a>00950         errormsg += cmd;
<a name="l00951"></a>00951         errormsg += <span class="stringliteral">&quot; command was found which does not specify which TAXA block it uses.  The most recent TAXA block will be used.&quot;</span>;
<a name="l00952"></a>00952         nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ac790b23b7c9d8cd1b9716a561fe31e6b">NxsReader::AMBIGUOUS_CONTENT_WARNING</a>, token);
<a name="l00953"></a>00953         errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l00954"></a>00954         effectiveB = GetAssumptionsBlockForTaxaBlock(cb, NxsBlock::BLOCK_LINK_TO_MOST_RECENT, token);
<a name="l00955"></a>00955         }
<a name="l00956"></a>00956     <span class="keywordflow">else</span>
<a name="l00957"></a>00957         {
<a name="l00958"></a>00958         NxsBlockLinkStatus statusRequested = (taxTitle == NULL ? NxsBlock::BLOCK_LINK_TO_ONLY_CHOICE : NxsBlock::BLOCK_LINK_FROM_LINK_CMD);
<a name="l00959"></a>00959         effectiveB = GetAssumptionsBlockForTaxaBlock(cb, statusRequested, token);
<a name="l00960"></a>00960         }
<a name="l00961"></a>00961     effectiveB-&gt;FlagTaxaBlockAsUsed();
<a name="l00962"></a>00962     <span class="keywordflow">return</span> effectiveB;
<a name="l00963"></a>00963     }
<a name="l00964"></a>00964 
<a name="l00965"></a>00965 NxsAssumptionsBlockAPI  *NxsAssumptionsBlock::GetAssumptionsBlockForTreesTitle(<span class="keyword">const</span> <span class="keywordtype">char</span> *treesTitle, <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token, <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd)
<a name="l00966"></a>00966     {
<a name="l00967"></a>00967     <span class="keywordflow">if</span> (!nexusReader)
<a name="l00968"></a>00968         <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(<span class="stringliteral">&quot;No NxsReader when reading Assumptions block.&quot;</span>);
<a name="l00969"></a>00969     <span class="keywordflow">if</span> (treesTitle == NULL)
<a name="l00970"></a>00970         {
<a name="l00971"></a>00971         <span class="keywordtype">int</span> cbstatus;
<a name="l00972"></a>00972         NxsTreesBlockAPI * thisCB = GetTreesBlockPtr(&amp;cbstatus);
<a name="l00973"></a>00973         <span class="keywordtype">int</span> ust = cbstatus &amp; NxsBlock::BLOCK_LINK_UNUSED_MASK;
<a name="l00974"></a>00974         <span class="keywordflow">if</span> (thisCB != NULL &amp;&amp; ust != BLOCK_LINK_UNINITIALIZED &amp;&amp; ust != BLOCK_LINK_UNKNOWN_STATUS)
<a name="l00975"></a>00975             <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00976"></a>00976         }
<a name="l00977"></a>00977     <span class="keywordtype">unsigned</span> ncb = 0;
<a name="l00978"></a>00978     NxsTreesBlockAPI * cb = nexusReader-&gt;<a class="code" href="classNxsReader_aba1aa4dbb45a3a8d9a590d5212d3c4cb.html#aba1aa4dbb45a3a8d9a590d5212d3c4cb" title="NOTE: cast to NxsTreesBlockAPI *.">GetTreesBlockByTitle</a>(treesTitle, &amp;ncb);
<a name="l00979"></a>00979     NxsAssumptionsBlockAPI *effectiveB = NULL;
<a name="l00980"></a>00980     <span class="keywordflow">if</span> (cb == NULL)
<a name="l00981"></a>00981         {
<a name="l00982"></a>00982         <span class="keywordflow">if</span> (treesBlockPtr)
<a name="l00983"></a>00983             {
<a name="l00984"></a>00984             <span class="keyword">const</span> <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a>  t=treesBlockPtr-&gt;GetID();
<a name="l00985"></a>00985             <span class="keywordflow">if</span> (t.empty())
<a name="l00986"></a>00986                 {
<a name="l00987"></a>00987                 <span class="keywordflow">if</span> (treesTitle == NULL)
<a name="l00988"></a>00988                     effectiveB = <span class="keyword">this</span>;
<a name="l00989"></a>00989                 }
<a name="l00990"></a>00990             <span class="keywordflow">else</span>
<a name="l00991"></a>00991                 {
<a name="l00992"></a>00992                 <span class="keywordflow">if</span> (NxsString::case_insensitive_equals(treesTitle, t.c_str()))
<a name="l00993"></a>00993                     effectiveB = <span class="keyword">this</span>;
<a name="l00994"></a>00994                 }
<a name="l00995"></a>00995             }
<a name="l00996"></a>00996         <span class="keywordflow">if</span> (effectiveB == NULL)
<a name="l00997"></a>00997             {
<a name="l00998"></a>00998             errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l00999"></a>00999             errormsg &lt;&lt;  <span class="stringliteral">&quot;A TREES block&quot;</span>;
<a name="l01000"></a>01000             <span class="keywordflow">if</span> (treesTitle)
<a name="l01001"></a>01001                 errormsg &lt;&lt; <span class="stringliteral">&quot;with the title &quot;</span> &lt;&lt; NxsString::GetEscaped(treesTitle);
<a name="l01002"></a>01002             errormsg &lt;&lt; <span class="stringliteral">&quot; must precede an &quot;</span> &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot; block with a &quot;</span> &lt;&lt;  cmd &lt;&lt;  <span class="stringliteral">&quot; command.&quot;</span>;
<a name="l01003"></a>01003             errormsg &lt;&lt; <span class="stringliteral">&quot;\n(If such a block exists, then this program may not be using an API for the NCL library that supports block linking).&quot;</span>;
<a name="l01004"></a>01004             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l01005"></a>01005             }
<a name="l01006"></a>01006         }
<a name="l01007"></a>01007     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ncb &gt; 1)
<a name="l01008"></a>01008         {
<a name="l01009"></a>01009         errormsg = <span class="stringliteral">&quot;Multiple TREES blocks have been encountered, but a &quot;</span>;
<a name="l01010"></a>01010         errormsg += cmd;
<a name="l01011"></a>01011         errormsg += <span class="stringliteral">&quot; command was found which does not specify which TREES block it uses.  The most recent TREES block will be used.&quot;</span>;
<a name="l01012"></a>01012         nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ac790b23b7c9d8cd1b9716a561fe31e6b">NxsReader::AMBIGUOUS_CONTENT_WARNING</a>, token);
<a name="l01013"></a>01013         errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l01014"></a>01014         effectiveB = GetAssumptionsBlockForTreesBlock(cb, NxsBlock::BLOCK_LINK_TO_MOST_RECENT, token);
<a name="l01015"></a>01015         }
<a name="l01016"></a>01016     <span class="keywordflow">else</span>
<a name="l01017"></a>01017         {
<a name="l01018"></a>01018         NxsBlockLinkStatus statusRequested = (treesTitle == NULL ? NxsBlock::BLOCK_LINK_TO_ONLY_CHOICE : NxsBlock::BLOCK_LINK_FROM_LINK_CMD);
<a name="l01019"></a>01019         effectiveB = GetAssumptionsBlockForTreesBlock(cb, statusRequested, token);
<a name="l01020"></a>01020         }
<a name="l01021"></a>01021     effectiveB-&gt;FlagTreesBlockAsUsed();
<a name="l01022"></a>01022     <span class="keywordflow">return</span> effectiveB;
<a name="l01023"></a>01023     }
<a name="l01024"></a>01024 
<a name="l01025"></a>01025 <span class="keywordtype">void</span> NxsAssumptionsBlock::SetCharLinkStatus(NxsBlockLinkStatus s)
<a name="l01026"></a>01026     {
<a name="l01027"></a>01027     <span class="keywordflow">if</span> (charLinkStatus &amp; NxsBlock::BLOCK_LINK_USED)
<a name="l01028"></a>01028         {
<a name="l01029"></a>01029         <span class="keywordflow">throw</span> <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(<span class="stringliteral">&quot;Resetting a used charLinkStatus&quot;</span>);
<a name="l01030"></a>01030         }
<a name="l01031"></a>01031     charLinkStatus = s;
<a name="l01032"></a>01032     }
<a name="l01033"></a>01033 
<a name="l01034"></a>01034 <span class="keywordtype">void</span> NxsAssumptionsBlock::SetTaxaLinkStatus(NxsBlockLinkStatus s)
<a name="l01035"></a>01035     {
<a name="l01036"></a>01036     <span class="keywordflow">if</span> (taxaLinkStatus &amp; NxsBlock::BLOCK_LINK_USED)
<a name="l01037"></a>01037         {
<a name="l01038"></a>01038         <span class="keywordflow">throw</span> <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(<span class="stringliteral">&quot;Resetting a used taxaLinkStatus&quot;</span>);
<a name="l01039"></a>01039         }
<a name="l01040"></a>01040     taxaLinkStatus = s;
<a name="l01041"></a>01041     }
<a name="l01042"></a>01042 
<a name="l01043"></a>01043 <span class="keywordtype">void</span> NxsAssumptionsBlock::SetTreesLinkStatus(NxsBlockLinkStatus s)
<a name="l01044"></a>01044     {
<a name="l01045"></a>01045     <span class="keywordflow">if</span> (treesLinkStatus &amp; NxsBlock::BLOCK_LINK_USED)
<a name="l01046"></a>01046         {
<a name="l01047"></a>01047         <span class="keywordflow">throw</span> <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(<span class="stringliteral">&quot;Resetting a used charLinkStatus&quot;</span>);
<a name="l01048"></a>01048         }
<a name="l01049"></a>01049     treesLinkStatus = s;
<a name="l01050"></a>01050     }
<a name="l01051"></a>01051 
<a name="l01052"></a>01052 <span class="keywordtype">void</span> NxsAssumptionsBlock::SetCharBlockPtr(<a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a> * c, NxsBlockLinkStatus s)
<a name="l01053"></a>01053     {
<a name="l01054"></a>01054     SetCharLinkStatus(s);
<a name="l01055"></a>01055     charBlockPtr = c;
<a name="l01056"></a>01056     }
<a name="l01057"></a>01057 
<a name="l01058"></a>01058 <span class="keywordtype">void</span> NxsAssumptionsBlock::SetTaxaBlockPtr(<a class="code" href="classNxsTaxaBlockAPI.html" title="This abstract class describes the interface that every block that wants to serve...">NxsTaxaBlockAPI</a> *c, NxsBlockLinkStatus s)
<a name="l01059"></a>01059     {
<a name="l01060"></a>01060     SetTaxaLinkStatus(s);
<a name="l01061"></a>01061     taxa = c;
<a name="l01062"></a>01062     }
<a name="l01063"></a>01063 
<a name="l01064"></a>01064 <span class="keywordtype">void</span> NxsAssumptionsBlock::SetTreesBlockPtr(NxsTreesBlockAPI * c, NxsBlockLinkStatus s)
<a name="l01065"></a>01065     {
<a name="l01066"></a>01066     SetTreesLinkStatus(s);
<a name="l01067"></a>01067     treesBlockPtr = c;
<a name="l01068"></a>01068     }
<a name="l01069"></a>01069 
<a name="l01073"></a><a class="code" href="classNxsAssumptionsBlock_a286f1cc68103b9f6e64d05d0a5933744.html#a286f1cc68103b9f6e64d05d0a5933744">01073</a> <a class="code" href="classNxsAssumptionsBlock_a286f1cc68103b9f6e64d05d0a5933744.html#a286f1cc68103b9f6e64d05d0a5933744" title="Sets id = &amp;quot;ASSUMPTIONS&amp;quot;, charBlockPtr = NULL, and taxa = t.">NxsAssumptionsBlock::NxsAssumptionsBlock</a>(
<a name="l01074"></a>01074   <a class="code" href="classNxsTaxaBlockAPI.html" title="This abstract class describes the interface that every block that wants to serve...">NxsTaxaBlockAPI</a> *t)   <span class="comment">/* pointer to the taxa block */</span>
<a name="l01075"></a>01075     :taxa(t),
<a name="l01076"></a>01076     charBlockPtr(NULL),
<a name="l01077"></a>01077     treesBlockPtr(NULL),
<a name="l01078"></a>01078     charLinkStatus(<a class="code" href="classNxsBlock.html" title="This is the base class from which all block classes are derived.">NxsBlock</a>::BLOCK_LINK_UNINITIALIZED),
<a name="l01079"></a>01079     taxaLinkStatus(<a class="code" href="classNxsBlock.html" title="This is the base class from which all block classes are derived.">NxsBlock</a>::BLOCK_LINK_UNINITIALIZED),
<a name="l01080"></a>01080     treesLinkStatus(<a class="code" href="classNxsBlock.html" title="This is the base class from which all block classes are derived.">NxsBlock</a>::BLOCK_LINK_UNINITIALIZED),
<a name="l01081"></a>01081     passedRefOfOwnedBlock(false)
<a name="l01082"></a>01082     {
<a name="l01083"></a>01083     taxaLinkStatus = (t == NULL ? NxsBlock::BLOCK_LINK_UNINITIALIZED : NxsBlock::BLOCK_LINK_UNKNOWN_STATUS);
<a name="l01084"></a>01084     <span class="keywordtype">id</span>              = <span class="stringliteral">&quot;ASSUMPTIONS&quot;</span>;
<a name="l01085"></a>01085     <a class="code" href="classNxsAssumptionsBlock_a04c34387927c777895d86b06b3c8569e.html#a04c34387927c777895d86b06b3c8569e" title="Prepares for reading a new ASSUMPTIONS block.">Reset</a>();
<a name="l01086"></a>01086     }
<a name="l01087"></a>01087 
<a name="l01091"></a><a class="code" href="classNxsAssumptionsBlock_a55b7837376b399c12816127a7435b1d6.html#a55b7837376b399c12816127a7435b1d6">01091</a> <a class="code" href="classNxsAssumptionsBlock_a55b7837376b399c12816127a7435b1d6.html#a55b7837376b399c12816127a7435b1d6" title="Nothing needs to be done in the destructor.">NxsAssumptionsBlock::~NxsAssumptionsBlock</a>()
<a name="l01092"></a>01092     {
<a name="l01093"></a>01093     }
<a name="l01094"></a>01094 
<a name="l01100"></a><a class="code" href="classNxsAssumptionsBlock_a01ef97e183894bfb38501624ef4e0091.html#a01ef97e183894bfb38501624ef4e0091">01100</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a01ef97e183894bfb38501624ef4e0091.html#a01ef97e183894bfb38501624ef4e0091" title="Makes data member taxa point to &amp;#39;tb&amp;#39;.">NxsAssumptionsBlock::ReplaceTaxaBlockPtr</a>(
<a name="l01101"></a>01101   <a class="code" href="classNxsTaxaBlockAPI.html" title="This abstract class describes the interface that every block that wants to serve...">NxsTaxaBlockAPI</a> *tb)  <span class="comment">/* pointer to new NxsTaxaBlockAPI object */</span>
<a name="l01102"></a>01102     {
<a name="l01103"></a>01103     NCL_ASSERT(tb != NULL);
<a name="l01104"></a>01104     <span class="keywordflow">if</span> (tb != taxa)
<a name="l01105"></a>01105         SetTaxaBlockPtr(tb, NxsBlock::BLOCK_LINK_UNKNOWN_STATUS);
<a name="l01106"></a>01106     }
<a name="l01107"></a>01107 
<a name="l01111"></a><a class="code" href="classNxsAssumptionsBlock_a940829b30ff43294a1f0296b24e2709f.html#a940829b30ff43294a1f0296b24e2709f">01111</a> <span class="keywordtype">int</span> <a class="code" href="classNxsAssumptionsBlock_a940829b30ff43294a1f0296b24e2709f.html#a940829b30ff43294a1f0296b24e2709f" title="Returns the number of character sets stored.">NxsAssumptionsBlock::GetNumCharSets</a>()<span class="keyword"> const</span>
<a name="l01112"></a>01112 <span class="keyword">    </span>{
<a name="l01113"></a>01113     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)charsets.size();
<a name="l01114"></a>01114     }
<a name="l01115"></a>01115 
<a name="l01119"></a><a class="code" href="classNxsAssumptionsBlock_a8fb0f369a6cc840d07c15be1b167890e.html#a8fb0f369a6cc840d07c15be1b167890e">01119</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a8fb0f369a6cc840d07c15be1b167890e.html#a8fb0f369a6cc840d07c15be1b167890e" title="Erases &amp;#39;names&amp;#39; vector, then fills &amp;#39;names&amp;#39; with the names of all stored...">NxsAssumptionsBlock::GetCharSetNames</a>(
<a name="l01120"></a>01120   NxsStringVector &amp;names) <span class="keyword">const</span> <span class="comment">/* the vector in which to store the names */</span> <span class="comment">/*v2.1to2.2 3 */</span>
<a name="l01121"></a>01121     {
<a name="l01122"></a>01122     names.erase(names.begin(), names.end());
<a name="l01123"></a>01123     NxsUnsignedSetMap::const_iterator i;
<a name="l01124"></a>01124     <span class="keywordflow">for</span> (i = charsets.begin(); i != charsets.end(); i++)
<a name="l01125"></a>01125         names.push_back((*i).first);
<a name="l01126"></a>01126     }
<a name="l01127"></a>01127 
<a name="l01131"></a><a class="code" href="classNxsAssumptionsBlock_ac5349cd029353714cd71b6f1558105d3.html#ac5349cd029353714cd71b6f1558105d3">01131</a> <span class="keyword">const</span> NxsUnsignedSet *<a class="code" href="classNxsAssumptionsBlock_ac5349cd029353714cd71b6f1558105d3.html#ac5349cd029353714cd71b6f1558105d3" title="Returns pointer to character set having name &amp;#39;nm&amp;#39;.">NxsAssumptionsBlock::GetCharSet</a>(
<a name="l01132"></a>01132   <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> n) <span class="keyword">const</span> <span class="comment">/* the name of the character set to return */</span> <span class="comment">/*v2.1to2.2 4 */</span>
<a name="l01133"></a>01133     {
<a name="l01134"></a>01134     NxsUnsignedSetMap::const_iterator it = charsets.find(n); <span class="comment">/*v2.1to2.2 5 */</span>
<a name="l01135"></a>01135     <span class="keywordflow">if</span> (it == charsets.end())
<a name="l01136"></a>01136         <span class="keywordflow">return</span> NULL;
<a name="l01137"></a>01137     <span class="keywordflow">return</span> &amp;(it-&gt;second);
<a name="l01138"></a>01138     }
<a name="l01139"></a>01139 
<a name="l01143"></a><a class="code" href="classNxsAssumptionsBlock_aab94b5758e02ed2f2fb8a825f3c03592.html#aab94b5758e02ed2f2fb8a825f3c03592">01143</a> <span class="keywordtype">int</span> <a class="code" href="classNxsAssumptionsBlock_aab94b5758e02ed2f2fb8a825f3c03592.html#aab94b5758e02ed2f2fb8a825f3c03592" title="Returns the number of character partitions stored.">NxsAssumptionsBlock::GetNumCharPartitions</a>() <span class="comment">/*v2.1to2.2 6 */</span>
<a name="l01144"></a>01144     {
<a name="l01145"></a>01145     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)charPartitions.size();
<a name="l01146"></a>01146     }
<a name="l01147"></a>01147 
<a name="l01151"></a><a class="code" href="classNxsAssumptionsBlock_a4c6af34a36a82a64f37beed2566ae2e3.html#a4c6af34a36a82a64f37beed2566ae2e3">01151</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a4c6af34a36a82a64f37beed2566ae2e3.html#a4c6af34a36a82a64f37beed2566ae2e3" title="Erases &amp;#39;names&amp;#39; vector, then fills &amp;#39;names&amp;#39; with the names of all stored...">NxsAssumptionsBlock::GetCharPartitionNames</a>(
<a name="l01152"></a>01152     vector&lt;std::string&gt; &amp;names) <span class="comment">/* the vector in which to store the names */</span> <span class="comment">/*v2.1to2.2 6 */</span>
<a name="l01153"></a>01153     {
<a name="l01154"></a>01154     names.erase(names.begin(), names.end());
<a name="l01155"></a>01155     NxsPartitionsByName::const_iterator i;
<a name="l01156"></a>01156     <span class="keywordflow">for</span> (i = charPartitions.begin(); i != charPartitions.end(); i++)
<a name="l01157"></a>01157     names.push_back((*i).first);
<a name="l01158"></a>01158     }
<a name="l01159"></a>01159 
<a name="l01163"></a><a class="code" href="classNxsAssumptionsBlock_a325e5b8d11cecaa3b01e9e307a96c108.html#a325e5b8d11cecaa3b01e9e307a96c108">01163</a> <span class="keyword">const</span> NxsPartition *<a class="code" href="classNxsAssumptionsBlock_a325e5b8d11cecaa3b01e9e307a96c108.html#a325e5b8d11cecaa3b01e9e307a96c108" title="Returns pointer to character partition having name &amp;#39;nm&amp;#39;.">NxsAssumptionsBlock::GetCharPartition</a>(
<a name="l01164"></a>01164     std::string nm) <span class="keyword">const</span> <span class="comment">/* the name of the character set to return */</span>
<a name="l01165"></a>01165     {
<a name="l01166"></a>01166     NxsPartitionsByName::const_iterator it = charPartitions.find(nm);
<a name="l01167"></a>01167     <span class="keywordflow">if</span> (it == charPartitions.end())
<a name="l01168"></a>01168         <span class="keywordflow">return</span> NULL;
<a name="l01169"></a>01169     <span class="keywordflow">return</span> &amp;(it-&gt;second);
<a name="l01170"></a>01170     }
<a name="l01171"></a>01171 
<a name="l01175"></a><a class="code" href="classNxsAssumptionsBlock_aead6a4a2ddb3894003d32af95a45465b.html#aead6a4a2ddb3894003d32af95a45465b">01175</a> <span class="keywordtype">int</span> <a class="code" href="classNxsAssumptionsBlock_aead6a4a2ddb3894003d32af95a45465b.html#aead6a4a2ddb3894003d32af95a45465b" title="Returns the number of taxon sets stored.">NxsAssumptionsBlock::GetNumTaxSets</a>()<span class="comment">/*v2.1to2.2 6 */</span>
<a name="l01176"></a>01176     {
<a name="l01177"></a>01177     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)taxsets.size();
<a name="l01178"></a>01178     }
<a name="l01179"></a>01179 
<a name="l01183"></a><a class="code" href="classNxsAssumptionsBlock_a26f2fa28d0797b832dfaebe29e5a5e2e.html#a26f2fa28d0797b832dfaebe29e5a5e2e">01183</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a26f2fa28d0797b832dfaebe29e5a5e2e.html#a26f2fa28d0797b832dfaebe29e5a5e2e" title="Erases &amp;#39;names&amp;#39; vector, then fills &amp;#39;names&amp;#39; with the names of all stored...">NxsAssumptionsBlock::GetTaxSetNames</a>(
<a name="l01184"></a>01184   NxsStringVector &amp;names)   <span class="comment">/* the vector in which to store the names */</span> <span class="comment">/*v2.1to2.2 7 */</span>
<a name="l01185"></a>01185     {
<a name="l01186"></a>01186     names.erase(names.begin(), names.end());
<a name="l01187"></a>01187     NxsUnsignedSetMap::const_iterator i;
<a name="l01188"></a>01188     <span class="keywordflow">for</span> (i = taxsets.begin(); i != taxsets.end(); i++)
<a name="l01189"></a>01189         names.push_back((*i).first);
<a name="l01190"></a>01190     }
<a name="l01191"></a>01191 
<a name="l01195"></a><a class="code" href="classNxsAssumptionsBlock_a77edaa6ed625e35f6cab8c8f2ff85f08.html#a77edaa6ed625e35f6cab8c8f2ff85f08">01195</a> NxsUnsignedSet &amp;<a class="code" href="classNxsAssumptionsBlock_a77edaa6ed625e35f6cab8c8f2ff85f08.html#a77edaa6ed625e35f6cab8c8f2ff85f08" title="Returns reference to taxon set having name &amp;#39;nm&amp;#39;.">NxsAssumptionsBlock::GetTaxSet</a>( <span class="comment">/*v2.1to2.2 8 */</span>
<a name="l01196"></a>01196   <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> nm) <span class="comment">/* the name of the taxon set to return */</span> <span class="comment">/*v2.1to2.2 9 */</span>
<a name="l01197"></a>01197     {
<a name="l01198"></a>01198     <span class="keywordflow">return</span> taxsets[nm]; <span class="comment">/*v2.1to2.2 10 */</span>
<a name="l01199"></a>01199     }
<a name="l01200"></a>01200 
<a name="l01201"></a>01201 
<a name="l01205"></a><a class="code" href="classNxsAssumptionsBlock_ab0cb9b501b0e4698df204c243352caeb.html#ab0cb9b501b0e4698df204c243352caeb">01205</a> <span class="keywordtype">int</span> <a class="code" href="classNxsAssumptionsBlock_ab0cb9b501b0e4698df204c243352caeb.html#ab0cb9b501b0e4698df204c243352caeb" title="Returns the number of exclusion sets stored.">NxsAssumptionsBlock::GetNumExSets</a>() <span class="comment">/*v2.1to2.2 6 */</span>
<a name="l01206"></a>01206     {
<a name="l01207"></a>01207     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)exsets.size();
<a name="l01208"></a>01208     }
<a name="l01209"></a>01209 
<a name="l01213"></a><a class="code" href="classNxsAssumptionsBlock_a858efae26b2eff355b5240405493f057.html#a858efae26b2eff355b5240405493f057">01213</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a858efae26b2eff355b5240405493f057.html#a858efae26b2eff355b5240405493f057" title="Erases names, then fills names with the names of all stored exclusion sets.">NxsAssumptionsBlock::GetExSetNames</a>(
<a name="l01214"></a>01214   NxsStringVector &amp;names)   <span class="comment">/* the vector in which to store the names */</span> <span class="comment">/*v2.1to2.2 7 */</span>
<a name="l01215"></a>01215     {
<a name="l01216"></a>01216     names.erase(names.begin(), names.end());
<a name="l01217"></a>01217     NxsUnsignedSetMap::const_iterator i;
<a name="l01218"></a>01218     <span class="keywordflow">for</span> (i = exsets.begin(); i != exsets.end(); i++)
<a name="l01219"></a>01219         names.push_back((*i).first);
<a name="l01220"></a>01220     }
<a name="l01221"></a>01221 
<a name="l01225"></a><a class="code" href="classNxsAssumptionsBlock_ab3e975170b5b3f292cb4d9de01297f43.html#ab3e975170b5b3f292cb4d9de01297f43">01225</a> NxsUnsignedSet &amp;<a class="code" href="classNxsAssumptionsBlock_ab3e975170b5b3f292cb4d9de01297f43.html#ab3e975170b5b3f292cb4d9de01297f43" title="Returns reference to exclusion set having name &amp;#39;nm&amp;#39;.">NxsAssumptionsBlock::GetExSet</a>( <span class="comment">/*v2.1to2.2 8 */</span>
<a name="l01226"></a>01226   <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> nm) <span class="comment">/* the name of the exclusion set to return */</span> <span class="comment">/*v2.1to2.2 9 */</span>
<a name="l01227"></a>01227     {
<a name="l01228"></a>01228     <span class="keywordflow">return</span> exsets[nm]; <span class="comment">/*v2.1to2.2 11 */</span>
<a name="l01229"></a>01229     }
<a name="l01230"></a>01230 
<a name="l01235"></a><a class="code" href="classNxsAssumptionsBlock_a008b67365008523a422529f45d1d070e.html#a008b67365008523a422529f45d1d070e">01235</a> <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> <a class="code" href="classNxsAssumptionsBlock_a008b67365008523a422529f45d1d070e.html#a008b67365008523a422529f45d1d070e" title="Returns name of default exclusion set.">NxsAssumptionsBlock::GetDefExSetName</a>() <span class="comment">/*v2.1to2.2 12 */</span>
<a name="l01236"></a>01236     {
<a name="l01237"></a>01237     <span class="keywordflow">return</span> def_exset;
<a name="l01238"></a>01238     }
<a name="l01239"></a>01239 
<a name="l01245"></a><a class="code" href="classNxsAssumptionsBlock_abd5243ab9c4c6cb3f103b90f9debfdc9.html#abd5243ab9c4c6cb3f103b90f9debfdc9">01245</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_abd5243ab9c4c6cb3f103b90f9debfdc9.html#abd5243ab9c4c6cb3f103b90f9debfdc9" title="Applies exclusion set having name &amp;#39;nm&amp;#39; by calling the ApplyExset method of...">NxsAssumptionsBlock::ApplyExset</a>(
<a name="l01246"></a>01246   <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> n) <span class="comment">/* the name of the exclusion set to apply */</span> <span class="comment">/*v2.1to2.2 4 */</span>
<a name="l01247"></a>01247     {
<a name="l01248"></a>01248     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> nm(n.c_str()); <span class="comment">// null-op needed for ease of generation of v2.2 from 2.1 code</span>
<a name="l01249"></a>01249     NCL_ASSERT(charBlockPtr != NULL);
<a name="l01250"></a>01250     charBlockPtr-&gt;ApplyExset(exsets[nm]);
<a name="l01251"></a>01251     }
<a name="l01252"></a>01252 
<a name="l01253"></a>01253 NxsAssumptionsBlockAPI *NxsAssumptionsBlock::DealWithPossibleParensInCharDependentCmd(<a class="code" href="classNxsToken.html">NxsToken</a> &amp;token, <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keyword">const</span> std::vector&lt;std::string&gt; *unsupported, <span class="keywordtype">bool</span> * isVect)
<a name="l01254"></a>01254     {
<a name="l01255"></a>01255     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01256"></a>01256     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> charblock_name;
<a name="l01257"></a>01257     errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l01258"></a>01258     <span class="keywordflow">if</span> (isVect)
<a name="l01259"></a>01259         *isVect = <span class="keyword">false</span>;
<a name="l01260"></a>01260     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;(&quot;</span>))
<a name="l01261"></a>01261         {
<a name="l01262"></a>01262         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01263"></a>01263         <span class="keywordflow">while</span> (!token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;)&quot;</span>))
<a name="l01264"></a>01264             {
<a name="l01265"></a>01265             <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;CHARACTERS&quot;</span>))
<a name="l01266"></a>01266                 {
<a name="l01267"></a>01267                 <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> t;
<a name="l01268"></a>01268                 t &lt;&lt; <span class="stringliteral">&quot;after \&quot;(Characters\&quot; in a &quot;</span> &lt;&lt; cmd &lt;&lt; <span class="stringliteral">&quot; command&quot;</span>;
<a name="l01269"></a>01269                 <a class="code" href="classNxsBlock_aee6771bdd0c70f375d925c4e0b6d1095.html#aee6771bdd0c70f375d925c4e0b6d1095" title="Advances the token, and raise an exception if it is not an equals sign.">DemandEquals</a>(token, t.c_str());
<a name="l01270"></a>01270                 token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01271"></a>01271                 charblock_name = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l01272"></a>01272                 }
<a name="l01273"></a>01273             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;VECTOR&quot;</span>))
<a name="l01274"></a>01274                 {
<a name="l01275"></a>01275                 <span class="keywordflow">if</span> (!isVect)
<a name="l01276"></a>01276                     <a class="code" href="classNxsBlock_a9106779865a661477259f3d84edb36a5.html#a9106779865a661477259f3d84edb36a5" title="throws a NxsException with the token info for `token` `expected` should fill in the...">GenerateNxsException</a>(token, <span class="stringliteral">&quot;VECTOR-style set definitions are not currently supported&quot;</span>);
<a name="l01277"></a>01277                 <span class="keywordflow">else</span>
<a name="l01278"></a>01278                     *isVect = <span class="keyword">true</span>;
<a name="l01279"></a>01279                 }
<a name="l01280"></a>01280             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;NOTOKENS&quot;</span>))
<a name="l01281"></a>01281                 <a class="code" href="classNxsBlock_a9106779865a661477259f3d84edb36a5.html#a9106779865a661477259f3d84edb36a5" title="throws a NxsException with the token info for `token` `expected` should fill in the...">GenerateNxsException</a>(token, <span class="stringliteral">&quot;NOTOKENS-style set definitions are not currently supported&quot;</span>);
<a name="l01282"></a>01282             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;;&quot;</span>))
<a name="l01283"></a>01283                 {
<a name="l01284"></a>01284                 <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> s;
<a name="l01285"></a>01285                 s &lt;&lt; <span class="stringliteral">&quot;; encountered in &quot;</span> &lt;&lt; cmd &lt;&lt; <span class="stringliteral">&quot; command before parentheses were closed&quot;</span>;
<a name="l01286"></a>01286                 <a class="code" href="classNxsBlock_a9106779865a661477259f3d84edb36a5.html#a9106779865a661477259f3d84edb36a5" title="throws a NxsException with the token info for `token` `expected` should fill in the...">GenerateNxsException</a>(token, s.c_str());
<a name="l01287"></a>01287                 }
<a name="l01288"></a>01288             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;STANDARD&quot;</span>) || token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;TOKENS&quot;</span>)) &amp;&amp; nexusReader)
<a name="l01289"></a>01289                 {
<a name="l01290"></a>01290                 <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
<a name="l01291"></a>01291                 <span class="keywordflow">if</span> (unsupported)
<a name="l01292"></a>01292                     {
<a name="l01293"></a>01293                     <span class="keywordflow">for</span> (std::vector&lt;std::string&gt;::const_iterator u = unsupported-&gt;begin(); u != unsupported-&gt;end(); ++u)
<a name="l01294"></a>01294                         {
<a name="l01295"></a>01295                         <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(u-&gt;c_str()))
<a name="l01296"></a>01296                             {
<a name="l01297"></a>01297                             found = <span class="keyword">true</span>;
<a name="l01298"></a>01298                             <span class="keywordflow">break</span>;
<a name="l01299"></a>01299                             }
<a name="l01300"></a>01300                         }
<a name="l01301"></a>01301                     }
<a name="l01302"></a>01302                 <span class="keywordflow">if</span> (found)
<a name="l01303"></a>01303                     {
<a name="l01304"></a>01304                     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> s;
<a name="l01305"></a>01305                     s &lt;&lt; <span class="stringliteral">&quot;The &quot;</span> &lt;&lt; token.<a class="code" href="classNxsToken_a83fb9fa31b17d84caaa2c50c664d195a.html#a83fb9fa31b17d84caaa2c50c664d195a" title="Returns the token for functions that only need read only access - faster than GetToken...">GetTokenReference</a>()&lt;&lt; <span class="stringliteral">&quot; as a &quot;</span> &lt;&lt; cmd &lt;&lt; <span class="stringliteral">&quot; qualifier is not supported.&quot;</span>;
<a name="l01306"></a>01306                     <a class="code" href="classNxsBlock_a9106779865a661477259f3d84edb36a5.html#a9106779865a661477259f3d84edb36a5" title="throws a NxsException with the token info for `token` `expected` should fill in the...">GenerateNxsException</a>(token, s.c_str());
<a name="l01307"></a>01307                     }
<a name="l01308"></a>01308                 <span class="keywordflow">else</span>
<a name="l01309"></a>01309                     {
<a name="l01310"></a>01310                     errormsg  &lt;&lt; <span class="stringliteral">&quot;Skipping unknown &quot;</span> &lt;&lt; cmd &lt;&lt; <span class="stringliteral">&quot; qualifier: &quot;</span>  &lt;&lt; token.<a class="code" href="classNxsToken_a83fb9fa31b17d84caaa2c50c664d195a.html#a83fb9fa31b17d84caaa2c50c664d195a" title="Returns the token for functions that only need read only access - faster than GetToken...">GetTokenReference</a>();
<a name="l01311"></a>01311                     nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad6030a0462aaf947e6383d0fd91a0b68">NxsReader::SKIPPING_CONTENT_WARNING</a>, token);
<a name="l01312"></a>01312                     errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l01313"></a>01313                     }
<a name="l01314"></a>01314                 }
<a name="l01315"></a>01315             token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01316"></a>01316             }
<a name="l01317"></a>01317         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01318"></a>01318         }
<a name="l01319"></a>01319     <span class="keyword">const</span> <span class="keywordtype">char</span> *cbn = (charblock_name.empty() ? NULL : charblock_name.c_str());
<a name="l01320"></a>01320     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> u;
<a name="l01321"></a>01321     u &lt;&lt; <span class="stringliteral">&quot;in &quot;</span> &lt;&lt; cmd &lt;&lt; <span class="stringliteral">&quot; definition&quot;</span>;
<a name="l01322"></a>01322     <a class="code" href="classNxsBlock_a61a4c16c7c243d1d5c5ca4c030783e4d.html#a61a4c16c7c243d1d5c5ca4c030783e4d" title="Raises an exception if it is not an equals sign.">DemandIsAtEquals</a>(token, u.c_str());
<a name="l01323"></a>01323     <span class="keywordflow">return</span> this-&gt;GetAssumptionsBlockForCharTitle(cbn, token, cmd);
<a name="l01324"></a>01324     }
<a name="l01325"></a>01325 
<a name="l01326"></a>01326 
<a name="l01330"></a><a class="code" href="classNxsAssumptionsBlock_a4cbc1a29f81409c93e8e75dafff6f6e2.html#a4cbc1a29f81409c93e8e75dafff6f6e2">01330</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a4cbc1a29f81409c93e8e75dafff6f6e2.html#a4cbc1a29f81409c93e8e75dafff6f6e2" title="Reads and stores information contained in the command TypeSet within an ASSUMPTIONS...">NxsAssumptionsBlock::HandleTypeSet</a>(
<a name="l01331"></a>01331   <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token)  <span class="comment">/* the token used to read from in */</span>
<a name="l01332"></a>01332     {
<a name="l01333"></a>01333     errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l01334"></a>01334     <span class="keywordtype">bool</span> asterisked = <span class="keyword">false</span>;
<a name="l01335"></a>01335     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01336"></a>01336     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;*&quot;</span>))
<a name="l01337"></a>01337         {
<a name="l01338"></a>01338         asterisked = <span class="keyword">true</span>;
<a name="l01339"></a>01339         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01340"></a>01340         }
<a name="l01341"></a>01341     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> typeset_name = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l01342"></a>01342     <span class="comment">//typeset_name.ToUpper();</span>
<a name="l01343"></a>01343     NxsAssumptionsBlockAPI * effectiveAssumpBlock = DealWithPossibleParensInCharDependentCmd(token, <span class="stringliteral">&quot;TypeSet&quot;</span>);
<a name="l01344"></a>01344     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01345"></a>01345     NCL_ASSERT(effectiveAssumpBlock);
<a name="l01346"></a>01346     NxsPartition newPartition;
<a name="l01347"></a>01347     <a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a> *cbp = effectiveAssumpBlock-&gt;GetCharBlockPtr();
<a name="l01348"></a>01348     NCL_ASSERT(cbp);
<a name="l01349"></a>01349     effectiveAssumpBlock-&gt;ReadPartitionDef(newPartition, *cbp, typeset_name, <span class="stringliteral">&quot;Character&quot;</span>, <span class="stringliteral">&quot;TypeSet&quot;</span>, token, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l01350"></a>01350     <a class="code" href="classNxsTransformationManager.html" title="NEXUS &amp;quot;types&amp;quot; (as in UserType and TypeSet commands) are assumptions about...">NxsTransformationManager</a> &amp;ctm = cbp-&gt;GetNxsTransformationManagerRef();
<a name="l01351"></a>01351     <span class="keywordflow">for</span> (NxsPartition::const_iterator groupIt = newPartition.begin(); groupIt != newPartition.end(); ++groupIt)
<a name="l01352"></a>01352         {
<a name="l01353"></a>01353         <span class="keywordflow">if</span> (!ctm.<a class="code" href="classNxsTransformationManager_ab72c47de22344f0e6a79717fa1299314.html#ab72c47de22344f0e6a79717fa1299314" title="Returns true if `n` is the name of a known type (standard or user type) -- not case-sensitive...">IsValidTypeName</a>(groupIt-&gt;first))
<a name="l01354"></a>01354             {
<a name="l01355"></a>01355             errormsg &lt;&lt; <span class="stringliteral">&quot;The group name &quot;</span> &lt;&lt; groupIt-&gt;first &lt;&lt; <span class="stringliteral">&quot; found in a TypeSet command does not correspond to a known type&quot;</span>;
<a name="l01356"></a>01356             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l01357"></a>01357             }
<a name="l01358"></a>01358         }
<a name="l01359"></a>01359     <a class="code" href="classNxsTransformationManager.html" title="NEXUS &amp;quot;types&amp;quot; (as in UserType and TypeSet commands) are assumptions about...">NxsTransformationManager</a> &amp;tm = effectiveAssumpBlock-&gt;GetNxsTransformationManagerRef();
<a name="l01360"></a>01360     ctm.AddTypeSet(typeset_name, newPartition, asterisked);
<a name="l01361"></a>01361     tm.AddTypeSet(typeset_name, newPartition, asterisked);
<a name="l01362"></a>01362     }
<a name="l01363"></a>01363 
<a name="l01364"></a>01364 
<a name="l01365"></a>01365 <span class="keywordtype">void</span> NxsAssumptionsBlock::HandleUserType(<a class="code" href="classNxsToken.html">NxsToken</a>&amp; token)
<a name="l01366"></a>01366     {
<a name="l01367"></a>01367     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01368"></a>01368     errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l01369"></a>01369     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;*&quot;</span>))
<a name="l01370"></a>01370         {
<a name="l01371"></a>01371         errormsg &lt;&lt; <span class="stringliteral">&quot;An * is ignored in a UserType command&quot;</span>;
<a name="l01372"></a>01372         <span class="keywordflow">if</span> (nexusReader)
<a name="l01373"></a>01373             nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad6030a0462aaf947e6383d0fd91a0b68">NxsReader::SKIPPING_CONTENT_WARNING</a>, token);
<a name="l01374"></a>01374         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01375"></a>01375         errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l01376"></a>01376         }
<a name="l01377"></a>01377     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> user_type_name = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l01378"></a>01378     <span class="comment">//codonPosSetName.ToUpper();</span>
<a name="l01379"></a>01379     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01380"></a>01380     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> charblock_name;
<a name="l01381"></a>01381     <span class="keywordtype">bool</span> floatMat = <span class="keyword">false</span>;
<a name="l01382"></a>01382     <span class="keywordtype">bool</span> cstreeform = <span class="keyword">false</span>;
<a name="l01383"></a>01383     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;(&quot;</span>))
<a name="l01384"></a>01384         {
<a name="l01385"></a>01385         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01386"></a>01386         <span class="keywordflow">while</span> (!token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;)&quot;</span>))
<a name="l01387"></a>01387             {
<a name="l01388"></a>01388             <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;CHARACTERS&quot;</span>))
<a name="l01389"></a>01389                 {
<a name="l01390"></a>01390                 <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> t;
<a name="l01391"></a>01391                 t &lt;&lt; <span class="stringliteral">&quot;after \&quot;(Characters\&quot; in a UserType command&quot;</span>;
<a name="l01392"></a>01392                 <a class="code" href="classNxsBlock_aee6771bdd0c70f375d925c4e0b6d1095.html#aee6771bdd0c70f375d925c4e0b6d1095" title="Advances the token, and raise an exception if it is not an equals sign.">DemandEquals</a>(token, t.c_str());
<a name="l01393"></a>01393                 token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01394"></a>01394                 charblock_name = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l01395"></a>01395                 }
<a name="l01396"></a>01396             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;CSTREE&quot;</span>))
<a name="l01397"></a>01397                 cstreeform = <span class="keyword">true</span>;
<a name="l01398"></a>01398             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;NOTOKENS&quot;</span>))
<a name="l01399"></a>01399                 <a class="code" href="classNxsBlock_a9106779865a661477259f3d84edb36a5.html#a9106779865a661477259f3d84edb36a5" title="throws a NxsException with the token info for `token` `expected` should fill in the...">GenerateNxsException</a>(token, <span class="stringliteral">&quot;NOTOKENS-style UserType are not supported&quot;</span>);
<a name="l01400"></a>01400             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;REALMATRIX&quot;</span>))
<a name="l01401"></a>01401                 floatMat = <span class="keyword">true</span>;
<a name="l01402"></a>01402             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;;&quot;</span>))
<a name="l01403"></a>01403                 {
<a name="l01404"></a>01404                 <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> s;
<a name="l01405"></a>01405                 s &lt;&lt; <span class="stringliteral">&quot;; encountered in UserType command before parentheses were closed&quot;</span>;
<a name="l01406"></a>01406                 <a class="code" href="classNxsBlock_a9106779865a661477259f3d84edb36a5.html#a9106779865a661477259f3d84edb36a5" title="throws a NxsException with the token info for `token` `expected` should fill in the...">GenerateNxsException</a>(token, s.c_str());
<a name="l01407"></a>01407                 }
<a name="l01408"></a>01408             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;STEPMATRIX&quot;</span>) || token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;TOKENS&quot;</span>)) &amp;&amp; nexusReader)
<a name="l01409"></a>01409                 {
<a name="l01410"></a>01410                 errormsg  &lt;&lt; <span class="stringliteral">&quot;Skipping unknown UserType qualifier: &quot;</span>  &lt;&lt; token.<a class="code" href="classNxsToken_a83fb9fa31b17d84caaa2c50c664d195a.html#a83fb9fa31b17d84caaa2c50c664d195a" title="Returns the token for functions that only need read only access - faster than GetToken...">GetTokenReference</a>();
<a name="l01411"></a>01411                 nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad6030a0462aaf947e6383d0fd91a0b68">NxsReader::SKIPPING_CONTENT_WARNING</a>, token);
<a name="l01412"></a>01412                 errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l01413"></a>01413                 }
<a name="l01414"></a>01414             token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01415"></a>01415             }
<a name="l01416"></a>01416         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01417"></a>01417         }
<a name="l01418"></a>01418     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;STEPMATRIX&quot;</span>) || token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;REALMATRIX&quot;</span>))
<a name="l01419"></a>01419         {
<a name="l01420"></a>01420         errormsg  &lt;&lt; <span class="stringliteral">&quot;UserType qualifier &quot;</span>&lt;&lt; token.<a class="code" href="classNxsToken_a83fb9fa31b17d84caaa2c50c664d195a.html#a83fb9fa31b17d84caaa2c50c664d195a" title="Returns the token for functions that only need read only access - faster than GetToken...">GetTokenReference</a>() &lt;&lt; <span class="stringliteral">&quot; should occur in parentheses (&quot;</span>&lt;&lt; token.<a class="code" href="classNxsToken_a83fb9fa31b17d84caaa2c50c664d195a.html#a83fb9fa31b17d84caaa2c50c664d195a" title="Returns the token for functions that only need read only access - faster than GetToken...">GetTokenReference</a>() &lt;&lt;<span class="stringliteral">&quot;) &quot;</span>;
<a name="l01421"></a>01421         nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978aaa20309c3f4df7ded74de92d7f8e682f">NxsReader::DEPRECATED_WARNING</a>, token);
<a name="l01422"></a>01422         errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l01423"></a>01423         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01424"></a>01424         }
<a name="l01425"></a>01425     <a class="code" href="classNxsBlock_a61a4c16c7c243d1d5c5ca4c030783e4d.html#a61a4c16c7c243d1d5c5ca4c030783e4d" title="Raises an exception if it is not an equals sign.">DemandIsAtEquals</a>(token, <span class="stringliteral">&quot;in UserType definition&quot;</span>);
<a name="l01426"></a>01426 
<a name="l01427"></a>01427     <span class="keyword">const</span> <span class="keywordtype">char</span> *cbn = (charblock_name.empty() ? NULL : charblock_name.c_str());
<a name="l01428"></a>01428     NxsAssumptionsBlockAPI * effectiveAssumpBlock =  this-&gt;GetAssumptionsBlockForCharTitle(cbn, token, <span class="stringliteral">&quot;UserType&quot;</span>);
<a name="l01429"></a>01429     NCL_ASSERT(effectiveAssumpBlock);
<a name="l01430"></a>01430     <a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a> *cbp = effectiveAssumpBlock-&gt;GetCharBlockPtr();
<a name="l01431"></a>01431     NCL_ASSERT(cbp);
<a name="l01432"></a>01432 
<a name="l01433"></a>01433     NxsRealStepMatrix::DblMatrix dm;
<a name="l01434"></a>01434     NxsIntStepMatrix::IntMatrix im;
<a name="l01435"></a>01435     std::vector&lt;std::string&gt; symbolsOrder;
<a name="l01436"></a>01436     <span class="keyword">const</span> std::vector&lt;const NxsDiscreteDatatypeMapper *&gt; mappers = cbp-&gt;GetAllDatatypeMappers();
<a name="l01437"></a>01437 
<a name="l01438"></a>01438     <span class="keywordflow">if</span> (cstreeform)
<a name="l01439"></a>01439         {
<a name="l01440"></a>01440         <span class="keywordtype">bool</span> success = <span class="keyword">false</span>;
<a name="l01441"></a>01441         ProcessedNxsCommand tokenVec;
<a name="l01442"></a>01442         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01443"></a>01443         token.<a class="code" href="classNxsToken_af339d0b55c743a874f781e0fe2e3c6c0.html#af339d0b55c743a874f781e0fe2e3c6c0" title="Reads until &amp;quot;;&amp;quot; and fills the vector of ProcessedNxsToken objects.">ProcessAsCommand</a>(&amp;tokenVec);
<a name="l01444"></a>01444 
<a name="l01445"></a>01445         <span class="keywordflow">for</span> (std::vector&lt;const NxsDiscreteDatatypeMapper *&gt;::const_iterator mIt = mappers.begin(); !success &amp;&amp; mIt != mappers.end(); ++mIt)
<a name="l01446"></a>01446             {
<a name="l01447"></a>01447             <span class="keyword">const</span> <a class="code" href="classNxsDiscreteDatatypeMapper.html" title="This class stores the information needed to map the internal storage for a cell of...">NxsDiscreteDatatypeMapper</a> * mapper = *mIt;
<a name="l01448"></a>01448             std::string s = mapper-&gt;GetSymbolsWithGapChar();
<a name="l01449"></a>01449             symbolsOrder.clear();
<a name="l01450"></a>01450             std::map&lt;std::string, unsigned&gt; symMap;
<a name="l01451"></a>01451             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; s.length(); ++i)
<a name="l01452"></a>01452                 {
<a name="l01453"></a>01453                 std::string sym(1, s[i]);
<a name="l01454"></a>01454                 symbolsOrder.push_back(sym);
<a name="l01455"></a>01455                 symMap[sym] = i;
<a name="l01456"></a>01456                 }
<a name="l01457"></a>01457             std::string newick;
<a name="l01458"></a>01458             NxsFullTreeDescription treeDesc(newick, user_type_name, 0);
<a name="l01459"></a>01459             BogusToIndMapper labelToIndMapper;
<a name="l01460"></a>01460             <span class="keywordflow">try</span>
<a name="l01461"></a>01461                 {
<a name="l01462"></a>01462                 NxsTreesBlock::ProcessTokenVecIntoTree(tokenVec, treeDesc, &amp;labelToIndMapper, symMap, <span class="keyword">false</span>, nexusReader, mapper-&gt;IsRespectCase());
<a name="l01463"></a>01463                 success = <span class="keyword">true</span>;
<a name="l01464"></a>01464                 }
<a name="l01465"></a>01465             <span class="keywordflow">catch</span> (<a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a> &amp;x)
<a name="l01466"></a>01466                 {
<a name="l01467"></a>01467                 <span class="keywordflow">if</span> (!labelToIndMapper.queried)
<a name="l01468"></a>01468                     <span class="keywordflow">throw</span> x;
<a name="l01469"></a>01469                 }
<a name="l01470"></a>01470             NxsSimpleTree cstree(treeDesc, 1, 1.0);
<a name="l01471"></a>01471             <span class="keywordflow">if</span> (treeDesc.SomeEdgesHaveLengths() &amp;&amp; !treeDesc.EdgeLengthsAreAllIntegers())
<a name="l01472"></a>01472                 {
<a name="l01473"></a>01473                 floatMat = <span class="keyword">true</span>;
<a name="l01474"></a>01474                 dm = cstree.GetDblPathDistances(<span class="keyword">false</span>);
<a name="l01475"></a>01475                 <span class="keywordflow">if</span> (dm.size() &lt; symbolsOrder.size())
<a name="l01476"></a>01476                     symbolsOrder.resize(dm.size());
<a name="l01477"></a>01477                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dm.size() &gt; symbolsOrder.size())
<a name="l01478"></a>01478                     success = <span class="keyword">false</span>;
<a name="l01479"></a>01479                 }
<a name="l01480"></a>01480             <span class="keywordflow">else</span>
<a name="l01481"></a>01481                 {
<a name="l01482"></a>01482                 im = cstree.GetIntPathDistances();
<a name="l01483"></a>01483                 <span class="keywordflow">if</span> (im.size() &lt; symbolsOrder.size())
<a name="l01484"></a>01484                     symbolsOrder.resize(im.size());
<a name="l01485"></a>01485                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (im.size() &gt; symbolsOrder.size())
<a name="l01486"></a>01486                     success = <span class="keyword">false</span>;
<a name="l01487"></a>01487                 }
<a name="l01488"></a>01488 
<a name="l01489"></a>01489             }
<a name="l01490"></a>01490         <span class="keywordflow">if</span> (!success)
<a name="l01491"></a>01491             {
<a name="l01492"></a>01492             errormsg &lt;&lt; <span class="stringliteral">&quot;No datatype was found with all of the symbols the UserType CSTree&quot;</span>;
<a name="l01493"></a>01493             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l01494"></a>01494             }
<a name="l01495"></a>01495         }
<a name="l01496"></a>01496     <span class="keywordflow">else</span>
<a name="l01497"></a>01497         {
<a name="l01498"></a>01498         <span class="comment">/* BEGIN Read as Stepmatrix section  */</span>
<a name="l01499"></a>01499         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01500"></a>01500         <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> t = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l01501"></a>01501         <span class="keywordtype">long</span> longNstates;
<a name="l01502"></a>01502         <span class="keywordflow">if</span> (!<a class="code" href="classNxsString_adf4b63c464113eb110a44e454cb0ed4e.html#adf4b63c464113eb110a44e454cb0ed4e" title="Returns true if `o` points to a string that represents a long (and `o` has no other...">NxsString::to_long</a>(t.c_str(), &amp;longNstates) || longNstates &lt; 2)
<a name="l01503"></a>01503             {
<a name="l01504"></a>01504             errormsg &lt;&lt; <span class="stringliteral">&quot;Expecting a number of states after the = in the UserType command (the number of states must be greater than one).  Found &quot;</span> &lt;&lt; t;
<a name="l01505"></a>01505             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(t, token);
<a name="l01506"></a>01506             }
<a name="l01507"></a>01507         <span class="keyword">const</span> <span class="keywordtype">bool</span> respectCase = cbp-&gt;IsRespectCase();
<a name="l01508"></a>01508         <span class="keywordtype">unsigned</span> nStates = (unsigned) longNstates;
<a name="l01509"></a>01509         NxsRealStepMatrix::DblVec dv(nStates, DBL_MAX);
<a name="l01510"></a>01510         NxsIntStepMatrix::IntVec iv(nStates, INT_MAX);
<a name="l01511"></a>01511         dm.assign(nStates, dv);
<a name="l01512"></a>01512         im.assign(nStates, iv);
<a name="l01513"></a>01513         std::set&lt;char&gt; symbolsSet;
<a name="l01514"></a>01514         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; nStates;)
<a name="l01515"></a>01515             {
<a name="l01516"></a>01516             token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01517"></a>01517             <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;;&quot;</span>))
<a name="l01518"></a>01518                 {
<a name="l01519"></a>01519                 errormsg &lt;&lt; <span class="stringliteral">&quot;; prematurely terminated the state declaration portion of a UserType stepmatrix.&quot;</span>;
<a name="l01520"></a>01520                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(t, token);
<a name="l01521"></a>01521                 }
<a name="l01522"></a>01522             <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> tokStr = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l01523"></a>01523             <span class="keywordflow">if</span> (!respectCase)
<a name="l01524"></a>01524                 tokStr.ToUpper();
<a name="l01525"></a>01525             <span class="keywordflow">for</span> (NxsString::const_iterator cIt = tokStr.begin(); cIt != tokStr.end(); ++cIt, ++i)
<a name="l01526"></a>01526                 {
<a name="l01527"></a>01527                 <span class="keywordtype">char</span> s = *cIt;
<a name="l01528"></a>01528                 <span class="keywordflow">if</span> (symbolsSet.count(s) &gt; 0)
<a name="l01529"></a>01529                     {
<a name="l01530"></a>01530                     errormsg &lt;&lt; <span class="stringliteral">&quot;State names cannot be repeated in a UserType stepmatrix.  &quot;</span> &lt;&lt; s &lt;&lt; <span class="stringliteral">&quot; was encountered more than once.&quot;</span>;
<a name="l01531"></a>01531                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(t, token);
<a name="l01532"></a>01532                     }
<a name="l01533"></a>01533                 <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
<a name="l01534"></a>01534                 <span class="keywordflow">for</span> (std::vector&lt;const NxsDiscreteDatatypeMapper *&gt;::const_iterator mIt = mappers.begin(); mIt != mappers.end(); ++mIt)
<a name="l01535"></a>01535                     {
<a name="l01536"></a>01536                     <span class="keyword">const</span> <a class="code" href="classNxsDiscreteDatatypeMapper.html" title="This class stores the information needed to map the internal storage for a cell of...">NxsDiscreteDatatypeMapper</a> * mapper = *mIt;
<a name="l01537"></a>01537                     <span class="keywordflow">if</span> (mapper-&gt;PositionInSymbolsOrGaps(s) != NXS_INVALID_STATE_CODE)
<a name="l01538"></a>01538                         {
<a name="l01539"></a>01539                         found = <span class="keyword">true</span>;
<a name="l01540"></a>01540                         <span class="keywordflow">break</span>;
<a name="l01541"></a>01541                         }
<a name="l01542"></a>01542                     }
<a name="l01543"></a>01543                 <span class="keywordflow">if</span> (!found)
<a name="l01544"></a>01544                     {
<a name="l01545"></a>01545                     errormsg &lt;&lt; <span class="stringliteral">&quot;Unrecognized state &quot;</span> &lt;&lt; s &lt;&lt; <span class="stringliteral">&quot;in  UserType stepmatrix.&quot;</span>;
<a name="l01546"></a>01546                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(t, token);
<a name="l01547"></a>01547                     }
<a name="l01548"></a>01548                 symbolsSet.insert(s);
<a name="l01549"></a>01549                 symbolsOrder.push_back(std::string(1,s));
<a name="l01550"></a>01550                 }
<a name="l01551"></a>01551             }
<a name="l01552"></a>01552 
<a name="l01553"></a>01553         <span class="keywordtype">double</span> currDblWt;
<a name="l01554"></a>01554         <span class="keywordtype">long</span> currLongWt;
<a name="l01555"></a>01555 
<a name="l01556"></a>01556         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; nStates; ++i)
<a name="l01557"></a>01557             {
<a name="l01558"></a>01558             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; nStates; ++j)
<a name="l01559"></a>01559                 {
<a name="l01560"></a>01560                 token.<a class="code" href="classNxsToken_afa5232738ca19e069173e8befe75e730.html#afa5232738ca19e069173e8befe75e730" title="Sets the bit specified in the variable `labileFlags&amp;#39;.">SetLabileFlagBit</a>(NxsToken::hyphenNotPunctuation); <span class="comment">// this allows us to deal with sci. not. in weights.</span>
<a name="l01561"></a>01561                 token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01562"></a>01562                 <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> s = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l01563"></a>01563                 <span class="keywordflow">if</span> (i == j &amp;&amp; (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;.&quot;</span>) || token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;-&quot;</span>)))
<a name="l01564"></a>01564                     {
<a name="l01565"></a>01565                     im[i][i] = 0;
<a name="l01566"></a>01566                     dm[i][i] = 0.0;
<a name="l01567"></a>01567                     }
<a name="l01568"></a>01568                 <span class="keywordflow">else</span>
<a name="l01569"></a>01569                     {
<a name="l01570"></a>01570                     <span class="keywordtype">bool</span> v = <a class="code" href="classNxsString_a8e64423982159633f63b9716956f7ca3.html#a8e64423982159633f63b9716956f7ca3" title="Returns true if `o` points to a string that represents a double (and `o` has no other...">NxsString::to_double</a>(s.c_str(), &amp;currDblWt);
<a name="l01571"></a>01571                     <span class="keywordflow">if</span> (!v)
<a name="l01572"></a>01572                         {
<a name="l01573"></a>01573                         <span class="keywordflow">if</span> (!token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;I&quot;</span>) &amp;&amp; !token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;INF&quot;</span>))
<a name="l01574"></a>01574                             {
<a name="l01575"></a>01575                             errormsg &lt;&lt; <span class="stringliteral">&quot;Expecting a number or i (for infinity) as an element of the UserType stepmatrix. Found &quot;</span> &lt;&lt; s;
<a name="l01576"></a>01576                             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l01577"></a>01577                             }
<a name="l01578"></a>01578                         }
<a name="l01579"></a>01579                     <span class="keywordflow">else</span>
<a name="l01580"></a>01580                         {
<a name="l01581"></a>01581                         dm[i][j] = currDblWt;
<a name="l01582"></a>01582                         <span class="keywordflow">if</span> (!floatMat)
<a name="l01583"></a>01583                             {
<a name="l01584"></a>01584                             floatMat = !<a class="code" href="classNxsString_adf4b63c464113eb110a44e454cb0ed4e.html#adf4b63c464113eb110a44e454cb0ed4e" title="Returns true if `o` points to a string that represents a long (and `o` has no other...">NxsString::to_long</a>(s.c_str(), &amp;currLongWt);
<a name="l01585"></a>01585                             <span class="keywordflow">if</span> (!floatMat)
<a name="l01586"></a>01586                                 im[i][j] = currLongWt;
<a name="l01587"></a>01587                             }
<a name="l01588"></a>01588                         }
<a name="l01589"></a>01589                     }
<a name="l01590"></a>01590                 }
<a name="l01591"></a>01591             }
<a name="l01592"></a>01592         <span class="comment">/* END Read as Stepmatrix section  */</span>
<a name="l01593"></a>01593         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01594"></a>01594         <span class="keywordflow">if</span> (!token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;;&quot;</span>))
<a name="l01595"></a>01595             {
<a name="l01596"></a>01596             errormsg &lt;&lt; <span class="stringliteral">&quot;Expecting ; at the end of the UserType command. Found &quot;</span>  &lt;&lt; token.<a class="code" href="classNxsToken_a83fb9fa31b17d84caaa2c50c664d195a.html#a83fb9fa31b17d84caaa2c50c664d195a" title="Returns the token for functions that only need read only access - faster than GetToken...">GetTokenReference</a>();
<a name="l01597"></a>01597             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(t, token);
<a name="l01598"></a>01598             }
<a name="l01599"></a>01599         }
<a name="l01600"></a>01600 
<a name="l01601"></a>01601     <a class="code" href="classNxsTransformationManager.html" title="NEXUS &amp;quot;types&amp;quot; (as in UserType and TypeSet commands) are assumptions about...">NxsTransformationManager</a> &amp;ctm = cbp-&gt;GetNxsTransformationManagerRef();
<a name="l01602"></a>01602     <a class="code" href="classNxsTransformationManager.html" title="NEXUS &amp;quot;types&amp;quot; (as in UserType and TypeSet commands) are assumptions about...">NxsTransformationManager</a> &amp;tm = effectiveAssumpBlock-&gt;GetNxsTransformationManagerRef();
<a name="l01603"></a>01603     <span class="keywordflow">if</span> (floatMat)
<a name="l01604"></a>01604         {
<a name="l01605"></a>01605         <span class="keyword">const</span> <a class="code" href="classNxsRealStepMatrix.html" title="Internal representation of a stepmatrix with cells composed of doubles.">NxsRealStepMatrix</a> nrsm(symbolsOrder, dm);
<a name="l01606"></a>01606         ctm.<a class="code" href="classNxsTransformationManager_a8b912a987afbdb9ca09f67878799a815.html#a8b912a987afbdb9ca09f67878799a815" title="Raises an NxsNCLAPIException if the `name` is the name of a &amp;quot;standard&amp;quot;...">AddRealType</a>(user_type_name, nrsm);
<a name="l01607"></a>01607         tm.<a class="code" href="classNxsTransformationManager_a8b912a987afbdb9ca09f67878799a815.html#a8b912a987afbdb9ca09f67878799a815" title="Raises an NxsNCLAPIException if the `name` is the name of a &amp;quot;standard&amp;quot;...">AddRealType</a>(user_type_name, nrsm);
<a name="l01608"></a>01608         }
<a name="l01609"></a>01609     <span class="keywordflow">else</span>
<a name="l01610"></a>01610         {
<a name="l01611"></a>01611         <span class="keyword">const</span> <a class="code" href="classNxsIntStepMatrix.html" title="Internal representation of a stepmatrix with cells composed of ints.">NxsIntStepMatrix</a> nism(symbolsOrder, im);
<a name="l01612"></a>01612         ctm.<a class="code" href="classNxsTransformationManager_adf35400da3a9e9e3d74f4084d08bf52e.html#adf35400da3a9e9e3d74f4084d08bf52e" title="Raises an NxsNCLAPIException if the `name` is the name of a &amp;quot;standard&amp;quot;...">AddIntType</a>(user_type_name, nism);
<a name="l01613"></a>01613         tm.<a class="code" href="classNxsTransformationManager_adf35400da3a9e9e3d74f4084d08bf52e.html#adf35400da3a9e9e3d74f4084d08bf52e" title="Raises an NxsNCLAPIException if the `name` is the name of a &amp;quot;standard&amp;quot;...">AddIntType</a>(user_type_name, nism);
<a name="l01614"></a>01614         }
<a name="l01615"></a>01615     }
<a name="l01616"></a>01616 
<a name="l01617"></a>01617 
<a name="l01618"></a>01618 NxsGeneticCodesManager::NxsGeneticCodesManager()
<a name="l01619"></a>01619     {
<a name="l01620"></a>01620     standardCodeNames.insert(std::string(<span class="stringliteral">&quot;UNIVERSAL&quot;</span>));
<a name="l01621"></a>01621     standardCodeNames.insert(std::string(<span class="stringliteral">&quot;UNIVERSAL.EXT&quot;</span>));
<a name="l01622"></a>01622     standardCodeNames.insert(std::string(<span class="stringliteral">&quot;MTDNA.DROS&quot;</span>));
<a name="l01623"></a>01623     standardCodeNames.insert(std::string(<span class="stringliteral">&quot;MTDNA.DROS.EXT&quot;</span>));
<a name="l01624"></a>01624     standardCodeNames.insert(std::string(<span class="stringliteral">&quot;MTDNA.MAM&quot;</span>));
<a name="l01625"></a>01625     standardCodeNames.insert(std::string(<span class="stringliteral">&quot;MTDNA.MAM.EXT&quot;</span>));
<a name="l01626"></a>01626     standardCodeNames.insert(std::string(<span class="stringliteral">&quot;MTDNA.YEAST&quot;</span>));
<a name="l01627"></a>01627     }
<a name="l01628"></a>01628 
<a name="l01629"></a>01629 <span class="keywordtype">bool</span> NxsGeneticCodesManager::IsValidCodeName(<span class="keyword">const</span> std::string &amp;n)<span class="keyword"> const</span>
<a name="l01630"></a>01630 <span class="keyword">    </span>{
<a name="l01631"></a>01631     std::string capName(n.c_str());
<a name="l01632"></a>01632     <a class="code" href="classNxsString_afa27910900e7e9f3bdc8d1b9753479a9.html#afa27910900e7e9f3bdc8d1b9753479a9" title="Capitalizes every character in s.">NxsString::to_upper</a>(capName);
<a name="l01633"></a>01633     <span class="keywordflow">return</span> (standardCodeNames.count(capName) &gt; 0) || (userDefinedCodeNames.count(capName) &gt; 0);
<a name="l01634"></a>01634     }
<a name="l01638"></a><a class="code" href="classNxsAssumptionsBlock_a0d5a1f86cd7780ad198f3d597a7e2fd9.html#a0d5a1f86cd7780ad198f3d597a7e2fd9">01638</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a0d5a1f86cd7780ad198f3d597a7e2fd9.html#a0d5a1f86cd7780ad198f3d597a7e2fd9" title="Reads and stores information contained in the command TypeSet within an ASSUMPTIONS...">NxsAssumptionsBlock::HandleCodeSet</a>(
<a name="l01639"></a>01639   <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token)  <span class="comment">/* the token used to read from in */</span>
<a name="l01640"></a>01640     {
<a name="l01641"></a>01641     <span class="keywordtype">bool</span> asterisked = <span class="keyword">false</span>;
<a name="l01642"></a>01642     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01643"></a>01643     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;*&quot;</span>))
<a name="l01644"></a>01644         {
<a name="l01645"></a>01645         asterisked = <span class="keyword">true</span>;
<a name="l01646"></a>01646         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01647"></a>01647         }
<a name="l01648"></a>01648     std::vector&lt;std::string&gt; unsupported;
<a name="l01649"></a>01649     unsupported.push_back(std::string(<span class="stringliteral">&quot;TAXA&quot;</span>));
<a name="l01650"></a>01650     unsupported.push_back(std::string(<span class="stringliteral">&quot;UNALIGNED&quot;</span>));
<a name="l01651"></a>01651     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> codeset_name = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l01652"></a>01652     <span class="comment">//codeset_name.ToUpper();</span>
<a name="l01653"></a>01653     NxsAssumptionsBlockAPI * effectiveAssumpBlock = DealWithPossibleParensInCharDependentCmd(token, <span class="stringliteral">&quot;CodeSet&quot;</span>, &amp;unsupported);
<a name="l01654"></a>01654     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01655"></a>01655     NxsPartition newPartition;
<a name="l01656"></a>01656     <a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a> *cbp = effectiveAssumpBlock-&gt;GetCharBlockPtr();
<a name="l01657"></a>01657     NCL_ASSERT(cbp);
<a name="l01658"></a>01658     effectiveAssumpBlock-&gt;ReadPartitionDef(newPartition, *cbp, codeset_name, <span class="stringliteral">&quot;Character&quot;</span>, <span class="stringliteral">&quot;CodeSet&quot;</span>, token, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l01659"></a>01659     NxsGeneticCodesManager &amp;gcm = effectiveAssumpBlock-&gt;GetNxsGeneticCodesManagerRef();
<a name="l01660"></a>01660     <span class="keywordflow">for</span> (NxsPartition::const_iterator groupIt = newPartition.begin(); groupIt != newPartition.end(); ++groupIt)
<a name="l01661"></a>01661         {
<a name="l01662"></a>01662         <span class="keyword">const</span> std::string &amp; s = groupIt-&gt;first;
<a name="l01663"></a>01663         <span class="keywordflow">if</span> (!gcm.IsValidCodeName(s))
<a name="l01664"></a>01664             {
<a name="l01665"></a>01665             errormsg &lt;&lt; <span class="stringliteral">&quot;The Genetic code name &quot;</span> &lt;&lt; groupIt-&gt;first &lt;&lt; <span class="stringliteral">&quot; found in a CodeSet command does not correspond to a known code&quot;</span>;
<a name="l01666"></a>01666             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l01667"></a>01667             }
<a name="l01668"></a>01668         }
<a name="l01669"></a>01669     effectiveAssumpBlock-&gt;AddCodeSet(codeset_name, newPartition, asterisked);
<a name="l01670"></a>01670     }
<a name="l01671"></a>01671 
<a name="l01675"></a><a class="code" href="classNxsAssumptionsBlock_a15b2808a67dedc7b22282b3d413df1b8.html#a15b2808a67dedc7b22282b3d413df1b8">01675</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a15b2808a67dedc7b22282b3d413df1b8.html#a15b2808a67dedc7b22282b3d413df1b8" title="Reads and stores information contained in the command TypeSet within an ASSUMPTIONS...">NxsAssumptionsBlock::HandleCodonPosSet</a>(
<a name="l01676"></a>01676   <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token)  <span class="comment">/* the token used to read from in */</span>
<a name="l01677"></a>01677     {
<a name="l01678"></a>01678     <span class="keywordtype">bool</span> asterisked = <span class="keyword">false</span>;
<a name="l01679"></a>01679     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01680"></a>01680     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;*&quot;</span>))
<a name="l01681"></a>01681         {
<a name="l01682"></a>01682         asterisked = <span class="keyword">true</span>;
<a name="l01683"></a>01683         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01684"></a>01684         }
<a name="l01685"></a>01685     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> codonPosSetName = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l01686"></a>01686     <span class="comment">//codonPosSetName.ToUpper();</span>
<a name="l01687"></a>01687     NxsAssumptionsBlockAPI * effectiveAssumpBlock = DealWithPossibleParensInCharDependentCmd(token, <span class="stringliteral">&quot;CodonPosSet&quot;</span>, NULL);
<a name="l01688"></a>01688     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01689"></a>01689     NxsPartition newPartition;
<a name="l01690"></a>01690     <a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a> *cbp = effectiveAssumpBlock-&gt;GetCharBlockPtr();
<a name="l01691"></a>01691     NCL_ASSERT(cbp);
<a name="l01692"></a>01692     effectiveAssumpBlock-&gt;ReadPartitionDef(newPartition, *cbp, codonPosSetName, <span class="stringliteral">&quot;Character&quot;</span>, <span class="stringliteral">&quot;CodonPosSet&quot;</span>, token, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l01693"></a>01693     <span class="keywordflow">for</span> (NxsPartition::const_iterator groupIt = newPartition.begin(); groupIt != newPartition.end(); ++groupIt)
<a name="l01694"></a>01694         {
<a name="l01695"></a>01695         <span class="keyword">const</span> std::string &amp; s = groupIt-&gt;first;
<a name="l01696"></a>01696         <span class="keywordtype">bool</span> legal = <span class="keyword">false</span>;
<a name="l01697"></a>01697         <span class="keywordflow">if</span> (s.length() == 1)
<a name="l01698"></a>01698             {
<a name="l01699"></a>01699             <span class="keyword">const</span> <span class="keywordtype">char</span> c = s[0];
<a name="l01700"></a>01700             <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;n&#39;</span> || c == <span class="charliteral">&#39;N&#39;</span> || c == <span class="charliteral">&#39;1&#39;</span> || c == <span class="charliteral">&#39;2&#39;</span> || c == <span class="charliteral">&#39;3&#39;</span> || c == <span class="charliteral">&#39;?&#39;</span>)
<a name="l01701"></a>01701                 legal = <span class="keyword">true</span>;
<a name="l01702"></a>01702             }
<a name="l01703"></a>01703         <span class="keywordflow">if</span> (!legal)
<a name="l01704"></a>01704             {
<a name="l01705"></a>01705             errormsg &lt;&lt; <span class="stringliteral">&quot;The Codon Position category name &quot;</span> &lt;&lt; groupIt-&gt;first &lt;&lt; <span class="stringliteral">&quot; found in a CodonPosSet command is not legal.  \&quot;N\&quot;, \&quot;1\&quot;, \&quot;2\&quot;, or \&quot;3\&quot; were expected.&quot;</span>;
<a name="l01706"></a>01706             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l01707"></a>01707             }
<a name="l01708"></a>01708         }
<a name="l01709"></a>01709     effectiveAssumpBlock-&gt;AddCodonPosSet(codonPosSetName, newPartition, asterisked);
<a name="l01710"></a>01710     cbp-&gt;AddNewCodonPosPartition(codonPosSetName, newPartition, asterisked);
<a name="l01711"></a>01711     }
<a name="l01712"></a>01712 
<a name="l01713"></a>01713 <span class="keyword">class </span>NxsSetVectorItemValidator
<a name="l01714"></a>01714     {
<a name="l01715"></a>01715     <span class="keyword">public</span>:
<a name="l01716"></a>01716         <span class="keyword">virtual</span> ~NxsSetVectorItemValidator(){};
<a name="l01717"></a>01717         <span class="keyword">virtual</span> std::string convert(<a class="code" href="classNxsToken.html">NxsToken</a> &amp;) = 0;
<a name="l01718"></a>01718     };
<a name="l01719"></a>01719 
<a name="l01720"></a>01720 <span class="keyword">class </span>WtSetVectorItemValidator: <span class="keyword">public</span> NxsSetVectorItemValidator
<a name="l01721"></a>01721     {
<a name="l01722"></a>01722     <span class="keyword">public</span>:
<a name="l01723"></a>01723         <span class="keyword">virtual</span> ~WtSetVectorItemValidator(){};
<a name="l01724"></a>01724         <span class="keyword">virtual</span> std::string convert(<a class="code" href="classNxsToken.html">NxsToken</a> &amp; token)
<a name="l01725"></a>01725             {
<a name="l01726"></a>01726             <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> s = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l01727"></a>01727             <span class="keyword">const</span> <span class="keywordtype">char</span> * c = s.c_str();
<a name="l01728"></a>01728             <span class="keywordtype">long</span> currLongWt;
<a name="l01729"></a>01729             <span class="keywordtype">double</span> currDblWt;
<a name="l01730"></a>01730             <span class="keywordflow">if</span> (<a class="code" href="classNxsString_adf4b63c464113eb110a44e454cb0ed4e.html#adf4b63c464113eb110a44e454cb0ed4e" title="Returns true if `o` points to a string that represents a long (and `o` has no other...">NxsString::to_long</a>(c, &amp;currLongWt) || <a class="code" href="classNxsString_a8e64423982159633f63b9716956f7ca3.html#a8e64423982159633f63b9716956f7ca3" title="Returns true if `o` points to a string that represents a double (and `o` has no other...">NxsString::to_double</a>(s.c_str(), &amp;currDblWt))
<a name="l01731"></a>01731                 <span class="keywordflow">return</span> std::string(c);
<a name="l01732"></a>01732             <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> errormsg;
<a name="l01733"></a>01733             errormsg &lt;&lt; <span class="stringliteral">&quot;Expecting a number as a character weight.  Found \&quot;&quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;\&quot; instead.&quot;</span>;
<a name="l01734"></a>01734             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l01735"></a>01735             }
<a name="l01736"></a>01736 
<a name="l01737"></a>01737     };
<a name="l01738"></a>01738 
<a name="l01742"></a><a class="code" href="classNxsAssumptionsBlock_aee9f164a7a9ab5383be57b7c46ec91da.html#aee9f164a7a9ab5383be57b7c46ec91da">01742</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_aee9f164a7a9ab5383be57b7c46ec91da.html#aee9f164a7a9ab5383be57b7c46ec91da" title="Reads and stores information contained in the command TypeSet within an ASSUMPTIONS...">NxsAssumptionsBlock::HandleWeightSet</a>(
<a name="l01743"></a>01743   <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token)  <span class="comment">/* the token used to read from in */</span>
<a name="l01744"></a>01744     {
<a name="l01745"></a>01745     <span class="keywordtype">bool</span> asterisked = <span class="keyword">false</span>;
<a name="l01746"></a>01746     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01747"></a>01747     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;*&quot;</span>))
<a name="l01748"></a>01748         {
<a name="l01749"></a>01749         asterisked = <span class="keyword">true</span>;
<a name="l01750"></a>01750         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01751"></a>01751         }
<a name="l01752"></a>01752     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> wtset_name = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l01753"></a>01753     <span class="comment">//wtset_name.ToUpper();</span>
<a name="l01754"></a>01754     <span class="keywordtype">bool</span> isVect;
<a name="l01755"></a>01755     NxsAssumptionsBlockAPI * effectiveAssumpBlock = DealWithPossibleParensInCharDependentCmd(token, <span class="stringliteral">&quot;WtSet&quot;</span>, NULL, &amp;isVect);
<a name="l01756"></a>01756     token.<a class="code" href="classNxsToken_afa5232738ca19e069173e8befe75e730.html#afa5232738ca19e069173e8befe75e730" title="Sets the bit specified in the variable `labileFlags&amp;#39;.">SetLabileFlagBit</a>(NxsToken::hyphenNotPunctuation); <span class="comment">// this allows us to deal with sci. not. in weights.</span>
<a name="l01757"></a>01757     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01758"></a>01758     NxsPartition newPartition;
<a name="l01759"></a>01759     <a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a> *cbp = effectiveAssumpBlock-&gt;GetCharBlockPtr();
<a name="l01760"></a>01760     NCL_ASSERT(cbp);
<a name="l01761"></a>01761     <span class="keywordflow">if</span> (isVect)
<a name="l01762"></a>01762         {
<a name="l01763"></a>01763         WtSetVectorItemValidator validator;
<a name="l01764"></a>01764         effectiveAssumpBlock-&gt;ReadVectorPartitionDef(newPartition, *cbp, wtset_name, <span class="stringliteral">&quot;Character&quot;</span>, <span class="stringliteral">&quot;WtSet&quot;</span>, token, <span class="keyword">false</span>, <span class="keyword">true</span>, validator);
<a name="l01765"></a>01765         }
<a name="l01766"></a>01766     <span class="keywordflow">else</span>
<a name="l01767"></a>01767         effectiveAssumpBlock-&gt;ReadPartitionDef(newPartition, *cbp, wtset_name, <span class="stringliteral">&quot;Character&quot;</span>, <span class="stringliteral">&quot;WtSet&quot;</span>, token, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l01768"></a>01768     <span class="keywordtype">bool</span> floatWts = <span class="keyword">false</span>;
<a name="l01769"></a>01769     <span class="keywordtype">long</span> currLongWt;
<a name="l01770"></a>01770     <span class="keywordtype">double</span> currDblWt;
<a name="l01771"></a>01771     <a class="code" href="classNxsTransformationManager.html" title="NEXUS &amp;quot;types&amp;quot; (as in UserType and TypeSet commands) are assumptions about...">NxsTransformationManager</a> &amp;ctm = cbp-&gt;GetNxsTransformationManagerRef();
<a name="l01772"></a>01772     NxsTransformationManager::ListOfIntWeights liw;
<a name="l01773"></a>01773     NxsTransformationManager::ListOfDblWeights diw;
<a name="l01774"></a>01774     <span class="keywordflow">for</span> (NxsPartition::const_iterator groupIt = newPartition.begin(); groupIt != newPartition.end(); ++groupIt)
<a name="l01775"></a>01775         {
<a name="l01776"></a>01776         <span class="keyword">const</span> std::string &amp; s = groupIt-&gt;first;
<a name="l01777"></a>01777         <span class="keywordflow">if</span> (!floatWts)
<a name="l01778"></a>01778             {
<a name="l01779"></a>01779             floatWts = !<a class="code" href="classNxsString_adf4b63c464113eb110a44e454cb0ed4e.html#adf4b63c464113eb110a44e454cb0ed4e" title="Returns true if `o` points to a string that represents a long (and `o` has no other...">NxsString::to_long</a>(s.c_str(), &amp;currLongWt);
<a name="l01780"></a>01780             <span class="keywordflow">if</span> (!floatWts)
<a name="l01781"></a>01781                 liw.push_back(NxsTransformationManager::IntWeightToIndexSet((<span class="keywordtype">int</span>)currLongWt, groupIt-&gt;second));
<a name="l01782"></a>01782             }
<a name="l01783"></a>01783         <span class="keywordtype">bool</span> v = <a class="code" href="classNxsString_a8e64423982159633f63b9716956f7ca3.html#a8e64423982159633f63b9716956f7ca3" title="Returns true if `o` points to a string that represents a double (and `o` has no other...">NxsString::to_double</a>(s.c_str(), &amp;currDblWt);
<a name="l01784"></a>01784         <span class="keywordflow">if</span> (!v)
<a name="l01785"></a>01785             {
<a name="l01786"></a>01786             errormsg &lt;&lt; <span class="stringliteral">&quot;Invalid weight &quot;</span> &lt;&lt; groupIt-&gt;first &lt;&lt; <span class="stringliteral">&quot; found in a WtSet command.&quot;</span>;
<a name="l01787"></a>01787             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l01788"></a>01788             }
<a name="l01789"></a>01789         diw.push_back(NxsTransformationManager::DblWeightToIndexSet(currDblWt, groupIt-&gt;second));
<a name="l01790"></a>01790         }
<a name="l01791"></a>01791     <a class="code" href="classNxsTransformationManager.html" title="NEXUS &amp;quot;types&amp;quot; (as in UserType and TypeSet commands) are assumptions about...">NxsTransformationManager</a> &amp;tm = effectiveAssumpBlock-&gt;GetNxsTransformationManagerRef();
<a name="l01792"></a>01792     <span class="keywordflow">if</span> (floatWts)
<a name="l01793"></a>01793         {
<a name="l01794"></a>01794         ctm.AddRealWeightSet(wtset_name, diw, asterisked);
<a name="l01795"></a>01795         tm.AddRealWeightSet(wtset_name, diw, asterisked);
<a name="l01796"></a>01796         }
<a name="l01797"></a>01797     <span class="keywordflow">else</span>
<a name="l01798"></a>01798         {
<a name="l01799"></a>01799         ctm.AddIntWeightSet(wtset_name, liw, asterisked);
<a name="l01800"></a>01800         tm.AddIntWeightSet(wtset_name, liw, asterisked);
<a name="l01801"></a>01801         }
<a name="l01802"></a>01802     }
<a name="l01803"></a>01803 
<a name="l01804"></a>01804 
<a name="l01808"></a><a class="code" href="classNxsAssumptionsBlock_a4fef73b13860daa94c46a33e577f97ee.html#a4fef73b13860daa94c46a33e577f97ee">01808</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a4fef73b13860daa94c46a33e577f97ee.html#a4fef73b13860daa94c46a33e577f97ee" title="Reads and stores information contained in the command CharPartition within an ASSUMPTIONS...">NxsAssumptionsBlock::HandleCharPartition</a>(
<a name="l01809"></a>01809   <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token)  <span class="comment">/* the token used to read from in */</span>
<a name="l01810"></a>01810     {
<a name="l01811"></a>01811     <span class="keywordtype">bool</span> asterisked = <span class="keyword">false</span>;
<a name="l01812"></a>01812     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01813"></a>01813     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;*&quot;</span>))
<a name="l01814"></a>01814         {
<a name="l01815"></a>01815         asterisked = <span class="keyword">true</span>;
<a name="l01816"></a>01816         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01817"></a>01817         }
<a name="l01818"></a>01818     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> charpart_name = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l01819"></a>01819     <span class="comment">//charpart_name.ToUpper();</span>
<a name="l01820"></a>01820     NxsAssumptionsBlockAPI * effectiveAssumpBlock = DealWithPossibleParensInCharDependentCmd(token, <span class="stringliteral">&quot;CharPartition&quot;</span>);
<a name="l01821"></a>01821     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01822"></a>01822 
<a name="l01823"></a>01823     NxsPartition newPartition;
<a name="l01824"></a>01824     <a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a> *cbp = effectiveAssumpBlock-&gt;GetCharBlockPtr();
<a name="l01825"></a>01825     NCL_ASSERT(cbp);
<a name="l01826"></a>01826     effectiveAssumpBlock-&gt;ReadPartitionDef(newPartition, *cbp, charpart_name, <span class="stringliteral">&quot;Character&quot;</span>, <span class="stringliteral">&quot;CharPartition&quot;</span>, token, asterisked, <span class="keyword">false</span>, <span class="keyword">true</span>);
<a name="l01827"></a>01827     effectiveAssumpBlock-&gt;AddCharPartition(charpart_name, newPartition);
<a name="l01828"></a>01828     }
<a name="l01829"></a>01829 
<a name="l01833"></a><a class="code" href="classNxsAssumptionsBlock_adc5f0d218f63bb0605ce8530aff42047.html#adc5f0d218f63bb0605ce8530aff42047">01833</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_adc5f0d218f63bb0605ce8530aff42047.html#adc5f0d218f63bb0605ce8530aff42047" title="Reads and stores information contained in the command CHARSET within an ASSUMPTIONS...">NxsAssumptionsBlock::HandleCharSet</a>(
<a name="l01834"></a>01834   <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token)  <span class="comment">/* the token used to read from in */</span>
<a name="l01835"></a>01835     {
<a name="l01836"></a>01836     <span class="keywordtype">bool</span> asterisked = <span class="keyword">false</span>;
<a name="l01837"></a>01837     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01838"></a>01838     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;*&quot;</span>))
<a name="l01839"></a>01839         {
<a name="l01840"></a>01840         asterisked = <span class="keyword">true</span>;
<a name="l01841"></a>01841         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01842"></a>01842         }
<a name="l01843"></a>01843     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> charset_name = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l01844"></a>01844     <span class="comment">//charset_name.ToUpper();</span>
<a name="l01845"></a>01845     NxsAssumptionsBlockAPI * effectiveAssumpBlock = DealWithPossibleParensInCharDependentCmd(token, <span class="stringliteral">&quot;CharSet&quot;</span>);
<a name="l01846"></a>01846     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01847"></a>01847     effectiveAssumpBlock-&gt;ReadCharsetDef(charset_name, token, asterisked);
<a name="l01848"></a>01848     }
<a name="l01849"></a>01849 
<a name="l01853"></a><a class="code" href="classNxsAssumptionsBlock_a623b8b8324e4d8d815af6265b962d4ca.html#a623b8b8324e4d8d815af6265b962d4ca">01853</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a623b8b8324e4d8d815af6265b962d4ca.html#a623b8b8324e4d8d815af6265b962d4ca" title="Called after verifying that the correct Char block pointer is set.">NxsAssumptionsBlock::ReadCharsetDef</a>(<a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> charset_name, <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token, <span class="keywordtype">bool</span> asterisked)
<a name="l01854"></a>01854     {
<a name="l01855"></a>01855     NCL_ASSERT(charBlockPtr != NULL);
<a name="l01856"></a>01856     <a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a> &amp;charBlock = *charBlockPtr;
<a name="l01857"></a>01857     NxsUnsignedSet s;
<a name="l01858"></a>01858     <a class="code" href="classNxsSetReader_ac6f29f1443b854aacc64be03c1b96f02.html#ac6f29f1443b854aacc64be03c1b96f02">NxsSetReader::ReadSetDefinition</a>(token, charBlock, <span class="stringliteral">&quot;Character&quot;</span>, <span class="stringliteral">&quot;CharSet&quot;</span>, &amp;s);
<a name="l01859"></a>01859     charsets[charset_name] = s;
<a name="l01860"></a>01860     <span class="keywordflow">if</span> (asterisked &amp;&amp; nexusReader != NULL)
<a name="l01861"></a>01861         {
<a name="l01862"></a>01862         nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(<span class="stringliteral">&quot;An * is ignored in a CHARSET command&quot;</span>, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad6030a0462aaf947e6383d0fd91a0b68">NxsReader::SKIPPING_CONTENT_WARNING</a>, token);
<a name="l01863"></a>01863         errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l01864"></a>01864         }
<a name="l01865"></a>01865     <span class="keywordflow">if</span> (charBlock.AddNewIndexSet(charset_name, s) &amp;&amp; nexusReader)
<a name="l01866"></a>01866         {
<a name="l01867"></a>01867         errormsg = <span class="stringliteral">&quot;A CHARSET with the name &quot;</span>;
<a name="l01868"></a>01868         errormsg += charset_name;
<a name="l01869"></a>01869         errormsg += <span class="stringliteral">&quot; has already been encountered.    The later definition will preempt the earlier definition(s).&quot;</span>;
<a name="l01870"></a>01870         nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978a4a28a7e651fba82b8601d926a3ba6baa">NxsReader::OVERWRITING_CONTENT_WARNING</a>, token);
<a name="l01871"></a>01871         errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l01872"></a>01872         }
<a name="l01873"></a>01873     }
<a name="l01874"></a>01874 
<a name="l01875"></a>01875 
<a name="l01879"></a><a class="code" href="classNxsAssumptionsBlock_a13d6a13c9ab758251bb69f743fdce87e.html#a13d6a13c9ab758251bb69f743fdce87e">01879</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a13d6a13c9ab758251bb69f743fdce87e.html#a13d6a13c9ab758251bb69f743fdce87e" title="Reads and stores information contained in the command CHARSET within an ASSUMPTIONS...">NxsAssumptionsBlock::HandleExSet</a>(
<a name="l01880"></a>01880   <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token)  <span class="comment">/* the token used to read from in */</span>
<a name="l01881"></a>01881     {
<a name="l01882"></a>01882 
<a name="l01883"></a>01883     <span class="keywordtype">bool</span> asterisked = <span class="keyword">false</span>;
<a name="l01884"></a>01884     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01885"></a>01885     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;*&quot;</span>))
<a name="l01886"></a>01886         {
<a name="l01887"></a>01887         asterisked = <span class="keyword">true</span>;
<a name="l01888"></a>01888         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01889"></a>01889         }
<a name="l01890"></a>01890     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> exset_name = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l01891"></a>01891     <span class="comment">//exset_name.ToUpper();</span>
<a name="l01892"></a>01892     NxsAssumptionsBlockAPI * effectiveAssumpBlock = DealWithPossibleParensInCharDependentCmd(token, <span class="stringliteral">&quot;ExSet&quot;</span>);
<a name="l01893"></a>01893     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01894"></a>01894     effectiveAssumpBlock-&gt;ReadExsetDef(exset_name, token, asterisked);
<a name="l01895"></a>01895     }
<a name="l01896"></a>01896 
<a name="l01900"></a><a class="code" href="classNxsAssumptionsBlock_a825f9f298b413a6857a1d4a6e4d92401.html#a825f9f298b413a6857a1d4a6e4d92401">01900</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a825f9f298b413a6857a1d4a6e4d92401.html#a825f9f298b413a6857a1d4a6e4d92401" title="Called after verifying that the correct Char block pointer is set.">NxsAssumptionsBlock::ReadExsetDef</a>(<a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> charset_name, <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token, <span class="keywordtype">bool</span> asterisked)
<a name="l01901"></a>01901     {
<a name="l01902"></a>01902     NCL_ASSERT(charBlockPtr != NULL);
<a name="l01903"></a>01903     <a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a> &amp;charBlock = *charBlockPtr;
<a name="l01904"></a>01904     NxsUnsignedSet s;
<a name="l01905"></a>01905     <a class="code" href="classNxsSetReader_ac6f29f1443b854aacc64be03c1b96f02.html#ac6f29f1443b854aacc64be03c1b96f02">NxsSetReader::ReadSetDefinition</a>(token, charBlock, <span class="stringliteral">&quot;Character&quot;</span>, <span class="stringliteral">&quot;ExSet&quot;</span>, &amp;s);
<a name="l01906"></a>01906     exsets[charset_name] = s;
<a name="l01907"></a>01907     <span class="keywordflow">if</span> (charBlock.AddNewExSet(charset_name, s) &amp;&amp; nexusReader)
<a name="l01908"></a>01908         {
<a name="l01909"></a>01909         errormsg = <span class="stringliteral">&quot;A ExSet with the name &quot;</span>;
<a name="l01910"></a>01910         errormsg += charset_name;
<a name="l01911"></a>01911         errormsg += <span class="stringliteral">&quot; has already been encountered.    The later definition will preempt the earlier definition(s).&quot;</span>;
<a name="l01912"></a>01912         nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978a4a28a7e651fba82b8601d926a3ba6baa">NxsReader::OVERWRITING_CONTENT_WARNING</a>, token);
<a name="l01913"></a>01913         errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l01914"></a>01914         }
<a name="l01915"></a>01915     <span class="keywordflow">if</span> (asterisked)
<a name="l01916"></a>01916         {
<a name="l01917"></a>01917         def_exset = charset_name;
<a name="l01918"></a>01918         <a class="code" href="classNxsAssumptionsBlock_abd5243ab9c4c6cb3f103b90f9debfdc9.html#abd5243ab9c4c6cb3f103b90f9debfdc9" title="Applies exclusion set having name &amp;#39;nm&amp;#39; by calling the ApplyExset method of...">ApplyExset</a>(charset_name);
<a name="l01919"></a>01919         }
<a name="l01920"></a>01920     }
<a name="l01921"></a>01921 
<a name="l01922"></a>01922 
<a name="l01926"></a><a class="code" href="classNxsAssumptionsBlock_ad2e53ec84b5823c39d5ba81547fa9eb3.html#ad2e53ec84b5823c39d5ba81547fa9eb3">01926</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_ad2e53ec84b5823c39d5ba81547fa9eb3.html#ad2e53ec84b5823c39d5ba81547fa9eb3" title="Reads and stores information contained in the command TaxPartition within an ASSUMPTIONS...">NxsAssumptionsBlock::HandleTaxPartition</a>(
<a name="l01927"></a>01927   <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token)  <span class="comment">/* the token used to read from in */</span>
<a name="l01928"></a>01928     {
<a name="l01929"></a>01929     <span class="keywordtype">bool</span> asterisked = <span class="keyword">false</span>;
<a name="l01930"></a>01930     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01931"></a>01931     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;*&quot;</span>))
<a name="l01932"></a>01932         {
<a name="l01933"></a>01933         asterisked = <span class="keyword">true</span>;
<a name="l01934"></a>01934         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01935"></a>01935         }
<a name="l01936"></a>01936     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> taxpart_name = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l01937"></a>01937     <span class="comment">//taxpart_name.ToUpper();</span>
<a name="l01938"></a>01938 
<a name="l01939"></a>01939     NxsAssumptionsBlockAPI *effectiveAssumpBlock = NULL;
<a name="l01940"></a>01940     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01941"></a>01941     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> taxblock_name;
<a name="l01942"></a>01942 
<a name="l01943"></a>01943     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;(&quot;</span>))
<a name="l01944"></a>01944         {
<a name="l01945"></a>01945         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01946"></a>01946         <span class="keywordflow">while</span> (!token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;)&quot;</span>))
<a name="l01947"></a>01947             {
<a name="l01948"></a>01948             <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;TAXA&quot;</span>))
<a name="l01949"></a>01949                 {
<a name="l01950"></a>01950                 <a class="code" href="classNxsBlock_aee6771bdd0c70f375d925c4e0b6d1095.html#aee6771bdd0c70f375d925c4e0b6d1095" title="Advances the token, and raise an exception if it is not an equals sign.">DemandEquals</a>(token, <span class="stringliteral">&quot;after \&quot;(Taxa\&quot; in a TaxPartition command&quot;</span>);
<a name="l01951"></a>01951                 token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01952"></a>01952                 taxblock_name = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l01953"></a>01953                 }
<a name="l01954"></a>01954             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;VECTOR&quot;</span>))
<a name="l01955"></a>01955                 <a class="code" href="classNxsBlock_a9106779865a661477259f3d84edb36a5.html#a9106779865a661477259f3d84edb36a5" title="throws a NxsException with the token info for `token` `expected` should fill in the...">GenerateNxsException</a>(token, <span class="stringliteral">&quot;VECTOR-style set definitions are not currently supported&quot;</span>);
<a name="l01956"></a>01956             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;NOTOKENS&quot;</span>))
<a name="l01957"></a>01957                 <a class="code" href="classNxsBlock_a9106779865a661477259f3d84edb36a5.html#a9106779865a661477259f3d84edb36a5" title="throws a NxsException with the token info for `token` `expected` should fill in the...">GenerateNxsException</a>(token, <span class="stringliteral">&quot;NOTOKENS-style set definitions are not currently supported&quot;</span>);
<a name="l01958"></a>01958             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;;&quot;</span>))
<a name="l01959"></a>01959                 <a class="code" href="classNxsBlock_a9106779865a661477259f3d84edb36a5.html#a9106779865a661477259f3d84edb36a5" title="throws a NxsException with the token info for `token` `expected` should fill in the...">GenerateNxsException</a>(token, <span class="stringliteral">&quot;; encountered in TaxPartition command before parentheses were closed&quot;</span>);
<a name="l01960"></a>01960             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;STANDARD&quot;</span>) || token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;TOKENS&quot;</span>)) &amp;&amp; nexusReader)
<a name="l01961"></a>01961                 {
<a name="l01962"></a>01962                 errormsg = <span class="stringliteral">&quot;Skipping unknown TaxPartition qualifier: &quot;</span>;
<a name="l01963"></a>01963                 errormsg &lt;&lt; token.<a class="code" href="classNxsToken_a83fb9fa31b17d84caaa2c50c664d195a.html#a83fb9fa31b17d84caaa2c50c664d195a" title="Returns the token for functions that only need read only access - faster than GetToken...">GetTokenReference</a>();
<a name="l01964"></a>01964                 nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad6030a0462aaf947e6383d0fd91a0b68">NxsReader::SKIPPING_CONTENT_WARNING</a>, token);
<a name="l01965"></a>01965                 errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l01966"></a>01966                 }
<a name="l01967"></a>01967             token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01968"></a>01968             }
<a name="l01969"></a>01969         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01970"></a>01970         }
<a name="l01971"></a>01971     <span class="keyword">const</span> <span class="keywordtype">char</span> *cbn = (taxblock_name.empty() ? NULL : taxblock_name.c_str());
<a name="l01972"></a>01972     effectiveAssumpBlock = this-&gt;GetAssumptionsBlockForTaxaTitle(cbn, token, <span class="stringliteral">&quot;TaxPartition&quot;</span>);
<a name="l01973"></a>01973     <a class="code" href="classNxsBlock_a61a4c16c7c243d1d5c5ca4c030783e4d.html#a61a4c16c7c243d1d5c5ca4c030783e4d" title="Raises an exception if it is not an equals sign.">DemandIsAtEquals</a>(token, <span class="stringliteral">&quot;in TaxPartition definition&quot;</span>);
<a name="l01974"></a>01974     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01975"></a>01975     NxsPartition newPartition;
<a name="l01976"></a>01976     NCL_ASSERT(taxa);
<a name="l01977"></a>01977     effectiveAssumpBlock-&gt;ReadPartitionDef(newPartition, *taxa, taxpart_name, <span class="stringliteral">&quot;Taxa&quot;</span>, <span class="stringliteral">&quot;TaxPartition&quot;</span>, token, asterisked, <span class="keyword">false</span>, <span class="keyword">true</span>);
<a name="l01978"></a>01978     effectiveAssumpBlock-&gt;AddTaxPartition(taxpart_name, newPartition);
<a name="l01979"></a>01979     }
<a name="l01983"></a><a class="code" href="classNxsAssumptionsBlock_aabf11e6505bda5a3d68efb5f8a05bf1a.html#aabf11e6505bda5a3d68efb5f8a05bf1a">01983</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_aabf11e6505bda5a3d68efb5f8a05bf1a.html#aabf11e6505bda5a3d68efb5f8a05bf1a" title="Reads and stores information contained in the command TreePartition within an ASSUMPTIONS...">NxsAssumptionsBlock::HandleTreePartition</a>(
<a name="l01984"></a>01984   <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token)  <span class="comment">/* the token used to read from in */</span>
<a name="l01985"></a>01985     {
<a name="l01986"></a>01986     <span class="keywordtype">bool</span> asterisked = <span class="keyword">false</span>;
<a name="l01987"></a>01987     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01988"></a>01988     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;*&quot;</span>))
<a name="l01989"></a>01989         {
<a name="l01990"></a>01990         asterisked = <span class="keyword">true</span>;
<a name="l01991"></a>01991         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01992"></a>01992         }
<a name="l01993"></a>01993     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> treepart_name = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l01994"></a>01994     <span class="comment">//treepart_name.ToUpper();</span>
<a name="l01995"></a>01995     NxsAssumptionsBlockAPI *effectiveAssumpBlock = NULL;
<a name="l01996"></a>01996     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l01997"></a>01997     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> treeblock_name;
<a name="l01998"></a>01998 
<a name="l01999"></a>01999     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;(&quot;</span>))
<a name="l02000"></a>02000         {
<a name="l02001"></a>02001         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02002"></a>02002         <span class="keywordflow">while</span> (!token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;)&quot;</span>))
<a name="l02003"></a>02003             {
<a name="l02004"></a>02004             <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;TREES&quot;</span>))
<a name="l02005"></a>02005                 {
<a name="l02006"></a>02006                 <a class="code" href="classNxsBlock_aee6771bdd0c70f375d925c4e0b6d1095.html#aee6771bdd0c70f375d925c4e0b6d1095" title="Advances the token, and raise an exception if it is not an equals sign.">DemandEquals</a>(token, <span class="stringliteral">&quot;after \&quot;(Trees\&quot; in a TreePartition command&quot;</span>);
<a name="l02007"></a>02007                 token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02008"></a>02008                 treeblock_name = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l02009"></a>02009                 }
<a name="l02010"></a>02010             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;VECTOR&quot;</span>))
<a name="l02011"></a>02011                 <a class="code" href="classNxsBlock_a9106779865a661477259f3d84edb36a5.html#a9106779865a661477259f3d84edb36a5" title="throws a NxsException with the token info for `token` `expected` should fill in the...">GenerateNxsException</a>(token, <span class="stringliteral">&quot;VECTOR-style set definitions are not currently supported&quot;</span>);
<a name="l02012"></a>02012             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;NOTOKENS&quot;</span>))
<a name="l02013"></a>02013                 <a class="code" href="classNxsBlock_a9106779865a661477259f3d84edb36a5.html#a9106779865a661477259f3d84edb36a5" title="throws a NxsException with the token info for `token` `expected` should fill in the...">GenerateNxsException</a>(token, <span class="stringliteral">&quot;NOTOKENS-style set definitions are not currently supported&quot;</span>);
<a name="l02014"></a>02014             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;;&quot;</span>))
<a name="l02015"></a>02015                 <a class="code" href="classNxsBlock_a9106779865a661477259f3d84edb36a5.html#a9106779865a661477259f3d84edb36a5" title="throws a NxsException with the token info for `token` `expected` should fill in the...">GenerateNxsException</a>(token, <span class="stringliteral">&quot;; encountered in TreePartition command before parentheses were closed&quot;</span>);
<a name="l02016"></a>02016             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;STANDARD&quot;</span>) || token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;TOKENS&quot;</span>)) &amp;&amp; nexusReader)
<a name="l02017"></a>02017                 {
<a name="l02018"></a>02018                 errormsg = <span class="stringliteral">&quot;Skipping unknown TreePartition qualifier: &quot;</span>;
<a name="l02019"></a>02019                 errormsg &lt;&lt; token.<a class="code" href="classNxsToken_a83fb9fa31b17d84caaa2c50c664d195a.html#a83fb9fa31b17d84caaa2c50c664d195a" title="Returns the token for functions that only need read only access - faster than GetToken...">GetTokenReference</a>();
<a name="l02020"></a>02020                 nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad6030a0462aaf947e6383d0fd91a0b68">NxsReader::SKIPPING_CONTENT_WARNING</a>, token);
<a name="l02021"></a>02021                 errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02022"></a>02022                 }
<a name="l02023"></a>02023             token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02024"></a>02024             }
<a name="l02025"></a>02025         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02026"></a>02026         }
<a name="l02027"></a>02027     <span class="keyword">const</span> <span class="keywordtype">char</span> *cbn = (treeblock_name.empty() ? NULL : treeblock_name.c_str());
<a name="l02028"></a>02028     effectiveAssumpBlock = this-&gt;GetAssumptionsBlockForTreesTitle(cbn, token, <span class="stringliteral">&quot;TreePartition&quot;</span>);
<a name="l02029"></a>02029     <a class="code" href="classNxsBlock_a61a4c16c7c243d1d5c5ca4c030783e4d.html#a61a4c16c7c243d1d5c5ca4c030783e4d" title="Raises an exception if it is not an equals sign.">DemandIsAtEquals</a>(token, <span class="stringliteral">&quot;in TreePartition definition&quot;</span>);
<a name="l02030"></a>02030     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02031"></a>02031     NxsPartition newPartition;
<a name="l02032"></a>02032     NCL_ASSERT(treesBlockPtr);
<a name="l02033"></a>02033     effectiveAssumpBlock-&gt;ReadPartitionDef(newPartition, *treesBlockPtr, treepart_name, <span class="stringliteral">&quot;Tree&quot;</span>, <span class="stringliteral">&quot;TreePartition&quot;</span>, token, asterisked, <span class="keyword">false</span>, <span class="keyword">true</span>);
<a name="l02034"></a>02034     effectiveAssumpBlock-&gt;AddTreePartition(treepart_name, newPartition);
<a name="l02035"></a>02035     }
<a name="l02036"></a>02036 
<a name="l02037"></a>02037 <span class="keywordtype">void</span> NxsBlock::ReadPartitionDef(
<a name="l02038"></a>02038   NxsPartition &amp;np,
<a name="l02039"></a>02039   <a class="code" href="classNxsLabelToIndicesMapper.html" title="This is the base class for the block interfaces that correspond to blocks that hold...">NxsLabelToIndicesMapper</a> &amp;ltm,
<a name="l02040"></a>02040   <span class="keyword">const</span> std::string &amp; partName,
<a name="l02041"></a>02041   <span class="keyword">const</span> <span class="keywordtype">char</span> * ptype,
<a name="l02042"></a>02042   <span class="keyword">const</span> <span class="keywordtype">char</span> * cmd,
<a name="l02043"></a>02043   <a class="code" href="classNxsToken.html">NxsToken</a> &amp; token,
<a name="l02044"></a>02044   <span class="keywordtype">bool</span> warnAsterisked,
<a name="l02045"></a>02045   <span class="keywordtype">bool</span> demandAllInds,
<a name="l02046"></a>02046   <span class="keywordtype">bool</span> storeAsPartition)
<a name="l02047"></a>02047     {
<a name="l02048"></a>02048     NxsUnsignedSet allInds;
<a name="l02049"></a>02049     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> total = ltm.GetMaxIndex() + 1;
<a name="l02050"></a>02050     std::set&lt;NxsString&gt; prevGroupNames;
<a name="l02051"></a>02051     errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02052"></a>02052     <span class="keywordflow">for</span> (;;)
<a name="l02053"></a>02053         {
<a name="l02054"></a>02054         <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;;&quot;</span>))
<a name="l02055"></a>02055             <span class="keywordflow">break</span>;
<a name="l02056"></a>02056         <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> groupN = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l02057"></a>02057         <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> capGroupN = groupN;
<a name="l02058"></a>02058         capGroupN.ToUpper();
<a name="l02059"></a>02059         <span class="keywordflow">if</span> (prevGroupNames.count(capGroupN) &gt; 0)
<a name="l02060"></a>02060             {
<a name="l02061"></a>02061             errormsg &lt;&lt; <span class="stringliteral">&quot;Illegal repitition of a subset name (&quot;</span> &lt;&lt; groupN &lt;&lt; <span class="stringliteral">&quot;) in the &quot;</span> &lt;&lt; cmd &lt;&lt; <span class="stringliteral">&quot; definition of &quot;</span> &lt;&lt; partName;
<a name="l02062"></a>02062             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l02063"></a>02063             }
<a name="l02064"></a>02064         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02065"></a>02065         <span class="keywordflow">if</span> (!token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;:&quot;</span>))
<a name="l02066"></a>02066             {
<a name="l02067"></a>02067             errormsg &lt;&lt; <span class="stringliteral">&quot;Expecting a : after the subset name &quot;</span> &lt;&lt; groupN &lt;&lt; <span class="stringliteral">&quot; in the &quot;</span> &lt;&lt; cmd  &lt;&lt; <span class="stringliteral">&quot; definition of &quot;</span> &lt;&lt; partName &lt;&lt; <span class="stringliteral">&quot;. Found &quot;</span> &lt;&lt; token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l02068"></a>02068             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l02069"></a>02069             }
<a name="l02070"></a>02070         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02071"></a>02071         NxsUnsignedSet s;
<a name="l02072"></a>02072         <a class="code" href="classNxsSetReader_ac6f29f1443b854aacc64be03c1b96f02.html#ac6f29f1443b854aacc64be03c1b96f02">NxsSetReader::ReadSetDefinition</a>(token, ltm, ptype, cmd, &amp;s, &amp;allInds);
<a name="l02073"></a>02073         allInds.insert(s.begin(), s.end());
<a name="l02074"></a>02074         np.push_back(NxsPartitionGroup(groupN, s));
<a name="l02075"></a>02075         <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;;&quot;</span>))
<a name="l02076"></a>02076             <span class="keywordflow">break</span>;
<a name="l02077"></a>02077         NCL_ASSERT(token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;,&quot;</span>));
<a name="l02078"></a>02078          <span class="comment">// this flag allows us to deal with sci. not. in WtSet commands.</span>
<a name="l02079"></a>02079          <span class="comment">// It shouldn&#39;t hurt in other contexts, though the parser will be</span>
<a name="l02080"></a>02080          <span class="comment">//     more lax than it should (and will accept unquoted tokens-like-this as names).</span>
<a name="l02081"></a>02081         token.<a class="code" href="classNxsToken_afa5232738ca19e069173e8befe75e730.html#afa5232738ca19e069173e8befe75e730" title="Sets the bit specified in the variable `labileFlags&amp;#39;.">SetLabileFlagBit</a>(NxsToken::hyphenNotPunctuation);
<a name="l02082"></a>02082         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02083"></a>02083         }
<a name="l02084"></a>02084     <span class="keywordflow">if</span> (allInds.size() &lt; total)
<a name="l02085"></a>02085         {
<a name="l02086"></a>02086         <span class="keywordtype">unsigned</span> n = 0;
<a name="l02087"></a>02087         <span class="keywordflow">for</span> (;n &lt; total; ++n)
<a name="l02088"></a>02088             {
<a name="l02089"></a>02089             <span class="keywordflow">if</span> (allInds.count(n) == 0)
<a name="l02090"></a>02090                 <span class="keywordflow">break</span>;
<a name="l02091"></a>02091             }
<a name="l02092"></a>02092         errormsg &lt;&lt; partName &lt;&lt; <span class="stringliteral">&quot; is a not a valid &quot;</span>&lt;&lt; cmd &lt;&lt;<span class="stringliteral">&quot;. At least one &quot;</span> &lt;&lt; ptype &lt;&lt; <span class="stringliteral">&quot; (&quot;</span>&lt;&lt; n+1 &lt;&lt; <span class="stringliteral">&quot;) is not included&quot;</span>;
<a name="l02093"></a>02093         <span class="keywordflow">if</span> (demandAllInds)
<a name="l02094"></a>02094             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l02095"></a>02095         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nexusReader)
<a name="l02096"></a>02096             {
<a name="l02097"></a>02097             nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad5c23fc7c666abfd376c2934650821b1">NxsReader::ILLEGAL_CONTENT_WARNING</a>, token);
<a name="l02098"></a>02098             errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02099"></a>02099             }
<a name="l02100"></a>02100         }
<a name="l02101"></a>02101     <span class="keywordflow">if</span> (warnAsterisked &amp;&amp; nexusReader != NULL)
<a name="l02102"></a>02102         {
<a name="l02103"></a>02103         errormsg &lt;&lt; <span class="stringliteral">&quot;An * is ignored in a &quot;</span> &lt;&lt; cmd &lt;&lt; <span class="stringliteral">&quot; command&quot;</span>;
<a name="l02104"></a>02104         nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad6030a0462aaf947e6383d0fd91a0b68">NxsReader::SKIPPING_CONTENT_WARNING</a>, token);
<a name="l02105"></a>02105         errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02106"></a>02106         }
<a name="l02107"></a>02107     <span class="keywordflow">if</span> (storeAsPartition &amp;&amp; ltm.AddNewPartition(partName, np) &amp;&amp; nexusReader)
<a name="l02108"></a>02108         {
<a name="l02109"></a>02109         errormsg &lt;&lt; <span class="stringliteral">&quot;A &quot;</span> &lt;&lt; cmd &lt;&lt; <span class="stringliteral">&quot; with the name &quot;</span>;
<a name="l02110"></a>02110         errormsg += partName;
<a name="l02111"></a>02111         errormsg += <span class="stringliteral">&quot; has already been encountered.    The later definition will preempt the earlier definition(s).&quot;</span>;
<a name="l02112"></a>02112         nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978a4a28a7e651fba82b8601d926a3ba6baa">NxsReader::OVERWRITING_CONTENT_WARNING</a>, token);
<a name="l02113"></a>02113         errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02114"></a>02114         }
<a name="l02115"></a>02115     }
<a name="l02116"></a>02116 
<a name="l02117"></a>02117 <span class="keywordtype">unsigned</span> NxsBlock::ReadVectorPartitionDef(NxsPartition &amp;np, <a class="code" href="classNxsLabelToIndicesMapper.html" title="This is the base class for the block interfaces that correspond to blocks that hold...">NxsLabelToIndicesMapper</a> &amp;ltm, <span class="keyword">const</span> std::string &amp; partName, <span class="keyword">const</span> <span class="keywordtype">char</span> * ptype, <span class="keyword">const</span> <span class="keywordtype">char</span> * cmd, <a class="code" href="classNxsToken.html">NxsToken</a> &amp; token, <span class="keywordtype">bool</span> warnAsterisked, <span class="keywordtype">bool</span> demandAllInds, NxsSetVectorItemValidator &amp; v)
<a name="l02118"></a>02118     {
<a name="l02119"></a>02119     NxsUnsignedSet allInds;
<a name="l02120"></a>02120     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> total = ltm.GetMaxIndex() + 1;
<a name="l02121"></a>02121     std::map&lt;std::string, NxsUnsignedSet&gt; subsetMap;
<a name="l02122"></a>02122     errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02123"></a>02123     <span class="keywordtype">unsigned</span> ind = 0;
<a name="l02124"></a>02124     <span class="keywordflow">for</span> (; ind &lt; total; ++ind)
<a name="l02125"></a>02125         {
<a name="l02126"></a>02126         <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;;&quot;</span>))
<a name="l02127"></a>02127             <span class="keywordflow">break</span>;
<a name="l02128"></a>02128         <span class="keyword">const</span> std::string key = v.convert(token);
<a name="l02129"></a>02129         <span class="keyword">const</span> std::string capKey = NxsString::get_upper(key);
<a name="l02130"></a>02130         NxsUnsignedSet &amp; s = subsetMap[key];
<a name="l02131"></a>02131         s.insert(ind);
<a name="l02132"></a>02132         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02133"></a>02133         }
<a name="l02134"></a>02134     <span class="keywordflow">if</span> (ind &lt; total)
<a name="l02135"></a>02135         {
<a name="l02136"></a>02136         errormsg &lt;&lt; partName &lt;&lt; <span class="stringliteral">&quot; is a not a valid &quot;</span>&lt;&lt; cmd &lt;&lt;<span class="stringliteral">&quot;. Only &quot;</span> &lt;&lt; ind + 1 &lt;&lt; <span class="stringliteral">&quot; entries for &quot;</span> &lt;&lt; ptype &lt;&lt; <span class="stringliteral">&quot;(s) were included in the definition&quot;</span>;
<a name="l02137"></a>02137         <span class="keywordflow">if</span> (demandAllInds)
<a name="l02138"></a>02138             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l02139"></a>02139         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nexusReader)
<a name="l02140"></a>02140             {
<a name="l02141"></a>02141             nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad5c23fc7c666abfd376c2934650821b1">NxsReader::ILLEGAL_CONTENT_WARNING</a>, token);
<a name="l02142"></a>02142             errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02143"></a>02143             }
<a name="l02144"></a>02144         }
<a name="l02145"></a>02145     <span class="keywordflow">if</span> (warnAsterisked &amp;&amp; nexusReader != NULL)
<a name="l02146"></a>02146         {
<a name="l02147"></a>02147         errormsg &lt;&lt; <span class="stringliteral">&quot;An * is ignored in a &quot;</span> &lt;&lt; cmd &lt;&lt; <span class="stringliteral">&quot; command&quot;</span>;
<a name="l02148"></a>02148         nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad6030a0462aaf947e6383d0fd91a0b68">NxsReader::SKIPPING_CONTENT_WARNING</a>, token);
<a name="l02149"></a>02149         errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02150"></a>02150         }
<a name="l02151"></a>02151     np.clear();
<a name="l02152"></a>02152     <span class="keywordflow">for</span> (std::map&lt;std::string, NxsUnsignedSet&gt;::const_iterator sIt = subsetMap.begin(); sIt != subsetMap.end(); ++sIt)
<a name="l02153"></a>02153         {
<a name="l02154"></a>02154         <span class="keyword">const</span> std::string &amp; k = sIt-&gt;first;
<a name="l02155"></a>02155         <span class="keyword">const</span> NxsUnsignedSet &amp; valset = sIt-&gt;second;
<a name="l02156"></a>02156         np.push_back(NxsPartitionGroup(k, valset));
<a name="l02157"></a>02157         }
<a name="l02158"></a>02158     <span class="keywordflow">if</span> (ltm.AddNewPartition(partName, np) &amp;&amp; nexusReader)
<a name="l02159"></a>02159         {
<a name="l02160"></a>02160         errormsg &lt;&lt; <span class="stringliteral">&quot;A &quot;</span> &lt;&lt; cmd &lt;&lt; <span class="stringliteral">&quot; with the name &quot;</span>;
<a name="l02161"></a>02161         errormsg += partName;
<a name="l02162"></a>02162         errormsg += <span class="stringliteral">&quot; has already been encountered.    The later definition will preempt the earlier definition(s).&quot;</span>;
<a name="l02163"></a>02163         nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978a4a28a7e651fba82b8601d926a3ba6baa">NxsReader::OVERWRITING_CONTENT_WARNING</a>, token);
<a name="l02164"></a>02164         errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02165"></a>02165         }
<a name="l02166"></a>02166     <span class="keywordflow">return</span> ind;
<a name="l02167"></a>02167     }
<a name="l02168"></a>02168 
<a name="l02169"></a>02169 <span class="keywordtype">void</span> NxsWriteSetCommand(<span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keyword">const</span> NxsUnsignedSetMap &amp; usetmap, std::ostream &amp;out, <span class="keyword">const</span> <span class="keywordtype">char</span> * nameOfDef)
<a name="l02170"></a>02170     {
<a name="l02171"></a>02171     <span class="keywordflow">if</span> (usetmap.empty())
<a name="l02172"></a>02172         <span class="keywordflow">return</span>;
<a name="l02173"></a>02173     <span class="keywordflow">for</span> (NxsUnsignedSetMap::const_iterator csIt = usetmap.begin(); csIt != usetmap.end(); ++csIt)
<a name="l02174"></a>02174         {
<a name="l02175"></a>02175         out &lt;&lt; <span class="stringliteral">&quot;    &quot;</span> &lt;&lt; cmd &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l02176"></a>02176         <span class="keywordflow">if</span> (NxsString::case_insensitive_equals(csIt-&gt;first.c_str(), nameOfDef))
<a name="l02177"></a>02177             out &lt;&lt; <span class="stringliteral">&quot;* &quot;</span>;
<a name="l02178"></a>02178         out &lt;&lt; <a class="code" href="classNxsToken_a9f41ec322921ff9cadad0ec566eaa0b5.html#a9f41ec322921ff9cadad0ec566eaa0b5" title="Returns copy of s but with quoting according to the NEXUS Standard iff s needs to...">NexusToken::EscapeString</a>(csIt-&gt;first) &lt;&lt; <span class="stringliteral">&quot; =&quot;</span>;
<a name="l02179"></a>02179         NxsSetReader::WriteSetAsNexusValue(csIt-&gt;second, out);
<a name="l02180"></a>02180         out &lt;&lt; <span class="stringliteral">&quot;;\n&quot;</span>;
<a name="l02181"></a>02181         }
<a name="l02182"></a>02182     }
<a name="l02183"></a>02183 
<a name="l02184"></a>02184 <span class="keywordtype">void</span> NxsWritePartitionCommand(<span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keyword">const</span> NxsPartitionsByName &amp; usetmap, std::ostream &amp;out, <span class="keyword">const</span> <span class="keywordtype">char</span> * nameOfDef)
<a name="l02185"></a>02185     {
<a name="l02186"></a>02186     <span class="keywordflow">if</span> (usetmap.empty())
<a name="l02187"></a>02187         <span class="keywordflow">return</span>;
<a name="l02188"></a>02188     <span class="keywordflow">for</span> (NxsPartitionsByName::const_iterator csIt = usetmap.begin(); csIt != usetmap.end(); ++csIt)
<a name="l02189"></a>02189         {
<a name="l02190"></a>02190         out &lt;&lt; <span class="stringliteral">&quot;    &quot;</span> &lt;&lt; cmd &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l02191"></a>02191         <span class="keywordflow">if</span> (NxsString::case_insensitive_equals(csIt-&gt;first.c_str(), nameOfDef))
<a name="l02192"></a>02192             out &lt;&lt; <span class="stringliteral">&quot;* &quot;</span>;
<a name="l02193"></a>02193         out &lt;&lt; <a class="code" href="classNxsToken_a9f41ec322921ff9cadad0ec566eaa0b5.html#a9f41ec322921ff9cadad0ec566eaa0b5" title="Returns copy of s but with quoting according to the NEXUS Standard iff s needs to...">NexusToken::EscapeString</a>(csIt-&gt;first) &lt;&lt; <span class="stringliteral">&quot; =&quot;</span>;
<a name="l02194"></a>02194         <span class="keyword">const</span> NxsPartition &amp; p = csIt-&gt;second;
<a name="l02195"></a>02195         <span class="keywordtype">bool</span> first = <span class="keyword">true</span>;
<a name="l02196"></a>02196         <span class="keywordflow">for</span> (NxsPartition::const_iterator pIt = p.begin(); pIt != p.end(); ++pIt)
<a name="l02197"></a>02197             {
<a name="l02198"></a>02198             <span class="keyword">const</span> NxsPartitionGroup &amp; g = *pIt;
<a name="l02199"></a>02199             <span class="keywordflow">if</span> (!first)
<a name="l02200"></a>02200                 out &lt;&lt; <span class="charliteral">&#39;,&#39;</span>;
<a name="l02201"></a>02201             out &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; NxsString::GetEscaped(g.first) &lt;&lt; <span class="stringliteral">&quot; :&quot;</span>;
<a name="l02202"></a>02202             NxsSetReader::WriteSetAsNexusValue(g.second, out);
<a name="l02203"></a>02203             first = <span class="keyword">false</span>;
<a name="l02204"></a>02204             }
<a name="l02205"></a>02205         out &lt;&lt; <span class="stringliteral">&quot;;\n&quot;</span>;
<a name="l02206"></a>02206         }
<a name="l02207"></a>02207     }
<a name="l02208"></a>02208 
<a name="l02212"></a><a class="code" href="classNxsAssumptionsBlock_a59917c3bf29ccb184b8fd28f2bcb284c.html#a59917c3bf29ccb184b8fd28f2bcb284c">02212</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a59917c3bf29ccb184b8fd28f2bcb284c.html#a59917c3bf29ccb184b8fd28f2bcb284c" title="Reads and stores information contained in the command TAXSET within an ASSUMPTIONS...">NxsAssumptionsBlock::HandleTaxSet</a>(
<a name="l02213"></a>02213   <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token)  <span class="comment">/* the token used to read from in */</span>
<a name="l02214"></a>02214     {
<a name="l02215"></a>02215     <span class="keywordtype">bool</span> asterisked = <span class="keyword">false</span>;
<a name="l02216"></a>02216     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02217"></a>02217     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;*&quot;</span>))
<a name="l02218"></a>02218         {
<a name="l02219"></a>02219         asterisked = <span class="keyword">true</span>;
<a name="l02220"></a>02220         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02221"></a>02221         }
<a name="l02222"></a>02222     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> taxset_name = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l02223"></a>02223     <span class="comment">//taxset_name.ToUpper();</span>
<a name="l02224"></a>02224     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02225"></a>02225     NxsAssumptionsBlockAPI *effectiveAssumpBlock = NULL;
<a name="l02226"></a>02226     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> taxblock_name;
<a name="l02227"></a>02227     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;(&quot;</span>))
<a name="l02228"></a>02228         {
<a name="l02229"></a>02229         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02230"></a>02230         <span class="keywordflow">while</span> (!token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;)&quot;</span>))
<a name="l02231"></a>02231             {
<a name="l02232"></a>02232             <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;TAXA&quot;</span>))
<a name="l02233"></a>02233                 {
<a name="l02234"></a>02234                 <a class="code" href="classNxsBlock_aee6771bdd0c70f375d925c4e0b6d1095.html#aee6771bdd0c70f375d925c4e0b6d1095" title="Advances the token, and raise an exception if it is not an equals sign.">DemandEquals</a>(token, <span class="stringliteral">&quot;after \&quot;(Taxa\&quot; in a TaxSet command&quot;</span>);
<a name="l02235"></a>02235                 token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02236"></a>02236                 taxblock_name = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l02237"></a>02237                 }
<a name="l02238"></a>02238             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;VECTOR&quot;</span>))
<a name="l02239"></a>02239                 <a class="code" href="classNxsBlock_a9106779865a661477259f3d84edb36a5.html#a9106779865a661477259f3d84edb36a5" title="throws a NxsException with the token info for `token` `expected` should fill in the...">GenerateNxsException</a>(token, <span class="stringliteral">&quot;VECTOR-style set definitions are not currently supported&quot;</span>);
<a name="l02240"></a>02240             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;;&quot;</span>))
<a name="l02241"></a>02241                 <a class="code" href="classNxsBlock_a9106779865a661477259f3d84edb36a5.html#a9106779865a661477259f3d84edb36a5" title="throws a NxsException with the token info for `token` `expected` should fill in the...">GenerateNxsException</a>(token, <span class="stringliteral">&quot;; encountered in TaxSet command before parentheses were closed&quot;</span>);
<a name="l02242"></a>02242             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;STANDARD&quot;</span>) &amp;&amp; nexusReader)
<a name="l02243"></a>02243                 {
<a name="l02244"></a>02244                 errormsg = <span class="stringliteral">&quot;Skipping unknown TaxSet qualifier: &quot;</span>;
<a name="l02245"></a>02245                 errormsg &lt;&lt; token.<a class="code" href="classNxsToken_a83fb9fa31b17d84caaa2c50c664d195a.html#a83fb9fa31b17d84caaa2c50c664d195a" title="Returns the token for functions that only need read only access - faster than GetToken...">GetTokenReference</a>();
<a name="l02246"></a>02246                 nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad6030a0462aaf947e6383d0fd91a0b68">NxsReader::SKIPPING_CONTENT_WARNING</a>, token);
<a name="l02247"></a>02247                 errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02248"></a>02248                 }
<a name="l02249"></a>02249             token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02250"></a>02250             }
<a name="l02251"></a>02251         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02252"></a>02252         }
<a name="l02253"></a>02253     <span class="keyword">const</span> <span class="keywordtype">char</span> *tbn = (taxblock_name.empty() ? NULL : taxblock_name.c_str());
<a name="l02254"></a>02254     effectiveAssumpBlock = this-&gt;GetAssumptionsBlockForTaxaTitle(tbn, token, <span class="stringliteral">&quot;TAXSET&quot;</span>);
<a name="l02255"></a>02255     <a class="code" href="classNxsBlock_a61a4c16c7c243d1d5c5ca4c030783e4d.html#a61a4c16c7c243d1d5c5ca4c030783e4d" title="Raises an exception if it is not an equals sign.">DemandIsAtEquals</a>(token, <span class="stringliteral">&quot;in TAXSET definition&quot;</span>);
<a name="l02256"></a>02256     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02257"></a>02257     effectiveAssumpBlock-&gt;ReadTaxsetDef(taxset_name, token, asterisked);
<a name="l02258"></a>02258     }
<a name="l02259"></a>02259 
<a name="l02263"></a><a class="code" href="classNxsAssumptionsBlock_a4f1feafec1e14eb457803c8fa1ea3008.html#a4f1feafec1e14eb457803c8fa1ea3008">02263</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a4f1feafec1e14eb457803c8fa1ea3008.html#a4f1feafec1e14eb457803c8fa1ea3008" title="Called after verifying that the correct taxa block pointer is set.">NxsAssumptionsBlock::ReadTaxsetDef</a>(<a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> taxset_name, <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token, <span class="keywordtype">bool</span> asterisked)
<a name="l02264"></a>02264     {
<a name="l02265"></a>02265     NCL_ASSERT(taxa != NULL);
<a name="l02266"></a>02266     <a class="code" href="classNxsTaxaBlockAPI.html" title="This abstract class describes the interface that every block that wants to serve...">NxsTaxaBlockAPI</a> &amp;taxaBlock = *taxa;
<a name="l02267"></a>02267     NxsUnsignedSet s;
<a name="l02268"></a>02268     <a class="code" href="classNxsSetReader_ac6f29f1443b854aacc64be03c1b96f02.html#ac6f29f1443b854aacc64be03c1b96f02">NxsSetReader::ReadSetDefinition</a>(token, taxaBlock, <span class="stringliteral">&quot;Taxon&quot;</span>, <span class="stringliteral">&quot;TaxSet&quot;</span>, &amp;s);
<a name="l02269"></a>02269     taxsets[taxset_name] = s;
<a name="l02270"></a>02270     <span class="keywordflow">if</span> (asterisked &amp;&amp; nexusReader != NULL)
<a name="l02271"></a>02271         {
<a name="l02272"></a>02272         nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(<span class="stringliteral">&quot;An * is ignored in a TaxSet command&quot;</span>, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad6030a0462aaf947e6383d0fd91a0b68">NxsReader::SKIPPING_CONTENT_WARNING</a>, token);
<a name="l02273"></a>02273         errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02274"></a>02274         }
<a name="l02275"></a>02275     <span class="keywordflow">if</span> (taxaBlock.AddNewIndexSet(taxset_name, s) &amp;&amp; nexusReader)
<a name="l02276"></a>02276         {
<a name="l02277"></a>02277         errormsg = <span class="stringliteral">&quot;A TaxSet with the name &quot;</span>;
<a name="l02278"></a>02278         errormsg += taxset_name;
<a name="l02279"></a>02279         errormsg += <span class="stringliteral">&quot; has already been encountered.    The later definition will preempt the earlier definition(s).&quot;</span>;
<a name="l02280"></a>02280         nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad6030a0462aaf947e6383d0fd91a0b68">NxsReader::SKIPPING_CONTENT_WARNING</a>, token);
<a name="l02281"></a>02281         errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02282"></a>02282         }
<a name="l02283"></a>02283     }
<a name="l02284"></a>02284 
<a name="l02288"></a><a class="code" href="classNxsAssumptionsBlock_ac5eb1b5933d295df59709575d9937cf2.html#ac5eb1b5933d295df59709575d9937cf2">02288</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_ac5eb1b5933d295df59709575d9937cf2.html#ac5eb1b5933d295df59709575d9937cf2" title="Reads and stores information contained in the command TAXSET within an ASSUMPTIONS...">NxsAssumptionsBlock::HandleTreeSet</a>(
<a name="l02289"></a>02289   <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token)  <span class="comment">/* the token used to read from in */</span>
<a name="l02290"></a>02290     {
<a name="l02291"></a>02291     <span class="keywordtype">bool</span> asterisked = <span class="keyword">false</span>;
<a name="l02292"></a>02292     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02293"></a>02293     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;*&quot;</span>))
<a name="l02294"></a>02294         {
<a name="l02295"></a>02295         asterisked = <span class="keyword">true</span>;
<a name="l02296"></a>02296         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02297"></a>02297         }
<a name="l02298"></a>02298     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> treeset_name = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l02299"></a>02299     <span class="comment">//treeset_name.ToUpper();</span>
<a name="l02300"></a>02300     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02301"></a>02301     NxsAssumptionsBlockAPI *effectiveAssumpBlock = NULL;
<a name="l02302"></a>02302     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> treeblock_name;
<a name="l02303"></a>02303     <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;(&quot;</span>))
<a name="l02304"></a>02304         {
<a name="l02305"></a>02305         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02306"></a>02306         <span class="keywordflow">while</span> (!token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;)&quot;</span>))
<a name="l02307"></a>02307             {
<a name="l02308"></a>02308             <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;TREES&quot;</span>))
<a name="l02309"></a>02309                 {
<a name="l02310"></a>02310                 <a class="code" href="classNxsBlock_aee6771bdd0c70f375d925c4e0b6d1095.html#aee6771bdd0c70f375d925c4e0b6d1095" title="Advances the token, and raise an exception if it is not an equals sign.">DemandEquals</a>(token, <span class="stringliteral">&quot;after \&quot;(Trees\&quot; in a TreeSet command&quot;</span>);
<a name="l02311"></a>02311                 token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02312"></a>02312                 treeblock_name = token.<a class="code" href="classNxsToken_a83d7b2a9a2307a0aee8476b904c8145f.html#a83d7b2a9a2307a0aee8476b904c8145f" title="Returns the data member `token&amp;#39;.">GetToken</a>();
<a name="l02313"></a>02313                 }
<a name="l02314"></a>02314             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;VECTOR&quot;</span>))
<a name="l02315"></a>02315                 <a class="code" href="classNxsBlock_a9106779865a661477259f3d84edb36a5.html#a9106779865a661477259f3d84edb36a5" title="throws a NxsException with the token info for `token` `expected` should fill in the...">GenerateNxsException</a>(token, <span class="stringliteral">&quot;VECTOR-style set definitions are not currently supported&quot;</span>);
<a name="l02316"></a>02316             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;;&quot;</span>))
<a name="l02317"></a>02317                 <a class="code" href="classNxsBlock_a9106779865a661477259f3d84edb36a5.html#a9106779865a661477259f3d84edb36a5" title="throws a NxsException with the token info for `token` `expected` should fill in the...">GenerateNxsException</a>(token, <span class="stringliteral">&quot;; encountered in TreeSet command before parentheses were closed&quot;</span>);
<a name="l02318"></a>02318             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;STANDARD&quot;</span>) &amp;&amp; nexusReader)
<a name="l02319"></a>02319                 {
<a name="l02320"></a>02320                 errormsg = <span class="stringliteral">&quot;Skipping unknown TreeSet qualifier: &quot;</span>;
<a name="l02321"></a>02321                 errormsg &lt;&lt; token.<a class="code" href="classNxsToken_a83fb9fa31b17d84caaa2c50c664d195a.html#a83fb9fa31b17d84caaa2c50c664d195a" title="Returns the token for functions that only need read only access - faster than GetToken...">GetTokenReference</a>();
<a name="l02322"></a>02322                 nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad6030a0462aaf947e6383d0fd91a0b68">NxsReader::SKIPPING_CONTENT_WARNING</a>, token);
<a name="l02323"></a>02323                 errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02324"></a>02324                 }
<a name="l02325"></a>02325             token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02326"></a>02326             }
<a name="l02327"></a>02327         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02328"></a>02328         }
<a name="l02329"></a>02329     <span class="keyword">const</span> <span class="keywordtype">char</span> *tbn = (treeblock_name.empty() ? NULL : treeblock_name.c_str());
<a name="l02330"></a>02330     effectiveAssumpBlock = this-&gt;GetAssumptionsBlockForTreesTitle(tbn, token, <span class="stringliteral">&quot;TreeSet&quot;</span>);
<a name="l02331"></a>02331     <a class="code" href="classNxsBlock_a61a4c16c7c243d1d5c5ca4c030783e4d.html#a61a4c16c7c243d1d5c5ca4c030783e4d" title="Raises an exception if it is not an equals sign.">DemandIsAtEquals</a>(token, <span class="stringliteral">&quot;in TreeSet definition&quot;</span>);
<a name="l02332"></a>02332     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02333"></a>02333     effectiveAssumpBlock-&gt;ReadTreesetDef(treeset_name, token, asterisked);
<a name="l02334"></a>02334     }
<a name="l02335"></a>02335 
<a name="l02339"></a><a class="code" href="classNxsAssumptionsBlock_a66afaec60f9648146d1d761e2b8c6d7d.html#a66afaec60f9648146d1d761e2b8c6d7d">02339</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a66afaec60f9648146d1d761e2b8c6d7d.html#a66afaec60f9648146d1d761e2b8c6d7d" title="Called after verifying that the correct trees block pointer is set.">NxsAssumptionsBlock::ReadTreesetDef</a>(<a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> treeset_name, <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token, <span class="keywordtype">bool</span> asterisked)
<a name="l02340"></a>02340     {
<a name="l02341"></a>02341     NCL_ASSERT(treesBlockPtr != NULL);
<a name="l02342"></a>02342     NxsTreesBlockAPI &amp;treesBlock = *treesBlockPtr;
<a name="l02343"></a>02343     NxsUnsignedSet s;
<a name="l02344"></a>02344     <a class="code" href="classNxsSetReader_ac6f29f1443b854aacc64be03c1b96f02.html#ac6f29f1443b854aacc64be03c1b96f02">NxsSetReader::ReadSetDefinition</a>(token, treesBlock, <span class="stringliteral">&quot;Trees&quot;</span>, <span class="stringliteral">&quot;TreeSet&quot;</span>, &amp;s);
<a name="l02345"></a>02345     treesets[treeset_name] = s;
<a name="l02346"></a>02346     <span class="keywordflow">if</span> (asterisked &amp;&amp; nexusReader != NULL)
<a name="l02347"></a>02347         {
<a name="l02348"></a>02348         nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(<span class="stringliteral">&quot;An * is ignored in a TreeSet command&quot;</span>, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad6030a0462aaf947e6383d0fd91a0b68">NxsReader::SKIPPING_CONTENT_WARNING</a>, token);
<a name="l02349"></a>02349         errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02350"></a>02350         }
<a name="l02351"></a>02351     <span class="keywordflow">if</span> (treesBlock.AddNewIndexSet(treeset_name, s) &amp;&amp; nexusReader)
<a name="l02352"></a>02352         {
<a name="l02353"></a>02353         errormsg = <span class="stringliteral">&quot;A TreeSet with the name &quot;</span>;
<a name="l02354"></a>02354         errormsg += treeset_name;
<a name="l02355"></a>02355         errormsg += <span class="stringliteral">&quot; has already been encountered.    The later definition will preempt the earlier definition(s).&quot;</span>;
<a name="l02356"></a>02356         nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad6030a0462aaf947e6383d0fd91a0b68">NxsReader::SKIPPING_CONTENT_WARNING</a>, token);
<a name="l02357"></a>02357         errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02358"></a>02358         }
<a name="l02359"></a>02359     }
<a name="l02360"></a>02360 
<a name="l02366"></a><a class="code" href="classNxsAssumptionsBlock_ab5564d8dc36afc344531b24c41b2689f.html#ab5564d8dc36afc344531b24c41b2689f">02366</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_ab5564d8dc36afc344531b24c41b2689f.html#ab5564d8dc36afc344531b24c41b2689f" title="This function provides the ability to read everything following the block name (which...">NxsAssumptionsBlock::Read</a>(
<a name="l02367"></a>02367   <a class="code" href="classNxsToken.html">NxsToken</a> &amp;token)  <span class="comment">/* the token used to read from in */</span>
<a name="l02368"></a>02368     {
<a name="l02369"></a>02369     isEmpty = <span class="keyword">false</span>;
<a name="l02370"></a>02370     isUserSupplied = <span class="keyword">true</span>;
<a name="l02371"></a>02371     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> n = <span class="stringliteral">&quot;BEGIN &quot;</span>;
<a name="l02372"></a>02372     n &lt;&lt; id;
<a name="l02373"></a>02373     DemandEndSemicolon(token, n.c_str());
<a name="l02374"></a>02374 
<a name="l02375"></a>02375     <span class="keywordflow">for</span>(;;)
<a name="l02376"></a>02376         {
<a name="l02377"></a>02377         token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02378"></a>02378         NxsBlock::NxsCommandResult res = <a class="code" href="classNxsBlock_af9c3fcff6324f4b220a1dd9ebcb1017a.html#af9c3fcff6324f4b220a1dd9ebcb1017a" title="Hook to consolidate the handling of COMMANDS that are common to all blocks (TITLE...">HandleBasicBlockCommands</a>(token);
<a name="l02379"></a>02379         <span class="keywordflow">if</span> (res == NxsBlock::NxsCommandResult(STOP_PARSING_BLOCK))
<a name="l02380"></a>02380             <span class="keywordflow">return</span>;
<a name="l02381"></a>02381         <span class="keywordflow">if</span> (res != NxsBlock::NxsCommandResult(HANDLED_COMMAND))
<a name="l02382"></a>02382             {
<a name="l02383"></a>02383             <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;CHARPARTITION&quot;</span>))
<a name="l02384"></a>02384                 <a class="code" href="classNxsAssumptionsBlock_a4fef73b13860daa94c46a33e577f97ee.html#a4fef73b13860daa94c46a33e577f97ee" title="Reads and stores information contained in the command CharPartition within an ASSUMPTIONS...">HandleCharPartition</a>(token);
<a name="l02385"></a>02385             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;CHARSET&quot;</span>))
<a name="l02386"></a>02386                 <a class="code" href="classNxsAssumptionsBlock_adc5f0d218f63bb0605ce8530aff42047.html#adc5f0d218f63bb0605ce8530aff42047" title="Reads and stores information contained in the command CHARSET within an ASSUMPTIONS...">HandleCharSet</a>(token);
<a name="l02387"></a>02387             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;CODESET&quot;</span>))
<a name="l02388"></a>02388                 <a class="code" href="classNxsAssumptionsBlock_a0d5a1f86cd7780ad198f3d597a7e2fd9.html#a0d5a1f86cd7780ad198f3d597a7e2fd9" title="Reads and stores information contained in the command TypeSet within an ASSUMPTIONS...">HandleCodeSet</a>(token);
<a name="l02389"></a>02389             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;CODONPOSSET&quot;</span>))
<a name="l02390"></a>02390                 <a class="code" href="classNxsAssumptionsBlock_a15b2808a67dedc7b22282b3d413df1b8.html#a15b2808a67dedc7b22282b3d413df1b8" title="Reads and stores information contained in the command TypeSet within an ASSUMPTIONS...">HandleCodonPosSet</a>(token);
<a name="l02391"></a>02391             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;EXSET&quot;</span>))
<a name="l02392"></a>02392                 <a class="code" href="classNxsAssumptionsBlock_a13d6a13c9ab758251bb69f743fdce87e.html#a13d6a13c9ab758251bb69f743fdce87e" title="Reads and stores information contained in the command CHARSET within an ASSUMPTIONS...">HandleExSet</a>(token);
<a name="l02393"></a>02393             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;OPTIONS&quot;</span>))
<a name="l02394"></a>02394                 HandleOptions(token);
<a name="l02395"></a>02395             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;TAXSET&quot;</span>))
<a name="l02396"></a>02396                 <a class="code" href="classNxsAssumptionsBlock_a59917c3bf29ccb184b8fd28f2bcb284c.html#a59917c3bf29ccb184b8fd28f2bcb284c" title="Reads and stores information contained in the command TAXSET within an ASSUMPTIONS...">HandleTaxSet</a>(token);
<a name="l02397"></a>02397             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;TAXPARTITION&quot;</span>))
<a name="l02398"></a>02398                 <a class="code" href="classNxsAssumptionsBlock_ad2e53ec84b5823c39d5ba81547fa9eb3.html#ad2e53ec84b5823c39d5ba81547fa9eb3" title="Reads and stores information contained in the command TaxPartition within an ASSUMPTIONS...">HandleTaxPartition</a>(token);
<a name="l02399"></a>02399             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;TREESET&quot;</span>))
<a name="l02400"></a>02400                 <a class="code" href="classNxsAssumptionsBlock_ac5eb1b5933d295df59709575d9937cf2.html#ac5eb1b5933d295df59709575d9937cf2" title="Reads and stores information contained in the command TAXSET within an ASSUMPTIONS...">HandleTreeSet</a>(token);
<a name="l02401"></a>02401             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;TREEPARTITION&quot;</span>))
<a name="l02402"></a>02402                 <a class="code" href="classNxsAssumptionsBlock_aabf11e6505bda5a3d68efb5f8a05bf1a.html#aabf11e6505bda5a3d68efb5f8a05bf1a" title="Reads and stores information contained in the command TreePartition within an ASSUMPTIONS...">HandleTreePartition</a>(token);
<a name="l02403"></a>02403             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;TYPESET&quot;</span>))
<a name="l02404"></a>02404                 <a class="code" href="classNxsAssumptionsBlock_a4cbc1a29f81409c93e8e75dafff6f6e2.html#a4cbc1a29f81409c93e8e75dafff6f6e2" title="Reads and stores information contained in the command TypeSet within an ASSUMPTIONS...">HandleTypeSet</a>(token);
<a name="l02405"></a>02405             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;USERTYPE&quot;</span>))
<a name="l02406"></a>02406                 HandleUserType(token);
<a name="l02407"></a>02407             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token.<a class="code" href="classNxsToken_a3fd38838e685bffa670dbbaa5b047966.html#a3fd38838e685bffa670dbbaa5b047966" title="Returns true if token NxsString exactly equals `s&amp;#39;.">Equals</a>(<span class="stringliteral">&quot;WTSET&quot;</span>))
<a name="l02408"></a>02408                 <a class="code" href="classNxsAssumptionsBlock_aee9f164a7a9ab5383be57b7c46ec91da.html#aee9f164a7a9ab5383be57b7c46ec91da" title="Reads and stores information contained in the command TypeSet within an ASSUMPTIONS...">HandleWeightSet</a>(token);
<a name="l02409"></a>02409             <span class="keywordflow">else</span>
<a name="l02410"></a>02410                 SkipCommand(token);
<a name="l02411"></a>02411 
<a name="l02412"></a>02412             }
<a name="l02413"></a>02413         }   <span class="comment">// for(;;)</span>
<a name="l02414"></a>02414     }
<a name="l02415"></a>02415 <span class="keywordtype">void</span> NxsAssumptionsBlock::HandleOptions(<a class="code" href="classNxsToken.html">NxsToken</a> &amp;token)
<a name="l02416"></a>02416     {
<a name="l02417"></a>02417     errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02418"></a>02418     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02419"></a>02419     std::map&lt;std::string, std::string&gt; kv = token.ProcessAsSimpleKeyValuePairs(<span class="stringliteral">&quot;OPTIONS&quot;</span>);
<a name="l02420"></a>02420     std::map&lt;std::string, std::string&gt;::const_iterator kvIt = kv.begin();
<a name="l02421"></a>02421     <span class="keywordflow">for</span> (; kvIt != kv.end(); ++kvIt)
<a name="l02422"></a>02422         {
<a name="l02423"></a>02423         <span class="keywordflow">if</span> (NxsString::case_insensitive_equals(kvIt-&gt;first.c_str(), <span class="stringliteral">&quot;DEFTYPE&quot;</span>))
<a name="l02424"></a>02424             {
<a name="l02425"></a>02425             NxsAssumptionsBlockAPI  * effAssumpB = GetAssumptionsBlockForCharTitle(NULL, token, <span class="stringliteral">&quot;OPTIONS&quot;</span>);
<a name="l02426"></a>02426             NCL_ASSERT(effAssumpB);
<a name="l02427"></a>02427             <a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a> * cb = effAssumpB-&gt;GetCharBlockPtr();
<a name="l02428"></a>02428             NCL_ASSERT(cb);
<a name="l02429"></a>02429             <a class="code" href="classNxsTransformationManager.html" title="NEXUS &amp;quot;types&amp;quot; (as in UserType and TypeSet commands) are assumptions about...">NxsTransformationManager</a> &amp; tmRef = cb-&gt;GetNxsTransformationManagerRef();
<a name="l02430"></a>02430             <span class="keywordflow">if</span> (!tmRef.<a class="code" href="classNxsTransformationManager_ab72c47de22344f0e6a79717fa1299314.html#ab72c47de22344f0e6a79717fa1299314" title="Returns true if `n` is the name of a known type (standard or user type) -- not case-sensitive...">IsValidTypeName</a>(kvIt-&gt;second.c_str()))
<a name="l02431"></a>02431                 {
<a name="l02432"></a>02432                 errormsg &lt;&lt; kvIt-&gt;second &lt;&lt; <span class="stringliteral">&quot; is not a valid type name for OPTIONS DefType. Expceting one of:\n&quot;</span>;
<a name="l02433"></a>02433                 <span class="keyword">const</span> std::set&lt;std::string&gt; &amp; tn = tmRef.<a class="code" href="classNxsTransformationManager_a3ba2f9d49c643203942a1d2da5e75e67.html#a3ba2f9d49c643203942a1d2da5e75e67">GetTypeNames</a>();
<a name="l02434"></a>02434                 <span class="keywordflow">for</span> (std::set&lt;std::string&gt;::const_iterator tnIt = tn.begin(); tnIt != tn.end(); ++tnIt)
<a name="l02435"></a>02435                     errormsg &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; NxsString::GetEscaped(*tnIt);
<a name="l02436"></a>02436                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l02437"></a>02437                 }
<a name="l02438"></a>02438             <span class="keywordflow">try</span>
<a name="l02439"></a>02439                 {
<a name="l02440"></a>02440                 tmRef.<a class="code" href="classNxsTransformationManager_a720487e62ceb55bc37e6f4e154b3850c.html#a720487e62ceb55bc37e6f4e154b3850c" title="Returns -1 if `index` is not in `wtset`.">SetDefaultTypeName</a>(kvIt-&gt;second);
<a name="l02441"></a>02441                 <a class="code" href="classNxsTransformationManager.html" title="NEXUS &amp;quot;types&amp;quot; (as in UserType and TypeSet commands) are assumptions about...">NxsTransformationManager</a> &amp; etmRef  = effAssumpB-&gt;GetNxsTransformationManagerRef();
<a name="l02442"></a>02442                 etmRef.<a class="code" href="classNxsTransformationManager_a720487e62ceb55bc37e6f4e154b3850c.html#a720487e62ceb55bc37e6f4e154b3850c" title="Returns -1 if `index` is not in `wtset`.">SetDefaultTypeName</a>(kvIt-&gt;second);
<a name="l02443"></a>02443                 }
<a name="l02444"></a>02444             <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a> &amp; x)
<a name="l02445"></a>02445                 {
<a name="l02446"></a>02446                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(x.msg, token);
<a name="l02447"></a>02447                 }
<a name="l02448"></a>02448             }
<a name="l02449"></a>02449         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NxsString::case_insensitive_equals(kvIt-&gt;first.c_str(), <span class="stringliteral">&quot;POLYTCOUNT&quot;</span>))
<a name="l02450"></a>02450             {
<a name="l02451"></a>02451             <span class="keywordflow">if</span> (NxsString::case_insensitive_equals(kvIt-&gt;second.c_str(), <span class="stringliteral">&quot;MINSTEPS&quot;</span>))
<a name="l02452"></a>02452                 polyTCountValue = POLY_T_COUNT_MIN;
<a name="l02453"></a>02453             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NxsString::case_insensitive_equals(kvIt-&gt;second.c_str(), <span class="stringliteral">&quot;MAXSTEPS&quot;</span>))
<a name="l02454"></a>02454                 polyTCountValue = POLY_T_COUNT_MAX;
<a name="l02455"></a>02455             <span class="keywordflow">else</span>
<a name="l02456"></a>02456                 {
<a name="l02457"></a>02457                 errormsg &lt;&lt; <span class="stringliteral">&quot;Unknown value (&quot;</span> &lt;&lt; kvIt-&gt;second &lt;&lt; <span class="stringliteral">&quot;) found for OPTIONS PolyTCount (expecting MINSTEPS or MAXSTEPS).&quot;</span>;
<a name="l02458"></a>02458                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l02459"></a>02459                 }
<a name="l02460"></a>02460             }
<a name="l02461"></a>02461         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NxsString::case_insensitive_equals(kvIt-&gt;first.c_str(), <span class="stringliteral">&quot;GAPMODE&quot;</span>))
<a name="l02462"></a>02462             {
<a name="l02463"></a>02463             NxsAssumptionsBlockAPI  * effAssumpB = GetAssumptionsBlockForCharTitle(NULL, token, <span class="stringliteral">&quot;OPTIONS&quot;</span>);
<a name="l02464"></a>02464             NCL_ASSERT(effAssumpB);
<a name="l02465"></a>02465             <a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a> * cb = effAssumpB-&gt;GetCharBlockPtr();
<a name="l02466"></a>02466             NCL_ASSERT(cb);
<a name="l02467"></a>02467             <span class="keywordflow">if</span> (NxsString::case_insensitive_equals(kvIt-&gt;second.c_str(), <span class="stringliteral">&quot;MISSING&quot;</span>))
<a name="l02468"></a>02468                 {
<a name="l02469"></a>02469                 effAssumpB-&gt;SetGapsAsNewstate(<span class="keyword">false</span>);
<a name="l02470"></a>02470                 cb-&gt;SetGapModeSetting(NxsCharactersBlockAPI::GAP_MODE_MISSING);
<a name="l02471"></a>02471                 }
<a name="l02472"></a>02472             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NxsString::case_insensitive_equals(kvIt-&gt;second.c_str(), <span class="stringliteral">&quot;NEWSTATE&quot;</span>))
<a name="l02473"></a>02473                 {
<a name="l02474"></a>02474                 effAssumpB-&gt;SetGapsAsNewstate(<span class="keyword">true</span>);
<a name="l02475"></a>02475                 cb-&gt;SetGapModeSetting(NxsCharactersBlockAPI::GAP_MODE_NEWSTATE);
<a name="l02476"></a>02476                 }
<a name="l02477"></a>02477             <span class="keywordflow">else</span>
<a name="l02478"></a>02478                 {
<a name="l02479"></a>02479                 errormsg &lt;&lt; <span class="stringliteral">&quot;Unknown value (&quot;</span> &lt;&lt; kvIt-&gt;second &lt;&lt; <span class="stringliteral">&quot;) found for OPTIONS GapMode (expecting MISSING or NEWSTATE).&quot;</span>;
<a name="l02480"></a>02480                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l02481"></a>02481                 }
<a name="l02482"></a>02482             }
<a name="l02483"></a>02483         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nexusReader)
<a name="l02484"></a>02484             {
<a name="l02485"></a>02485             errormsg &lt;&lt; <span class="stringliteral">&quot;Skipping unknown subcommand (&quot;</span> &lt;&lt; kvIt-&gt;first &lt;&lt; <span class="stringliteral">&quot;) in OPTIONS command of &quot;</span> &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot; Block&quot;</span>;
<a name="l02486"></a>02486             nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad6030a0462aaf947e6383d0fd91a0b68">NxsReader::SKIPPING_CONTENT_WARNING</a>, token);
<a name="l02487"></a>02487             errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02488"></a>02488             }
<a name="l02489"></a>02489         }
<a name="l02490"></a>02490     }
<a name="l02491"></a>02491 
<a name="l02495"></a><a class="code" href="classNxsAssumptionsBlock_a04c34387927c777895d86b06b3c8569e.html#a04c34387927c777895d86b06b3c8569e">02495</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a04c34387927c777895d86b06b3c8569e.html#a04c34387927c777895d86b06b3c8569e" title="Prepares for reading a new ASSUMPTIONS block.">NxsAssumptionsBlock::Reset</a>()
<a name="l02496"></a>02496     {
<a name="l02497"></a>02497     <span class="keywordflow">if</span> (!passedRefOfOwnedBlock)
<a name="l02498"></a>02498         {
<a name="l02499"></a>02499         VecAssumpBlockPtr::iterator bIt = createdSubBlocks.begin();
<a name="l02500"></a>02500         <span class="keywordflow">for</span>(; bIt != createdSubBlocks.end(); ++bIt)
<a name="l02501"></a>02501             {
<a name="l02502"></a>02502             <span class="keywordflow">if</span> (*bIt)
<a name="l02503"></a>02503                 <span class="keyword">delete</span> *bIt;
<a name="l02504"></a>02504             }
<a name="l02505"></a>02505         createdSubBlocks.clear();
<a name="l02506"></a>02506         }
<a name="l02507"></a>02507     passedRefOfOwnedBlock = <span class="keyword">false</span>;
<a name="l02508"></a>02508     <a class="code" href="classNxsAssumptionsBlock_a04c34387927c777895d86b06b3c8569e.html#a04c34387927c777895d86b06b3c8569e" title="Prepares for reading a new ASSUMPTIONS block.">NxsBlock::Reset</a>();
<a name="l02509"></a>02509     exsets.clear();
<a name="l02510"></a>02510     taxsets.clear();
<a name="l02511"></a>02511     charsets.clear();
<a name="l02512"></a>02512     def_exset.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02513"></a>02513     charPartitions.clear();
<a name="l02514"></a>02514     taxPartitions.clear();
<a name="l02515"></a>02515     treePartitions.clear();
<a name="l02516"></a>02516     readAs = UNREAD_OR_GENERATED_BLOCK;
<a name="l02517"></a>02517     charLinkStatus &amp;= BLOCK_LINK_UNUSED_MASK;
<a name="l02518"></a>02518     taxaLinkStatus &amp;= BLOCK_LINK_UNUSED_MASK;
<a name="l02519"></a>02519     treesLinkStatus &amp;= BLOCK_LINK_UNUSED_MASK;
<a name="l02520"></a>02520     <span class="keywordflow">if</span> (charLinkStatus &amp; NxsBlock::BLOCK_LINK_FROM_LINK_CMD)
<a name="l02521"></a>02521         SetCharBlockPtr(NULL, NxsBlock::BLOCK_LINK_UNINITIALIZED);
<a name="l02522"></a>02522     <span class="keywordflow">if</span> (taxaLinkStatus &amp; NxsBlock::BLOCK_LINK_FROM_LINK_CMD)
<a name="l02523"></a>02523         SetTaxaBlockPtr(NULL, NxsBlock::BLOCK_LINK_UNINITIALIZED);
<a name="l02524"></a>02524     <span class="keywordflow">if</span> (treesLinkStatus &amp; NxsBlock::BLOCK_LINK_FROM_LINK_CMD)
<a name="l02525"></a>02525         SetTreesBlockPtr(NULL, NxsBlock::BLOCK_LINK_UNINITIALIZED);
<a name="l02526"></a>02526     transfMgr.Reset();
<a name="l02527"></a>02527     codesMgr.Reset();
<a name="l02528"></a>02528     polyTCountValue = POLY_T_COUNT_UNKNOWN;
<a name="l02529"></a>02529     gapsAsNewstate = <span class="keyword">false</span>;
<a name="l02530"></a>02530     codonPosSets.clear();
<a name="l02531"></a>02531     def_codonPosSet.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02532"></a>02532     codeSets.clear();
<a name="l02533"></a>02533     def_codeSet.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l02534"></a>02534     }
<a name="l02535"></a>02535 
<a name="l02540"></a><a class="code" href="classNxsAssumptionsBlock_ae0f9f717d498d626a911eeeec79dd06a.html#ae0f9f717d498d626a911eeeec79dd06a">02540</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_ae0f9f717d498d626a911eeeec79dd06a.html#ae0f9f717d498d626a911eeeec79dd06a" title="This function outputs a brief report of the contents of this ASSUMPTIONS block.">NxsAssumptionsBlock::Report</a>(
<a name="l02541"></a>02541   std::ostream &amp;out)  NCL_COULD_BE_CONST <span class="comment">/* the output stream to which to write the report */</span> <span class="comment">/*v2.1to2.2 1 */</span>
<a name="l02542"></a>02542     {
<a name="l02543"></a>02543     out &lt;&lt; endl;
<a name="l02544"></a>02544     out &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot; block contains the following:&quot;</span> &lt;&lt; endl;
<a name="l02545"></a>02545 
<a name="l02546"></a>02546     <span class="keywordflow">if</span> (charsets.empty())
<a name="l02547"></a>02547         out &lt;&lt; <span class="stringliteral">&quot;  No character sets were defined&quot;</span> &lt;&lt; endl;
<a name="l02548"></a>02548     <span class="keywordflow">else</span>
<a name="l02549"></a>02549         {
<a name="l02550"></a>02550         NxsUnsignedSetMap::const_iterator charsets_iter = charsets.begin();
<a name="l02551"></a>02551         <span class="keywordflow">if</span> (charsets.size() == 1)
<a name="l02552"></a>02552             {
<a name="l02553"></a>02553             out &lt;&lt; <span class="stringliteral">&quot;  1 character set defined:&quot;</span> &lt;&lt; endl;
<a name="l02554"></a>02554             out &lt;&lt; <span class="stringliteral">&quot;   &quot;</span> &lt;&lt; (*charsets_iter).first &lt;&lt; endl;
<a name="l02555"></a>02555             }
<a name="l02556"></a>02556         <span class="keywordflow">else</span>
<a name="l02557"></a>02557             {
<a name="l02558"></a>02558             out &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; (unsigned)charsets.size() &lt;&lt; <span class="stringliteral">&quot; character sets defined:&quot;</span> &lt;&lt; endl;
<a name="l02559"></a>02559             <span class="keywordflow">for</span> (; charsets_iter != charsets.end(); charsets_iter++)
<a name="l02560"></a>02560                 {
<a name="l02561"></a>02561                 <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> nm = (*charsets_iter).first;
<a name="l02562"></a>02562                 out &lt;&lt; <span class="stringliteral">&quot;   &quot;</span> &lt;&lt; nm;
<a name="l02563"></a>02563                 out &lt;&lt; endl;
<a name="l02564"></a>02564                 }
<a name="l02565"></a>02565             }
<a name="l02566"></a>02566         }   <span class="comment">// if (charsets.empty()) ... else</span>
<a name="l02567"></a>02567 
<a name="l02568"></a>02568     <span class="keywordflow">if</span> (taxsets.empty())
<a name="l02569"></a>02569         out &lt;&lt; <span class="stringliteral">&quot;  No taxon sets were defined&quot;</span> &lt;&lt; endl;
<a name="l02570"></a>02570     <span class="keywordflow">else</span>
<a name="l02571"></a>02571         {
<a name="l02572"></a>02572         NxsUnsignedSetMap::const_iterator taxsets_iter = taxsets.begin();
<a name="l02573"></a>02573         <span class="keywordflow">if</span> (taxsets.size() == 1)
<a name="l02574"></a>02574             {
<a name="l02575"></a>02575             out &lt;&lt; <span class="stringliteral">&quot;  1 taxon set defined:&quot;</span> &lt;&lt; endl;
<a name="l02576"></a>02576             out &lt;&lt; <span class="stringliteral">&quot;   &quot;</span> &lt;&lt; (*taxsets_iter).first &lt;&lt; endl;
<a name="l02577"></a>02577             }
<a name="l02578"></a>02578         <span class="keywordflow">else</span>
<a name="l02579"></a>02579             {
<a name="l02580"></a>02580             out &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; (unsigned)taxsets.size() &lt;&lt; <span class="stringliteral">&quot; taxon sets defined:&quot;</span> &lt;&lt; endl;
<a name="l02581"></a>02581             <span class="keywordflow">for</span> (; taxsets_iter != taxsets.end(); taxsets_iter++)
<a name="l02582"></a>02582                 {
<a name="l02583"></a>02583                 <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> nm = (*taxsets_iter).first;
<a name="l02584"></a>02584                 out &lt;&lt; <span class="stringliteral">&quot;   &quot;</span> &lt;&lt; nm;
<a name="l02585"></a>02585                 out &lt;&lt; endl;
<a name="l02586"></a>02586                 }
<a name="l02587"></a>02587             }
<a name="l02588"></a>02588         }   <span class="comment">// if (taxsets.empty()) ... else</span>
<a name="l02589"></a>02589 
<a name="l02590"></a>02590     <span class="keywordflow">if</span> (exsets.empty())
<a name="l02591"></a>02591         out &lt;&lt; <span class="stringliteral">&quot;  No exclusion sets were defined&quot;</span> &lt;&lt; endl;
<a name="l02592"></a>02592     <span class="keywordflow">else</span>
<a name="l02593"></a>02593         {
<a name="l02594"></a>02594         NxsUnsignedSetMap::const_iterator exsets_iter = exsets.begin();
<a name="l02595"></a>02595         <span class="keywordflow">if</span> (exsets.size() == 1)
<a name="l02596"></a>02596             {
<a name="l02597"></a>02597             out &lt;&lt; <span class="stringliteral">&quot;  1 exclusion set defined:&quot;</span> &lt;&lt; endl;
<a name="l02598"></a>02598             out &lt;&lt; <span class="stringliteral">&quot;   &quot;</span> &lt;&lt; (*exsets_iter).first &lt;&lt; endl;
<a name="l02599"></a>02599             }
<a name="l02600"></a>02600         <span class="keywordflow">else</span>
<a name="l02601"></a>02601             {
<a name="l02602"></a>02602             out &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; (unsigned)exsets.size() &lt;&lt; <span class="stringliteral">&quot; exclusion sets defined:&quot;</span> &lt;&lt; endl;
<a name="l02603"></a>02603             <span class="keywordflow">for</span> (; exsets_iter != exsets.end(); exsets_iter++)
<a name="l02604"></a>02604                 {
<a name="l02605"></a>02605                 <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> nm = (*exsets_iter).first;
<a name="l02606"></a>02606                 out &lt;&lt; <span class="stringliteral">&quot;   &quot;</span> &lt;&lt; nm;
<a name="l02607"></a>02607                 <span class="keywordflow">if</span> (NxsString::case_insensitive_equals(nm.c_str(), def_exset.c_str()))
<a name="l02608"></a>02608                     out &lt;&lt; <span class="stringliteral">&quot; (default)&quot;</span>;
<a name="l02609"></a>02609                 out &lt;&lt; endl;
<a name="l02610"></a>02610                 }
<a name="l02611"></a>02611             }
<a name="l02612"></a>02612         }
<a name="l02613"></a>02613 
<a name="l02614"></a>02614     out &lt;&lt; endl;
<a name="l02615"></a>02615     }
<a name="l02616"></a>02616 
<a name="l02623"></a><a class="code" href="classNxsAssumptionsBlock_a30597a27d24180327a7f1d9af5b3a84a.html#a30597a27d24180327a7f1d9af5b3a84a">02623</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a30597a27d24180327a7f1d9af5b3a84a.html#a30597a27d24180327a7f1d9af5b3a84a" title="A CHARACTERS, DATA, or ALLELES block can call this function to specify that it is...">NxsAssumptionsBlock::SetCallback</a>(
<a name="l02624"></a>02624   <a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a>* p) <span class="comment">/* the object to be called in the event of a change in character status */</span>
<a name="l02625"></a>02625     {
<a name="l02626"></a>02626     charBlockPtr = p;
<a name="l02627"></a>02627     SetCharLinkStatus(NxsBlock::BLOCK_LINK_TO_MOST_RECENT);
<a name="l02628"></a>02628     }
<a name="l02629"></a>02629 
<a name="l02635"></a><a class="code" href="classNxsAssumptionsBlock_a728674b501fa33b9330234ad342fb353.html#a728674b501fa33b9330234ad342fb353">02635</a> <span class="keywordtype">unsigned</span> <a class="code" href="classNxsAssumptionsBlock_a728674b501fa33b9330234ad342fb353.html#a728674b501fa33b9330234ad342fb353" title="Converts a taxon label to a number corresponding to the taxon&amp;#39;s position within...">NxsAssumptionsBlock::TaxonLabelToNumber</a>(
<a name="l02636"></a>02636   <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> s)  <span class="keyword">const</span> <span class="comment">/* the taxon label to convert */</span> <span class="comment">/*v2.1to2.2 4 */</span>
<a name="l02637"></a>02637     {
<a name="l02638"></a>02638     NCL_ASSERT(taxa != NULL);
<a name="l02639"></a>02639     <span class="keywordtype">int</span> i;
<a name="l02640"></a>02640     <span class="keywordflow">try</span>
<a name="l02641"></a>02641         {
<a name="l02642"></a>02642         i = 1 + taxa-&gt;FindTaxon(s);
<a name="l02643"></a>02643         }
<a name="l02644"></a>02644     <span class="keywordflow">catch</span>(NxsTaxaBlock::NxsX_NoSuchTaxon)
<a name="l02645"></a>02645         {
<a name="l02646"></a>02646         i = 0;
<a name="l02647"></a>02647         }
<a name="l02648"></a>02648 
<a name="l02649"></a>02649     <span class="keywordflow">return</span> i;
<a name="l02650"></a>02650     }
<a name="l02651"></a>02651 
<a name="l02652"></a>02652 <span class="comment">/*only used it the linkAPI is enabled*/</span>
<a name="l02653"></a><a class="code" href="classNxsAssumptionsBlock_af36040722a0cdc636a3924b057ecadce.html#af36040722a0cdc636a3924b057ecadce">02653</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_af36040722a0cdc636a3924b057ecadce.html#af36040722a0cdc636a3924b057ecadce" title="The LINK command was invented for use in Mesquite where multiple instances of a particular...">NxsAssumptionsBlock::HandleLinkCommand</a>(<a class="code" href="classNxsToken.html">NxsToken</a> &amp; token)
<a name="l02654"></a>02654     {
<a name="l02655"></a>02655     <span class="keywordflow">if</span> (!nexusReader)
<a name="l02656"></a>02656         <a class="code" href="classNxsNCLAPIException.html" title="Thrown when a programming error (a violation of one of the APIs used in NCL) is revealed...">NxsNCLAPIException</a>(<span class="stringliteral">&quot;No NxsReader when reading Assumptions block.&quot;</span>);
<a name="l02657"></a>02657 
<a name="l02658"></a>02658     token.<a class="code" href="classNxsToken_a3346e398b3f6b5e8c7c3cebc49ae1c4b.html#a3346e398b3f6b5e8c7c3cebc49ae1c4b" title="Reads characters from in until a complete token has been read and stored in token...">GetNextToken</a>();
<a name="l02659"></a>02659     <span class="keyword">const</span> std::map&lt;std::string, std::string&gt; kv = token.ProcessAsSimpleKeyValuePairs(<span class="stringliteral">&quot;LINK&quot;</span>);
<a name="l02660"></a>02660     std::map&lt;std::string, std::string&gt;::const_iterator pairIt = kv.begin();
<a name="l02661"></a>02661     <span class="keywordflow">for</span> (;pairIt != kv.end(); ++pairIt)
<a name="l02662"></a>02662         {
<a name="l02663"></a>02663         <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> key(pairIt-&gt;first.c_str());
<a name="l02664"></a>02664         key.ToUpper();
<a name="l02665"></a>02665         <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> value(pairIt-&gt;second.c_str());
<a name="l02666"></a>02666         <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;TAXA&quot;</span>)
<a name="l02667"></a>02667             {
<a name="l02668"></a>02668             <span class="keywordflow">if</span> (taxa &amp;&amp; !taxa-&gt;<a class="code" href="classNxsBlock_a43cb2dac4ccc14d798d29670d9dc6017.html#a43cb2dac4ccc14d798d29670d9dc6017" title="Returns the `id` NxsString.">GetID</a>().<a class="code" href="classNxsString_a1c9d6018f25dd43b0e6795afa25cadd8.html#a1c9d6018f25dd43b0e6795afa25cadd8" title="Returns true if the stored string is a non-case-sensitive copy of the argument `s&amp;#39;...">EqualsCaseInsensitive</a>(value))
<a name="l02669"></a>02669                 {
<a name="l02670"></a>02670                 <span class="keywordflow">if</span> (GetTaxaLinkStatus() &amp; NxsBlock::BLOCK_LINK_USED)
<a name="l02671"></a>02671                     {
<a name="l02672"></a>02672                     errormsg = <span class="stringliteral">&quot;LINK to a Taxa block must occur before commands that use a taxa block&quot;</span>;
<a name="l02673"></a>02673                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l02674"></a>02674                     }
<a name="l02675"></a>02675                 SetTaxaBlockPtr(NULL, NxsBlock::BLOCK_LINK_UNINITIALIZED);
<a name="l02676"></a>02676                 }
<a name="l02677"></a>02677             <span class="keywordflow">if</span> (!taxa)
<a name="l02678"></a>02678                 {
<a name="l02679"></a>02679                 <a class="code" href="classNxsTaxaBlockAPI.html" title="This abstract class describes the interface that every block that wants to serve...">NxsTaxaBlockAPI</a> * cb = nexusReader-&gt;<a class="code" href="classNxsReader_acb2f095e4d006a3757d5296eb68743e4.html#acb2f095e4d006a3757d5296eb68743e4" title="NOTE: cast to NxsTaxaBlockAPI *.">GetTaxaBlockByTitle</a>(value.c_str(), NULL);
<a name="l02680"></a>02680                 <span class="keywordflow">if</span> (cb == NULL)
<a name="l02681"></a>02681                     {
<a name="l02682"></a>02682                     errormsg = <span class="stringliteral">&quot;Unknown TAXA block (&quot;</span>;
<a name="l02683"></a>02683                     errormsg += value;
<a name="l02684"></a>02684                     errormsg +=<span class="stringliteral">&quot;) referred to in the LINK command&quot;</span>;
<a name="l02685"></a>02685                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l02686"></a>02686                     }
<a name="l02687"></a>02687                 SetTaxaBlockPtr(cb, NxsBlock::BLOCK_LINK_FROM_LINK_CMD);
<a name="l02688"></a>02688                 }
<a name="l02689"></a>02689             }
<a name="l02690"></a>02690         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;CHARACTERS&quot;</span>)
<a name="l02691"></a>02691             {
<a name="l02692"></a>02692             <span class="keywordflow">if</span> (charBlockPtr &amp;&amp; !charBlockPtr-&gt;<a class="code" href="classNxsBlock_a43cb2dac4ccc14d798d29670d9dc6017.html#a43cb2dac4ccc14d798d29670d9dc6017" title="Returns the `id` NxsString.">GetID</a>().<a class="code" href="classNxsString_a1c9d6018f25dd43b0e6795afa25cadd8.html#a1c9d6018f25dd43b0e6795afa25cadd8" title="Returns true if the stored string is a non-case-sensitive copy of the argument `s&amp;#39;...">EqualsCaseInsensitive</a>(value))
<a name="l02693"></a>02693                 {
<a name="l02694"></a>02694                 <span class="keywordflow">if</span> (GetCharLinkStatus() &amp; NxsBlock::BLOCK_LINK_USED)
<a name="l02695"></a>02695                     {
<a name="l02696"></a>02696                     errormsg = <span class="stringliteral">&quot;LINK to a CHARACTERS block must occur before commands that use a CHARACTERS block&quot;</span>;
<a name="l02697"></a>02697                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l02698"></a>02698                     }
<a name="l02699"></a>02699                 SetCharBlockPtr(NULL, NxsBlock::BLOCK_LINK_UNINITIALIZED);
<a name="l02700"></a>02700                 }
<a name="l02701"></a>02701             <span class="keywordflow">if</span> (!charBlockPtr)
<a name="l02702"></a>02702                 {
<a name="l02703"></a>02703                 <a class="code" href="classNxsCharactersBlockAPI.html" title="Intended to specify the interface of a NxsCharactersBlock, but actually does not...">NxsCharactersBlockAPI</a> * cb = nexusReader-&gt;<a class="code" href="classNxsReader_aa6781043d2429789e69bd67f486a16d4.html#aa6781043d2429789e69bd67f486a16d4" title="NOTE: cast to NxsCharactersBlockAPI *.">GetCharBlockByTitle</a>(value.c_str(), NULL);
<a name="l02704"></a>02704                 <span class="keywordflow">if</span> (cb == NULL)
<a name="l02705"></a>02705                     {
<a name="l02706"></a>02706                     errormsg = <span class="stringliteral">&quot;Unknown CHARACTERS block (&quot;</span>;
<a name="l02707"></a>02707                     errormsg += value;
<a name="l02708"></a>02708                     errormsg +=<span class="stringliteral">&quot;) referred to in the LINK command&quot;</span>;
<a name="l02709"></a>02709                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l02710"></a>02710                     }
<a name="l02711"></a>02711                 SetCharBlockPtr(cb, NxsBlock::BLOCK_LINK_FROM_LINK_CMD);
<a name="l02712"></a>02712                 }
<a name="l02713"></a>02713             }
<a name="l02714"></a>02714         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;TREES&quot;</span>)
<a name="l02715"></a>02715             {
<a name="l02716"></a>02716             <span class="keywordflow">if</span> (treesBlockPtr &amp;&amp; !treesBlockPtr-&gt;GetID().EqualsCaseInsensitive(value))
<a name="l02717"></a>02717                 {
<a name="l02718"></a>02718                 <span class="keywordflow">if</span> (GetTreesLinkStatus() &amp; NxsBlock::BLOCK_LINK_USED)
<a name="l02719"></a>02719                     {
<a name="l02720"></a>02720                     errormsg = <span class="stringliteral">&quot;LINK to a TREES block must occur before commands that use a TREES block&quot;</span>;
<a name="l02721"></a>02721                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l02722"></a>02722                     }
<a name="l02723"></a>02723                 SetTreesBlockPtr(NULL, NxsBlock::BLOCK_LINK_UNINITIALIZED);
<a name="l02724"></a>02724                 }
<a name="l02725"></a>02725             <span class="keywordflow">if</span> (!treesBlockPtr)
<a name="l02726"></a>02726                 {
<a name="l02727"></a>02727                 NxsTreesBlockAPI * cb = nexusReader-&gt;<a class="code" href="classNxsReader_aba1aa4dbb45a3a8d9a590d5212d3c4cb.html#aba1aa4dbb45a3a8d9a590d5212d3c4cb" title="NOTE: cast to NxsTreesBlockAPI *.">GetTreesBlockByTitle</a>(value.c_str(), NULL);
<a name="l02728"></a>02728                 <span class="keywordflow">if</span> (cb == NULL)
<a name="l02729"></a>02729                     {
<a name="l02730"></a>02730                     errormsg = <span class="stringliteral">&quot;Unknown TREES block (&quot;</span>;
<a name="l02731"></a>02731                     errormsg += value;
<a name="l02732"></a>02732                     errormsg +=<span class="stringliteral">&quot;) referred to in the LINK command&quot;</span>;
<a name="l02733"></a>02733                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(errormsg, token);
<a name="l02734"></a>02734                     }
<a name="l02735"></a>02735                 SetTreesBlockPtr(cb, NxsBlock::BLOCK_LINK_FROM_LINK_CMD);
<a name="l02736"></a>02736                 }
<a name="l02737"></a>02737             }
<a name="l02738"></a>02738         <span class="keywordflow">else</span>
<a name="l02739"></a>02739             {
<a name="l02740"></a>02740             errormsg = <span class="stringliteral">&quot;Skipping unknown LINK subcommand: &quot;</span>;
<a name="l02741"></a>02741             errormsg += pairIt-&gt;first.c_str();
<a name="l02742"></a>02742             nexusReader-&gt;<a class="code" href="classNxsReader_aa81b33d57a4c5ddac0d5ccbf81df9c5b.html#aa81b33d57a4c5ddac0d5ccbf81df9c5b" title="Used internally as a more convenient way of calling NexusWarn.">NexusWarnToken</a>(errormsg, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ad6030a0462aaf947e6383d0fd91a0b68">NxsReader::SKIPPING_CONTENT_WARNING</a>, token);
<a name="l02743"></a>02743             errormsg.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>(); <span class="comment">//this token pos will be off a bit.</span>
<a name="l02744"></a>02744             }
<a name="l02745"></a>02745         }
<a name="l02746"></a>02746     }
<a name="l02747"></a><a class="code" href="classNxsAssumptionsBlock_a0515221c85c80748d5598827f684ac20.html#a0515221c85c80748d5598827f684ac20">02747</a> <span class="keywordtype">void</span> <a class="code" href="classNxsAssumptionsBlock_a0515221c85c80748d5598827f684ac20.html#a0515221c85c80748d5598827f684ac20" title="Should write the LINK command to out.">NxsAssumptionsBlock::WriteLinkCommand</a>(std::ostream &amp;out)<span class="keyword"> const</span>
<a name="l02748"></a>02748 <span class="keyword">    </span>{
<a name="l02749"></a>02749     <span class="keywordflow">if</span> ( (taxa &amp;&amp; !(taxa-&gt;GetTitle().empty()))
<a name="l02750"></a>02750         || (treesBlockPtr  &amp;&amp; !(treesBlockPtr-&gt;GetTitle().empty()))
<a name="l02751"></a>02751         || (charBlockPtr &amp;&amp; !(charBlockPtr-&gt;GetTitle().empty())))
<a name="l02752"></a>02752         {
<a name="l02753"></a>02753         out &lt;&lt; <span class="stringliteral">&quot;    LINK&quot;</span>;
<a name="l02754"></a>02754         <span class="keywordflow">if</span> (taxa)
<a name="l02755"></a>02755             out &lt;&lt; <span class="stringliteral">&quot; TAXA = &quot;</span> &lt;&lt; NxsString::GetEscaped(taxa-&gt;GetTitle());
<a name="l02756"></a>02756         <span class="keywordflow">if</span> (charBlockPtr)
<a name="l02757"></a>02757             out &lt;&lt; <span class="stringliteral">&quot; CHARACTERS = &quot;</span> &lt;&lt; NxsString::GetEscaped(charBlockPtr-&gt;GetTitle());
<a name="l02758"></a>02758         <span class="keywordflow">if</span> (treesBlockPtr)
<a name="l02759"></a>02759             out &lt;&lt; <span class="stringliteral">&quot; TREES = &quot;</span> &lt;&lt; NxsString::GetEscaped(treesBlockPtr-&gt;GetTitle());
<a name="l02760"></a>02760         out &lt;&lt; <span class="stringliteral">&quot;;\n&quot;</span>;
<a name="l02761"></a>02761         }
<a name="l02762"></a>02762     }
<a name="l02763"></a>02763 
<a name="l02764"></a>02764 VecBlockPtr NxsAssumptionsBlock::GetCreatedTaxaBlocks()
<a name="l02765"></a>02765     {
<a name="l02766"></a>02766     passedRefOfOwnedBlock = <span class="keyword">true</span>;
<a name="l02767"></a>02767     VecBlockPtr r;
<a name="l02768"></a>02768     VecAssumpBlockPtr::iterator bIt = createdSubBlocks.begin();
<a name="l02769"></a>02769     <span class="keywordflow">for</span>(; bIt != createdSubBlocks.end(); ++bIt)
<a name="l02770"></a>02770         r.push_back(*bIt);
<a name="l02771"></a>02771     <span class="keywordflow">return</span> r;
<a name="l02772"></a>02772     }
<a name="l02773"></a>02773 
<a name="l02774"></a>02774 
<a name="l02775"></a>02775 <a class="code" href="classNxsAssumptionsBlock.html" title="This class handles reading and storage for the NxsReader block ASSUMPTIONS.">NxsAssumptionsBlock</a> *NxsAssumptionsBlockFactory::GetBlockReaderForID(<span class="keyword">const</span> std::string &amp; idneeded, <a class="code" href="classNxsReader.html" title="This is the class that orchestrates the reading of a NEXUS data file, and so is the...">NxsReader</a> *reader, <a class="code" href="classNxsToken.html">NxsToken</a> *)
<a name="l02776"></a>02776     {
<a name="l02777"></a>02777     <span class="keywordflow">if</span> (reader == NULL || (idneeded != <span class="stringliteral">&quot;ASSUMPTIONS&quot;</span> &amp;&amp; idneeded != <span class="stringliteral">&quot;CODONS&quot;</span> &amp;&amp; idneeded != <span class="stringliteral">&quot;SETS&quot;</span>))
<a name="l02778"></a>02778         <span class="keywordflow">return</span> NULL;
<a name="l02779"></a>02779     <a class="code" href="classNxsAssumptionsBlock.html" title="This class handles reading and storage for the NxsReader block ASSUMPTIONS.">NxsAssumptionsBlock</a> * nb =  <span class="keyword">new</span> <a class="code" href="classNxsAssumptionsBlock_a286f1cc68103b9f6e64d05d0a5933744.html#a286f1cc68103b9f6e64d05d0a5933744" title="Sets id = &amp;quot;ASSUMPTIONS&amp;quot;, charBlockPtr = NULL, and taxa = t.">NxsAssumptionsBlock</a>(NULL);
<a name="l02780"></a>02780     nb-&gt;<a class="code" href="classNxsBlock_a1c26882db165367dcb8e7ada8d5b1aea.html#a1c26882db165367dcb8e7ada8d5b1aea" title="Should be called with SetImplementsLinkAPI(true) by all blocks that overload both:...">SetImplementsLinkAPI</a>(<span class="keyword">true</span>);
<a name="l02781"></a>02781     <span class="keywordflow">return</span> nb;
<a name="l02782"></a>02782     }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Sat Mar 27 13:49:19 2010 for NCL by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
