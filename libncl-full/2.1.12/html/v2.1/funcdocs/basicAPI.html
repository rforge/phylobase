<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>NCL: The Basics of the NCL API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="ncl.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="basicAPI">The Basics of the NCL API </a></h1><p>The core API has not changed from version 2.0 to 2.1.</p>
<p>NCL parses an std::istream by creating a <a class="el" href="classNxsToken.html">NxsToken</a> object around the stream (a better name for the class would be NxsTokenizer). Rather than using a low-level C++ istream operations, the <a class="el" href="classNxsToken.html">NxsToken</a> allows you to process a file by the NEXUS tokenizing rules - comments are skipped and NEXUS's quoting rules are obeyed.</p>
<p>A <a class="el" href="classNxsReader.html" title="This is the class that orchestrates the reading of a NEXUS data file, and so is the...">NxsReader</a> instance is capable of reading an entire stream (usually a file) by interacting with the <a class="el" href="classNxsToken.html">NxsToken</a> until EOF is reached. The NxsReader's job is to identify the blocks in a file, and hand off the procesing of each block to an appropriate block reader (or skip the block if no reader is found).</p>
<p>The objects that read each block are instances of <a class="el" href="classNxsBlock.html" title="This is the base class from which all block classes are derived.">NxsBlock</a> (perhaps a better name for this class would be NxsBlockReader). After the <a class="el" href="classNxsReader.html" title="This is the class that orchestrates the reading of a NEXUS data file, and so is the...">NxsReader</a> chooses which block should handle a portion of NEXUS file, it will call the <a class="el" href="classNxsBlock_a3b7a229312d9182c6a7a3823d0e46a69.html#a3b7a229312d9182c6a7a3823d0e46a69" title="This virtual function must be overridden for each derived class to provide the ability...">NxsBlock::Read</a> function and pass in the <a class="el" href="classNxsToken.html">NxsToken</a> object which is poised to return tokens for the block that is to be read next.</p>
<p>Client code uses NCL by: </p>
<ul>
<li>creating a <a class="el" href="classNxsReader.html" title="This is the class that orchestrates the reading of a NEXUS data file, and so is the...">NxsReader</a> object, </li>
<li>registering the <a class="el" href="classNxsBlock.html" title="This is the base class from which all block classes are derived.">NxsBlock</a> objects that will process all of the NEXUS blocks that are not to be skipped, </li>
<li>create a <a class="el" href="classNxsToken.html">NxsToken</a> object around the istream to be read, </li>
<li>calling the Execute(NxsToken) method of the reader, and </li>
<li>retrieving the parsed information from the NxsBlocks In version 2.0 of the API, the client would have to retrieve the information from <a class="el" href="classNxsBlock.html" title="This is the base class from which all block classes are derived.">NxsBlock</a> in hooks (such as NxsBlock::ExitingBlock) during the parse.</li>
</ul>
<p>The main extensions to this basic structure that are new to version 2.1 are </p>
<ul>
<li>The ability to register <a class="el" href="classNxsBlock.html" title="This is the base class from which all block classes are derived.">NxsBlock</a> factories rather than NxsBlocks (this enables parsing of the entire file, rather than requiring the client to harvest all of the information via hooks called during the parse); </li>
<li>public blocks have been extended to deal with the TITLE and LINK commands introduced by Mesquite; </li>
<li>other formats can be parsed by a special version of the <a class="el" href="classNxsReader.html" title="This is the class that orchestrates the reading of a NEXUS data file, and so is the...">NxsReader</a> called a <a class="el" href="classMultiFormatReader.html" title="A special class of PublicNexusReader, that can parse.">MultiFormatReader</a>; </li>
<li>various extensions to individual blocks (such as full implementation of ASSUMPTIONS block, and the addition of MrBayes' "Datatype=Mixed..." subcommand in the Characters block's FORMAT command; </li>
<li>"implied" blocks are now created during some parses</li>
</ul>
<h2><a class="anchor" id="simpleparse">
Simplest example of reading</a></h2>
<p>The simplest (and admittedly least useful) NCL client that uses the version 2.1 API would be the following fragment:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &quot;ncl/nxsmultiformat.h&quot;</span>

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[])
{
<a class="code" href="classMultiFormatReader.html" title="A special class of PublicNexusReader, that can parse.">MultiFormatReader</a> nexusReader(-1, <a class="code" href="classNxsReader_aae1b69753e31aba3ff7e4b48a5afba95.html#aae1b69753e31aba3ff7e4b48a5afba95a0b0c59f3609e43fd90018b8320345a44">NxsReader::WARNINGS_TO_STDERR</a>);
<span class="keywordflow">try</span> {
    nexusReader.ReadFilepath(argv[1], MultiFormatReader::NEXUS_FORMAT);
    }
<span class="keywordflow">catch</span>(...)
    {
    nexusReader.DeleteBlocksFromFactories();
    <span class="keywordflow">throw</span>;
    }
nexusReader.DeleteBlocksFromFactories();

<span class="keywordflow">return</span> 0;
}
</pre></div><p>If you were to save this file as "simpleNCLClient.cpp" and save this <a href="simpleNCLClient/Makefile">Makefile</a> in the same directory then you could build the client. You would also need to specify the location of your NCL installation (see notes in the Makefile about NCL_INSTALL_DIR)</p>
<h2><a class="anchor" id="nonNexus">
Reading non-NEXUS file formats</a></h2>
<p>Despite the name "Nexus Class Library" NCL will actually read other file formats. NCL does not diagnose file format type. However, if you have data in PHYLIP, relaxed FASTA, ALN format or trees in Newick file then you can ask the <a class="el" href="classMultiFormatReader.html" title="A special class of PublicNexusReader, that can parse.">MultiFormatReader</a> to parse these files by passing in the appropriate <a class="el" href="classMultiFormatReader_a81e7bd3fb7ed488d7d443d3d75b8e6b4.html#a81e7bd3fb7ed488d7d443d3d75b8e6b4" title="enumeration of all of the formats supported by MultiFormatReader">MultiFormatReader::DataFormatType</a> or format name (see the <a class="el" href="classMultiFormatReader_acb70d749d174b83607981dcf304915b8.html#acb70d749d174b83607981dcf304915b8">MultiFormatReader::getFormatNames()</a> method).</p>
<p>NCL actually coerces inforamation from these sources into <a class="el" href="classNxsTaxaBlock.html" title="The default implementation of the NxsTaxaBlockAPI that is used to parse TAXA blocks...">NxsTaxaBlock</a>, NxsCharactersBlocks..., so the user of library does not have to change the code associated with querying NCL for information in order to support these formats.</p>
<p>Support for PhyloXML and nexml are planned. <hr/>
 Next see <a class="el" href="simpleextract.html">Getting information out of NCL</a> for information on getting parsed information out of NCL.</p>
<p>Brief Directory:<br/>
</p>
<ul>
<li><a class="el" href="index.html#introduction">What is the NCL?</a></li>
<li><a class="el" href="basicAPI.html">The Basics of the NCL API</a></li>
<li><a class="el" href="simpleextract.html">Getting information out of NCL</a></li>
<li><a class="el" href="LessStrict.html">Making NCL less strict</a></li>
<li><a class="el" href="Gotchas.html">Quirks and Gotchas</a></li>
<li><a class="el" href="FAQ.html">NCL FAQ</a></li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Mon Mar 29 16:37:12 2010 for NCL by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
