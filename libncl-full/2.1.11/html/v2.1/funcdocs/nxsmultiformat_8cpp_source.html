<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>NCL: nxsmultiformat.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>nxsmultiformat.cpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//  Copyright (C) 1999-2003 Paul O. Lewis and Mark T. Holder</span>
<a name="l00002"></a>00002 <span class="comment">//</span>
<a name="l00003"></a>00003 <span class="comment">//  This file is part of NCL (Nexus Class Library) version 2.0.</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">//  NCL is free software; you can redistribute it and/or modify</span>
<a name="l00006"></a>00006 <span class="comment">//  it under the terms of the GNU General Public License as published by</span>
<a name="l00007"></a>00007 <span class="comment">//  the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00008"></a>00008 <span class="comment">//  (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment">//</span>
<a name="l00010"></a>00010 <span class="comment">//  NCL is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment">//  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment">//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<a name="l00013"></a>00013 <span class="comment">//  GNU General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment">//</span>
<a name="l00015"></a>00015 <span class="comment">//  You should have received a copy of the GNU General Public License</span>
<a name="l00016"></a>00016 <span class="comment">//  along with NCL; if not, write to the Free Software Foundation, Inc.,</span>
<a name="l00017"></a>00017 <span class="comment">//  59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<a name="l00018"></a>00018 <span class="comment">//</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="comment">/* The phylip parser is based on code from PHYLIP which is:</span>
<a name="l00022"></a>00022 <span class="comment"> * version 3.6. (c) Copyright 1993-2004 by the University of Washington.</span>
<a name="l00023"></a>00023 <span class="comment"> * Written by Joseph Felsenstein, Akiko Fuseki, Sean Lamont, Andrew Keeffe,</span>
<a name="l00024"></a>00024 <span class="comment"> * Mike Palczewski, Doug Buxton and Dan Fineman. Permission is granted to</span>
<a name="l00025"></a>00025 <span class="comment"> * copy and use this program provided no fee is charged for it and provided</span>
<a name="l00026"></a>00026 <span class="comment"> * that this copyright notice is not removed.</span>
<a name="l00027"></a>00027 <span class="comment"> */</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="comment">/*</span>
<a name="l00031"></a>00031 <span class="comment"> * This file is a phylip to NEXUS converter that consists of code from PHYLIP</span>
<a name="l00032"></a>00032 <span class="comment"> * 3.6.5 (see copyright above) tweaked by Mark Holder to output NEXUS.</span>
<a name="l00033"></a>00033 <span class="comment"> *</span>
<a name="l00034"></a>00034 <span class="comment"> * This file was created by concatenating the headers, and .c files:</span>
<a name="l00035"></a>00035 <span class="comment"> *  phylip.h,</span>
<a name="l00036"></a>00036 <span class="comment"> *  seq.h,</span>
<a name="l00037"></a>00037 <span class="comment"> *  discrete.h</span>
<a name="l00038"></a>00038 <span class="comment"> *  phylip.c</span>
<a name="l00039"></a>00039 <span class="comment"> *  seq.c,</span>
<a name="l00040"></a>00040 <span class="comment"> *  pars.c, and</span>
<a name="l00041"></a>00041 <span class="comment"> *  discrete.c concatenated</span>
<a name="l00042"></a>00042 <span class="comment"> *  followed by removal of code that is unused in this simple program, and</span>
<a name="l00043"></a>00043 <span class="comment"> * the addition of routines for printing out NEXUS.</span>
<a name="l00044"></a>00044 <span class="comment"> */</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;cassert&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;ncl/nxsmultiformat.h&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;ncl/nxsstring.h&quot;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> MAX_BUFFER_SIZE = 0x80000;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="keyword">const</span> <span class="keywordtype">char</span> * gFormatNames[] = { <span class="stringliteral">&quot;nexus&quot;</span>,
<a name="l00062"></a>00062                                 <span class="stringliteral">&quot;dnafasta&quot;</span>,
<a name="l00063"></a>00063                                 <span class="stringliteral">&quot;aafasta&quot;</span>,
<a name="l00064"></a>00064                                 <span class="stringliteral">&quot;rnafasta&quot;</span>,
<a name="l00065"></a>00065                                 <span class="stringliteral">&quot;dnaphylip&quot;</span>,
<a name="l00066"></a>00066                                 <span class="stringliteral">&quot;rnaphylip&quot;</span>,
<a name="l00067"></a>00067                                 <span class="stringliteral">&quot;aaphylip&quot;</span>,
<a name="l00068"></a>00068                                 <span class="stringliteral">&quot;discretephylip&quot;</span>,
<a name="l00069"></a>00069                                 <span class="stringliteral">&quot;dnaphylipinterleaved&quot;</span>,
<a name="l00070"></a>00070                                 <span class="stringliteral">&quot;rnaphylipinterleaved&quot;</span>,
<a name="l00071"></a>00071                                 <span class="stringliteral">&quot;aaphylipinterleaved&quot;</span>,
<a name="l00072"></a>00072                                 <span class="stringliteral">&quot;discretephylipinterleaved&quot;</span>,
<a name="l00073"></a>00073                                 <span class="stringliteral">&quot;dnarelaxedphylip&quot;</span>,
<a name="l00074"></a>00074                                 <span class="stringliteral">&quot;rnarelaxedphylip&quot;</span>,
<a name="l00075"></a>00075                                 <span class="stringliteral">&quot;aarelaxedphylip&quot;</span>,
<a name="l00076"></a>00076                                 <span class="stringliteral">&quot;discreterelaxedphylip&quot;</span>,
<a name="l00077"></a>00077                                 <span class="stringliteral">&quot;dnarelaxedphylipinterleaved&quot;</span>,
<a name="l00078"></a>00078                                 <span class="stringliteral">&quot;rnarelaxedphylipinterleaved&quot;</span>,
<a name="l00079"></a>00079                                 <span class="stringliteral">&quot;aarelaxedphylipinterleaved&quot;</span>,
<a name="l00080"></a>00080                                 <span class="stringliteral">&quot;discreterelaxedphylipinterleaved&quot;</span>,
<a name="l00081"></a>00081                                 <span class="stringliteral">&quot;dnaaln&quot;</span>,
<a name="l00082"></a>00082                                 <span class="stringliteral">&quot;rnaaln&quot;</span>,
<a name="l00083"></a>00083                                 <span class="stringliteral">&quot;aaaln&quot;</span>,
<a name="l00084"></a>00084                                 <span class="stringliteral">&quot;phyliptree&quot;</span>,
<a name="l00085"></a>00085                                 <span class="stringliteral">&quot;relaxedphyliptree&quot;</span>,
<a name="l00086"></a>00086                                 <span class="stringliteral">&quot;nexml&quot;</span>,
<a name="l00087"></a>00087                             };
<a name="l00088"></a>00088 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> gNumFormats = 26;
<a name="l00089"></a>00089 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> PHYLIP_NMLNGTH = 10;
<a name="l00090"></a>00090 
<a name="l00091"></a><a class="code" href="classMultiFormatReader_acb70d749d174b83607981dcf304915b8.html#acb70d749d174b83607981dcf304915b8">00091</a> std::vector&lt;std::string&gt; <a class="code" href="classMultiFormatReader_acb70d749d174b83607981dcf304915b8.html#acb70d749d174b83607981dcf304915b8">MultiFormatReader::getFormatNames</a>()
<a name="l00092"></a>00092     {
<a name="l00093"></a>00093     std::vector&lt;std::string&gt; v(gNumFormats);
<a name="l00094"></a>00094     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; gNumFormats; ++i)
<a name="l00095"></a>00095         {
<a name="l00096"></a>00096         v[i] = std::string(gFormatNames[i]);
<a name="l00097"></a>00097         }
<a name="l00098"></a>00098     <span class="keywordflow">return</span> v;
<a name="l00099"></a>00099     }
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="keyword">class </span>FileToCharBuffer
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105         <span class="keywordtype">char</span> prevChar;
<a name="l00106"></a>00106         std::istream &amp; inf;
<a name="l00107"></a>00107         <span class="keywordtype">unsigned</span> remaining;
<a name="l00108"></a>00108         <span class="keywordtype">unsigned</span> pos;
<a name="l00109"></a>00109     <span class="keyword">public</span>:
<a name="l00110"></a>00110         <span class="keywordtype">unsigned</span> totalSize;
<a name="l00111"></a>00111     <span class="keyword">protected</span>:
<a name="l00112"></a>00112         <span class="keywordtype">unsigned</span> lineNumber;
<a name="l00113"></a>00113         <span class="keywordtype">unsigned</span> prevNewlinePos;
<a name="l00114"></a>00114     <span class="keyword">public</span>:
<a name="l00115"></a>00115         <span class="comment">/* reads at most MAX_BUFFER_SIZE characters from inf into the buffer that is</span>
<a name="l00116"></a>00116 <span class="comment">        returned. The caller must delete the buffer.  On exit `len` will store the</span>
<a name="l00117"></a>00117 <span class="comment">        length of the buffer.</span>
<a name="l00118"></a>00118 <span class="comment">        */</span>
<a name="l00119"></a>00119 
<a name="l00120"></a>00120         FileToCharBuffer(std::istream &amp; instream);
<a name="l00121"></a>00121 
<a name="l00122"></a>00122         <span class="comment">/* reads at most maxLen characters from `inf` into the `buffer`</span>
<a name="l00123"></a>00123 <span class="comment">        Returns false if no characters are read.</span>
<a name="l00124"></a>00124 <span class="comment">        If true is returned then `maxLen` will indicate the number of characters read.</span>
<a name="l00125"></a>00125 <span class="comment">        */</span>
<a name="l00126"></a>00126         <span class="keywordtype">bool</span> refillBuffer(<span class="keywordtype">unsigned</span> offset);
<a name="l00127"></a>00127         <span class="keywordtype">char</span> current()<span class="keyword"> const</span>
<a name="l00128"></a>00128 <span class="keyword">            </span>{
<a name="l00129"></a>00129             <span class="keywordflow">return</span> buffer[pos];
<a name="l00130"></a>00130             }
<a name="l00131"></a>00131         <span class="keywordtype">bool</span> advance()
<a name="l00132"></a>00132             {
<a name="l00133"></a>00133             <span class="keywordflow">if</span> (pos + 1 &gt;= inbuffer)
<a name="l00134"></a>00134                 {
<a name="l00135"></a>00135                 <span class="keywordflow">if</span> (!refillBuffer(0))
<a name="l00136"></a>00136                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00137"></a>00137                 }
<a name="l00138"></a>00138             <span class="keywordflow">else</span>
<a name="l00139"></a>00139                 ++pos;
<a name="l00140"></a>00140             <span class="keyword">const</span> <span class="keywordtype">char</span> c = current();
<a name="l00141"></a>00141             <span class="keywordflow">if</span> (c == 13)
<a name="l00142"></a>00142                 {
<a name="l00143"></a>00143                 ++lineNumber;
<a name="l00144"></a>00144                 prevNewlinePos = position();
<a name="l00145"></a>00145                 }
<a name="l00146"></a>00146             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == 10)
<a name="l00147"></a>00147                 {
<a name="l00148"></a>00148                 <span class="keywordflow">if</span> (prev() != 13)
<a name="l00149"></a>00149                     ++lineNumber;
<a name="l00150"></a>00150                 prevNewlinePos = position();
<a name="l00151"></a>00151                 }
<a name="l00152"></a>00152             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00153"></a>00153             }
<a name="l00154"></a>00154         <span class="keywordtype">bool</span> advance_then_store(<span class="keywordtype">char</span> &amp; c)
<a name="l00155"></a>00155             {
<a name="l00156"></a>00156             <span class="keywordflow">if</span> (!this-&gt;advance())
<a name="l00157"></a>00157                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00158"></a>00158             c = this-&gt;current();
<a name="l00159"></a>00159             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00160"></a>00160             }
<a name="l00161"></a>00161         <span class="keywordtype">bool</span> skip_to_beginning_of_line(<span class="keywordtype">char</span> &amp; next);
<a name="l00162"></a>00162         <span class="keywordtype">char</span> prev()<span class="keyword"> const</span>
<a name="l00163"></a>00163 <span class="keyword">            </span>{
<a name="l00164"></a>00164             <span class="keywordflow">if</span> (pos == 0)
<a name="l00165"></a>00165                 <span class="keywordflow">return</span> prevChar;
<a name="l00166"></a>00166             <span class="keywordflow">return</span> buffer[pos - 1];
<a name="l00167"></a>00167             }
<a name="l00168"></a>00168         ~FileToCharBuffer()
<a name="l00169"></a>00169             {
<a name="l00170"></a>00170             <span class="keyword">delete</span> [] buffer;
<a name="l00171"></a>00171             }
<a name="l00172"></a>00172         <span class="keywordtype">unsigned</span> position()<span class="keyword"> const</span>
<a name="l00173"></a>00173 <span class="keyword">            </span>{
<a name="l00174"></a>00174             <span class="keywordflow">return</span> totalSize +  pos - remaining - inbuffer;
<a name="l00175"></a>00175             }
<a name="l00176"></a>00176         <span class="keywordtype">unsigned</span> line()<span class="keyword"> const</span>
<a name="l00177"></a>00177 <span class="keyword">            </span>{
<a name="l00178"></a>00178             <span class="keywordflow">return</span> lineNumber;
<a name="l00179"></a>00179             }
<a name="l00180"></a>00180         <span class="keywordtype">unsigned</span> column()<span class="keyword"> const</span>
<a name="l00181"></a>00181 <span class="keyword">            </span>{
<a name="l00182"></a>00182             <span class="keywordtype">unsigned</span> p = position();
<a name="l00183"></a>00183             <span class="keywordflow">if</span> (p &lt; prevNewlinePos)
<a name="l00184"></a>00184                 <span class="keywordflow">return</span> 0;
<a name="l00185"></a>00185             <span class="keywordflow">return</span> p - prevNewlinePos;
<a name="l00186"></a>00186             }
<a name="l00187"></a>00187         <span class="keywordtype">char</span> * buffer;
<a name="l00188"></a>00188         <span class="keywordtype">unsigned</span> inbuffer;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 };
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 
<a name="l00193"></a><a class="code" href="classMultiFormatReader_a08cd0829823430327b512d303e6e6a38.html#a08cd0829823430327b512d303e6e6a38">00193</a> <span class="keywordtype">void</span> <a class="code" href="classMultiFormatReader_a08cd0829823430327b512d303e6e6a38.html#a08cd0829823430327b512d303e6e6a38" title="Read a file of the specified format.">MultiFormatReader::ReadFilepath</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * filepath, <span class="keyword">const</span> <span class="keywordtype">char</span> * formatName)
<a name="l00194"></a>00194     {
<a name="l00195"></a>00195     <span class="keywordflow">if</span> (!formatName)
<a name="l00196"></a>00196         <span class="keywordflow">return</span>;
<a name="l00197"></a>00197     <a class="code" href="classMultiFormatReader_a81e7bd3fb7ed488d7d443d3d75b8e6b4.html#a81e7bd3fb7ed488d7d443d3d75b8e6b4" title="enumeration of all of the formats supported by MultiFormatReader">DataFormatType</a> f =  <a class="code" href="classMultiFormatReader_a1059706db0d035a5e97d3da005547a81.html#a1059706db0d035a5e97d3da005547a81" title="Converts a string such as &amp;quot;nexus&amp;quot; to the corresponding facet of the DataForamType...">formatNameToCode</a>(formatName);
<a name="l00198"></a>00198     <span class="keywordflow">if</span> (f == UNSUPPORTED_FORMAT)
<a name="l00199"></a>00199         {
<a name="l00200"></a>00200         <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> m;
<a name="l00201"></a>00201         m &lt;&lt; <span class="stringliteral">&quot;Unsupported format: &quot;</span> &lt;&lt; formatName;
<a name="l00202"></a>00202         <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(m);
<a name="l00203"></a>00203         }
<a name="l00204"></a>00204     this-&gt;<a class="code" href="classMultiFormatReader_a08cd0829823430327b512d303e6e6a38.html#a08cd0829823430327b512d303e6e6a38" title="Read a file of the specified format.">ReadFilepath</a>(filepath, f);
<a name="l00205"></a>00205     }
<a name="l00206"></a>00206 
<a name="l00207"></a><a class="code" href="classMultiFormatReader_a8742f38a08ee3f821802b52cc1101a4f.html#a8742f38a08ee3f821802b52cc1101a4f">00207</a> <span class="keywordtype">void</span> <a class="code" href="classMultiFormatReader_a8742f38a08ee3f821802b52cc1101a4f.html#a8742f38a08ee3f821802b52cc1101a4f" title="Read the specified format.">MultiFormatReader::ReadStream</a>(std::istream &amp; inf, <span class="keyword">const</span> <span class="keywordtype">char</span> * formatName)
<a name="l00208"></a>00208     {
<a name="l00209"></a>00209     <span class="keywordflow">if</span> (!formatName)
<a name="l00210"></a>00210         <span class="keywordflow">return</span>;
<a name="l00211"></a>00211     <a class="code" href="classMultiFormatReader_a81e7bd3fb7ed488d7d443d3d75b8e6b4.html#a81e7bd3fb7ed488d7d443d3d75b8e6b4" title="enumeration of all of the formats supported by MultiFormatReader">DataFormatType</a> f =  <a class="code" href="classMultiFormatReader_a1059706db0d035a5e97d3da005547a81.html#a1059706db0d035a5e97d3da005547a81" title="Converts a string such as &amp;quot;nexus&amp;quot; to the corresponding facet of the DataForamType...">formatNameToCode</a>(formatName);
<a name="l00212"></a>00212     <span class="keywordflow">if</span> (f == UNSUPPORTED_FORMAT)
<a name="l00213"></a>00213         {
<a name="l00214"></a>00214         <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> m;
<a name="l00215"></a>00215         m &lt;&lt; <span class="stringliteral">&quot;Unsupported format: &quot;</span> &lt;&lt; formatName;
<a name="l00216"></a>00216         <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(m);
<a name="l00217"></a>00217         }
<a name="l00218"></a>00218     this-&gt;<a class="code" href="classMultiFormatReader_a8742f38a08ee3f821802b52cc1101a4f.html#a8742f38a08ee3f821802b52cc1101a4f" title="Read the specified format.">ReadStream</a>(inf, f);
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 FileToCharBuffer::FileToCharBuffer(std::istream &amp; instream)
<a name="l00222"></a>00222     :prevChar(<span class="stringliteral">&#39;\n&#39;</span>),
<a name="l00223"></a>00223     inf(instream),
<a name="l00224"></a>00224     pos(0),
<a name="l00225"></a>00225     totalSize(0),
<a name="l00226"></a>00226     lineNumber(1),
<a name="l00227"></a>00227     prevNewlinePos(0),
<a name="l00228"></a>00228     buffer(0L)
<a name="l00229"></a>00229     {
<a name="l00230"></a>00230     std::streampos s = inf.tellg();
<a name="l00231"></a>00231     inf.seekg (0, std::ios::end);
<a name="l00232"></a>00232     std::streampos e = inf.tellg();
<a name="l00233"></a>00233     <span class="keywordflow">if</span> (e &lt;= s)
<a name="l00234"></a>00234         {
<a name="l00235"></a>00235         inbuffer = 0;
<a name="l00236"></a>00236         remaining = 0;
<a name="l00237"></a>00237         <span class="keywordflow">return</span>;
<a name="l00238"></a>00238         }
<a name="l00239"></a>00239     inf.seekg(s);
<a name="l00240"></a>00240     totalSize = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(e - s);
<a name="l00241"></a>00241     inbuffer = std::min(MAX_BUFFER_SIZE, totalSize);
<a name="l00242"></a>00242     remaining = totalSize - inbuffer;
<a name="l00243"></a>00243     buffer = <span class="keyword">new</span> <span class="keywordtype">char</span> [inbuffer];
<a name="l00244"></a>00244     inf.read(buffer, inbuffer);
<a name="l00245"></a>00245     <span class="keyword">const</span> <span class="keywordtype">char</span> c = current();
<a name="l00246"></a>00246     <span class="keywordflow">if</span> (c == 13)
<a name="l00247"></a>00247         {
<a name="l00248"></a>00248         ++lineNumber;
<a name="l00249"></a>00249         prevNewlinePos = position();
<a name="l00250"></a>00250         }
<a name="l00251"></a>00251     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == 10)
<a name="l00252"></a>00252         {
<a name="l00253"></a>00253         <span class="keywordflow">if</span> (prev() != 13)
<a name="l00254"></a>00254             ++lineNumber;
<a name="l00255"></a>00255         prevNewlinePos = position();
<a name="l00256"></a>00256         }
<a name="l00257"></a>00257     }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 <span class="keywordtype">bool</span> FileToCharBuffer::refillBuffer(<span class="keywordtype">unsigned</span> offset)
<a name="l00260"></a>00260     {
<a name="l00261"></a>00261     <span class="keywordflow">if</span> (remaining  == 0)
<a name="l00262"></a>00262         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00263"></a>00263     <span class="keywordflow">if</span> (offset == 0)
<a name="l00264"></a>00264         prevChar = buffer[inbuffer-1];
<a name="l00265"></a>00265     inbuffer = std::min(inbuffer - offset, remaining);
<a name="l00266"></a>00266     remaining -= inbuffer;
<a name="l00267"></a>00267     inf.read(buffer + offset, inbuffer);
<a name="l00268"></a>00268     pos = offset;
<a name="l00269"></a>00269     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00270"></a>00270     }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 
<a name="l00273"></a><a class="code" href="classMultiFormatReader_a1059706db0d035a5e97d3da005547a81.html#a1059706db0d035a5e97d3da005547a81">00273</a> <a class="code" href="classMultiFormatReader_a81e7bd3fb7ed488d7d443d3d75b8e6b4.html#a81e7bd3fb7ed488d7d443d3d75b8e6b4" title="enumeration of all of the formats supported by MultiFormatReader">MultiFormatReader::DataFormatType</a> <a class="code" href="classMultiFormatReader_a1059706db0d035a5e97d3da005547a81.html#a1059706db0d035a5e97d3da005547a81" title="Converts a string such as &amp;quot;nexus&amp;quot; to the corresponding facet of the DataForamType...">MultiFormatReader::formatNameToCode</a>(<span class="keyword">const</span> std::string &amp;s)
<a name="l00274"></a>00274     {
<a name="l00275"></a>00275     std::string l(s);
<a name="l00276"></a>00276     <a class="code" href="classNxsString_a8a226fa743e246c3b2b65880deaa81db.html#a8a226fa743e246c3b2b65880deaa81db" title="Capitalizes every character in s.">NxsString::to_lower</a>(l);
<a name="l00277"></a>00277     <span class="keywordtype">int</span> ind = NxsString::index_in_array(l, gFormatNames, gNumFormats);
<a name="l00278"></a>00278     <span class="keywordflow">if</span> (ind &lt; 0)
<a name="l00279"></a>00279         <span class="keywordflow">return</span> UNSUPPORTED_FORMAT;
<a name="l00280"></a>00280     NCL_ASSERT(ind &lt; UNSUPPORTED_FORMAT);
<a name="l00281"></a>00281     <span class="keywordflow">return</span> <a class="code" href="classMultiFormatReader_a81e7bd3fb7ed488d7d443d3d75b8e6b4.html#a81e7bd3fb7ed488d7d443d3d75b8e6b4" title="enumeration of all of the formats supported by MultiFormatReader">MultiFormatReader::DataFormatType</a>(ind);
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 <span class="comment">/* Assumes that `contents` was returned from readFileToMemory() has been called</span>
<a name="l00287"></a>00287 <span class="comment">    with `inf` and the `len` refers the size of the buffer allocated by</span>
<a name="l00288"></a>00288 <span class="comment">    readFileToMemory</span>
<a name="l00289"></a>00289 <span class="comment">*/</span>
<a name="l00290"></a>00290 <span class="keywordtype">bool</span>  MultiFormatReader::readFastaSequences(
<a name="l00291"></a>00291     FileToCharBuffer &amp; ftcb,
<a name="l00292"></a>00292     <span class="keyword">const</span> <a class="code" href="classNxsDiscreteDatatypeMapper.html" title="This class stores the information needed to map the internal storage for a cell of...">NxsDiscreteDatatypeMapper</a> &amp;dm,
<a name="l00293"></a>00293     std::list&lt;std::string&gt; &amp; taxaNames,
<a name="l00294"></a>00294     std::list&lt;NxsDiscreteStateRow&gt; &amp; matList,
<a name="l00295"></a>00295     <span class="keywordtype">size_t</span> &amp; longest)
<a name="l00296"></a>00296     {
<a name="l00297"></a>00297     <span class="keywordtype">char</span> * contents = ftcb.buffer;
<a name="l00298"></a>00298     NCL_ASSERT(contents);
<a name="l00299"></a>00299     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> err;
<a name="l00300"></a>00300     <span class="keywordflow">for</span> (;;)
<a name="l00301"></a>00301         {
<a name="l00302"></a>00302         <span class="keywordflow">if</span> (ftcb.current() == <span class="charliteral">&#39;&gt;&#39;</span> &amp;&amp; ( ftcb.prev() == <span class="charliteral">&#39;\n&#39;</span> ||  ftcb.prev() == <span class="charliteral">&#39;\r&#39;</span>))
<a name="l00303"></a>00303             {
<a name="l00304"></a>00304             std::string n;
<a name="l00305"></a>00305             <span class="keywordflow">if</span> (!ftcb.advance())
<a name="l00306"></a>00306                 <span class="keywordflow">break</span>;
<a name="l00307"></a>00307             <span class="keywordflow">for</span> (;;)
<a name="l00308"></a>00308                 {
<a name="l00309"></a>00309                 <span class="keywordtype">char</span> c = ftcb.current();
<a name="l00310"></a>00310                 <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\n&#39;</span> || c == <span class="charliteral">&#39;\r&#39;</span>)
<a name="l00311"></a>00311                     <span class="keywordflow">break</span>;
<a name="l00312"></a>00312                 n.append(1, c);
<a name="l00313"></a>00313                 <span class="keywordflow">if</span> (!ftcb.advance())
<a name="l00314"></a>00314                     <span class="keywordflow">break</span>;
<a name="l00315"></a>00315                 }
<a name="l00316"></a>00316             std::string nameStripped = <a class="code" href="classNxsString_a02c7ba5f259fb05e9526d92d8d361a3e.html#a02c7ba5f259fb05e9526d92d8d361a3e" title="Strips whitespace from the front and end of a string.">NxsString::strip_surrounding_whitespace</a>(n);
<a name="l00317"></a>00317             taxaNames.push_back(nameStripped);
<a name="l00318"></a>00318 
<a name="l00319"></a>00319             matList.push_back(NxsDiscreteStateRow());
<a name="l00320"></a>00320             <span class="keywordflow">if</span> (!ftcb.advance())
<a name="l00321"></a>00321                 <span class="keywordflow">break</span>;
<a name="l00322"></a>00322             NxsDiscreteStateRow &amp; row = *(matList.rbegin());
<a name="l00323"></a>00323             row.reserve(longest);
<a name="l00324"></a>00324             <span class="keywordflow">for</span> (;;)
<a name="l00325"></a>00325                 {
<a name="l00326"></a>00326                 <span class="keywordtype">char</span> c = ftcb.current();
<a name="l00327"></a>00327                 <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;&gt;&#39;</span> &amp;&amp; (ftcb.prev() == <span class="charliteral">&#39;\n&#39;</span> || ftcb.prev() == <span class="charliteral">&#39;\r&#39;</span>))
<a name="l00328"></a>00328                     <span class="keywordflow">break</span>;
<a name="l00329"></a>00329                 <span class="keywordflow">if</span> (isgraph(c))
<a name="l00330"></a>00330                     {
<a name="l00331"></a>00331                     <span class="keywordtype">int</span> stateCode = dm.<a class="code" href="classNxsDiscreteDatatypeMapper_ac4926ef2d724b3af20d51d380f64325f.html#ac4926ef2d724b3af20d51d380f64325f" title="Returns a state code for a NEXUS symbol.">GetStateCodeStored</a>(c);
<a name="l00332"></a>00332                     <span class="keywordflow">if</span> (stateCode == NXS_INVALID_STATE_CODE)
<a name="l00333"></a>00333                         {
<a name="l00334"></a>00334                         err &lt;&lt; <span class="stringliteral">&quot;Illegal state code \&quot;&quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;\&quot; found when reading character &quot;</span> &lt;&lt; row.size() &lt;&lt; <span class="stringliteral">&quot; for taxon &quot;</span> &lt;&lt; n;
<a name="l00335"></a>00335                         <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00336"></a>00336                         }
<a name="l00337"></a>00337                     row.push_back(stateCode);
<a name="l00338"></a>00338                     }
<a name="l00339"></a>00339                 <span class="keywordflow">if</span> (!ftcb.advance())
<a name="l00340"></a>00340                     <span class="keywordflow">break</span>;
<a name="l00341"></a>00341                 }
<a name="l00342"></a>00342             longest = std::max(longest, row.size());
<a name="l00343"></a>00343             }
<a name="l00344"></a>00344         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!ftcb.advance())
<a name="l00345"></a>00345             <span class="keywordflow">break</span>;
<a name="l00346"></a>00346         }
<a name="l00347"></a>00347     <span class="comment">// pad with missing data to make even rows</span>
<a name="l00348"></a>00348     std::list&lt;NxsDiscreteStateRow&gt;::iterator sIt = matList.begin();
<a name="l00349"></a>00349     <span class="keywordtype">bool</span> allSameLength = <span class="keyword">true</span>;
<a name="l00350"></a>00350     <span class="keywordflow">for</span> (; sIt != matList.end(); ++sIt)
<a name="l00351"></a>00351         {
<a name="l00352"></a>00352         NxsDiscreteStateRow &amp; row = *sIt;
<a name="l00353"></a>00353         <span class="keywordflow">if</span> (row.size() &lt; longest)
<a name="l00354"></a>00354             {
<a name="l00355"></a>00355             allSameLength = <span class="keyword">false</span>;
<a name="l00356"></a>00356             <span class="keywordflow">break</span>;
<a name="l00357"></a>00357             }
<a name="l00358"></a>00358         }
<a name="l00359"></a>00359     <span class="keywordflow">return</span> allSameLength;
<a name="l00360"></a>00360     }
<a name="l00361"></a>00361 
<a name="l00362"></a>00362 std::string  MultiFormatReader::readPhylipName(FileToCharBuffer &amp; ftcb, <span class="keywordtype">unsigned</span> i, <span class="keywordtype">bool</span> relaxedNames)
<a name="l00363"></a>00363     {
<a name="l00364"></a>00364     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> err;
<a name="l00365"></a>00365     std::string n;
<a name="l00366"></a>00366     <span class="keywordflow">if</span> (relaxedNames)
<a name="l00367"></a>00367         {
<a name="l00368"></a>00368         <span class="keywordflow">do</span> {
<a name="l00369"></a>00369             n.append(1,ftcb.current());
<a name="l00370"></a>00370             <span class="keywordflow">if</span> (!ftcb.advance())
<a name="l00371"></a>00371                 {
<a name="l00372"></a>00372                 err &lt;&lt; <span class="stringliteral">&quot;End of file found when reading the name of taxon &quot;</span> &lt;&lt; i+1 &lt;&lt; <span class="stringliteral">&quot;, \&quot;&quot;</span> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l00373"></a>00373                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00374"></a>00374                 }
<a name="l00375"></a>00375             }
<a name="l00376"></a>00376         <span class="keywordflow">while</span> (isgraph(ftcb.current()));
<a name="l00377"></a>00377         <span class="keywordflow">while</span> (!isgraph(ftcb.current()))
<a name="l00378"></a>00378             {
<a name="l00379"></a>00379             <span class="keywordflow">if</span> (!ftcb.advance())
<a name="l00380"></a>00380                 {
<a name="l00381"></a>00381                 err &lt;&lt; <span class="stringliteral">&quot;End of file found when expecting the beginning of the data for taxon &quot;</span> &lt;&lt; i+1 &lt;&lt; <span class="stringliteral">&quot;, \&quot;&quot;</span> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l00382"></a>00382                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00383"></a>00383                 }
<a name="l00384"></a>00384             }
<a name="l00385"></a>00385         }
<a name="l00386"></a>00386     <span class="keywordflow">else</span>
<a name="l00387"></a>00387         {
<a name="l00388"></a>00388         std::string ws;
<a name="l00389"></a>00389         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> letter = 0; letter &lt; PHYLIP_NMLNGTH; ++letter)
<a name="l00390"></a>00390             {
<a name="l00391"></a>00391             <span class="keywordtype">char</span> c = ftcb.current();
<a name="l00392"></a>00392             <span class="keywordflow">if</span> (isgraph(c))
<a name="l00393"></a>00393                 {
<a name="l00394"></a>00394                 n.append(ws);
<a name="l00395"></a>00395                 n.append(1,c);
<a name="l00396"></a>00396                 ws.clear();
<a name="l00397"></a>00397                 }
<a name="l00398"></a>00398             <span class="keywordflow">else</span>
<a name="l00399"></a>00399                 ws.append(1, c);
<a name="l00400"></a>00400             <span class="keywordflow">if</span> (!ftcb.advance())
<a name="l00401"></a>00401                 {
<a name="l00402"></a>00402                 err &lt;&lt; <span class="stringliteral">&quot;End of file found when reading the name for taxon &quot;</span> &lt;&lt; i+1 &lt;&lt; <span class="stringliteral">&quot;, \&quot;&quot;</span> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l00403"></a>00403                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00404"></a>00404                 }
<a name="l00405"></a>00405             }
<a name="l00406"></a>00406         }
<a name="l00407"></a>00407     <span class="keywordflow">return</span> n;
<a name="l00408"></a>00408     }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410 <span class="keywordtype">void</span>  MultiFormatReader::readPhylipData(
<a name="l00411"></a>00411     FileToCharBuffer &amp; ftcb,
<a name="l00412"></a>00412     <span class="keyword">const</span> <a class="code" href="classNxsDiscreteDatatypeMapper.html" title="This class stores the information needed to map the internal storage for a cell of...">NxsDiscreteDatatypeMapper</a> &amp;dm,
<a name="l00413"></a>00413     std::list&lt;std::string&gt; &amp; taxaNames,
<a name="l00414"></a>00414     std::list&lt;NxsDiscreteStateRow&gt; &amp; matList,
<a name="l00415"></a>00415     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_taxa,
<a name="l00416"></a>00416     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_char,
<a name="l00417"></a>00417     <span class="keywordtype">bool</span> relaxedNames)
<a name="l00418"></a>00418     {
<a name="l00419"></a>00419     NCL_ASSERT(n_taxa &gt; 0 &amp;&amp; n_char &gt; 0);
<a name="l00420"></a>00420     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> err;
<a name="l00421"></a>00421     matList.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l00422"></a>00422     matList.assign(n_taxa, NxsDiscreteStateRow(n_char, NXS_INVALID_STATE_CODE));
<a name="l00423"></a>00423     std::list&lt;NxsDiscreteStateRow&gt;::iterator mIt = matList.begin();
<a name="l00424"></a>00424     <span class="keywordflow">while</span> (!isgraph(ftcb.current()))
<a name="l00425"></a>00425         {
<a name="l00426"></a>00426         <span class="keywordflow">if</span> (!ftcb.advance())
<a name="l00427"></a>00427             <span class="keywordflow">goto</span> funcExit;
<a name="l00428"></a>00428         }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; n_taxa; ++i)
<a name="l00431"></a>00431         {
<a name="l00432"></a>00432         std::string n = readPhylipName(ftcb, i, relaxedNames);
<a name="l00433"></a>00433         taxaNames.push_back(n);
<a name="l00434"></a>00434         NCL_ASSERT(mIt != matList.end());
<a name="l00435"></a>00435         NxsDiscreteStateRow &amp; row = *mIt++;
<a name="l00436"></a>00436         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; n_char; ++j)
<a name="l00437"></a>00437             {
<a name="l00438"></a>00438             <span class="keywordtype">bool</span> readChar = <span class="keyword">false</span>;
<a name="l00439"></a>00439             <span class="keywordflow">for</span> (;;)
<a name="l00440"></a>00440                 {
<a name="l00441"></a>00441                 <span class="keyword">const</span> <span class="keywordtype">char</span> c = ftcb.current();
<a name="l00442"></a>00442                 <span class="keywordflow">if</span> (isgraph(c))
<a name="l00443"></a>00443                     {
<a name="l00444"></a>00444                     <span class="keywordflow">if</span> (isdigit(c))<span class="comment">// I don&#39;t know why PHYLIP allows digits in the midst of the sequence, but it seems to.</span>
<a name="l00445"></a>00445                         {
<a name="l00446"></a>00446                         err &lt;&lt; <span class="stringliteral">&quot;Number encountered (and ignored) within sequence for taxon &quot;</span> &lt;&lt; n;
<a name="l00447"></a>00447                         <a class="code" href="classExceptionRaisingNxsReader_a127218c47878bc24086f1bf589543a3d.html#a127218c47878bc24086f1bf589543a3d" title="This hook is called by the block readers when they encounter content that is interpretable...">NexusWarn</a>(err, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ae05d3628dc9dc89ff7ac9f36bb475895">NxsReader::PROBABLY_INCORRECT_CONTENT_WARNING</a>, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00448"></a>00448                         err.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l00449"></a>00449                         }
<a name="l00450"></a>00450                     <span class="keywordflow">else</span>
<a name="l00451"></a>00451                         {
<a name="l00452"></a>00452                         <span class="keyword">const</span> <span class="keywordtype">int</span> stateCode = dm.<a class="code" href="classNxsDiscreteDatatypeMapper_ac4926ef2d724b3af20d51d380f64325f.html#ac4926ef2d724b3af20d51d380f64325f" title="Returns a state code for a NEXUS symbol.">GetStateCodeStored</a>(c);
<a name="l00453"></a>00453                         <span class="keywordflow">if</span> (stateCode == NXS_INVALID_STATE_CODE)
<a name="l00454"></a>00454                             {
<a name="l00455"></a>00455                             <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;.&#39;</span>)
<a name="l00456"></a>00456                                 {
<a name="l00457"></a>00457                                 <span class="keywordflow">if</span> (i == 0)
<a name="l00458"></a>00458                                     {
<a name="l00459"></a>00459                                     err &lt;&lt; <span class="stringliteral">&quot;Illegal match character state code  \&quot;.\&quot; found in the first taxon for character &quot;</span> &lt;&lt; j + 1 ;
<a name="l00460"></a>00460                                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00461"></a>00461                                     }
<a name="l00462"></a>00462                                 NxsDiscreteStateRow &amp; firstRow = *(matList.begin());
<a name="l00463"></a>00463                                 row[j] = firstRow.at(j);
<a name="l00464"></a>00464                                 }
<a name="l00465"></a>00465                             <span class="keywordflow">else</span>
<a name="l00466"></a>00466                                 {
<a name="l00467"></a>00467                                 err &lt;&lt; <span class="stringliteral">&quot;Illegal state code \&quot;&quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;\&quot; found when reading site &quot;</span> &lt;&lt; j + 1 &lt;&lt; <span class="stringliteral">&quot; for taxon &quot;</span> &lt;&lt; n;
<a name="l00468"></a>00468                                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00469"></a>00469                                 }
<a name="l00470"></a>00470                             }
<a name="l00471"></a>00471                         <span class="keywordflow">else</span>
<a name="l00472"></a>00472                             row[j] = stateCode;
<a name="l00473"></a>00473                         readChar = <span class="keyword">true</span>;
<a name="l00474"></a>00474                         }
<a name="l00475"></a>00475                     }
<a name="l00476"></a>00476                 <span class="keywordflow">if</span> (!ftcb.advance())
<a name="l00477"></a>00477                     <span class="keywordflow">goto</span> funcExit;
<a name="l00478"></a>00478                 <span class="keywordflow">if</span> (readChar)
<a name="l00479"></a>00479                     <span class="keywordflow">break</span>;
<a name="l00480"></a>00480                 }
<a name="l00481"></a>00481             }
<a name="l00482"></a>00482         <span class="keywordtype">char</span> f = ftcb.current();
<a name="l00483"></a>00483         <span class="keywordflow">while</span> (f != <span class="charliteral">&#39;\r&#39;</span> &amp;&amp; f != <span class="charliteral">&#39;\n&#39;</span>)
<a name="l00484"></a>00484             {
<a name="l00485"></a>00485             <span class="keywordflow">if</span> (isgraph(f))
<a name="l00486"></a>00486                 {
<a name="l00487"></a>00487                 err &lt;&lt; <span class="stringliteral">&quot;Sequence longer than &quot;</span> &lt;&lt; n_char &lt;&lt; <span class="stringliteral">&quot; found for taxon &quot;</span> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot;. The character \&quot;&quot;</span>&lt;&lt; f &lt;&lt; <span class="stringliteral">&quot;\&quot; was found, and will be ignored. If the file position of this error corresponds to sequences for the next taxon in the matrix, then that is an indication that the sequences for taxon &quot;</span> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot; are too short.&quot;</span>;
<a name="l00488"></a>00488                 <a class="code" href="classExceptionRaisingNxsReader_a127218c47878bc24086f1bf589543a3d.html#a127218c47878bc24086f1bf589543a3d" title="This hook is called by the block readers when they encounter content that is interpretable...">NexusWarn</a>(err, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ae05d3628dc9dc89ff7ac9f36bb475895">NxsReader::PROBABLY_INCORRECT_CONTENT_WARNING</a>, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00489"></a>00489                 err.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l00490"></a>00490                 }
<a name="l00491"></a>00491             <span class="keywordflow">if</span> (!ftcb.advance())
<a name="l00492"></a>00492                 <span class="keywordflow">goto</span> funcExit;
<a name="l00493"></a>00493             f = ftcb.current();
<a name="l00494"></a>00494             }
<a name="l00495"></a>00495         <span class="keywordflow">while</span> (!isgraph(ftcb.current()))
<a name="l00496"></a>00496             {
<a name="l00497"></a>00497             <span class="keywordflow">if</span> (!ftcb.advance())
<a name="l00498"></a>00498                 <span class="keywordflow">goto</span> funcExit;
<a name="l00499"></a>00499             }
<a name="l00500"></a>00500         }
<a name="l00501"></a>00501     funcExit:
<a name="l00502"></a>00502         <span class="keywordflow">if</span> (matList.size() != n_taxa)
<a name="l00503"></a>00503             {
<a name="l00504"></a>00504             err &lt;&lt; <span class="stringliteral">&quot;Unexpected end of file.\nExpecting data for &quot;</span> &lt;&lt; n_taxa &lt;&lt; <span class="stringliteral">&quot; taxa, but only found data for &quot;</span> &lt;&lt; matList.size();
<a name="l00505"></a>00505             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00506"></a>00506             }
<a name="l00507"></a>00507         <span class="keyword">const</span> NxsDiscreteStateRow &amp; lastRow = *matList.rbegin();
<a name="l00508"></a>00508         <span class="keywordflow">if</span> (lastRow.size() != n_char)
<a name="l00509"></a>00509             {
<a name="l00510"></a>00510             err &lt;&lt; <span class="stringliteral">&quot;Unexpected end of file.\nExpecting &quot;</span> &lt;&lt; n_char &lt;&lt; <span class="stringliteral">&quot; characters for taxon &quot;</span> &lt;&lt;  *(taxaNames.rbegin()) &lt;&lt; <span class="stringliteral">&quot;, but only found &quot;</span> &lt;&lt; lastRow.size() &lt;&lt; <span class="stringliteral">&quot; characters.&quot;</span>;
<a name="l00511"></a>00511             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00512"></a>00512             }
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515 
<a name="l00516"></a>00516 <span class="keywordtype">void</span>  MultiFormatReader::readInterleavedPhylipData(
<a name="l00517"></a>00517     FileToCharBuffer &amp; ftcb,
<a name="l00518"></a>00518     <span class="keyword">const</span> <a class="code" href="classNxsDiscreteDatatypeMapper.html" title="This class stores the information needed to map the internal storage for a cell of...">NxsDiscreteDatatypeMapper</a> &amp;dm,
<a name="l00519"></a>00519     std::list&lt;std::string&gt; &amp; taxaNames,
<a name="l00520"></a>00520     std::list&lt;NxsDiscreteStateRow&gt; &amp; matList,
<a name="l00521"></a>00521     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_taxa,
<a name="l00522"></a>00522     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_char,
<a name="l00523"></a>00523     <span class="keywordtype">bool</span> relaxedNames)
<a name="l00524"></a>00524     {
<a name="l00525"></a>00525     NCL_ASSERT(n_taxa &gt; 0 &amp;&amp; n_char &gt; 0);
<a name="l00526"></a>00526     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> err;
<a name="l00527"></a>00527     matList.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l00528"></a>00528     matList.assign(n_taxa, NxsDiscreteStateRow(n_char, NXS_INVALID_STATE_CODE));
<a name="l00529"></a>00529     std::list&lt;NxsDiscreteStateRow&gt;::iterator mIt = matList.begin();
<a name="l00530"></a>00530     <span class="keywordtype">unsigned</span> startCharIndex = 0;
<a name="l00531"></a>00531     <span class="keywordtype">unsigned</span> endCharIndex = n_char;
<a name="l00532"></a>00532     <span class="keywordflow">while</span> (!isgraph(ftcb.current()))
<a name="l00533"></a>00533         {
<a name="l00534"></a>00534         <span class="keywordflow">if</span> (!ftcb.advance())
<a name="l00535"></a>00535             <span class="keywordflow">goto</span> funcExit;
<a name="l00536"></a>00536         }
<a name="l00537"></a>00537     <span class="keywordflow">while</span> (startCharIndex &lt; n_char)
<a name="l00538"></a>00538         {
<a name="l00539"></a>00539         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; n_taxa; ++i)
<a name="l00540"></a>00540             {
<a name="l00541"></a>00541             <span class="keywordflow">if</span> (startCharIndex == 0)
<a name="l00542"></a>00542                 {
<a name="l00543"></a>00543                 std::string n = readPhylipName(ftcb, i, relaxedNames);
<a name="l00544"></a>00544                 taxaNames.push_back(n);
<a name="l00545"></a>00545                 }
<a name="l00546"></a>00546             <span class="keywordflow">if</span> (i == 0)
<a name="l00547"></a>00547                 mIt = matList.begin();
<a name="l00548"></a>00548             NCL_ASSERT(mIt != matList.end());
<a name="l00549"></a>00549             NxsDiscreteStateRow &amp; row = *mIt++;
<a name="l00550"></a>00550             <span class="keywordtype">unsigned</span> j = startCharIndex;
<a name="l00551"></a>00551             <span class="keywordflow">for</span> (;;)
<a name="l00552"></a>00552                 {
<a name="l00553"></a>00553                 <span class="keyword">const</span> <span class="keywordtype">char</span> c = ftcb.current();
<a name="l00554"></a>00554                 <span class="keywordflow">if</span> (isgraph(c))
<a name="l00555"></a>00555                     {
<a name="l00556"></a>00556                     <span class="keywordflow">if</span> (j &gt;= endCharIndex)
<a name="l00557"></a>00557                         {
<a name="l00558"></a>00558                         <span class="keywordflow">if</span> (i == 0)
<a name="l00559"></a>00559                             {
<a name="l00560"></a>00560                             err &lt;&lt; <span class="stringliteral">&quot;Too many characters were found for the taxon &quot;</span> &lt;&lt; *(taxaNames.begin());
<a name="l00561"></a>00561                             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00562"></a>00562                             }
<a name="l00563"></a>00563                         <span class="keywordflow">else</span>
<a name="l00564"></a>00564                             {
<a name="l00565"></a>00565                             std::list&lt;std::string&gt;::const_iterator nIt = taxaNames.begin();
<a name="l00566"></a>00566                             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> q = 0; q &lt; i ; ++q)
<a name="l00567"></a>00567                                 ++nIt;
<a name="l00568"></a>00568                             err &lt;&lt; <span class="stringliteral">&quot;Illegal character \&quot;&quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;\&quot; found, after all of the data for this interleave page has been read for the taxon &quot;</span> &lt;&lt; *nIt;
<a name="l00569"></a>00569                             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00570"></a>00570                             }
<a name="l00571"></a>00571                         }
<a name="l00572"></a>00572                     <span class="keywordflow">if</span> (isdigit(c))<span class="comment">// I don&#39;t know why PHYLIP allows digits in the midst of the sequence, but it seems to.</span>
<a name="l00573"></a>00573                         {
<a name="l00574"></a>00574                         std::list&lt;std::string&gt;::const_iterator nIt = taxaNames.begin();
<a name="l00575"></a>00575                         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> q = 0; q &lt; i ; ++q)
<a name="l00576"></a>00576                             ++nIt;
<a name="l00577"></a>00577                         err &lt;&lt; <span class="stringliteral">&quot;Number encountered (and ignored) within sequence for taxon &quot;</span> &lt;&lt; *nIt;
<a name="l00578"></a>00578                         <a class="code" href="classExceptionRaisingNxsReader_a127218c47878bc24086f1bf589543a3d.html#a127218c47878bc24086f1bf589543a3d" title="This hook is called by the block readers when they encounter content that is interpretable...">NexusWarn</a>(err, <a class="code" href="classNxsReader_a409e01dc0baecef7ed471879c0692978.html#a409e01dc0baecef7ed471879c0692978ae05d3628dc9dc89ff7ac9f36bb475895">NxsReader::PROBABLY_INCORRECT_CONTENT_WARNING</a>, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00579"></a>00579                         err.<a class="code" href="classNxsString_abbf904c772d9776139dcae602c9fd06b.html#abbf904c772d9776139dcae602c9fd06b" title="Most containers in the standard template library can be completely erased using the...">clear</a>();
<a name="l00580"></a>00580                         }
<a name="l00581"></a>00581                     <span class="keywordflow">else</span>
<a name="l00582"></a>00582                         {
<a name="l00583"></a>00583                         <span class="keyword">const</span> <span class="keywordtype">int</span> stateCode = dm.<a class="code" href="classNxsDiscreteDatatypeMapper_ac4926ef2d724b3af20d51d380f64325f.html#ac4926ef2d724b3af20d51d380f64325f" title="Returns a state code for a NEXUS symbol.">GetStateCodeStored</a>(c);
<a name="l00584"></a>00584                         <span class="keywordflow">if</span> (stateCode == NXS_INVALID_STATE_CODE)
<a name="l00585"></a>00585                             {
<a name="l00586"></a>00586                             <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;.&#39;</span>)
<a name="l00587"></a>00587                                 {
<a name="l00588"></a>00588                                 <span class="keywordflow">if</span> (i == 0)
<a name="l00589"></a>00589                                     {
<a name="l00590"></a>00590                                     err &lt;&lt; <span class="stringliteral">&quot;Illegal match character state code  \&quot;.\&quot; found in the first taxon for character &quot;</span> &lt;&lt; j + 1 ;
<a name="l00591"></a>00591                                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00592"></a>00592                                     }
<a name="l00593"></a>00593                                 NxsDiscreteStateRow &amp; firstRow = *(matList.begin());
<a name="l00594"></a>00594                                 row[j] = firstRow.at(j);
<a name="l00595"></a>00595                                 }
<a name="l00596"></a>00596                             <span class="keywordflow">else</span>
<a name="l00597"></a>00597                                 {
<a name="l00598"></a>00598                                 std::list&lt;std::string&gt;::const_iterator nIt = taxaNames.begin();
<a name="l00599"></a>00599                                 <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> q = 0; q &lt; i ; ++q)
<a name="l00600"></a>00600                                     ++nIt;
<a name="l00601"></a>00601                                 err &lt;&lt; <span class="stringliteral">&quot;Illegal state code \&quot;&quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;\&quot; found when reading site &quot;</span> &lt;&lt; j + 1 &lt;&lt; <span class="stringliteral">&quot; for taxon &quot;</span> &lt;&lt; *nIt;
<a name="l00602"></a>00602                                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00603"></a>00603                                 }
<a name="l00604"></a>00604                             }
<a name="l00605"></a>00605                         <span class="keywordflow">else</span>
<a name="l00606"></a>00606                             row[j] = stateCode;
<a name="l00607"></a>00607                         j++;
<a name="l00608"></a>00608                         }
<a name="l00609"></a>00609                     }
<a name="l00610"></a>00610                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\r&#39;</span> || c == <span class="charliteral">&#39;\n&#39;</span>)
<a name="l00611"></a>00611                     {
<a name="l00612"></a>00612                     <span class="keywordflow">if</span> (i == 0)
<a name="l00613"></a>00613                         endCharIndex = j;
<a name="l00614"></a>00614                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (j != endCharIndex)
<a name="l00615"></a>00615                         {
<a name="l00616"></a>00616                         std::list&lt;std::string&gt;::const_iterator nIt = taxaNames.begin();
<a name="l00617"></a>00617                         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> q = 0; q &lt; i ; ++q)
<a name="l00618"></a>00618                             ++nIt;
<a name="l00619"></a>00619                         err &lt;&lt; <span class="stringliteral">&quot;Expecting &quot;</span> &lt;&lt; endCharIndex -  startCharIndex &lt;&lt; <span class="stringliteral">&quot;characters  in this interleave page (based on the number of characters in the first taxon), but only found &quot;</span> &lt;&lt; j - startCharIndex &lt;&lt; <span class="stringliteral">&quot; for taxon &quot;</span> &lt;&lt; *nIt;
<a name="l00620"></a>00620                         <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00621"></a>00621                         }
<a name="l00622"></a>00622                     <span class="keywordflow">break</span>;
<a name="l00623"></a>00623                     }
<a name="l00624"></a>00624                 <span class="keywordflow">if</span> (!ftcb.advance())
<a name="l00625"></a>00625                     <span class="keywordflow">goto</span> funcExit;
<a name="l00626"></a>00626                 }
<a name="l00627"></a>00627             <span class="keywordflow">while</span> (!isgraph(ftcb.current()))
<a name="l00628"></a>00628                 {
<a name="l00629"></a>00629                 <span class="keywordflow">if</span> (!ftcb.advance())
<a name="l00630"></a>00630                     <span class="keywordflow">goto</span> funcExit;
<a name="l00631"></a>00631                 }
<a name="l00632"></a>00632             }
<a name="l00633"></a>00633         startCharIndex = endCharIndex;
<a name="l00634"></a>00634         endCharIndex = n_char;
<a name="l00635"></a>00635         }
<a name="l00636"></a>00636     funcExit:
<a name="l00637"></a>00637         <span class="keywordflow">if</span> (matList.size() != n_taxa)
<a name="l00638"></a>00638             {
<a name="l00639"></a>00639             err &lt;&lt; <span class="stringliteral">&quot;Unexpected end of file.\nExpecting data for &quot;</span> &lt;&lt; n_taxa &lt;&lt; <span class="stringliteral">&quot; taxa, but only found data for &quot;</span> &lt;&lt; matList.size();
<a name="l00640"></a>00640             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00641"></a>00641             }
<a name="l00642"></a>00642         <span class="keyword">const</span> NxsDiscreteStateRow &amp; lastRow = *matList.rbegin();
<a name="l00643"></a>00643         <span class="keywordflow">if</span> (lastRow.size() != n_char)
<a name="l00644"></a>00644             {
<a name="l00645"></a>00645             err &lt;&lt; <span class="stringliteral">&quot;Unexpected end of file.\nExpecting &quot;</span> &lt;&lt; n_char &lt;&lt; <span class="stringliteral">&quot; characters for taxon &quot;</span> &lt;&lt;  *(taxaNames.rbegin()) &lt;&lt; <span class="stringliteral">&quot;, but only found &quot;</span> &lt;&lt; lastRow.size() &lt;&lt; <span class="stringliteral">&quot; characters.&quot;</span>;
<a name="l00646"></a>00646             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00647"></a>00647             }
<a name="l00648"></a>00648     }
<a name="l00649"></a>00649 
<a name="l00650"></a>00650 <span class="keywordtype">bool</span> FileToCharBuffer::skip_to_beginning_of_line(<span class="keywordtype">char</span> &amp; next)
<a name="l00651"></a>00651     {
<a name="l00652"></a>00652     next = this-&gt;current();
<a name="l00653"></a>00653     <span class="keywordflow">for</span> (;;)
<a name="l00654"></a>00654         {
<a name="l00655"></a>00655         <span class="keyword">const</span> <span class="keywordtype">char</span> c = next;
<a name="l00656"></a>00656         <span class="keywordflow">if</span> (!this-&gt;advance_then_store(next))
<a name="l00657"></a>00657             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00658"></a>00658         <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\n&#39;</span>)
<a name="l00659"></a>00659             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00660"></a>00660         <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\r&#39;</span>)
<a name="l00661"></a>00661             {
<a name="l00662"></a>00662             <span class="keywordflow">if</span> (next == <span class="charliteral">&#39;\n&#39;</span> &amp;&amp; (!this-&gt;advance_then_store(next)))
<a name="l00663"></a>00663                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00664"></a>00664             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00665"></a>00665             }
<a name="l00666"></a>00666         }
<a name="l00667"></a>00667     }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669 <span class="keywordtype">bool</span>  MultiFormatReader::readAlnData(
<a name="l00670"></a>00670     FileToCharBuffer &amp; ftcb,
<a name="l00671"></a>00671     <span class="keyword">const</span> <a class="code" href="classNxsDiscreteDatatypeMapper.html" title="This class stores the information needed to map the internal storage for a cell of...">NxsDiscreteDatatypeMapper</a> &amp;dm,
<a name="l00672"></a>00672     std::list&lt;std::string&gt; &amp; taxaNames,
<a name="l00673"></a>00673     std::list&lt;NxsDiscreteStateRow&gt; &amp; matList)
<a name="l00674"></a>00674     {
<a name="l00675"></a>00675     taxaNames.clear();
<a name="l00676"></a>00676     <span class="keywordtype">char</span> * contents = ftcb.buffer;
<a name="l00677"></a>00677     NCL_ASSERT(contents);
<a name="l00678"></a>00678     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> err;
<a name="l00679"></a>00679     <span class="keywordtype">char</span> c;
<a name="l00680"></a>00680     <span class="keywordflow">if</span> (!ftcb.current())
<a name="l00681"></a>00681         <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(<span class="stringliteral">&quot;Could not read from file&quot;</span>, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00682"></a>00682 
<a name="l00683"></a>00683     c = ftcb.current();
<a name="l00684"></a>00684     <span class="keywordtype">unsigned</span> index = 0;
<a name="l00685"></a>00685     <span class="keyword">const</span> <span class="keywordtype">char</span> * firstWord = <span class="stringliteral">&quot;CLUSTAL&quot;</span>;
<a name="l00686"></a>00686     std::string found;
<a name="l00687"></a>00687     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> lenFirstWord = strlen(firstWord);
<a name="l00688"></a>00688     <span class="keywordflow">while</span> (index &lt; lenFirstWord)
<a name="l00689"></a>00689         {
<a name="l00690"></a>00690         found.append(1, c);
<a name="l00691"></a>00691         <span class="keywordflow">if</span> (toupper(c) != firstWord[index] || !ftcb.advance())
<a name="l00692"></a>00692             {
<a name="l00693"></a>00693             err &lt;&lt; <span class="stringliteral">&quot;Expecting file to start \&quot;CLUSTAL\&quot; found \&quot;&quot;</span> &lt;&lt; found &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l00694"></a>00694             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00695"></a>00695             }
<a name="l00696"></a>00696         ++index;
<a name="l00697"></a>00697         c = ftcb.current();
<a name="l00698"></a>00698         }
<a name="l00699"></a>00699     <span class="keywordflow">do</span> {
<a name="l00700"></a>00700         <span class="keywordflow">if</span> (!ftcb.skip_to_beginning_of_line(c))
<a name="l00701"></a>00701             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(<span class="stringliteral">&quot;Expecting multi-line file&quot;</span>,ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00702"></a>00702     } <span class="keywordflow">while</span> (!isgraph(c));
<a name="l00703"></a>00703     <span class="keywordtype">bool</span> readingFirstBlock = <span class="keyword">true</span>;
<a name="l00704"></a>00704     <span class="keywordflow">for</span> (;;)
<a name="l00705"></a>00705         {
<a name="l00706"></a>00706         <span class="comment">// skip lines starting with whitespace</span>
<a name="l00707"></a>00707         <span class="keywordflow">while</span> (!isgraph(c))
<a name="l00708"></a>00708             {
<a name="l00709"></a>00709             <span class="keywordflow">if</span> (!ftcb.skip_to_beginning_of_line(c))
<a name="l00710"></a>00710                 {
<a name="l00711"></a>00711                 <span class="keywordflow">if</span> (taxaNames.empty())
<a name="l00712"></a>00712                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(<span class="stringliteral">&quot;Sequences after clustal header&quot;</span>, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00713"></a>00713                 <span class="keywordflow">goto</span> funcExit;
<a name="l00714"></a>00714                 }
<a name="l00715"></a>00715             }
<a name="l00716"></a>00716         <span class="keywordtype">unsigned</span> curr_tax_ind = 0;
<a name="l00717"></a>00717         std::list&lt;std::string&gt;::const_iterator taxNameIt;
<a name="l00718"></a>00718         std::list&lt;NxsDiscreteStateRow&gt;::iterator matRowIt;
<a name="l00719"></a>00719         <span class="keywordflow">if</span> (!readingFirstBlock)
<a name="l00720"></a>00720             {
<a name="l00721"></a>00721             taxNameIt = taxaNames.begin();
<a name="l00722"></a>00722             matRowIt = matList.begin();
<a name="l00723"></a>00723             }
<a name="l00724"></a>00724         NxsDiscreteStateRow * row = NULL;
<a name="l00725"></a>00725         <span class="comment">// this is the loop over taxa for a &quot;page&quot; of interleave data</span>
<a name="l00726"></a>00726         <span class="keywordflow">for</span> (;isgraph(c);)
<a name="l00727"></a>00727             {
<a name="l00728"></a>00728             std::string n;
<a name="l00729"></a>00729             <span class="keywordflow">for</span> (;;)
<a name="l00730"></a>00730                 {
<a name="l00731"></a>00731                 n.append(1, c);
<a name="l00732"></a>00732                 <span class="keywordflow">if</span> (!ftcb.advance())
<a name="l00733"></a>00733                     <span class="keywordflow">break</span>;
<a name="l00734"></a>00734                 c = ftcb.current();
<a name="l00735"></a>00735                 <span class="keywordflow">if</span> (!isgraph(c))
<a name="l00736"></a>00736                     <span class="keywordflow">break</span>;
<a name="l00737"></a>00737                 }
<a name="l00738"></a>00738             <span class="keywordflow">if</span> (readingFirstBlock)
<a name="l00739"></a>00739                 {
<a name="l00740"></a>00740                 taxaNames.push_back(n);
<a name="l00741"></a>00741                 matList.push_back(NxsDiscreteStateRow());
<a name="l00742"></a>00742                 row = &amp;(*(matList.rbegin()));
<a name="l00743"></a>00743                 }
<a name="l00744"></a>00744             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (curr_tax_ind &gt; taxaNames.size())
<a name="l00745"></a>00745                 {
<a name="l00746"></a>00746                 err &lt;&lt; <span class="stringliteral">&quot;Expecting a line beginning with whitespace (or a blank line), but found \&quot;&quot;</span> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l00747"></a>00747                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00748"></a>00748                 }
<a name="l00749"></a>00749             <span class="keywordflow">else</span>
<a name="l00750"></a>00750                 {
<a name="l00751"></a>00751                 std::string prev_name = *taxNameIt++;
<a name="l00752"></a>00752                 <span class="keywordflow">if</span> (!NxsString::case_insensitive_equals(prev_name.c_str(), n.c_str()))
<a name="l00753"></a>00753                     {
<a name="l00754"></a>00754                     err &lt;&lt; <span class="stringliteral">&quot;Expecting data for taxon # &quot;</span> &lt;&lt; (1 + curr_tax_ind) &lt;&lt; <span class="stringliteral">&quot; \&quot;&quot;</span> &lt;&lt; prev_name &lt;&lt; <span class="stringliteral">&quot;\&quot; but got \&quot;&quot;</span> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l00755"></a>00755                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00756"></a>00756                     }
<a name="l00757"></a>00757                 row = &amp;(*matRowIt++);
<a name="l00758"></a>00758                 }
<a name="l00759"></a>00759 
<a name="l00760"></a>00760 
<a name="l00761"></a>00761             <span class="keywordflow">while</span> (ftcb.advance_then_store(c))
<a name="l00762"></a>00762                 {
<a name="l00763"></a>00763                 <span class="keywordflow">if</span> (isgraph(c))
<a name="l00764"></a>00764                     <span class="keywordflow">break</span>;
<a name="l00765"></a>00765                 }
<a name="l00766"></a>00766             <span class="keywordflow">if</span>  (!isgraph(c))
<a name="l00767"></a>00767                 {
<a name="l00768"></a>00768                 err &lt;&lt; <span class="stringliteral">&quot;Unexpected end-of-file after taxon name \&quot;&quot;</span> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l00769"></a>00769                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00770"></a>00770                 }
<a name="l00771"></a>00771             <span class="comment">// this is the loop over states for a given taxon</span>
<a name="l00772"></a>00772             <span class="keywordtype">bool</span> eof = <span class="keyword">false</span>;
<a name="l00773"></a>00773             <span class="keywordtype">bool</span> eoseq = <span class="keyword">false</span>;
<a name="l00774"></a>00774             <span class="keywordflow">for</span> (;!eoseq;)
<a name="l00775"></a>00775                 {
<a name="l00776"></a>00776                 <span class="keywordflow">if</span> (isgraph(c))
<a name="l00777"></a>00777                     {
<a name="l00778"></a>00778                     <span class="keywordflow">if</span> (isdigit(c))
<a name="l00779"></a>00779                         {
<a name="l00780"></a>00780                         <span class="keywordflow">if</span> (!ftcb.skip_to_beginning_of_line(c))
<a name="l00781"></a>00781                             {
<a name="l00782"></a>00782                             <span class="keywordflow">if</span> (!readingFirstBlock &amp;&amp; (curr_tax_ind + 1) != taxaNames.size())
<a name="l00783"></a>00783                                 {
<a name="l00784"></a>00784                                 err &lt;&lt; <span class="stringliteral">&quot;Unexpected End of file. Expecting data for &quot;</span> &lt;&lt; taxaNames.size() &lt;&lt; <span class="stringliteral">&quot; sequences&quot;</span>;
<a name="l00785"></a>00785                                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00786"></a>00786                                 }
<a name="l00787"></a>00787                             <span class="keywordflow">goto</span> funcExit;
<a name="l00788"></a>00788                             }
<a name="l00789"></a>00789                         <span class="keywordflow">break</span>;
<a name="l00790"></a>00790                         }
<a name="l00791"></a>00791                     <span class="keywordflow">else</span>
<a name="l00792"></a>00792                         {
<a name="l00793"></a>00793                         <span class="keywordtype">int</span> stateCode = dm.<a class="code" href="classNxsDiscreteDatatypeMapper_ac4926ef2d724b3af20d51d380f64325f.html#ac4926ef2d724b3af20d51d380f64325f" title="Returns a state code for a NEXUS symbol.">GetStateCodeStored</a>(c);
<a name="l00794"></a>00794                         <span class="keywordflow">if</span> (stateCode == NXS_INVALID_STATE_CODE)
<a name="l00795"></a>00795                             {
<a name="l00796"></a>00796                             err &lt;&lt; <span class="stringliteral">&quot;Illegal state code \&quot;&quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;\&quot; found when reading character &quot;</span> &lt;&lt; row-&gt;size() &lt;&lt; <span class="stringliteral">&quot; for taxon &quot;</span> &lt;&lt; n;
<a name="l00797"></a>00797                             <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00798"></a>00798                             }
<a name="l00799"></a>00799                         row-&gt;push_back(stateCode);
<a name="l00800"></a>00800                         eof = !ftcb.advance_then_store(c);
<a name="l00801"></a>00801                         }
<a name="l00802"></a>00802                     }
<a name="l00803"></a>00803                 <span class="keywordflow">if</span> ((!eof) &amp;&amp; (!isgraph(c)))
<a name="l00804"></a>00804                     {
<a name="l00805"></a>00805                     <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\n&#39;</span>)
<a name="l00806"></a>00806                         {
<a name="l00807"></a>00807                         eof = !ftcb.advance_then_store(c);
<a name="l00808"></a>00808                         eoseq = <span class="keyword">true</span>;
<a name="l00809"></a>00809                         }
<a name="l00810"></a>00810                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\r&#39;</span>)
<a name="l00811"></a>00811                         {
<a name="l00812"></a>00812                         eof = !ftcb.advance_then_store(c);
<a name="l00813"></a>00813                         <span class="keywordflow">if</span> (!eof &amp;&amp; c == <span class="charliteral">&#39;\n&#39;</span>)
<a name="l00814"></a>00814                             eof = !ftcb.advance_then_store(c);
<a name="l00815"></a>00815                         eoseq = <span class="keyword">true</span>;
<a name="l00816"></a>00816                         }
<a name="l00817"></a>00817                     <span class="keywordflow">else</span>
<a name="l00818"></a>00818                         eof = !ftcb.advance_then_store(c);
<a name="l00819"></a>00819                     }
<a name="l00820"></a>00820                 <span class="keywordflow">if</span> (eof)
<a name="l00821"></a>00821                     {
<a name="l00822"></a>00822                     <span class="keywordflow">if</span> (!readingFirstBlock &amp;&amp; (curr_tax_ind + 1) != taxaNames.size())
<a name="l00823"></a>00823                         {
<a name="l00824"></a>00824                         err &lt;&lt; <span class="stringliteral">&quot;Unexpected End of file. Expecting data for &quot;</span> &lt;&lt; taxaNames.size() &lt;&lt; <span class="stringliteral">&quot; sequences&quot;</span>;
<a name="l00825"></a>00825                         <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00826"></a>00826                         }
<a name="l00827"></a>00827                     <span class="keywordflow">goto</span> funcExit;
<a name="l00828"></a>00828                     }
<a name="l00829"></a>00829                 }
<a name="l00830"></a>00830             <span class="keywordflow">if</span> (isgraph(c))
<a name="l00831"></a>00831                 curr_tax_ind++;
<a name="l00832"></a>00832             <span class="keywordflow">else</span>
<a name="l00833"></a>00833                 {
<a name="l00834"></a>00834                 <span class="keywordflow">if</span> (!readingFirstBlock &amp;&amp; (1 + curr_tax_ind) != taxaNames.size())
<a name="l00835"></a>00835                     {
<a name="l00836"></a>00836                     err &lt;&lt; <span class="stringliteral">&quot;Unexpected line beginning with whitespace. Expecting data for &quot;</span> &lt;&lt; taxaNames.size() &lt;&lt; <span class="stringliteral">&quot; sequences&quot;</span>;
<a name="l00837"></a>00837                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, ftcb.position(), ftcb.line(), ftcb.column());
<a name="l00838"></a>00838                     }
<a name="l00839"></a>00839                 curr_tax_ind = 0;
<a name="l00840"></a>00840                 readingFirstBlock = <span class="keyword">false</span>;
<a name="l00841"></a>00841                 }
<a name="l00842"></a>00842             }
<a name="l00843"></a>00843         }
<a name="l00844"></a>00844 
<a name="l00845"></a>00845     funcExit:
<a name="l00846"></a>00846         <span class="comment">// pad with missing data to make even rows</span>
<a name="l00847"></a>00847         std::list&lt;NxsDiscreteStateRow&gt;::iterator sIt = matList.begin();
<a name="l00848"></a>00848         <span class="keywordtype">long</span> longest = -1;
<a name="l00849"></a>00849         <span class="keywordflow">for</span> (; sIt != matList.end(); ++sIt)
<a name="l00850"></a>00850             {
<a name="l00851"></a>00851             NxsDiscreteStateRow &amp; row = *sIt;
<a name="l00852"></a>00852             <span class="keywordflow">if</span> (longest == -1)
<a name="l00853"></a>00853                 longest = (long) row.size();
<a name="l00854"></a>00854             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (longest != (<span class="keywordtype">long</span>) row.size())
<a name="l00855"></a>00855                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00856"></a>00856             }
<a name="l00857"></a>00857         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00858"></a>00858     }
<a name="l00859"></a>00859 
<a name="l00860"></a>00860 <span class="keywordtype">void</span> MultiFormatReader::addTaxaNames(<span class="keyword">const</span> std::list&lt;std::string&gt; &amp; taxaNames, <a class="code" href="classNxsTaxaBlockAPI.html" title="This abstract class describes the interface that every block that wants to serve...">NxsTaxaBlockAPI</a> * taxa)
<a name="l00861"></a>00861     {
<a name="l00862"></a>00862     NCL_ASSERT(taxa);
<a name="l00863"></a>00863     std::list&lt;std::string&gt;::const_iterator nIt = taxaNames.begin();
<a name="l00864"></a>00864 
<a name="l00865"></a>00865     std::vector&lt;NxsNameToNameTrans&gt; nameTrans;
<a name="l00866"></a>00866     <span class="keywordtype">bool</span> nameTransNeeded = <span class="keyword">false</span>;
<a name="l00867"></a>00867     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> t;
<a name="l00868"></a>00868 
<a name="l00869"></a>00869     <span class="keywordflow">for</span> (; nIt != taxaNames.end(); ++nIt)
<a name="l00870"></a>00870         {
<a name="l00871"></a>00871         std::string name = *nIt;
<a name="l00872"></a>00872         NxsNameToNameTrans trans(name, name);
<a name="l00873"></a>00873         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 1; ; ++i)
<a name="l00874"></a>00874             {
<a name="l00875"></a>00875             <span class="keywordflow">try</span> {
<a name="l00876"></a>00876                 taxa-&gt;<a class="code" href="classNxsTaxaBlockAPI_adb06043c2f1668102b6f0b725c7612b8.html#adb06043c2f1668102b6f0b725c7612b8" title="Adds taxon label &amp;#39;s&amp;#39; to end of list of taxon labels and increments dimNTax...">AddTaxonLabel</a>(name);
<a name="l00877"></a>00877                 <span class="keywordflow">break</span>;
<a name="l00878"></a>00878                 }
<a name="l00879"></a>00879             <span class="keywordflow">catch</span> (DuplicatedLabelNxsException &amp; x)
<a name="l00880"></a>00880                 {
<a name="l00881"></a>00881                 <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="classPublicNexusReader_adb44bac2531443daa097ce7134972af3.html#adb44bac2531443daa097ce7134972af3" title="this public field is used in some hacks that relate to printing out translation records...">conversionOutputRecord</a>.addNumbersToDisambiguateNames)
<a name="l00882"></a>00882                     <span class="keywordflow">throw</span>;
<a name="l00883"></a>00883                 nameTransNeeded = <span class="keyword">true</span>;
<a name="l00884"></a>00884                 t.assign(*nIt);
<a name="l00885"></a>00885                 t &lt;&lt; i;
<a name="l00886"></a>00886                 trans.second = t;
<a name="l00887"></a>00887                 name = t;
<a name="l00888"></a>00888                 }
<a name="l00889"></a>00889             }
<a name="l00890"></a>00890         <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classPublicNexusReader_adb44bac2531443daa097ce7134972af3.html#adb44bac2531443daa097ce7134972af3" title="this public field is used in some hacks that relate to printing out translation records...">conversionOutputRecord</a>.addNumbersToDisambiguateNames)
<a name="l00891"></a>00891             nameTrans.push_back(trans);
<a name="l00892"></a>00892         }
<a name="l00893"></a>00893 
<a name="l00894"></a>00894 
<a name="l00895"></a>00895     <span class="comment">// write out a name translation file if we need to</span>
<a name="l00896"></a>00896     <span class="keywordflow">if</span> (nameTransNeeded)
<a name="l00897"></a>00897         this-&gt;<a class="code" href="classPublicNexusReader_adb44bac2531443daa097ce7134972af3.html#adb44bac2531443daa097ce7134972af3" title="this public field is used in some hacks that relate to printing out translation records...">conversionOutputRecord</a>.writeNameTranslation(nameTrans, taxa);
<a name="l00898"></a>00898     }
<a name="l00899"></a>00899 
<a name="l00900"></a>00900 <span class="keywordtype">void</span> MultiFormatReader::moveDataToMatrix(std::list&lt;NxsDiscreteStateRow&gt; &amp; matList,  NxsDiscreteStateMatrix &amp;mat)
<a name="l00901"></a>00901     {
<a name="l00902"></a>00902     mat.clear();
<a name="l00903"></a>00903     mat.resize(matList.size());
<a name="l00904"></a>00904     NxsDiscreteStateMatrix::iterator dIt = mat.begin();
<a name="l00905"></a>00905     std::list&lt;NxsDiscreteStateRow&gt;::iterator sIt = matList.begin();
<a name="l00906"></a>00906     <span class="keywordflow">for</span> (; sIt != matList.end(); ++sIt, ++dIt)
<a name="l00907"></a>00907         {
<a name="l00908"></a>00908         NxsDiscreteStateRow &amp; source = *sIt;
<a name="l00909"></a>00909         NxsDiscreteStateRow &amp; dest = *dIt;
<a name="l00910"></a>00910         dest.swap(source);
<a name="l00911"></a>00911         }
<a name="l00912"></a>00912     }
<a name="l00913"></a>00913 
<a name="l00914"></a>00914 <span class="keywordtype">void</span>  MultiFormatReader::moveDataToDataBlock(<span class="keyword">const</span> std::list&lt;std::string&gt; &amp; taxaNames, std::list&lt;NxsDiscreteStateRow&gt; &amp; matList, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> nchar, <a class="code" href="classNxsDataBlock.html" title="This class handles reading and storage for the NEXUS block DATA.">NxsDataBlock</a> * dataB)
<a name="l00915"></a>00915     {
<a name="l00916"></a>00916     NCL_ASSERT(dataB);
<a name="l00917"></a>00917     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> d;
<a name="l00918"></a>00918     d &lt;&lt; <span class="stringliteral">&quot;Dimensions ntax = &quot;</span> &lt;&lt; matList.size() &lt;&lt; <span class="stringliteral">&quot; nchar = &quot;</span> &lt;&lt; nchar &lt;&lt; <span class="stringliteral">&quot; ; &quot;</span>;
<a name="l00919"></a>00919     std::istringstream fakeDimStream(d);
<a name="l00920"></a>00920     <a class="code" href="classNxsToken.html">NxsToken</a> fakeDimToken(fakeDimStream);
<a name="l00921"></a>00921     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> newTaxLabel(<span class="stringliteral">&quot;NewTaxa&quot;</span>);
<a name="l00922"></a>00922     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> ntaxLabel(<span class="stringliteral">&quot;NTax&quot;</span>);
<a name="l00923"></a>00923     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> ncharLabel(<span class="stringliteral">&quot;NChar&quot;</span>);
<a name="l00924"></a>00924     dataB-&gt;<a class="code" href="classNxsCharactersBlock_a2403d3b7e8c91566a2bb39dc7807e33e.html#a2403d3b7e8c91566a2bb39dc7807e33e" title="Called when DIMENSIONS command needs to be parsed from within the CHARACTERS block...">HandleDimensions</a>(fakeDimToken, newTaxLabel, ntaxLabel, ncharLabel);
<a name="l00925"></a>00925 
<a name="l00926"></a>00926     NCL_ASSERT(dataB-&gt;taxa);
<a name="l00927"></a>00927     addTaxaNames(taxaNames, dataB-&gt;taxa);
<a name="l00928"></a>00928 
<a name="l00929"></a>00929     moveDataToMatrix(matList, dataB-&gt;discreteMatrix);
<a name="l00930"></a>00930     }
<a name="l00931"></a>00931 
<a name="l00932"></a>00932 <span class="keywordtype">void</span>  MultiFormatReader::moveDataToUnalignedBlock(<span class="keyword">const</span> std::list&lt;std::string&gt; &amp; taxaNames, std::list&lt;NxsDiscreteStateRow&gt; &amp; matList, <a class="code" href="classNxsUnalignedBlock.html" title="This class handles reading and storage for the NEXUS block UNALIGNED.">NxsUnalignedBlock</a> * uB)
<a name="l00933"></a>00933     {
<a name="l00934"></a>00934     NCL_ASSERT(uB);
<a name="l00935"></a>00935     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> d;
<a name="l00936"></a>00936     d &lt;&lt; <span class="stringliteral">&quot;Dimensions NewTaxa ntax = &quot;</span> &lt;&lt; matList.size() &lt;&lt; <span class="stringliteral">&quot; ; &quot;</span>;
<a name="l00937"></a>00937     std::istringstream fakeDimStream(d);
<a name="l00938"></a>00938     <a class="code" href="classNxsToken.html">NxsToken</a> fakeDimToken(fakeDimStream);
<a name="l00939"></a>00939     uB-&gt;<a class="code" href="classNxsUnalignedBlock_a481990bc1a73bb3ee04b700701b94ac2.html#a481990bc1a73bb3ee04b700701b94ac2" title="Called when DIMENSIONS command needs to be parsed from within the UNALIGNED block...">HandleDimensions</a>(fakeDimToken);
<a name="l00940"></a>00940 
<a name="l00941"></a>00941     NCL_ASSERT(uB-&gt;taxa);
<a name="l00942"></a>00942     addTaxaNames(taxaNames, uB-&gt;taxa);
<a name="l00943"></a>00943 
<a name="l00944"></a>00944     moveDataToMatrix(matList, uB-&gt;uMatrix);
<a name="l00945"></a>00945     }
<a name="l00946"></a>00946 
<a name="l00947"></a><a class="code" href="classMultiFormatReader_ab7f85d2c6de5a06b3981e13d52a91173.html#ab7f85d2c6de5a06b3981e13d52a91173">00947</a> <span class="keywordtype">void</span>  <a class="code" href="classMultiFormatReader_ab7f85d2c6de5a06b3981e13d52a91173.html#ab7f85d2c6de5a06b3981e13d52a91173" title="A convenience function for reading FASTA files.">MultiFormatReader::readFastaFile</a>(std::istream &amp; inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290c" title="values used to represent different basic types of data stored in a CHARACTERS block...">NxsCharactersBlock::DataTypesEnum</a> dt)
<a name="l00948"></a>00948     {
<a name="l00949"></a>00949     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> blockID(<span class="stringliteral">&quot;DATA&quot;</span>);
<a name="l00950"></a>00950     <a class="code" href="classNxsBlock.html" title="This is the base class from which all block classes are derived.">NxsBlock</a> *nb = cloneFactory.<a class="code" href="classNxsCloneBlockFactory_ac2d70ff7ea662c0b5b7546083734386e.html#ac2d70ff7ea662c0b5b7546083734386e">GetBlockReaderForID</a>(blockID, <span class="keyword">this</span>, NULL);
<a name="l00951"></a>00951     NCL_ASSERT(nb);
<a name="l00952"></a>00952     <span class="keywordflow">if</span> (!nb)
<a name="l00953"></a>00953         <span class="keywordflow">return</span>;
<a name="l00954"></a>00954     nb-&gt;<a class="code" href="classNxsBlock_ade0e632784669a14df73fa0dc927d6b2.html#ade0e632784669a14df73fa0dc927d6b2" title="Sets the nexusReader data member of the NxsBlock object to &amp;#39;nxsptr&amp;#39;.">SetNexus</a>(<span class="keyword">this</span>);
<a name="l00955"></a>00955 
<a name="l00956"></a>00956     <a class="code" href="classNxsDataBlock.html" title="This class handles reading and storage for the NEXUS block DATA.">NxsDataBlock</a> * dataB = <span class="keyword">static_cast&lt;</span><a class="code" href="classNxsDataBlock.html" title="This class handles reading and storage for the NEXUS block DATA.">NxsDataBlock</a> *<span class="keyword">&gt;</span>(nb); <span class="comment">// this should be safe because we know that the PublicNexusReader has a DataBlock assigned to &quot;DATA&quot; -- unless the caller has replaced that clone template (gulp)</span>
<a name="l00957"></a>00957     FileToCharBuffer ftcb(inf);
<a name="l00958"></a>00958     <span class="keywordflow">if</span> (ftcb.buffer)
<a name="l00959"></a>00959         {
<a name="l00960"></a>00960         dataB-&gt;<a class="code" href="classNxsDataBlock_afbb0d98c0a459bb77b318c314c80dff1.html#afbb0d98c0a459bb77b318c314c80dff1" title="Calls Reset function of the parent class (NxsCharactersBlock) and resets `newtaxa&amp;#39;...">Reset</a>();
<a name="l00961"></a>00961         dataB-&gt;datatype = dt;
<a name="l00962"></a>00962         dataB-&gt;<a class="code" href="classNxsCharactersBlock_a60329b2e678a91ca6cd46957093e6f56.html#a60329b2e678a91ca6cd46957093e6f56" title="Resets standard symbol set after a change in `datatype&amp;#39; is made.">ResetSymbols</a>();
<a name="l00963"></a>00963         dataB-&gt;gap = <span class="charliteral">&#39;-&#39;</span>;
<a name="l00964"></a>00964         NxsPartition dtParts;
<a name="l00965"></a>00965         std::vector&lt;NxsCharactersBlock::DataTypesEnum&gt; dtv;
<a name="l00966"></a>00966         dataB-&gt;CreateDatatypeMapperObjects(dtParts, dtv);
<a name="l00967"></a>00967 
<a name="l00968"></a>00968         <span class="keyword">const</span> <a class="code" href="classNxsDiscreteDatatypeMapper.html" title="This class stores the information needed to map the internal storage for a cell of...">NxsDiscreteDatatypeMapper</a> * dm = dataB-&gt;GetDatatypeMapperForChar(0);
<a name="l00969"></a>00969 
<a name="l00970"></a>00970         std::list&lt;std::string&gt; taxaNames;
<a name="l00971"></a>00971         std::list&lt;NxsDiscreteStateRow&gt; matList;
<a name="l00972"></a>00972         <span class="keywordtype">size_t</span> longest = 0;
<a name="l00973"></a>00973         <span class="keywordtype">bool</span> aligned = <span class="keyword">true</span>;
<a name="l00974"></a>00974         <span class="keywordflow">try</span> {
<a name="l00975"></a>00975             aligned = readFastaSequences(ftcb, *dm, taxaNames, matList, longest);
<a name="l00976"></a>00976             }
<a name="l00977"></a>00977         <span class="keywordflow">catch</span> (...)
<a name="l00978"></a>00978             {
<a name="l00979"></a>00979             cloneFactory.<a class="code" href="classNxsBlockFactory_aac803d1280d8e4ea15b3335d9c253ba0.html#aac803d1280d8e4ea15b3335d9c253ba0" title="base-class implementation deletes the block (the NxsReader will not retain a reference...">BlockError</a>(dataB);
<a name="l00980"></a>00980             <span class="keywordflow">throw</span>;
<a name="l00981"></a>00981             }
<a name="l00982"></a>00982 
<a name="l00983"></a>00983         <span class="keywordflow">if</span> (aligned)
<a name="l00984"></a>00984             {
<a name="l00985"></a>00985             moveDataToDataBlock(taxaNames, matList, longest, dataB);
<a name="l00986"></a>00986             <a class="code" href="classNxsReader_a48e3c3da053fff92e3e2ffcb1f6635f6.html#a48e3c3da053fff92e3e2ffcb1f6635f6" title="Called by NxsReader::ExecuteBlock() to store the block and its implied blocks NxsReader::ExecuteBloc...">BlockReadHook</a>(blockID, dataB);
<a name="l00987"></a>00987             }
<a name="l00988"></a>00988         <span class="keywordflow">else</span>
<a name="l00989"></a>00989             {
<a name="l00990"></a>00990             cloneFactory.<a class="code" href="classNxsBlockFactory_aac803d1280d8e4ea15b3335d9c253ba0.html#aac803d1280d8e4ea15b3335d9c253ba0" title="base-class implementation deletes the block (the NxsReader will not retain a reference...">BlockError</a>(dataB);
<a name="l00991"></a>00991             blockID.assign(<span class="stringliteral">&quot;UNALIGNED&quot;</span>);
<a name="l00992"></a>00992             <a class="code" href="classNxsBlock.html" title="This is the base class from which all block classes are derived.">NxsBlock</a> * nub = cloneFactory.<a class="code" href="classNxsCloneBlockFactory_ac2d70ff7ea662c0b5b7546083734386e.html#ac2d70ff7ea662c0b5b7546083734386e">GetBlockReaderForID</a>(blockID, <span class="keyword">this</span>, NULL);
<a name="l00993"></a>00993             <span class="keywordflow">if</span> (!nub)
<a name="l00994"></a>00994                 {
<a name="l00995"></a>00995                 NCL_ASSERT(nub);
<a name="l00996"></a>00996                 <span class="keywordflow">return</span>;
<a name="l00997"></a>00997                 }
<a name="l00998"></a>00998             nub-&gt;<a class="code" href="classNxsBlock_ade0e632784669a14df73fa0dc927d6b2.html#ade0e632784669a14df73fa0dc927d6b2" title="Sets the nexusReader data member of the NxsBlock object to &amp;#39;nxsptr&amp;#39;.">SetNexus</a>(<span class="keyword">this</span>);
<a name="l00999"></a>00999 
<a name="l01000"></a>01000             <a class="code" href="classNxsUnalignedBlock.html" title="This class handles reading and storage for the NEXUS block UNALIGNED.">NxsUnalignedBlock</a> * unalignedB = <span class="keyword">static_cast&lt;</span><a class="code" href="classNxsUnalignedBlock.html" title="This class handles reading and storage for the NEXUS block UNALIGNED.">NxsUnalignedBlock</a> *<span class="keyword">&gt;</span>(nub); <span class="comment">// this should be safe because we know that the PublicNexusReader has a DataBlock assigned to &quot;DATA&quot; -- unless the caller has replaced that clone template (gulp)</span>
<a name="l01001"></a>01001             unalignedB-&gt;<a class="code" href="classNxsUnalignedBlock_a09af4c6bf421dc24aed22d5e064497ae.html#a09af4c6bf421dc24aed22d5e064497ae" title="Returns NxsUnalignedBlock object to the state it was in when first created.">Reset</a>();
<a name="l01002"></a>01002             unalignedB-&gt;datatype = dt;
<a name="l01003"></a>01003             unalignedB-&gt;<a class="code" href="classNxsUnalignedBlock_a7f9d272e707eb0529785967d4c97dd9c.html#a7f9d272e707eb0529785967d4c97dd9c" title="Resets standard symbol set after a change in `datatype&amp;#39; is made.">ResetSymbols</a>();
<a name="l01004"></a>01004             unalignedB-&gt;ResetDatatypeMapper();
<a name="l01005"></a>01005             moveDataToUnalignedBlock(taxaNames, matList, unalignedB);
<a name="l01006"></a>01006             <a class="code" href="classNxsReader_a48e3c3da053fff92e3e2ffcb1f6635f6.html#a48e3c3da053fff92e3e2ffcb1f6635f6" title="Called by NxsReader::ExecuteBlock() to store the block and its implied blocks NxsReader::ExecuteBloc...">BlockReadHook</a>(blockID, unalignedB);
<a name="l01007"></a>01007             }
<a name="l01008"></a>01008         }
<a name="l01009"></a>01009     <span class="keywordflow">else</span>
<a name="l01010"></a>01010         {
<a name="l01011"></a>01011         cloneFactory.<a class="code" href="classNxsBlockFactory_aac803d1280d8e4ea15b3335d9c253ba0.html#aac803d1280d8e4ea15b3335d9c253ba0" title="base-class implementation deletes the block (the NxsReader will not retain a reference...">BlockError</a>(dataB);
<a name="l01012"></a>01012         <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> err;
<a name="l01013"></a>01013         err &lt;&lt; <span class="stringliteral">&quot;No Data read -- file appears to be empty&quot;</span>;
<a name="l01014"></a>01014         this-&gt;<a class="code" href="classExceptionRaisingNxsReader_ab6ee7b74f4ff72b934778d835d41854f.html#ab6ee7b74f4ff72b934778d835d41854f" title="Raise a NxsException.">NexusError</a>(err, 0, -1, -1);
<a name="l01015"></a>01015         }
<a name="l01016"></a>01016     }
<a name="l01017"></a>01017 
<a name="l01018"></a><a class="code" href="classMultiFormatReader_aeb8f0c2a28168fcadb731d304dcf73e3.html#aeb8f0c2a28168fcadb731d304dcf73e3">01018</a> <span class="keywordtype">void</span>  <a class="code" href="classMultiFormatReader_a08cd0829823430327b512d303e6e6a38.html#a08cd0829823430327b512d303e6e6a38" title="Read a file of the specified format.">MultiFormatReader::ReadFilepath</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * filepath, <a class="code" href="classMultiFormatReader_a81e7bd3fb7ed488d7d443d3d75b8e6b4.html#a81e7bd3fb7ed488d7d443d3d75b8e6b4" title="enumeration of all of the formats supported by MultiFormatReader">DataFormatType</a> format)
<a name="l01019"></a>01019     {
<a name="l01020"></a>01020     <span class="keywordflow">if</span> (format == NEXUS_FORMAT)
<a name="l01021"></a>01021         {
<a name="l01022"></a>01022         <a class="code" href="classMultiFormatReader_a08cd0829823430327b512d303e6e6a38.html#a08cd0829823430327b512d303e6e6a38" title="Read a file of the specified format.">NxsReader::ReadFilepath</a>(filepath);
<a name="l01023"></a>01023         }
<a name="l01024"></a>01024     <span class="keywordflow">else</span>
<a name="l01025"></a>01025         {
<a name="l01026"></a>01026         std::ifstream inf;
<a name="l01027"></a>01027         <span class="keywordflow">try</span>{
<a name="l01028"></a>01028             inf.open(filepath, std::ios::binary);
<a name="l01029"></a>01029             <span class="keywordflow">if</span> (!inf.good())
<a name="l01030"></a>01030                 {
<a name="l01031"></a>01031                 <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> err;
<a name="l01032"></a>01032                 err &lt;&lt; <span class="stringliteral">&quot;Could not open the file \&quot;&quot;</span> &lt;&lt; filepath &lt;&lt;<span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l01033"></a>01033                 this-&gt;<a class="code" href="classExceptionRaisingNxsReader_ab6ee7b74f4ff72b934778d835d41854f.html#ab6ee7b74f4ff72b934778d835d41854f" title="Raise a NxsException.">NexusError</a>(err, 0, -1, -1);
<a name="l01034"></a>01034                 }
<a name="l01035"></a>01035             }
<a name="l01036"></a>01036         <span class="keywordflow">catch</span> (...)
<a name="l01037"></a>01037             {
<a name="l01038"></a>01038             <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> err;
<a name="l01039"></a>01039             err &lt;&lt; <span class="charliteral">&#39;\&quot;&#39;</span> &lt;&lt; filepath &lt;&lt;<span class="stringliteral">&quot;\&quot; does not refer to a valid file.&quot;</span> ;
<a name="l01040"></a>01040             this-&gt;<a class="code" href="classExceptionRaisingNxsReader_ab6ee7b74f4ff72b934778d835d41854f.html#ab6ee7b74f4ff72b934778d835d41854f" title="Raise a NxsException.">NexusError</a>(err, 0, -1, -1);
<a name="l01041"></a>01041             }
<a name="l01042"></a>01042         this-&gt;<a class="code" href="classMultiFormatReader_a8742f38a08ee3f821802b52cc1101a4f.html#a8742f38a08ee3f821802b52cc1101a4f" title="Read the specified format.">ReadStream</a>(inf, format, filepath);
<a name="l01043"></a>01043         }
<a name="l01044"></a>01044     }
<a name="l01045"></a>01045 
<a name="l01046"></a><a class="code" href="classMultiFormatReader_a78eef50a56c78d6f48ccf7645e8dcdf7.html#a78eef50a56c78d6f48ccf7645e8dcdf7">01046</a> <span class="keywordtype">void</span>  <a class="code" href="classMultiFormatReader_a8742f38a08ee3f821802b52cc1101a4f.html#a8742f38a08ee3f821802b52cc1101a4f" title="Read the specified format.">MultiFormatReader::ReadStream</a>(std::istream &amp; inf, <a class="code" href="classMultiFormatReader_a81e7bd3fb7ed488d7d443d3d75b8e6b4.html#a81e7bd3fb7ed488d7d443d3d75b8e6b4" title="enumeration of all of the formats supported by MultiFormatReader">DataFormatType</a> format, <span class="keyword">const</span> <span class="keywordtype">char</span> * filepath)
<a name="l01047"></a>01047     {
<a name="l01048"></a>01048     <span class="keywordflow">if</span> (format == NEXUS_FORMAT)
<a name="l01049"></a>01049         {
<a name="l01050"></a>01050         <a class="code" href="classNxsReader_a15930392fe0fa5416057b8adced38f79.html#a15930392fe0fa5416057b8adced38f79" title="Reads the istream `inf` by creating a NxsToken object and then calling NxsReader::Execute()...">NxsReader::ReadFilestream</a>(inf);
<a name="l01051"></a>01051         }
<a name="l01052"></a>01052     <span class="keywordflow">else</span>
<a name="l01053"></a>01053         {
<a name="l01054"></a>01054         <span class="keywordflow">if</span> (format == FASTA_DNA_FORMAT)
<a name="l01055"></a>01055             <a class="code" href="classMultiFormatReader_ab7f85d2c6de5a06b3981e13d52a91173.html#ab7f85d2c6de5a06b3981e13d52a91173" title="A convenience function for reading FASTA files.">readFastaFile</a>(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca0145b9755a4581acaabe1e4c458d7f73" title="indicates `matrix&amp;#39; holds characters with arbitrarily-assigned, discrete states...">NxsCharactersBlock::dna</a>);
<a name="l01056"></a>01056         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == FASTA_RNA_FORMAT)
<a name="l01057"></a>01057             <a class="code" href="classMultiFormatReader_ab7f85d2c6de5a06b3981e13d52a91173.html#ab7f85d2c6de5a06b3981e13d52a91173" title="A convenience function for reading FASTA files.">readFastaFile</a>(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca9cb7e8ceb8521a96df0b81ecac913814" title="indicates `matrix&amp;#39; holds DNA sequences (states A, C, G, T)">NxsCharactersBlock::rna</a>);
<a name="l01058"></a>01058         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == FASTA_AA_FORMAT)
<a name="l01059"></a>01059             <a class="code" href="classMultiFormatReader_ab7f85d2c6de5a06b3981e13d52a91173.html#ab7f85d2c6de5a06b3981e13d52a91173" title="A convenience function for reading FASTA files.">readFastaFile</a>(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca6867b9b05a5ce824179b5bdf10c891fc" title="indicates `matrix&amp;#39; holds nucleotide sequences">NxsCharactersBlock::protein</a>);
<a name="l01060"></a>01060         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == PHYLIP_DNA_FORMAT)
<a name="l01061"></a>01061             readPhylipFile(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca0145b9755a4581acaabe1e4c458d7f73" title="indicates `matrix&amp;#39; holds characters with arbitrarily-assigned, discrete states...">NxsCharactersBlock::dna</a>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l01062"></a>01062         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == PHYLIP_RNA_FORMAT)
<a name="l01063"></a>01063             readPhylipFile(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca9cb7e8ceb8521a96df0b81ecac913814" title="indicates `matrix&amp;#39; holds DNA sequences (states A, C, G, T)">NxsCharactersBlock::rna</a>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l01064"></a>01064         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == PHYLIP_AA_FORMAT)
<a name="l01065"></a>01065             readPhylipFile(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca6867b9b05a5ce824179b5bdf10c891fc" title="indicates `matrix&amp;#39; holds nucleotide sequences">NxsCharactersBlock::protein</a>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l01066"></a>01066         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == PHYLIP_DISC_FORMAT)
<a name="l01067"></a>01067             readPhylipFile(inf, NxsCharactersBlock::standard, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l01068"></a>01068         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == INTERLEAVED_PHYLIP_DNA_FORMAT)
<a name="l01069"></a>01069             readPhylipFile(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca0145b9755a4581acaabe1e4c458d7f73" title="indicates `matrix&amp;#39; holds characters with arbitrarily-assigned, discrete states...">NxsCharactersBlock::dna</a>, <span class="keyword">false</span>, <span class="keyword">true</span>);
<a name="l01070"></a>01070         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == INTERLEAVED_PHYLIP_RNA_FORMAT)
<a name="l01071"></a>01071             readPhylipFile(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca9cb7e8ceb8521a96df0b81ecac913814" title="indicates `matrix&amp;#39; holds DNA sequences (states A, C, G, T)">NxsCharactersBlock::rna</a>, <span class="keyword">false</span>, <span class="keyword">true</span>);
<a name="l01072"></a>01072         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == INTERLEAVED_PHYLIP_AA_FORMAT)
<a name="l01073"></a>01073             readPhylipFile(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca6867b9b05a5ce824179b5bdf10c891fc" title="indicates `matrix&amp;#39; holds nucleotide sequences">NxsCharactersBlock::protein</a>, <span class="keyword">false</span>, <span class="keyword">true</span>);
<a name="l01074"></a>01074         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == INTERLEAVED_PHYLIP_DISC_FORMAT)
<a name="l01075"></a>01075             readPhylipFile(inf, NxsCharactersBlock::standard, <span class="keyword">false</span>, <span class="keyword">true</span>);
<a name="l01076"></a>01076         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == RELAXED_PHYLIP_DNA_FORMAT)
<a name="l01077"></a>01077             readPhylipFile(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca0145b9755a4581acaabe1e4c458d7f73" title="indicates `matrix&amp;#39; holds characters with arbitrarily-assigned, discrete states...">NxsCharactersBlock::dna</a>, <span class="keyword">true</span>, <span class="keyword">false</span>);
<a name="l01078"></a>01078         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == RELAXED_PHYLIP_RNA_FORMAT)
<a name="l01079"></a>01079             readPhylipFile(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca9cb7e8ceb8521a96df0b81ecac913814" title="indicates `matrix&amp;#39; holds DNA sequences (states A, C, G, T)">NxsCharactersBlock::rna</a>, <span class="keyword">true</span>, <span class="keyword">false</span>);
<a name="l01080"></a>01080         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == RELAXED_PHYLIP_AA_FORMAT)
<a name="l01081"></a>01081             readPhylipFile(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca6867b9b05a5ce824179b5bdf10c891fc" title="indicates `matrix&amp;#39; holds nucleotide sequences">NxsCharactersBlock::protein</a>, <span class="keyword">true</span>, <span class="keyword">false</span>);
<a name="l01082"></a>01082         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == RELAXED_PHYLIP_DISC_FORMAT)
<a name="l01083"></a>01083             readPhylipFile(inf, NxsCharactersBlock::standard, <span class="keyword">true</span>, <span class="keyword">false</span>);
<a name="l01084"></a>01084         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == INTERLEAVED_RELAXED_PHYLIP_DNA_FORMAT)
<a name="l01085"></a>01085             readPhylipFile(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca0145b9755a4581acaabe1e4c458d7f73" title="indicates `matrix&amp;#39; holds characters with arbitrarily-assigned, discrete states...">NxsCharactersBlock::dna</a>, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l01086"></a>01086         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == INTERLEAVED_RELAXED_PHYLIP_RNA_FORMAT)
<a name="l01087"></a>01087             readPhylipFile(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca9cb7e8ceb8521a96df0b81ecac913814" title="indicates `matrix&amp;#39; holds DNA sequences (states A, C, G, T)">NxsCharactersBlock::rna</a>, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l01088"></a>01088         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == INTERLEAVED_RELAXED_PHYLIP_AA_FORMAT)
<a name="l01089"></a>01089             readPhylipFile(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca6867b9b05a5ce824179b5bdf10c891fc" title="indicates `matrix&amp;#39; holds nucleotide sequences">NxsCharactersBlock::protein</a>, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l01090"></a>01090         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == INTERLEAVED_RELAXED_PHYLIP_DISC_FORMAT)
<a name="l01091"></a>01091             readPhylipFile(inf, NxsCharactersBlock::standard, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l01092"></a>01092         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == ALN_DNA_FORMAT)
<a name="l01093"></a>01093             readAlnFile(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca0145b9755a4581acaabe1e4c458d7f73" title="indicates `matrix&amp;#39; holds characters with arbitrarily-assigned, discrete states...">NxsCharactersBlock::dna</a>);
<a name="l01094"></a>01094         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == ALN_RNA_FORMAT)
<a name="l01095"></a>01095             readAlnFile(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca9cb7e8ceb8521a96df0b81ecac913814" title="indicates `matrix&amp;#39; holds DNA sequences (states A, C, G, T)">NxsCharactersBlock::rna</a>);
<a name="l01096"></a>01096         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == ALN_AA_FORMAT)
<a name="l01097"></a>01097             readAlnFile(inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290ca6867b9b05a5ce824179b5bdf10c891fc" title="indicates `matrix&amp;#39; holds nucleotide sequences">NxsCharactersBlock::protein</a>);
<a name="l01098"></a>01098         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == RELAXED_PHYLIP_TREE_FORMAT)
<a name="l01099"></a>01099             readPhylipTreeFile(inf, <span class="keyword">true</span>);
<a name="l01100"></a>01100         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == PHYLIP_TREE_FORMAT)
<a name="l01101"></a>01101             readPhylipTreeFile(inf, <span class="keyword">false</span>);
<a name="l01102"></a>01102         <span class="keywordflow">else</span>
<a name="l01103"></a>01103             {
<a name="l01104"></a>01104             <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> m;
<a name="l01105"></a>01105             <span class="keywordflow">if</span> (filepath)
<a name="l01106"></a>01106                 m &lt;&lt; <span class="stringliteral">&quot;The file &quot;</span> &lt;&lt; filepath &lt;&lt; <span class="stringliteral">&quot; is not in a supported format.&quot;</span>;
<a name="l01107"></a>01107             <span class="keywordflow">else</span>
<a name="l01108"></a>01108                 m &lt;&lt; <span class="stringliteral">&quot;Unsupported format.&quot;</span>;
<a name="l01109"></a>01109             <a class="code" href="classExceptionRaisingNxsReader_ab6ee7b74f4ff72b934778d835d41854f.html#ab6ee7b74f4ff72b934778d835d41854f" title="Raise a NxsException.">NexusError</a>(m, 0, -1, -1);
<a name="l01110"></a>01110             <span class="keywordflow">return</span>;
<a name="l01111"></a>01111             }
<a name="l01112"></a>01112         <a class="code" href="classPublicNexusReader_a7c6f0491f255c5652918de1f3521e063.html#a7c6f0491f255c5652918de1f3521e063" title="Called after successful execute.">PostExecuteHook</a>();
<a name="l01113"></a>01113         }
<a name="l01114"></a>01114     }
<a name="l01115"></a>01115 <span class="comment">// More tolerant than strict PHYLIP (tolerates any amount of whitespace before or</span>
<a name="l01116"></a>01116 <span class="comment">// between ntax and nchar.</span>
<a name="l01117"></a>01117 <span class="comment">// throws a NxsException if the header cannot be read.</span>
<a name="l01118"></a>01118 <span class="comment">// returns the file position.</span>
<a name="l01119"></a>01119 <span class="keywordtype">unsigned</span> MultiFormatReader::readPhylipHeader(std::istream &amp; inf, <span class="keywordtype">unsigned</span> &amp; ntax, <span class="keywordtype">unsigned</span> &amp; nchar)
<a name="l01120"></a>01120     {
<a name="l01121"></a>01121     <span class="keywordflow">if</span> (inf.good())
<a name="l01122"></a>01122         inf &gt;&gt; ntax;
<a name="l01123"></a>01123     <span class="keywordflow">if</span> (inf.good())
<a name="l01124"></a>01124         inf &gt;&gt; nchar;
<a name="l01125"></a>01125     <span class="keywordflow">if</span> (!inf.good() || ntax == 0 || nchar == 0)
<a name="l01126"></a>01126         {
<a name="l01127"></a>01127         <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> err(<span class="stringliteral">&quot;Expecting the file to start with the number of taxa then the number of characters.&quot;</span>);
<a name="l01128"></a>01128         <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, 0, -1, -1);
<a name="l01129"></a>01129         }
<a name="l01130"></a>01130     <span class="keywordflow">return</span> (<span class="keywordtype">unsigned</span>) inf.tellg();
<a name="l01131"></a>01131     }
<a name="l01132"></a>01132 
<a name="l01133"></a>01133 <span class="keywordtype">void</span> MultiFormatReader::readPhylipTreeFile(std::istream &amp; inf, <span class="keywordtype">bool</span> relaxedNames)
<a name="l01134"></a>01134     {
<a name="l01135"></a>01135     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> blockID(<span class="stringliteral">&quot;TREES&quot;</span>);
<a name="l01136"></a>01136     <a class="code" href="classNxsBlock.html" title="This is the base class from which all block classes are derived.">NxsBlock</a> *nb = cloneFactory.<a class="code" href="classNxsCloneBlockFactory_ac2d70ff7ea662c0b5b7546083734386e.html#ac2d70ff7ea662c0b5b7546083734386e">GetBlockReaderForID</a>(blockID, <span class="keyword">this</span>, NULL);
<a name="l01137"></a>01137     NCL_ASSERT(nb);
<a name="l01138"></a>01138     <span class="keywordflow">if</span> (!nb)
<a name="l01139"></a>01139         <span class="keywordflow">return</span>;
<a name="l01140"></a>01140     nb-&gt;<a class="code" href="classNxsBlock_ade0e632784669a14df73fa0dc927d6b2.html#ade0e632784669a14df73fa0dc927d6b2" title="Sets the nexusReader data member of the NxsBlock object to &amp;#39;nxsptr&amp;#39;.">SetNexus</a>(<span class="keyword">this</span>);
<a name="l01141"></a>01141 
<a name="l01142"></a>01142     <span class="comment">/* this should be safe because we know that the PublicNexusReader has a</span>
<a name="l01143"></a>01143 <span class="comment">        NxsTreesBlock assigned to &quot;TREES&quot; -- unless the caller has replaced that</span>
<a name="l01144"></a>01144 <span class="comment">        clone template (gulp)</span>
<a name="l01145"></a>01145 <span class="comment">    */</span>
<a name="l01146"></a>01146     <a class="code" href="classNxsTreesBlock.html" title="This class handles reading and storage for the NEXUS block TREES.">NxsTreesBlock</a> * treesB = <span class="keyword">static_cast&lt;</span><a class="code" href="classNxsTreesBlock.html" title="This class handles reading and storage for the NEXUS block TREES.">NxsTreesBlock</a> *<span class="keyword">&gt;</span>(nb);
<a name="l01147"></a>01147     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> err;
<a name="l01148"></a>01148     <span class="keywordflow">try</span> {
<a name="l01149"></a>01149         treesB-&gt;<a class="code" href="classNxsTreesBlock_aebea09e1b7b01331ee2f89beee2ece46.html#aebea09e1b7b01331ee2f89beee2ece46" title="Flushes `treeName&amp;#39;, `treeDescription&amp;#39;, `translateList&amp;#39; and `rooted&amp;#39;...">Reset</a>();
<a name="l01150"></a>01150         <a class="code" href="classNxsToken.html">NxsToken</a> inTokens(inf);
<a name="l01151"></a>01151         treesB-&gt;ReadPhylipTreeFile(inTokens);
<a name="l01152"></a>01152         <span class="keywordflow">if</span> (!relaxedNames)
<a name="l01153"></a>01153             {
<a name="l01154"></a>01154             <span class="keyword">const</span> <a class="code" href="classNxsTaxaBlockAPI.html" title="This abstract class describes the interface that every block that wants to serve...">NxsTaxaBlockAPI</a> * taxa = treesB-&gt;GetTaxaBlockPtr(0L);
<a name="l01155"></a>01155             <span class="keywordflow">if</span> (!taxa)
<a name="l01156"></a>01156                 {
<a name="l01157"></a>01157                 err &lt;&lt; <span class="stringliteral">&quot;No taxa found in tree description (which probably means that no tree was found).&quot;</span>;
<a name="l01158"></a>01158                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err, inTokens);
<a name="l01159"></a>01159                 }
<a name="l01160"></a>01160             <span class="keyword">const</span> std::vector&lt;std::string&gt; l = taxa-&gt;<a class="code" href="classNxsTaxaBlockAPI_aaf998f694825a2b7b278b759fcc5ba9f.html#aaf998f694825a2b7b278b759fcc5ba9f">GetAllLabels</a>();
<a name="l01161"></a>01161             <span class="keywordflow">for</span> (std::vector&lt;std::string&gt;::const_iterator lIt = l.begin(); lIt != l.end(); ++lIt)
<a name="l01162"></a>01162                 {
<a name="l01163"></a>01163                 <span class="keywordflow">if</span> (lIt-&gt;length() &gt; PHYLIP_NMLNGTH)
<a name="l01164"></a>01164                     {
<a name="l01165"></a>01165                     err &lt;&lt; <span class="stringliteral">&quot;The taxon label &quot;</span> &lt;&lt; *lIt &lt;&lt; <span class="stringliteral">&quot; has more than the allowed number of charcters (&quot;</span> &lt;&lt; PHYLIP_NMLNGTH &lt;&lt; <span class="charliteral">&#39;)&#39;</span>;
<a name="l01166"></a>01166                     <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(err);
<a name="l01167"></a>01167                     }
<a name="l01168"></a>01168                 }
<a name="l01169"></a>01169             }
<a name="l01170"></a>01170         <a class="code" href="classNxsReader_a48e3c3da053fff92e3e2ffcb1f6635f6.html#a48e3c3da053fff92e3e2ffcb1f6635f6" title="Called by NxsReader::ExecuteBlock() to store the block and its implied blocks NxsReader::ExecuteBloc...">BlockReadHook</a>(blockID, treesB);
<a name="l01171"></a>01171         }
<a name="l01172"></a>01172     <span class="keywordflow">catch</span> (...)
<a name="l01173"></a>01173         {
<a name="l01174"></a>01174         cloneFactory.<a class="code" href="classNxsBlockFactory_aac803d1280d8e4ea15b3335d9c253ba0.html#aac803d1280d8e4ea15b3335d9c253ba0" title="base-class implementation deletes the block (the NxsReader will not retain a reference...">BlockError</a>(nb);
<a name="l01175"></a>01175         <span class="keywordflow">throw</span>;
<a name="l01176"></a>01176         }
<a name="l01177"></a>01177     }
<a name="l01178"></a>01178 
<a name="l01179"></a>01179 <span class="comment">/* if this returns NULL, then the read failed and gLogMessage will contain</span>
<a name="l01180"></a>01180 <span class="comment">    and error message.</span>
<a name="l01181"></a>01181 <span class="comment">*/</span>
<a name="l01182"></a>01182 <span class="keywordtype">void</span> MultiFormatReader::readAlnFile(std::istream &amp; inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290c" title="values used to represent different basic types of data stored in a CHARACTERS block...">NxsCharactersBlock::DataTypesEnum</a> dt)
<a name="l01183"></a>01183     {
<a name="l01184"></a>01184     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> blockID(<span class="stringliteral">&quot;DATA&quot;</span>);
<a name="l01185"></a>01185     <a class="code" href="classNxsBlock.html" title="This is the base class from which all block classes are derived.">NxsBlock</a> *nb = cloneFactory.<a class="code" href="classNxsCloneBlockFactory_ac2d70ff7ea662c0b5b7546083734386e.html#ac2d70ff7ea662c0b5b7546083734386e">GetBlockReaderForID</a>(blockID, <span class="keyword">this</span>, NULL);
<a name="l01186"></a>01186     NCL_ASSERT(nb);
<a name="l01187"></a>01187     <span class="keywordflow">if</span> (!nb)
<a name="l01188"></a>01188         <span class="keywordflow">return</span>;
<a name="l01189"></a>01189     nb-&gt;<a class="code" href="classNxsBlock_ade0e632784669a14df73fa0dc927d6b2.html#ade0e632784669a14df73fa0dc927d6b2" title="Sets the nexusReader data member of the NxsBlock object to &amp;#39;nxsptr&amp;#39;.">SetNexus</a>(<span class="keyword">this</span>);
<a name="l01190"></a>01190     <span class="comment">/* this should be safe because we know that the PublicNexusReader has a</span>
<a name="l01191"></a>01191 <span class="comment">        DataBlock assigned to &quot;DATA&quot; -- unless the caller has replaced that</span>
<a name="l01192"></a>01192 <span class="comment">        clone template (gulp)</span>
<a name="l01193"></a>01193 <span class="comment">    */</span>
<a name="l01194"></a>01194     <a class="code" href="classNxsDataBlock.html" title="This class handles reading and storage for the NEXUS block DATA.">NxsDataBlock</a> * dataB = <span class="keyword">static_cast&lt;</span><a class="code" href="classNxsDataBlock.html" title="This class handles reading and storage for the NEXUS block DATA.">NxsDataBlock</a> *<span class="keyword">&gt;</span>(nb);
<a name="l01195"></a>01195 
<a name="l01196"></a>01196     <span class="keywordflow">try</span> {
<a name="l01197"></a>01197         dataB-&gt;<a class="code" href="classNxsDataBlock_afbb0d98c0a459bb77b318c314c80dff1.html#afbb0d98c0a459bb77b318c314c80dff1" title="Calls Reset function of the parent class (NxsCharactersBlock) and resets `newtaxa&amp;#39;...">Reset</a>();
<a name="l01198"></a>01198         dataB-&gt;datatype = dt;
<a name="l01199"></a>01199         dataB-&gt;<a class="code" href="classNxsCharactersBlock_a60329b2e678a91ca6cd46957093e6f56.html#a60329b2e678a91ca6cd46957093e6f56" title="Resets standard symbol set after a change in `datatype&amp;#39; is made.">ResetSymbols</a>();
<a name="l01200"></a>01200         dataB-&gt;gap = <span class="charliteral">&#39;-&#39;</span>;
<a name="l01201"></a>01201         NxsPartition dtParts;
<a name="l01202"></a>01202         std::vector&lt;NxsCharactersBlock::DataTypesEnum&gt; dtv;
<a name="l01203"></a>01203         dataB-&gt;CreateDatatypeMapperObjects(dtParts, dtv);
<a name="l01204"></a>01204 
<a name="l01205"></a>01205         <span class="keyword">const</span> <a class="code" href="classNxsDiscreteDatatypeMapper.html" title="This class stores the information needed to map the internal storage for a cell of...">NxsDiscreteDatatypeMapper</a> * dm = dataB-&gt;GetDatatypeMapperForChar(0);
<a name="l01206"></a>01206         NCL_ASSERT(dm);
<a name="l01207"></a>01207         FileToCharBuffer ftcb(inf);
<a name="l01208"></a>01208         <span class="keywordflow">if</span> (ftcb.buffer)
<a name="l01209"></a>01209             {
<a name="l01210"></a>01210             std::list&lt;std::string&gt; taxaNames;
<a name="l01211"></a>01211             std::list&lt;NxsDiscreteStateRow&gt; matList;
<a name="l01212"></a>01212             <span class="keywordflow">if</span> (!readAlnData(ftcb, *dm, taxaNames, matList))
<a name="l01213"></a>01213                 <span class="keywordflow">throw</span> <a class="code" href="classNxsException.html" title="Exception class that conveys a message specific to the problem encountered.">NxsException</a>(<span class="stringliteral">&quot;Expecting the same number of characters for all sequences in the ALN file&quot;</span>);
<a name="l01214"></a>01214             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> nchar = matList.begin()-&gt;size();
<a name="l01215"></a>01215             moveDataToDataBlock(taxaNames, matList, nchar, dataB);
<a name="l01216"></a>01216             <a class="code" href="classNxsReader_a48e3c3da053fff92e3e2ffcb1f6635f6.html#a48e3c3da053fff92e3e2ffcb1f6635f6" title="Called by NxsReader::ExecuteBlock() to store the block and its implied blocks NxsReader::ExecuteBloc...">BlockReadHook</a>(blockID, dataB);
<a name="l01217"></a>01217             }
<a name="l01218"></a>01218         }
<a name="l01219"></a>01219     <span class="keywordflow">catch</span> (...)
<a name="l01220"></a>01220         {
<a name="l01221"></a>01221         cloneFactory.<a class="code" href="classNxsBlockFactory_aac803d1280d8e4ea15b3335d9c253ba0.html#aac803d1280d8e4ea15b3335d9c253ba0" title="base-class implementation deletes the block (the NxsReader will not retain a reference...">BlockError</a>(nb);
<a name="l01222"></a>01222         <span class="keywordflow">throw</span>;
<a name="l01223"></a>01223         }
<a name="l01224"></a>01224 }
<a name="l01225"></a>01225 
<a name="l01226"></a>01226 <span class="comment">/* if this returns NULL, then the read failed and gLogMessage will contain</span>
<a name="l01227"></a>01227 <span class="comment">    and error message.</span>
<a name="l01228"></a>01228 <span class="comment">*/</span>
<a name="l01229"></a>01229 <span class="keywordtype">void</span> MultiFormatReader::readPhylipFile(std::istream &amp; inf, <a class="code" href="classNxsCharactersBlock_ad81b69dd477d09c9c8d37b958819290c.html#ad81b69dd477d09c9c8d37b958819290c" title="values used to represent different basic types of data stored in a CHARACTERS block...">NxsCharactersBlock::DataTypesEnum</a> dt, <span class="keywordtype">bool</span> relaxedNames, <span class="keywordtype">bool</span> interleaved)
<a name="l01230"></a>01230     {
<a name="l01231"></a>01231     <a class="code" href="classNxsString.html" title="A string class for use with the Nexus Class Library.">NxsString</a> blockID(<span class="stringliteral">&quot;DATA&quot;</span>);
<a name="l01232"></a>01232     <a class="code" href="classNxsBlock.html" title="This is the base class from which all block classes are derived.">NxsBlock</a> *nb = cloneFactory.<a class="code" href="classNxsCloneBlockFactory_ac2d70ff7ea662c0b5b7546083734386e.html#ac2d70ff7ea662c0b5b7546083734386e">GetBlockReaderForID</a>(blockID, <span class="keyword">this</span>, NULL);
<a name="l01233"></a>01233     NCL_ASSERT(nb);
<a name="l01234"></a>01234     <span class="keywordflow">if</span> (!nb)
<a name="l01235"></a>01235         <span class="keywordflow">return</span>;
<a name="l01236"></a>01236     nb-&gt;<a class="code" href="classNxsBlock_ade0e632784669a14df73fa0dc927d6b2.html#ade0e632784669a14df73fa0dc927d6b2" title="Sets the nexusReader data member of the NxsBlock object to &amp;#39;nxsptr&amp;#39;.">SetNexus</a>(<span class="keyword">this</span>);
<a name="l01237"></a>01237     <span class="comment">/* this should be safe because we know that the PublicNexusReader has a</span>
<a name="l01238"></a>01238 <span class="comment">        DataBlock assigned to &quot;DATA&quot; -- unless the caller has replaced that</span>
<a name="l01239"></a>01239 <span class="comment">        clone template (gulp)</span>
<a name="l01240"></a>01240 <span class="comment">    */</span>
<a name="l01241"></a>01241     <a class="code" href="classNxsDataBlock.html" title="This class handles reading and storage for the NEXUS block DATA.">NxsDataBlock</a> * dataB = <span class="keyword">static_cast&lt;</span><a class="code" href="classNxsDataBlock.html" title="This class handles reading and storage for the NEXUS block DATA.">NxsDataBlock</a> *<span class="keyword">&gt;</span>(nb);
<a name="l01242"></a>01242 
<a name="l01243"></a>01243     <span class="keywordflow">try</span> {
<a name="l01244"></a>01244         dataB-&gt;<a class="code" href="classNxsDataBlock_afbb0d98c0a459bb77b318c314c80dff1.html#afbb0d98c0a459bb77b318c314c80dff1" title="Calls Reset function of the parent class (NxsCharactersBlock) and resets `newtaxa&amp;#39;...">Reset</a>();
<a name="l01245"></a>01245         dataB-&gt;datatype = dt;
<a name="l01246"></a>01246         dataB-&gt;<a class="code" href="classNxsCharactersBlock_a60329b2e678a91ca6cd46957093e6f56.html#a60329b2e678a91ca6cd46957093e6f56" title="Resets standard symbol set after a change in `datatype&amp;#39; is made.">ResetSymbols</a>();
<a name="l01247"></a>01247         dataB-&gt;gap = <span class="charliteral">&#39;-&#39;</span>;
<a name="l01248"></a>01248         NxsPartition dtParts;
<a name="l01249"></a>01249         std::vector&lt;NxsCharactersBlock::DataTypesEnum&gt; dtv;
<a name="l01250"></a>01250         dataB-&gt;CreateDatatypeMapperObjects(dtParts, dtv);
<a name="l01251"></a>01251 
<a name="l01252"></a>01252         <span class="keyword">const</span> <a class="code" href="classNxsDiscreteDatatypeMapper.html" title="This class stores the information needed to map the internal storage for a cell of...">NxsDiscreteDatatypeMapper</a> * dm = dataB-&gt;GetDatatypeMapperForChar(0);
<a name="l01253"></a>01253         NCL_ASSERT(dm);
<a name="l01254"></a>01254         <span class="keywordtype">unsigned</span> ntax, nchar;
<a name="l01255"></a>01255         <span class="keywordtype">unsigned</span> headerLen = readPhylipHeader(inf, ntax, nchar);
<a name="l01256"></a>01256         FileToCharBuffer ftcb(inf);
<a name="l01257"></a>01257         ftcb.totalSize += headerLen;
<a name="l01258"></a>01258         <span class="keywordflow">if</span> (ftcb.buffer)
<a name="l01259"></a>01259             {
<a name="l01260"></a>01260             std::list&lt;std::string&gt; taxaNames;
<a name="l01261"></a>01261             std::list&lt;NxsDiscreteStateRow&gt; matList;
<a name="l01262"></a>01262             <span class="keywordflow">if</span> (interleaved)
<a name="l01263"></a>01263                 readInterleavedPhylipData(ftcb, *dm, taxaNames, matList, ntax, nchar, relaxedNames);
<a name="l01264"></a>01264             <span class="keywordflow">else</span>
<a name="l01265"></a>01265                 readPhylipData(ftcb, *dm, taxaNames, matList, ntax, nchar, relaxedNames);
<a name="l01266"></a>01266             moveDataToDataBlock(taxaNames, matList, nchar, dataB);
<a name="l01267"></a>01267             <a class="code" href="classNxsReader_a48e3c3da053fff92e3e2ffcb1f6635f6.html#a48e3c3da053fff92e3e2ffcb1f6635f6" title="Called by NxsReader::ExecuteBlock() to store the block and its implied blocks NxsReader::ExecuteBloc...">BlockReadHook</a>(blockID, dataB);
<a name="l01268"></a>01268             }
<a name="l01269"></a>01269         }
<a name="l01270"></a>01270     <span class="keywordflow">catch</span> (...)
<a name="l01271"></a>01271         {
<a name="l01272"></a>01272         cloneFactory.<a class="code" href="classNxsBlockFactory_aac803d1280d8e4ea15b3335d9c253ba0.html#aac803d1280d8e4ea15b3335d9c253ba0" title="base-class implementation deletes the block (the NxsReader will not retain a reference...">BlockError</a>(nb);
<a name="l01273"></a>01273         <span class="keywordflow">throw</span>;
<a name="l01274"></a>01274         }
<a name="l01275"></a>01275 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Sat Mar 27 13:49:19 2010 for NCL by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
